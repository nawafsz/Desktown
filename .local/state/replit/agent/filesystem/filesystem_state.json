{"file_contents":{"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/pages/AccessControl.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { UserAvatar } from \"@/components/UserAvatar\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Search, Shield, UserPlus, Edit } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { User } from \"@shared/schema\";\n\nfunction getEffectiveStatus(user: User): \"online\" | \"away\" | \"offline\" | \"busy\" {\n  const INACTIVE_THRESHOLD = 5 * 60 * 1000; // 5 minutes\n  \n  if (user.status === \"online\" && user.lastSeenAt) {\n    const lastSeen = new Date(user.lastSeenAt).getTime();\n    const now = Date.now();\n    if (now - lastSeen > INACTIVE_THRESHOLD) {\n      return \"offline\";\n    }\n  }\n  \n  return (user.status as \"online\" | \"away\" | \"offline\" | \"busy\") || \"offline\";\n}\n\nconst permissions = [\n  { id: \"tasks\", label: \"Task Management\", description: \"Create, edit, and assign tasks\" },\n  { id: \"tickets\", label: \"Support Tickets\", description: \"Manage support tickets\" },\n  { id: \"social\", label: \"Social Feed\", description: \"Post and moderate content\" },\n  { id: \"meetings\", label: \"Meeting Scheduler\", description: \"Schedule and manage meetings\" },\n  { id: \"jobs\", label: \"Job Postings\", description: \"Create and publish job listings\" },\n  { id: \"finances\", label: \"Financial Review\", description: \"View and approve expenses\" },\n  { id: \"access\", label: \"Access Control\", description: \"Manage user roles and permissions\" },\n];\n\nconst rolePermissions: Record<string, string[]> = {\n  admin: permissions.map((p) => p.id),\n  manager: [\"tasks\", \"tickets\", \"social\", \"meetings\", \"finances\"],\n  member: [\"tasks\", \"social\", \"meetings\"],\n};\n\nexport default function AccessControl() {\n  const { toast } = useToast();\n  const [search, setSearch] = useState(\"\");\n  const [editingUser, setEditingUser] = useState<User | null>(null);\n  const [editPermissions, setEditPermissions] = useState<string[]>([]);\n  const [editRole, setEditRole] = useState(\"\");\n  const [inviteDialogOpen, setInviteDialogOpen] = useState(false);\n  const [inviteEmail, setInviteEmail] = useState(\"\");\n  const [inviteRole, setInviteRole] = useState(\"member\");\n\n  const { data: users = [], isLoading } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const updateUserMutation = useMutation({\n    mutationFn: async ({ userId, role }: { userId: string; role: string }) => {\n      return await apiRequest(\"PATCH\", `/api/users/${userId}`, { role });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      toast({ title: \"Changes saved\", description: \"User role has been updated.\" });\n      setEditingUser(null);\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to update user role.\", variant: \"destructive\" });\n    },\n  });\n\n  const filteredUsers = users.filter(\n    (user) =>\n      (`${user.firstName || ''} ${user.lastName || ''}`.toLowerCase().includes(search.toLowerCase())) ||\n      (user.role?.toLowerCase().includes(search.toLowerCase()) || false)\n  );\n\n  const handleEditUser = (user: User) => {\n    setEditingUser(user);\n    setEditRole(user.role || \"member\");\n    setEditPermissions(rolePermissions[user.role || \"member\"] || []);\n  };\n\n  const handleRoleChange = (newRole: string) => {\n    setEditRole(newRole);\n    setEditPermissions(rolePermissions[newRole] || []);\n  };\n\n  const handleSaveChanges = () => {\n    if (editingUser) {\n      updateUserMutation.mutate({ userId: editingUser.id, role: editRole });\n    }\n  };\n\n  const handleInvite = () => {\n    if (inviteEmail) {\n      toast({ title: \"Invitation sent\", description: `Invitation sent to ${inviteEmail}` });\n      setInviteEmail(\"\");\n      setInviteRole(\"member\");\n      setInviteDialogOpen(false);\n    }\n  };\n\n  const adminCount = users.filter((u) => u.role === \"admin\").length;\n  const managerCount = users.filter((u) => u.role === \"manager\").length;\n  const memberCount = users.filter((u) => u.role === \"member\" || !u.role).length;\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-3xl font-semibold\">Access Control</h1>\n          <p className=\"text-muted-foreground mt-1\">Manage roles and permissions</p>\n        </div>\n        <Dialog open={inviteDialogOpen} onOpenChange={setInviteDialogOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-invite-user\">\n              <UserPlus className=\"h-4 w-4 mr-1\" />\n              Invite User\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Invite New User</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4 py-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">Email Address</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"colleague@company.com\"\n                  value={inviteEmail}\n                  onChange={(e) => setInviteEmail(e.target.value)}\n                  data-testid=\"input-invite-email\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"role\">Role</Label>\n                <Select value={inviteRole} onValueChange={setInviteRole}>\n                  <SelectTrigger data-testid=\"select-invite-role\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"admin\">Admin</SelectItem>\n                    <SelectItem value=\"manager\">Manager</SelectItem>\n                    <SelectItem value=\"member\">Member</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            <DialogFooter>\n              <Button variant=\"outline\" onClick={() => setInviteDialogOpen(false)}>Cancel</Button>\n              <Button onClick={handleInvite} data-testid=\"button-send-invite\">Send Invite</Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <div className=\"lg:col-span-2 space-y-4\">\n          <div className=\"relative max-w-sm\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search users...\"\n              className=\"pl-9\"\n              value={search}\n              onChange={(e) => setSearch(e.target.value)}\n              data-testid=\"input-search-users\"\n            />\n          </div>\n\n          <Card>\n            <CardContent className=\"p-0\">\n              {isLoading ? (\n                Array(5).fill(0).map((_, i) => (\n                  <Skeleton key={i} className=\"h-16 w-full m-4\" />\n                ))\n              ) : filteredUsers.length > 0 ? (\n                filteredUsers.map((user, index) => {\n                  const displayName = `${user.firstName || ''} ${user.lastName || ''}`.trim() || user.email || 'Unknown';\n                  const effectiveStatus = getEffectiveStatus(user);\n                  return (\n                    <div\n                      key={user.id}\n                      className={`flex items-center gap-4 p-4 ${index !== filteredUsers.length - 1 ? \"border-b\" : \"\"}`}\n                    >\n                      <UserAvatar \n                        name={displayName} \n                        avatar={user.profileImageUrl} \n                        size=\"md\" \n                        status={effectiveStatus} \n                      />\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"font-medium\">{displayName}</p>\n                        <p className=\"text-sm text-muted-foreground\">{user.department || \"No department\"}</p>\n                      </div>\n                      <Badge variant=\"secondary\" className=\"capitalize\">{user.role || \"member\"}</Badge>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => handleEditUser(user)}\n                        data-testid={`button-edit-user-${user.id}`}\n                      >\n                        <Edit className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  );\n                })\n              ) : (\n                <div className=\"text-center py-12 text-muted-foreground\">\n                  {search ? \"No users match your search\" : \"No users yet\"}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Shield className=\"h-5 w-5\" />\n                Role Overview\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"font-medium\">Admin</span>\n                  <Badge>{adminCount}</Badge>\n                </div>\n                <p className=\"text-xs text-muted-foreground\">Full access to all features</p>\n              </div>\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"font-medium\">Manager</span>\n                  <Badge>{managerCount}</Badge>\n                </div>\n                <p className=\"text-xs text-muted-foreground\">Team management and approvals</p>\n              </div>\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"font-medium\">Member</span>\n                  <Badge>{memberCount}</Badge>\n                </div>\n                <p className=\"text-xs text-muted-foreground\">Basic access to tasks and social</p>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      <Dialog open={!!editingUser} onOpenChange={() => setEditingUser(null)}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Edit User Permissions</DialogTitle>\n          </DialogHeader>\n          {editingUser && (\n            <div className=\"space-y-6 py-4\">\n              <div className=\"flex items-center gap-4\">\n                <UserAvatar \n                  name={`${editingUser.firstName || ''} ${editingUser.lastName || ''}`.trim() || editingUser.email || 'Unknown'} \n                  avatar={editingUser.profileImageUrl}\n                  size=\"lg\" \n                />\n                <div>\n                  <p className=\"font-medium\">\n                    {`${editingUser.firstName || ''} ${editingUser.lastName || ''}`.trim() || editingUser.email}\n                  </p>\n                  <p className=\"text-sm text-muted-foreground\">{editingUser.department || \"No department\"}</p>\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label>Role</Label>\n                <Select value={editRole} onValueChange={handleRoleChange}>\n                  <SelectTrigger data-testid=\"select-user-role\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"admin\">Admin</SelectItem>\n                    <SelectItem value=\"manager\">Manager</SelectItem>\n                    <SelectItem value=\"member\">Member</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-3\">\n                <Label>Role Permissions</Label>\n                <p className=\"text-xs text-muted-foreground mb-2\">\n                  Permissions are determined by the assigned role\n                </p>\n                {permissions.map((permission) => (\n                  <div key={permission.id} className=\"flex items-center justify-between py-2\">\n                    <div>\n                      <p className=\"text-sm font-medium\">{permission.label}</p>\n                      <p className=\"text-xs text-muted-foreground\">{permission.description}</p>\n                    </div>\n                    <Switch\n                      checked={editPermissions.includes(permission.id)}\n                      disabled\n                      data-testid={`switch-permission-${permission.id}`}\n                    />\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n          <DialogFooter>\n            <Button \n              onClick={handleSaveChanges} \n              disabled={updateUserMutation.isPending}\n              data-testid=\"button-save-permissions\"\n            >\n              {updateUserMutation.isPending ? \"Saving...\" : \"Save Changes\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":13737,"size_tokens":null},"client/src/components/ChatThread.tsx":{"content":"import { UserAvatar } from \"./UserAvatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { cn } from \"@/lib/utils\";\n\ninterface ChatThreadItemProps {\n  id: string;\n  name: string;\n  lastMessage: string;\n  participants: Array<{ name: string; avatar?: string | null }>;\n  unread: number;\n  timestamp: string;\n  isActive?: boolean;\n  onClick?: () => void;\n}\n\nexport function ChatThreadItem({\n  id,\n  name,\n  lastMessage,\n  participants,\n  unread,\n  timestamp,\n  isActive,\n  onClick,\n}: ChatThreadItemProps) {\n  return (\n    <button\n      onClick={onClick}\n      className={cn(\n        \"w-full flex items-center gap-3 p-3 text-left rounded-md hover-elevate\",\n        isActive && \"bg-accent\"\n      )}\n      data-testid={`button-chat-thread-${id}`}\n    >\n      <div className=\"relative\">\n        <UserAvatar name={participants[0]?.name || name} size=\"md\" />\n        {participants.length > 1 && (\n          <span className=\"absolute -bottom-1 -right-1 flex items-center justify-center h-5 w-5 rounded-full bg-muted text-xs font-medium\">\n            +{participants.length - 1}\n          </span>\n        )}\n      </div>\n      <div className=\"flex-1 min-w-0\">\n        <div className=\"flex items-center justify-between gap-2\">\n          <span className={cn(\"font-medium truncate\", unread > 0 && \"text-foreground\")}>\n            {name}\n          </span>\n          <span className=\"text-xs text-muted-foreground whitespace-nowrap\">{timestamp}</span>\n        </div>\n        <div className=\"flex items-center justify-between gap-2 mt-0.5\">\n          <p className={cn(\n            \"text-sm truncate\",\n            unread > 0 ? \"text-foreground font-medium\" : \"text-muted-foreground\"\n          )}>\n            {lastMessage}\n          </p>\n          {unread > 0 && (\n            <Badge className=\"h-5 min-w-5 px-1.5 text-xs\">\n              {unread}\n            </Badge>\n          )}\n        </div>\n      </div>\n    </button>\n  );\n}\n","path":null,"size_bytes":1920,"size_tokens":null},"client/src/components/examples/AppSidebar.tsx":{"content":"import { AppSidebar } from \"../AppSidebar\";\nimport { SidebarProvider } from \"@/components/ui/sidebar\";\n\nexport default function AppSidebarExample() {\n  return (\n    <SidebarProvider>\n      <AppSidebar\n        user={{\n          name: \"Sarah Chen\",\n          email: \"sarah.chen@company.com\",\n          role: \"admin\",\n        }}\n      />\n    </SidebarProvider>\n  );\n}\n","path":null,"size_bytes":365,"size_tokens":null},"client/src/components/TransactionRow.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Check, X, ShoppingCart, Utensils, Monitor, FileText, Package } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\ninterface TransactionRowProps {\n  id: string;\n  description: string;\n  amount: number;\n  category: string;\n  date: string;\n  status: \"approved\" | \"pending\" | \"rejected\";\n  showApprovalActions?: boolean;\n  onApprove?: (id: string) => void;\n  onReject?: (id: string) => void;\n}\n\nconst categoryIcons: Record<string, React.ReactNode> = {\n  Software: <Monitor className=\"h-4 w-4\" />,\n  Meals: <Utensils className=\"h-4 w-4\" />,\n  Revenue: <FileText className=\"h-4 w-4\" />,\n  Supplies: <Package className=\"h-4 w-4\" />,\n  default: <ShoppingCart className=\"h-4 w-4\" />,\n};\n\nconst statusStyles = {\n  approved: \"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\",\n  pending: \"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400\",\n  rejected: \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\",\n};\n\nexport function TransactionRow({\n  id,\n  description,\n  amount,\n  category,\n  date,\n  status,\n  showApprovalActions = false,\n  onApprove,\n  onReject,\n}: TransactionRowProps) {\n  const { language } = useLanguage();\n  const t = translations[language];\n  const isPositive = amount > 0;\n  const icon = categoryIcons[category] || categoryIcons.default;\n\n  const getStatusLabel = (s: \"approved\" | \"pending\" | \"rejected\") => {\n    switch (s) {\n      case \"approved\":\n        return t.finances?.approved || \"Approved\";\n      case \"pending\":\n        return t.finances?.pending || \"Pending\";\n      case \"rejected\":\n        return t.finances?.rejected || \"Rejected\";\n      default:\n        return s;\n    }\n  };\n\n  return (\n    <div\n      className=\"flex items-center gap-4 p-4 border-b last:border-b-0 hover-elevate\"\n      data-testid={`row-transaction-${id}`}\n    >\n      <div className=\"p-2 rounded-md bg-muted\">{icon}</div>\n      <div className=\"flex-1 min-w-0\">\n        <p className=\"font-medium truncate\">{description}</p>\n        <div className=\"flex items-center gap-2 mt-0.5 flex-wrap\">\n          <span className=\"text-xs text-muted-foreground\">{category}</span>\n          <span className=\"text-xs text-muted-foreground\">{date}</span>\n        </div>\n      </div>\n      <div className=\"flex items-center gap-3\">\n        <Badge variant=\"secondary\" className={cn(\"text-xs\", statusStyles[status])}>\n          {getStatusLabel(status)}\n        </Badge>\n        <span\n          className={cn(\n            \"font-semibold tabular-nums\",\n            isPositive ? \"text-green-600 dark:text-green-400\" : \"text-foreground\"\n          )}\n        >\n          {isPositive ? \"+\" : \"\"}{amount.toLocaleString(language === 'ar' ? 'ar-SA' : 'en-US', { style: \"currency\", currency: \"USD\" })}\n        </span>\n        {showApprovalActions && status === \"pending\" && (\n          <div className=\"flex items-center gap-1\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"h-8 w-8 text-green-600\"\n              onClick={() => onApprove?.(id)}\n              data-testid={`button-approve-${id}`}\n            >\n              <Check className=\"h-4 w-4\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"h-8 w-8 text-red-600\"\n              onClick={() => onReject?.(id)}\n              data-testid={`button-reject-${id}`}\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":3666,"size_tokens":null},"client/src/hooks/useAuth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport type { User } from \"@shared/schema\";\nimport { getQueryFn } from \"@/lib/queryClient\";\n\nexport function useAuth() {\n  const { data: user, isLoading, error } = useQuery<User | null>({\n    queryKey: [\"/api/auth/user\"],\n    queryFn: getQueryFn<User | null>({ on401: \"returnNull\" }),\n    retry: false,\n    staleTime: 0,\n    gcTime: 0,\n  });\n\n  return {\n    user: user ?? undefined,\n    isLoading,\n    isAuthenticated: !!user && !error,\n    error,\n  };\n}\n","path":null,"size_bytes":505,"size_tokens":null},"client/src/components/examples/CreatePostComposer.tsx":{"content":"import { CreatePostComposer } from \"../CreatePostComposer\";\n\nexport default function CreatePostComposerExample() {\n  return (\n    <div className=\"max-w-xl\">\n      <CreatePostComposer\n        user={{ name: \"Sarah Chen\" }}\n        onPost={(content) => console.log(\"Posted:\", content)}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":310,"size_tokens":null},"server/objectStorage.ts":{"content":"import { Storage, File } from \"@google-cloud/storage\";\nimport { Response } from \"express\";\nimport { randomUUID } from \"crypto\";\nimport {\n  ObjectAclPolicy,\n  ObjectPermission,\n  canAccessObject,\n  getObjectAclPolicy,\n  setObjectAclPolicy,\n} from \"./objectAcl\";\n\nconst REPLIT_SIDECAR_ENDPOINT = \"http://127.0.0.1:1106\";\n\nexport const objectStorageClient = new Storage({\n  credentials: {\n    audience: \"replit\",\n    subject_token_type: \"access_token\",\n    token_url: `${REPLIT_SIDECAR_ENDPOINT}/token`,\n    type: \"external_account\",\n    credential_source: {\n      url: `${REPLIT_SIDECAR_ENDPOINT}/credential`,\n      format: {\n        type: \"json\",\n        subject_token_field_name: \"access_token\",\n      },\n    },\n    universe_domain: \"googleapis.com\",\n  },\n  projectId: \"\",\n});\n\nexport class ObjectNotFoundError extends Error {\n  constructor() {\n    super(\"Object not found\");\n    this.name = \"ObjectNotFoundError\";\n    Object.setPrototypeOf(this, ObjectNotFoundError.prototype);\n  }\n}\n\nexport class ObjectStorageService {\n  constructor() {}\n\n  getPublicObjectSearchPaths(): Array<string> {\n    const pathsStr = process.env.PUBLIC_OBJECT_SEARCH_PATHS || \"\";\n    const paths = Array.from(\n      new Set(\n        pathsStr\n          .split(\",\")\n          .map((path) => path.trim())\n          .filter((path) => path.length > 0)\n      )\n    );\n    if (paths.length === 0) {\n      throw new Error(\n        \"PUBLIC_OBJECT_SEARCH_PATHS not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PUBLIC_OBJECT_SEARCH_PATHS env var (comma-separated paths).\"\n      );\n    }\n    return paths;\n  }\n\n  getPrivateObjectDir(): string {\n    const dir = process.env.PRIVATE_OBJECT_DIR || \"\";\n    if (!dir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n    return dir;\n  }\n\n  async searchPublicObject(filePath: string): Promise<File | null> {\n    for (const searchPath of this.getPublicObjectSearchPaths()) {\n      const fullPath = `${searchPath}/${filePath}`;\n      const { bucketName, objectName } = parseObjectPath(fullPath);\n      const bucket = objectStorageClient.bucket(bucketName);\n      const file = bucket.file(objectName);\n      const [exists] = await file.exists();\n      if (exists) {\n        return file;\n      }\n    }\n    return null;\n  }\n\n  async downloadObject(file: File, res: Response, cacheTtlSec: number = 3600) {\n    try {\n      const [metadata] = await file.getMetadata();\n      const aclPolicy = await getObjectAclPolicy(file);\n      const isPublic = aclPolicy?.visibility === \"public\";\n      res.set({\n        \"Content-Type\": metadata.contentType || \"application/octet-stream\",\n        \"Content-Length\": metadata.size,\n        \"Cache-Control\": `${isPublic ? \"public\" : \"private\"}, max-age=${cacheTtlSec}`,\n      });\n      const stream = file.createReadStream();\n      stream.on(\"error\", (err) => {\n        console.error(\"Stream error:\", err);\n        if (!res.headersSent) {\n          res.status(500).json({ error: \"Error streaming file\" });\n        }\n      });\n      stream.pipe(res);\n    } catch (error) {\n      console.error(\"Error downloading file:\", error);\n      if (!res.headersSent) {\n        res.status(500).json({ error: \"Error downloading file\" });\n      }\n    }\n  }\n\n  async getObjectEntityUploadURL(fileExtension?: string): Promise<{ uploadURL: string; objectPath: string }> {\n    const privateObjectDir = this.getPrivateObjectDir();\n    if (!privateObjectDir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n    const objectId = randomUUID();\n    const extension = fileExtension ? `.${fileExtension}` : '';\n    const fullPath = `${privateObjectDir}/uploads/${objectId}${extension}`;\n    const { bucketName, objectName } = parseObjectPath(fullPath);\n    const uploadURL = await signObjectURL({\n      bucketName,\n      objectName,\n      method: \"PUT\",\n      ttlSec: 900,\n    });\n    return { uploadURL, objectPath: `/objects/uploads/${objectId}${extension}` };\n  }\n\n  async getObjectEntityFile(objectPath: string): Promise<File> {\n    if (!objectPath.startsWith(\"/objects/\")) {\n      throw new ObjectNotFoundError();\n    }\n    const parts = objectPath.slice(1).split(\"/\");\n    if (parts.length < 2) {\n      throw new ObjectNotFoundError();\n    }\n    const entityId = parts.slice(1).join(\"/\");\n    let entityDir = this.getPrivateObjectDir();\n    if (!entityDir.endsWith(\"/\")) {\n      entityDir = `${entityDir}/`;\n    }\n    const objectEntityPath = `${entityDir}${entityId}`;\n    const { bucketName, objectName } = parseObjectPath(objectEntityPath);\n    const bucket = objectStorageClient.bucket(bucketName);\n    const objectFile = bucket.file(objectName);\n    const [exists] = await objectFile.exists();\n    if (!exists) {\n      throw new ObjectNotFoundError();\n    }\n    return objectFile;\n  }\n\n  normalizeObjectEntityPath(rawPath: string): string {\n    if (!rawPath.startsWith(\"https://storage.googleapis.com/\")) {\n      return rawPath;\n    }\n    const url = new URL(rawPath);\n    const rawObjectPath = url.pathname;\n    let objectEntityDir = this.getPrivateObjectDir();\n    if (!objectEntityDir.endsWith(\"/\")) {\n      objectEntityDir = `${objectEntityDir}/`;\n    }\n    if (!rawObjectPath.startsWith(objectEntityDir)) {\n      return rawObjectPath;\n    }\n    const entityId = rawObjectPath.slice(objectEntityDir.length);\n    return `/objects/${entityId}`;\n  }\n\n  async trySetObjectEntityAclPolicy(\n    rawPath: string,\n    aclPolicy: ObjectAclPolicy\n  ): Promise<string> {\n    const normalizedPath = this.normalizeObjectEntityPath(rawPath);\n    if (!normalizedPath.startsWith(\"/\")) {\n      return normalizedPath;\n    }\n    const objectFile = await this.getObjectEntityFile(normalizedPath);\n    await setObjectAclPolicy(objectFile, aclPolicy);\n    return normalizedPath;\n  }\n\n  async canAccessObjectEntity({\n    userId,\n    objectFile,\n    requestedPermission,\n  }: {\n    userId?: string;\n    objectFile: File;\n    requestedPermission?: ObjectPermission;\n  }): Promise<boolean> {\n    return canAccessObject({\n      userId,\n      objectFile,\n      requestedPermission: requestedPermission ?? ObjectPermission.READ,\n    });\n  }\n}\n\nfunction parseObjectPath(path: string): {\n  bucketName: string;\n  objectName: string;\n} {\n  if (!path.startsWith(\"/\")) {\n    path = `/${path}`;\n  }\n  const pathParts = path.split(\"/\");\n  if (pathParts.length < 3) {\n    throw new Error(\"Invalid path: must contain at least a bucket name\");\n  }\n  const bucketName = pathParts[1];\n  const objectName = pathParts.slice(2).join(\"/\");\n  return { bucketName, objectName };\n}\n\nasync function signObjectURL({\n  bucketName,\n  objectName,\n  method,\n  ttlSec,\n}: {\n  bucketName: string;\n  objectName: string;\n  method: \"GET\" | \"PUT\" | \"DELETE\" | \"HEAD\";\n  ttlSec: number;\n}): Promise<string> {\n  const request = {\n    bucket_name: bucketName,\n    object_name: objectName,\n    method,\n    expires_at: new Date(Date.now() + ttlSec * 1000).toISOString(),\n  };\n  const response = await fetch(\n    `${REPLIT_SIDECAR_ENDPOINT}/object-storage/signed-object-url`,\n    {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(request),\n    }\n  );\n  if (!response.ok) {\n    throw new Error(\n      `Failed to sign object URL, errorcode: ${response.status}, ` +\n        `make sure you're running on Replit`\n    );\n  }\n  const { signed_url: signedURL } = await response.json();\n  return signedURL;\n}\n","path":null,"size_bytes":7580,"size_tokens":null},"client/src/components/examples/UserAvatar.tsx":{"content":"import { UserAvatar } from \"../UserAvatar\";\n\nexport default function UserAvatarExample() {\n  return (\n    <div className=\"flex items-center gap-4\">\n      <UserAvatar name=\"Sarah Chen\" size=\"sm\" status=\"online\" />\n      <UserAvatar name=\"James Wilson\" size=\"md\" status=\"away\" />\n      <UserAvatar name=\"Maria Garcia\" size=\"lg\" status=\"busy\" />\n      <UserAvatar name=\"David Kim\" size=\"md\" status=\"offline\" />\n    </div>\n  );\n}\n","path":null,"size_bytes":426,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { setupAuth, isAuthenticated } from \"./replitAuth\";\nimport {\n  ObjectStorageService,\n  ObjectNotFoundError,\n} from \"./objectStorage\";\nimport { ObjectPermission } from \"./objectAcl\";\nimport {\n  insertTaskSchema,\n  insertTicketSchema,\n  insertPostSchema,\n  insertPostCommentSchema,\n  insertChatThreadSchema,\n  insertMessageSchema,\n  insertMeetingSchema,\n  insertJobPostingSchema,\n  insertTransactionSchema,\n  insertRoleSchema,\n  updateUserSchema,\n  insertSubscriptionSchema,\n  insertAdvertisementSchema,\n  insertN8nSettingsSchema,\n  insertTaskAutomationSchema,\n  insertOfficeSchema,\n  insertOfficeServiceSchema,\n  insertServiceRatingSchema,\n  insertServiceCommentSchema,\n  insertOfficeMediaSchema,\n  insertOfficePostSchema,\n  insertOfficeMessageSchema,\n  insertVideoCallSchema,\n  insertStatusSchema,\n  insertStatusReplySchema,\n  insertInternalEmailSchema,\n  type InsertTask,\n} from \"@shared/schema\";\nimport { z } from \"zod\";\n\n// Video call validation schemas\nconst videoCallRequestSchema = z.object({\n  sessionId: z.string().min(10, \"Session ID must be at least 10 characters\"),\n  visitorName: z.string().max(100).nullable().optional(),\n});\n\nconst videoCallEndSchema = z.object({\n  sessionId: z.string().min(10, \"Session ID must be at least 10 characters\"),\n});\n\nconst roomIdSchema = z.string().regex(/^room_[a-f0-9]{32}$/, \"Invalid room ID format\");\n\n// Shared param schemas for authenticated routes\nconst officeIdParamSchema = z.coerce.number().int().positive(\"Office ID must be a positive integer\");\nconst callIdParamSchema = z.coerce.number().int().positive(\"Call ID must be a positive integer\");\n\n// Role-based access control middleware\ntype UserRole = \"member\" | \"manager\" | \"admin\";\n\nfunction requireRole(...allowedRoles: UserRole[]) {\n  return async (req: any, res: any, next: any) => {\n    try {\n      if (!req.user?.claims?.sub) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n      \n      const user = await storage.getUser(req.user.claims.sub);\n      const userRole = (user?.role || \"member\") as UserRole;\n      \n      if (!allowedRoles.includes(userRole)) {\n        return res.status(403).json({ \n          message: \"Access denied. Insufficient permissions.\",\n          required: allowedRoles,\n          current: userRole\n        });\n      }\n      \n      req.userRole = userRole;\n      next();\n    } catch (error) {\n      console.error(\"Role check error:\", error);\n      res.status(500).json({ message: \"Failed to verify permissions\" });\n    }\n  };\n}\n\nexport async function registerRoutes(httpServer: Server, app: Express): Promise<Server> {\n  // Auth middleware\n  await setupAuth(app);\n\n  // =====================\n  // Auth Routes\n  // =====================\n  app.get('/api/auth/user', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      res.json(user);\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  // Heartbeat endpoint to update user activity (lastSeenAt only, preserves manual status)\n  app.post('/api/auth/heartbeat', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      await storage.updateLastSeen(userId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error updating heartbeat:\", error);\n      res.status(500).json({ message: \"Failed to update heartbeat\" });\n    }\n  });\n\n  // =====================\n  // User Routes\n  // =====================\n  app.get('/api/users', isAuthenticated, async (req, res) => {\n    try {\n      const users = await storage.getAllUsers();\n      res.json(users);\n    } catch (error) {\n      console.error(\"Error fetching users:\", error);\n      res.status(500).json({ message: \"Failed to fetch users\" });\n    }\n  });\n\n  app.patch('/api/users/:id/status', isAuthenticated, async (req: any, res) => {\n    try {\n      const { status } = req.body;\n      const allowedStatuses = ['online', 'offline', 'away', 'busy'];\n      if (!status || !allowedStatuses.includes(status)) {\n        return res.status(400).json({ message: \"Invalid status. Must be one of: online, offline, away, busy\" });\n      }\n      const user = await storage.updateUserStatus(req.params.id, status);\n      res.json(user);\n    } catch (error) {\n      console.error(\"Error updating user status:\", error);\n      res.status(500).json({ message: \"Failed to update user status\" });\n    }\n  });\n\n  app.patch('/api/users/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const updateData = updateUserSchema.parse(req.body);\n      \n      if (Object.keys(updateData).length === 0) {\n        return res.status(400).json({ message: \"No valid fields to update\" });\n      }\n      \n      const user = await storage.updateUser(req.params.id, updateData);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      res.json(user);\n    } catch (error: any) {\n      if (error.name === 'ZodError') {\n        return res.status(400).json({ message: \"Invalid data\", errors: error.errors });\n      }\n      console.error(\"Error updating user:\", error);\n      res.status(500).json({ message: \"Failed to update user\" });\n    }\n  });\n\n  // =====================\n  // Task Routes\n  // =====================\n  app.get('/api/tasks', isAuthenticated, async (req, res) => {\n    try {\n      const tasks = await storage.getTasks();\n      res.json(tasks);\n    } catch (error) {\n      console.error(\"Error fetching tasks:\", error);\n      res.status(500).json({ message: \"Failed to fetch tasks\" });\n    }\n  });\n\n  app.get('/api/tasks/:id', isAuthenticated, async (req, res) => {\n    try {\n      const task = await storage.getTask(parseInt(req.params.id));\n      if (!task) {\n        return res.status(404).json({ message: \"Task not found\" });\n      }\n      res.json(task);\n    } catch (error) {\n      console.error(\"Error fetching task:\", error);\n      res.status(500).json({ message: \"Failed to fetch task\" });\n    }\n  });\n\n  app.post('/api/tasks', isAuthenticated, async (req: any, res) => {\n    try {\n      const { dueDate, ...restBody } = req.body;\n      const data = insertTaskSchema.parse({\n        ...restBody,\n        dueDate: dueDate ? new Date(dueDate) : null,\n        creatorId: req.user.claims.sub,\n      });\n      const task = await storage.createTask(data);\n      res.status(201).json(task);\n    } catch (error) {\n      console.error(\"Error creating task:\", error);\n      res.status(400).json({ message: \"Failed to create task\" });\n    }\n  });\n\n  const updateTaskSchema = z.object({\n    title: z.string().min(1).max(500).optional(),\n    description: z.string().max(5000).nullable().optional(),\n    assigneeId: z.string().nullable().optional(),\n    priority: z.enum([\"low\", \"medium\", \"high\"]).optional(),\n    status: z.enum([\"pending\", \"in_progress\", \"completed\"]).optional(),\n    dueDate: z.string().datetime().nullable().optional(),\n  }).strict();\n\n  app.patch('/api/tasks/:id', isAuthenticated, async (req, res) => {\n    try {\n      const taskId = parseInt(req.params.id);\n      if (isNaN(taskId)) {\n        return res.status(400).json({ message: \"Invalid task ID\" });\n      }\n      \n      const validationResult = updateTaskSchema.safeParse(req.body);\n      if (!validationResult.success) {\n        return res.status(400).json({ \n          message: \"Invalid update data\",\n          errors: validationResult.error.errors \n        });\n      }\n\n      const { dueDate, ...restData } = validationResult.data;\n      const updateData: Partial<InsertTask> = {\n        ...restData,\n        ...(dueDate !== undefined && { dueDate: dueDate ? new Date(dueDate) : null }),\n      };\n\n      const task = await storage.updateTask(taskId, updateData);\n      if (!task) {\n        return res.status(404).json({ message: \"Task not found\" });\n      }\n      res.json(task);\n    } catch (error) {\n      console.error(\"Error updating task:\", error);\n      res.status(500).json({ message: \"Failed to update task\" });\n    }\n  });\n\n  app.delete('/api/tasks/:id', isAuthenticated, async (req, res) => {\n    try {\n      await storage.deleteTask(parseInt(req.params.id));\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting task:\", error);\n      res.status(500).json({ message: \"Failed to delete task\" });\n    }\n  });\n\n  // Get tasks assigned to current user\n  app.get('/api/me/tasks', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const tasks = await storage.getTasksByAssignee(userId);\n      res.json(tasks);\n    } catch (error) {\n      console.error(\"Error fetching user tasks:\", error);\n      res.status(500).json({ message: \"Failed to fetch your tasks\" });\n    }\n  });\n\n  // Get tasks by employee email (public endpoint for employee portal)\n  app.get('/api/employee/tasks', async (req, res) => {\n    try {\n      const email = req.query.email as string;\n      if (!email) {\n        return res.status(400).json({ message: \"Email is required\" });\n      }\n      \n      // Find user by email\n      const user = await storage.getUserByEmail(email.toLowerCase());\n      if (!user) {\n        return res.json([]); // Return empty array if user not found\n      }\n      \n      // Get tasks assigned to this user\n      const tasks = await storage.getTasksByAssignee(user.id);\n      res.json(tasks);\n    } catch (error) {\n      console.error(\"Error fetching employee tasks:\", error);\n      res.status(500).json({ message: \"Failed to fetch tasks\" });\n    }\n  });\n\n  // =====================\n  // Ticket Routes\n  // =====================\n  app.get('/api/tickets', isAuthenticated, async (req, res) => {\n    try {\n      const tickets = await storage.getTickets();\n      res.json(tickets);\n    } catch (error) {\n      console.error(\"Error fetching tickets:\", error);\n      res.status(500).json({ message: \"Failed to fetch tickets\" });\n    }\n  });\n\n  app.get('/api/tickets/:id', isAuthenticated, async (req, res) => {\n    try {\n      const ticket = await storage.getTicket(parseInt(req.params.id));\n      if (!ticket) {\n        return res.status(404).json({ message: \"Ticket not found\" });\n      }\n      res.json(ticket);\n    } catch (error) {\n      console.error(\"Error fetching ticket:\", error);\n      res.status(500).json({ message: \"Failed to fetch ticket\" });\n    }\n  });\n\n  app.post('/api/tickets', isAuthenticated, async (req: any, res) => {\n    try {\n      const data = insertTicketSchema.parse({\n        ...req.body,\n        reporterId: req.user.claims.sub,\n      });\n      const ticket = await storage.createTicket(data);\n      res.status(201).json(ticket);\n    } catch (error) {\n      console.error(\"Error creating ticket:\", error);\n      res.status(400).json({ message: \"Failed to create ticket\" });\n    }\n  });\n\n  app.patch('/api/tickets/:id', isAuthenticated, async (req, res) => {\n    try {\n      const ticket = await storage.updateTicket(parseInt(req.params.id), req.body);\n      if (!ticket) {\n        return res.status(404).json({ message: \"Ticket not found\" });\n      }\n      res.json(ticket);\n    } catch (error) {\n      console.error(\"Error updating ticket:\", error);\n      res.status(500).json({ message: \"Failed to update ticket\" });\n    }\n  });\n\n  app.delete('/api/tickets/:id', isAuthenticated, async (req, res) => {\n    try {\n      await storage.deleteTicket(parseInt(req.params.id));\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting ticket:\", error);\n      res.status(500).json({ message: \"Failed to delete ticket\" });\n    }\n  });\n\n  // =====================\n  // Profile Routes\n  // =====================\n  app.get('/api/profile', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const profile = await storage.getOrCreateProfile(userId);\n      res.json(profile);\n    } catch (error) {\n      console.error(\"Error fetching profile:\", error);\n      res.status(500).json({ message: \"Failed to fetch profile\" });\n    }\n  });\n\n  app.get('/api/profile/:id', isAuthenticated, async (req, res) => {\n    try {\n      const profile = await storage.getProfile(parseInt(req.params.id));\n      if (!profile) {\n        return res.status(404).json({ message: \"Profile not found\" });\n      }\n      res.json(profile);\n    } catch (error) {\n      console.error(\"Error fetching profile:\", error);\n      res.status(500).json({ message: \"Failed to fetch profile\" });\n    }\n  });\n\n  app.patch('/api/profile', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const profile = await storage.getOrCreateProfile(userId);\n      const { displayName, bio, avatarUrl, coverUrl, website, location } = req.body;\n      const updateData: any = {};\n      if (displayName !== undefined) updateData.displayName = displayName?.trim() || null;\n      if (bio !== undefined) updateData.bio = bio?.trim() || null;\n      if (avatarUrl !== undefined) updateData.avatarUrl = avatarUrl || null;\n      if (coverUrl !== undefined) updateData.coverUrl = coverUrl || null;\n      if (website !== undefined) updateData.website = website?.trim() || null;\n      if (location !== undefined) updateData.location = location?.trim() || null;\n      const updated = await storage.updateProfile(profile.id, updateData);\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error updating profile:\", error);\n      res.status(500).json({ message: \"Failed to update profile\" });\n    }\n  });\n\n  app.get('/api/profile/:id/stats', isAuthenticated, async (req, res) => {\n    try {\n      const stats = await storage.getProfileStats(parseInt(req.params.id));\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Error fetching profile stats:\", error);\n      res.status(500).json({ message: \"Failed to fetch profile stats\" });\n    }\n  });\n\n  app.post('/api/profile/:id/follow', isAuthenticated, async (req: any, res) => {\n    try {\n      const profileId = parseInt(req.params.id);\n      const userId = req.user.claims.sub;\n      await storage.followProfile(profileId, userId);\n      const followers = await storage.getFollowerCount(profileId);\n      res.json({ followers });\n    } catch (error) {\n      console.error(\"Error following profile:\", error);\n      res.status(500).json({ message: \"Failed to follow profile\" });\n    }\n  });\n\n  app.delete('/api/profile/:id/follow', isAuthenticated, async (req: any, res) => {\n    try {\n      const profileId = parseInt(req.params.id);\n      const userId = req.user.claims.sub;\n      await storage.unfollowProfile(profileId, userId);\n      const followers = await storage.getFollowerCount(profileId);\n      res.json({ followers });\n    } catch (error) {\n      console.error(\"Error unfollowing profile:\", error);\n      res.status(500).json({ message: \"Failed to unfollow profile\" });\n    }\n  });\n\n  app.get('/api/profile/:id/following', isAuthenticated, async (req: any, res) => {\n    try {\n      const profileId = parseInt(req.params.id);\n      const userId = req.user.claims.sub;\n      const isFollowing = await storage.isFollowing(profileId, userId);\n      res.json({ isFollowing });\n    } catch (error) {\n      console.error(\"Error checking follow status:\", error);\n      res.status(500).json({ message: \"Failed to check follow status\" });\n    }\n  });\n\n  app.get('/api/profile/:id/posts', isAuthenticated, async (req, res) => {\n    try {\n      const posts = await storage.getProfilePosts(parseInt(req.params.id));\n      res.json(posts);\n    } catch (error) {\n      console.error(\"Error fetching profile posts:\", error);\n      res.status(500).json({ message: \"Failed to fetch profile posts\" });\n    }\n  });\n\n  // =====================\n  // Post Routes (Social Feed)\n  // =====================\n  app.get('/api/posts', isAuthenticated, async (req, res) => {\n    try {\n      const posts = await storage.getPublicPosts();\n      res.json(posts);\n    } catch (error) {\n      console.error(\"Error fetching posts:\", error);\n      res.status(500).json({ message: \"Failed to fetch posts\" });\n    }\n  });\n\n  app.post('/api/posts', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { content, mediaUrl, mediaType, dualPostToPublic } = req.body;\n      \n      const profile = await storage.getOrCreateProfile(userId);\n      \n      const profilePost = await storage.createPost({\n        authorId: userId,\n        content: content || '',\n        mediaUrl: mediaUrl || null,\n        mediaType: mediaType || null,\n        scope: 'profile',\n        profileId: profile.id,\n      });\n      \n      if (dualPostToPublic !== false) {\n        await storage.createPost({\n          authorId: userId,\n          content: content || '',\n          mediaUrl: mediaUrl || null,\n          mediaType: mediaType || null,\n          scope: 'public',\n          profileId: profile.id,\n        });\n      }\n      \n      res.status(201).json(profilePost);\n    } catch (error) {\n      console.error(\"Error creating post:\", error);\n      res.status(400).json({ message: \"Failed to create post\" });\n    }\n  });\n\n  app.delete('/api/posts/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const postId = parseInt(req.params.id);\n      const userId = req.user.claims.sub;\n      const post = await storage.getPost(postId);\n      \n      if (!post) {\n        return res.status(404).json({ message: \"Post not found\" });\n      }\n      \n      if (post.authorId !== userId) {\n        return res.status(403).json({ message: \"Not authorized to delete this post\" });\n      }\n      \n      await storage.deletePost(postId);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting post:\", error);\n      res.status(500).json({ message: \"Failed to delete post\" });\n    }\n  });\n\n  app.post('/api/posts/:id/like', isAuthenticated, async (req: any, res) => {\n    try {\n      const postId = parseInt(req.params.id);\n      const userId = req.user.claims.sub;\n      await storage.likePost(postId, userId);\n      const likes = await storage.getPostLikes(postId);\n      res.json({ likes });\n    } catch (error) {\n      console.error(\"Error liking post:\", error);\n      res.status(500).json({ message: \"Failed to like post\" });\n    }\n  });\n\n  app.delete('/api/posts/:id/like', isAuthenticated, async (req: any, res) => {\n    try {\n      const postId = parseInt(req.params.id);\n      const userId = req.user.claims.sub;\n      await storage.unlikePost(postId, userId);\n      const likes = await storage.getPostLikes(postId);\n      res.json({ likes });\n    } catch (error) {\n      console.error(\"Error unliking post:\", error);\n      res.status(500).json({ message: \"Failed to unlike post\" });\n    }\n  });\n\n  app.get('/api/posts/:id/comments', isAuthenticated, async (req, res) => {\n    try {\n      const comments = await storage.getPostComments(parseInt(req.params.id));\n      res.json(comments);\n    } catch (error) {\n      console.error(\"Error fetching comments:\", error);\n      res.status(500).json({ message: \"Failed to fetch comments\" });\n    }\n  });\n\n  app.post('/api/posts/:id/comments', isAuthenticated, async (req: any, res) => {\n    try {\n      const data = insertPostCommentSchema.parse({\n        postId: parseInt(req.params.id),\n        authorId: req.user.claims.sub,\n        content: req.body.content,\n      });\n      const comment = await storage.addPostComment(data);\n      res.status(201).json(comment);\n    } catch (error) {\n      console.error(\"Error adding comment:\", error);\n      res.status(400).json({ message: \"Failed to add comment\" });\n    }\n  });\n\n  app.delete('/api/posts/:postId/comments/:commentId', isAuthenticated, async (req: any, res) => {\n    try {\n      const commentId = parseInt(req.params.commentId);\n      const userId = req.user.claims.sub;\n      await storage.deletePostComment(commentId, userId);\n      res.status(204).send();\n    } catch (error: any) {\n      console.error(\"Error deleting comment:\", error);\n      if (error.message === \"Not authorized\") {\n        res.status(403).json({ message: \"Not authorized to delete this comment\" });\n      } else {\n        res.status(500).json({ message: \"Failed to delete comment\" });\n      }\n    }\n  });\n\n  // =====================\n  // Chat Routes (WhatsApp-style messaging)\n  // =====================\n  \n  // Get all threads for current user with last message and unread count\n  app.get('/api/threads', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const threads = await storage.getChatThreads(userId);\n      \n      // Enhance threads with last message and unread count\n      const enhancedThreads = await Promise.all(threads.map(async (thread) => {\n        const lastMessage = await storage.getLastMessage(thread.id);\n        const unreadCount = await storage.getUnreadCount(thread.id, userId);\n        const participants = await storage.getThreadParticipants(thread.id);\n        \n        return {\n          ...thread,\n          lastMessage,\n          unreadCount,\n          participants,\n        };\n      }));\n      \n      res.json(enhancedThreads);\n    } catch (error) {\n      console.error(\"Error fetching threads:\", error);\n      res.status(500).json({ message: \"Failed to fetch threads\" });\n    }\n  });\n\n  // Create a new group chat\n  app.post('/api/threads', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { participantIds, ...threadData } = req.body;\n      const data = insertChatThreadSchema.parse({\n        ...threadData,\n        type: \"group\",\n        creatorId: userId,\n      });\n      const allParticipants = Array.from(new Set([userId, ...(participantIds || [])]));\n      const thread = await storage.createChatThread(data, allParticipants, userId);\n      res.status(201).json(thread);\n    } catch (error) {\n      console.error(\"Error creating thread:\", error);\n      res.status(400).json({ message: \"Failed to create thread\" });\n    }\n  });\n\n  // Create or get direct chat between two users\n  app.post('/api/threads/direct', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { targetUserId } = req.body;\n      \n      if (!targetUserId) {\n        return res.status(400).json({ message: \"Target user ID is required\" });\n      }\n      \n      const thread = await storage.createDirectChat(userId, targetUserId);\n      const participants = await storage.getThreadParticipants(thread.id);\n      \n      res.status(201).json({ ...thread, participants });\n    } catch (error) {\n      console.error(\"Error creating direct chat:\", error);\n      res.status(400).json({ message: \"Failed to create direct chat\" });\n    }\n  });\n\n  // Get thread details with participants\n  app.get('/api/threads/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const threadId = parseInt(req.params.id);\n      const thread = await storage.getChatThread(threadId);\n      if (!thread) {\n        return res.status(404).json({ message: \"Thread not found\" });\n      }\n      \n      const participants = await storage.getThreadParticipants(threadId);\n      const lastMessage = await storage.getLastMessage(threadId);\n      const unreadCount = await storage.getUnreadCount(threadId, req.user.claims.sub);\n      \n      res.json({ ...thread, participants, lastMessage, unreadCount });\n    } catch (error) {\n      console.error(\"Error fetching thread:\", error);\n      res.status(500).json({ message: \"Failed to fetch thread\" });\n    }\n  });\n\n  // Update thread (name, description, avatar)\n  app.patch('/api/threads/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const threadId = parseInt(req.params.id);\n      const { name, description, avatarUrl } = req.body;\n      \n      const updated = await storage.updateThread(threadId, { name, description, avatarUrl });\n      if (!updated) {\n        return res.status(404).json({ message: \"Thread not found\" });\n      }\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error updating thread:\", error);\n      res.status(500).json({ message: \"Failed to update thread\" });\n    }\n  });\n\n  // Delete thread\n  app.delete('/api/threads/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const threadId = parseInt(req.params.id);\n      await storage.deleteThread(threadId);\n      res.json({ message: \"Thread deleted\" });\n    } catch (error) {\n      console.error(\"Error deleting thread:\", error);\n      res.status(500).json({ message: \"Failed to delete thread\" });\n    }\n  });\n\n  // Get thread participants\n  app.get('/api/threads/:id/participants', isAuthenticated, async (req, res) => {\n    try {\n      const threadId = parseInt(req.params.id);\n      const participants = await storage.getThreadParticipants(threadId);\n      res.json(participants);\n    } catch (error) {\n      console.error(\"Error fetching participants:\", error);\n      res.status(500).json({ message: \"Failed to fetch participants\" });\n    }\n  });\n\n  // Add participant to thread\n  app.post('/api/threads/:id/participants', isAuthenticated, async (req: any, res) => {\n    try {\n      const threadId = parseInt(req.params.id);\n      const { userId, isAdmin } = req.body;\n      \n      await storage.addThreadParticipant(threadId, userId, isAdmin || false);\n      res.status(201).json({ message: \"Participant added\" });\n    } catch (error) {\n      console.error(\"Error adding participant:\", error);\n      res.status(400).json({ message: \"Failed to add participant\" });\n    }\n  });\n\n  // Remove participant from thread\n  app.delete('/api/threads/:id/participants/:userId', isAuthenticated, async (req: any, res) => {\n    try {\n      const threadId = parseInt(req.params.id);\n      const { userId } = req.params;\n      \n      await storage.removeThreadParticipant(threadId, userId);\n      res.json({ message: \"Participant removed\" });\n    } catch (error) {\n      console.error(\"Error removing participant:\", error);\n      res.status(500).json({ message: \"Failed to remove participant\" });\n    }\n  });\n\n  // Get messages in thread\n  app.get('/api/threads/:id/messages', isAuthenticated, async (req: any, res) => {\n    try {\n      const threadId = parseInt(req.params.id);\n      const userId = req.user.claims.sub;\n      \n      const messages = await storage.getMessages(threadId);\n      \n      // Mark messages as read when fetching\n      await storage.markMessagesRead(threadId, userId);\n      \n      res.json(messages);\n    } catch (error) {\n      console.error(\"Error fetching messages:\", error);\n      res.status(500).json({ message: \"Failed to fetch messages\" });\n    }\n  });\n\n  // Send message in thread\n  app.post('/api/threads/:id/messages', isAuthenticated, async (req: any, res) => {\n    try {\n      const data = insertMessageSchema.parse({\n        threadId: parseInt(req.params.id),\n        senderId: req.user.claims.sub,\n        content: req.body.content,\n        messageType: req.body.messageType || \"text\",\n        mediaUrl: req.body.mediaUrl,\n      });\n      const message = await storage.createMessage(data);\n      res.status(201).json(message);\n    } catch (error) {\n      console.error(\"Error sending message:\", error);\n      res.status(400).json({ message: \"Failed to send message\" });\n    }\n  });\n\n  // Delete message\n  app.delete('/api/threads/:threadId/messages/:messageId', isAuthenticated, async (req: any, res) => {\n    try {\n      const messageId = parseInt(req.params.messageId);\n      const userId = req.user.claims.sub;\n      await storage.deleteMessage(messageId, userId);\n      res.status(204).send();\n    } catch (error: any) {\n      console.error(\"Error deleting message:\", error);\n      if (error.message === \"Not authorized\") {\n        res.status(403).json({ message: \"Not authorized to delete this message\" });\n      } else {\n        res.status(500).json({ message: \"Failed to delete message\" });\n      }\n    }\n  });\n\n  // Mark thread messages as read\n  app.post('/api/threads/:id/read', isAuthenticated, async (req: any, res) => {\n    try {\n      const threadId = parseInt(req.params.id);\n      const userId = req.user.claims.sub;\n      \n      await storage.markMessagesRead(threadId, userId);\n      res.json({ message: \"Messages marked as read\" });\n    } catch (error) {\n      console.error(\"Error marking messages as read:\", error);\n      res.status(500).json({ message: \"Failed to mark messages as read\" });\n    }\n  });\n\n  // =====================\n  // Object Storage / File Upload Routes\n  // =====================\n  \n  // Get upload URL for media files (images, voice notes)\n  app.post('/api/upload/media', isAuthenticated, async (req: any, res) => {\n    try {\n      const { fileType } = req.body; // e.g., \"jpg\", \"png\", \"webm\", \"ogg\"\n      console.log(\"Upload media request, fileType:\", fileType);\n      const objectStorageService = new ObjectStorageService();\n      const result = await objectStorageService.getObjectEntityUploadURL(fileType);\n      console.log(\"Upload URL result:\", result);\n      res.json(result);\n    } catch (error) {\n      console.error(\"Error getting upload URL:\", error);\n      res.status(500).json({ message: \"Failed to get upload URL\" });\n    }\n  });\n\n  // Serve uploaded objects\n  app.get('/objects/:objectPath(*)', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const objectStorageService = new ObjectStorageService();\n      const objectFile = await objectStorageService.getObjectEntityFile(req.path);\n      objectStorageService.downloadObject(objectFile, res);\n    } catch (error) {\n      console.error(\"Error serving object:\", error);\n      if (error instanceof ObjectNotFoundError) {\n        return res.status(404).json({ message: \"Object not found\" });\n      }\n      res.status(500).json({ message: \"Failed to serve object\" });\n    }\n  });\n\n  // =====================\n  // Meeting Routes\n  // =====================\n  app.get('/api/meetings', isAuthenticated, async (req, res) => {\n    try {\n      const meetings = await storage.getMeetings();\n      res.json(meetings);\n    } catch (error) {\n      console.error(\"Error fetching meetings:\", error);\n      res.status(500).json({ message: \"Failed to fetch meetings\" });\n    }\n  });\n\n  app.get('/api/meetings/:id', isAuthenticated, async (req, res) => {\n    try {\n      const meeting = await storage.getMeeting(parseInt(req.params.id));\n      if (!meeting) {\n        return res.status(404).json({ message: \"Meeting not found\" });\n      }\n      res.json(meeting);\n    } catch (error) {\n      console.error(\"Error fetching meeting:\", error);\n      res.status(500).json({ message: \"Failed to fetch meeting\" });\n    }\n  });\n\n  app.post('/api/meetings', isAuthenticated, async (req: any, res) => {\n    try {\n      const { attendeeIds, startTime, endTime, ...meetingData } = req.body;\n      const data = insertMeetingSchema.parse({\n        ...meetingData,\n        startTime: new Date(startTime),\n        endTime: new Date(endTime),\n        organizerId: req.user.claims.sub,\n      });\n      const meeting = await storage.createMeeting(data, attendeeIds || []);\n      res.status(201).json(meeting);\n    } catch (error) {\n      console.error(\"Error creating meeting:\", error);\n      res.status(400).json({ message: \"Failed to create meeting\" });\n    }\n  });\n\n  app.patch('/api/meetings/:id', isAuthenticated, async (req, res) => {\n    try {\n      const meeting = await storage.updateMeeting(parseInt(req.params.id), req.body);\n      if (!meeting) {\n        return res.status(404).json({ message: \"Meeting not found\" });\n      }\n      res.json(meeting);\n    } catch (error) {\n      console.error(\"Error updating meeting:\", error);\n      res.status(500).json({ message: \"Failed to update meeting\" });\n    }\n  });\n\n  app.delete('/api/meetings/:id', isAuthenticated, async (req, res) => {\n    try {\n      await storage.deleteMeeting(parseInt(req.params.id));\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting meeting:\", error);\n      res.status(500).json({ message: \"Failed to delete meeting\" });\n    }\n  });\n\n  app.get('/api/meetings/:id/attendees', isAuthenticated, async (req, res) => {\n    try {\n      const attendees = await storage.getMeetingAttendees(parseInt(req.params.id));\n      res.json(attendees);\n    } catch (error) {\n      console.error(\"Error fetching attendees:\", error);\n      res.status(500).json({ message: \"Failed to fetch attendees\" });\n    }\n  });\n\n  // =====================\n  // Job Posting Routes (Manager & Admin only)\n  // =====================\n  app.get('/api/jobs', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req, res) => {\n    try {\n      const jobs = await storage.getJobPostings();\n      res.json(jobs);\n    } catch (error) {\n      console.error(\"Error fetching jobs:\", error);\n      res.status(500).json({ message: \"Failed to fetch jobs\" });\n    }\n  });\n\n  app.get('/api/jobs/:id', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req, res) => {\n    try {\n      const job = await storage.getJobPosting(parseInt(req.params.id));\n      if (!job) {\n        return res.status(404).json({ message: \"Job not found\" });\n      }\n      res.json(job);\n    } catch (error) {\n      console.error(\"Error fetching job:\", error);\n      res.status(500).json({ message: \"Failed to fetch job\" });\n    }\n  });\n\n  app.post('/api/jobs', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const data = insertJobPostingSchema.parse({\n        ...req.body,\n        creatorId: req.user.claims.sub,\n      });\n      const job = await storage.createJobPosting(data);\n      res.status(201).json(job);\n    } catch (error) {\n      console.error(\"Error creating job:\", error);\n      res.status(400).json({ message: \"Failed to create job\" });\n    }\n  });\n\n  app.patch('/api/jobs/:id', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req, res) => {\n    try {\n      const job = await storage.updateJobPosting(parseInt(req.params.id), req.body);\n      if (!job) {\n        return res.status(404).json({ message: \"Job not found\" });\n      }\n      res.json(job);\n    } catch (error) {\n      console.error(\"Error updating job:\", error);\n      res.status(500).json({ message: \"Failed to update job\" });\n    }\n  });\n\n  app.delete('/api/jobs/:id', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req, res) => {\n    try {\n      await storage.deleteJobPosting(parseInt(req.params.id));\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting job:\", error);\n      res.status(500).json({ message: \"Failed to delete job\" });\n    }\n  });\n\n  // =====================\n  // Transaction Routes (Finance - Admin only)\n  // =====================\n  app.get('/api/transactions', isAuthenticated, requireRole(\"admin\"), async (req, res) => {\n    try {\n      const transactions = await storage.getTransactions();\n      res.json(transactions);\n    } catch (error) {\n      console.error(\"Error fetching transactions:\", error);\n      res.status(500).json({ message: \"Failed to fetch transactions\" });\n    }\n  });\n\n  app.get('/api/transactions/pending', isAuthenticated, requireRole(\"admin\"), async (req, res) => {\n    try {\n      const transactions = await storage.getPendingTransactions();\n      res.json(transactions);\n    } catch (error) {\n      console.error(\"Error fetching pending transactions:\", error);\n      res.status(500).json({ message: \"Failed to fetch pending transactions\" });\n    }\n  });\n\n  app.post('/api/transactions', isAuthenticated, requireRole(\"admin\"), async (req: any, res) => {\n    try {\n      const data = insertTransactionSchema.parse({\n        ...req.body,\n        submitterId: req.user.claims.sub,\n      });\n      const transaction = await storage.createTransaction(data);\n      res.status(201).json(transaction);\n    } catch (error) {\n      console.error(\"Error creating transaction:\", error);\n      res.status(400).json({ message: \"Failed to create transaction\" });\n    }\n  });\n\n  app.patch('/api/transactions/:id', isAuthenticated, requireRole(\"admin\"), async (req: any, res) => {\n    try {\n      const updateData = { ...req.body };\n      if (req.body.status === 'approved' || req.body.status === 'rejected') {\n        updateData.approverId = req.user.claims.sub;\n      }\n      const transaction = await storage.updateTransaction(parseInt(req.params.id), updateData);\n      if (!transaction) {\n        return res.status(404).json({ message: \"Transaction not found\" });\n      }\n      res.json(transaction);\n    } catch (error) {\n      console.error(\"Error updating transaction:\", error);\n      res.status(500).json({ message: \"Failed to update transaction\" });\n    }\n  });\n\n  app.delete('/api/transactions/:id', isAuthenticated, requireRole(\"admin\"), async (req, res) => {\n    try {\n      await storage.deleteTransaction(parseInt(req.params.id));\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting transaction:\", error);\n      res.status(500).json({ message: \"Failed to delete transaction\" });\n    }\n  });\n\n  // =====================\n  // Role Routes (Access Control - Admin only)\n  // =====================\n  app.get('/api/roles', isAuthenticated, requireRole(\"admin\"), async (req, res) => {\n    try {\n      const roles = await storage.getRoles();\n      res.json(roles);\n    } catch (error) {\n      console.error(\"Error fetching roles:\", error);\n      res.status(500).json({ message: \"Failed to fetch roles\" });\n    }\n  });\n\n  app.post('/api/roles', isAuthenticated, requireRole(\"admin\"), async (req, res) => {\n    try {\n      const data = insertRoleSchema.parse(req.body);\n      const role = await storage.createRole(data);\n      res.status(201).json(role);\n    } catch (error) {\n      console.error(\"Error creating role:\", error);\n      res.status(400).json({ message: \"Failed to create role\" });\n    }\n  });\n\n  app.patch('/api/roles/:id', isAuthenticated, requireRole(\"admin\"), async (req, res) => {\n    try {\n      const role = await storage.updateRole(parseInt(req.params.id), req.body);\n      if (!role) {\n        return res.status(404).json({ message: \"Role not found\" });\n      }\n      res.json(role);\n    } catch (error) {\n      console.error(\"Error updating role:\", error);\n      res.status(500).json({ message: \"Failed to update role\" });\n    }\n  });\n\n  app.delete('/api/roles/:id', isAuthenticated, requireRole(\"admin\"), async (req, res) => {\n    try {\n      await storage.deleteRole(parseInt(req.params.id));\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting role:\", error);\n      res.status(500).json({ message: \"Failed to delete role\" });\n    }\n  });\n\n  app.get('/api/users/:id/roles', isAuthenticated, async (req, res) => {\n    try {\n      const roles = await storage.getUserRoles(req.params.id);\n      res.json(roles);\n    } catch (error) {\n      console.error(\"Error fetching user roles:\", error);\n      res.status(500).json({ message: \"Failed to fetch user roles\" });\n    }\n  });\n\n  app.post('/api/users/:userId/roles/:roleId', isAuthenticated, async (req, res) => {\n    try {\n      await storage.assignRole(req.params.userId, parseInt(req.params.roleId));\n      res.status(200).json({ message: \"Role assigned\" });\n    } catch (error) {\n      console.error(\"Error assigning role:\", error);\n      res.status(500).json({ message: \"Failed to assign role\" });\n    }\n  });\n\n  app.delete('/api/users/:userId/roles/:roleId', isAuthenticated, async (req, res) => {\n    try {\n      await storage.removeRole(req.params.userId, parseInt(req.params.roleId));\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error removing role:\", error);\n      res.status(500).json({ message: \"Failed to remove role\" });\n    }\n  });\n\n  // =====================\n  // Notification Routes\n  // =====================\n  app.get('/api/notifications', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const notifications = await storage.getNotifications(userId);\n      res.json(notifications);\n    } catch (error) {\n      console.error(\"Error fetching notifications:\", error);\n      res.status(500).json({ message: \"Failed to fetch notifications\" });\n    }\n  });\n\n  app.get('/api/notifications/unread-count', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const count = await storage.getUnreadNotificationCount(userId);\n      res.json({ count });\n    } catch (error) {\n      console.error(\"Error fetching unread count:\", error);\n      res.status(500).json({ message: \"Failed to fetch unread count\" });\n    }\n  });\n\n  app.patch('/api/notifications/:id/read', isAuthenticated, async (req, res) => {\n    try {\n      await storage.markNotificationRead(parseInt(req.params.id));\n      res.status(200).json({ message: \"Notification marked as read\" });\n    } catch (error) {\n      console.error(\"Error marking notification read:\", error);\n      res.status(500).json({ message: \"Failed to mark notification read\" });\n    }\n  });\n\n  app.post('/api/notifications/read-all', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      await storage.markAllNotificationsRead(userId);\n      res.status(200).json({ message: \"All notifications marked as read\" });\n    } catch (error) {\n      console.error(\"Error marking all notifications read:\", error);\n      res.status(500).json({ message: \"Failed to mark all notifications read\" });\n    }\n  });\n\n  // =====================\n  // Push Notification Routes\n  // =====================\n  app.post('/api/push/subscribe', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { endpoint, p256dh, auth, userAgent } = req.body;\n      \n      if (!endpoint || !p256dh || !auth) {\n        return res.status(400).json({ message: \"Missing required push subscription data\" });\n      }\n\n      await storage.createPushSubscription({\n        userId,\n        endpoint,\n        p256dh,\n        auth,\n        userAgent: userAgent || null,\n      });\n\n      res.status(201).json({ message: \"Push subscription created\" });\n    } catch (error) {\n      console.error(\"Error creating push subscription:\", error);\n      res.status(500).json({ message: \"Failed to create push subscription\" });\n    }\n  });\n\n  app.post('/api/push/unsubscribe', isAuthenticated, async (req: any, res) => {\n    try {\n      const { endpoint } = req.body;\n      const userId = req.user?.claims?.sub;\n      \n      if (!endpoint) {\n        return res.status(400).json({ message: \"Missing endpoint\" });\n      }\n\n      if (!userId) {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      await storage.deletePushSubscription(endpoint, userId);\n      res.status(200).json({ message: \"Push subscription deleted\" });\n    } catch (error) {\n      console.error(\"Error deleting push subscription:\", error);\n      res.status(500).json({ message: \"Failed to delete push subscription\" });\n    }\n  });\n\n  app.get('/api/push/vapid-public-key', (req, res) => {\n    const publicKey = process.env.VAPID_PUBLIC_KEY || '';\n    res.json({ publicKey });\n  });\n\n  // =====================\n  // Department Routes (Standalone)\n  // =====================\n  \n  const verifyDepartmentOwnership = async (departmentId: number, userId: string) => {\n    const department = await storage.getDepartment(departmentId);\n    if (!department) return { error: 'not_found' as const };\n    if (department.managerId !== userId) return { error: 'forbidden' as const };\n    return { department };\n  };\n\n  app.get(\"/api/departments\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const departments = await storage.getDepartmentsByManager(userId);\n      res.json(departments);\n    } catch (error) {\n      console.error(\"Error fetching departments:\", error);\n      res.status(500).json({ message: \"Failed to fetch departments\" });\n    }\n  });\n\n  app.get(\"/api/departments/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const departmentId = parseInt(req.params.id);\n      const result = await verifyDepartmentOwnership(departmentId, userId);\n      if (result.error === 'not_found') {\n        return res.status(404).json({ message: \"Department not found\" });\n      }\n      if (result.error === 'forbidden') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      res.json(result.department);\n    } catch (error) {\n      console.error(\"Error fetching department:\", error);\n      res.status(500).json({ message: \"Failed to fetch department\" });\n    }\n  });\n\n  app.post(\"/api/departments\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const { name, description, icon, color, password } = req.body;\n      if (!name || typeof name !== 'string' || name.trim().length === 0) {\n        return res.status(400).json({ message: \"Name is required\" });\n      }\n      const department = await storage.createDepartment({\n        name: name.trim(),\n        description: description?.trim() || null,\n        icon: icon || 'briefcase',\n        color: color || 'blue',\n        password: password?.trim() || null,\n        managerId: userId,\n      });\n      res.status(201).json(department);\n    } catch (error) {\n      console.error(\"Error creating department:\", error);\n      res.status(500).json({ message: \"Failed to create department\" });\n    }\n  });\n\n  app.patch(\"/api/departments/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const departmentId = parseInt(req.params.id);\n      const result = await verifyDepartmentOwnership(departmentId, userId);\n      if (result.error === 'not_found') {\n        return res.status(404).json({ message: \"Department not found\" });\n      }\n      if (result.error === 'forbidden') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      const { name, description, icon, color, password } = req.body;\n      const updateData: any = {};\n      if (name !== undefined) updateData.name = name.trim();\n      if (description !== undefined) updateData.description = description?.trim() || null;\n      if (icon !== undefined) updateData.icon = icon;\n      if (color !== undefined) updateData.color = color;\n      if (password !== undefined) updateData.password = password?.trim() || null;\n      const department = await storage.updateDepartment(departmentId, updateData);\n      res.json(department);\n    } catch (error) {\n      console.error(\"Error updating department:\", error);\n      res.status(500).json({ message: \"Failed to update department\" });\n    }\n  });\n\n  app.delete(\"/api/departments/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const departmentId = parseInt(req.params.id);\n      const result = await verifyDepartmentOwnership(departmentId, userId);\n      if (result.error === 'not_found') {\n        return res.status(404).json({ message: \"Department not found\" });\n      }\n      if (result.error === 'forbidden') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      await storage.deleteDepartment(departmentId);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting department:\", error);\n      res.status(500).json({ message: \"Failed to delete department\" });\n    }\n  });\n\n  app.post(\"/api/departments/:id/verify-password\", isAuthenticated, async (req: any, res) => {\n    try {\n      const departmentId = parseInt(req.params.id);\n      const { password } = req.body;\n      const department = await storage.getDepartment(departmentId);\n      if (!department) {\n        return res.status(404).json({ message: \"Department not found\" });\n      }\n      const isValid = await storage.verifyDepartmentPassword(departmentId, password || '');\n      res.json({ valid: isValid });\n    } catch (error) {\n      console.error(\"Error verifying password:\", error);\n      res.status(500).json({ message: \"Failed to verify password\" });\n    }\n  });\n\n  // =====================\n  // Remote Employee Routes\n  // =====================\n  \n  app.get(\"/api/departments/:departmentId/employees\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const departmentId = parseInt(req.params.departmentId);\n      const result = await verifyDepartmentOwnership(departmentId, userId);\n      if (result.error === 'not_found') {\n        return res.status(404).json({ message: \"Department not found\" });\n      }\n      if (result.error === 'forbidden') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      const employees = await storage.getRemoteEmployees(departmentId);\n      res.json(employees);\n    } catch (error) {\n      console.error(\"Error fetching employees:\", error);\n      res.status(500).json({ message: \"Failed to fetch employees\" });\n    }\n  });\n\n  app.get(\"/api/employees/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const employeeId = parseInt(req.params.id);\n      const employee = await storage.getRemoteEmployee(employeeId);\n      if (!employee) {\n        return res.status(404).json({ message: \"Employee not found\" });\n      }\n      const deptResult = await verifyDepartmentOwnership(employee.departmentId, userId);\n      if (deptResult.error) {\n        return res.status(deptResult.error === 'not_found' ? 404 : 403).json({ message: \"Access denied\" });\n      }\n      res.json(employee);\n    } catch (error) {\n      console.error(\"Error fetching employee:\", error);\n      res.status(500).json({ message: \"Failed to fetch employee\" });\n    }\n  });\n\n  app.get(\"/api/employees/username/:username\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const employee = await storage.getRemoteEmployeeByUsername(req.params.username);\n      if (!employee) {\n        return res.status(404).json({ message: \"Employee not found\" });\n      }\n      const result = await verifyDepartmentOwnership(employee.departmentId, userId);\n      if (result.error === 'forbidden') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      res.json(employee);\n    } catch (error) {\n      console.error(\"Error fetching employee by username:\", error);\n      res.status(500).json({ message: \"Failed to fetch employee\" });\n    }\n  });\n\n  app.post(\"/api/departments/:departmentId/employees\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const departmentId = parseInt(req.params.departmentId);\n      const result = await verifyDepartmentOwnership(departmentId, userId);\n      if (result.error === 'not_found') {\n        return res.status(404).json({ message: \"Department not found\" });\n      }\n      if (result.error === 'forbidden') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      const { username, firstName, lastName, email, phone, jobTitle, bio, skills, status, profileImageUrl } = req.body;\n      if (!username || typeof username !== 'string' || username.trim().length === 0) {\n        return res.status(400).json({ message: \"Username is required\" });\n      }\n      if (!firstName || typeof firstName !== 'string' || firstName.trim().length === 0) {\n        return res.status(400).json({ message: \"First name is required\" });\n      }\n      if (!lastName || typeof lastName !== 'string' || lastName.trim().length === 0) {\n        return res.status(400).json({ message: \"Last name is required\" });\n      }\n      const existingEmployee = await storage.getRemoteEmployeeByUsername(username.trim().toLowerCase());\n      if (existingEmployee) {\n        return res.status(400).json({ message: \"Username already exists\" });\n      }\n      const employee = await storage.createRemoteEmployee({\n        username: username.trim().toLowerCase(),\n        firstName: firstName.trim(),\n        lastName: lastName.trim(),\n        email: email?.trim() || null,\n        phone: phone?.trim() || null,\n        jobTitle: jobTitle?.trim() || null,\n        bio: bio?.trim() || null,\n        skills: skills?.trim() || null,\n        status: status || 'active',\n        profileImageUrl: profileImageUrl || null,\n        departmentId,\n        hiredById: userId,\n      });\n      res.status(201).json(employee);\n    } catch (error) {\n      console.error(\"Error creating employee:\", error);\n      res.status(500).json({ message: \"Failed to create employee\" });\n    }\n  });\n\n  app.patch(\"/api/employees/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const employeeId = parseInt(req.params.id);\n      const employee = await storage.getRemoteEmployee(employeeId);\n      if (!employee) {\n        return res.status(404).json({ message: \"Employee not found\" });\n      }\n      const deptResult = await verifyDepartmentOwnership(employee.departmentId, userId);\n      if (deptResult.error) {\n        return res.status(deptResult.error === 'not_found' ? 404 : 403).json({ message: \"Access denied\" });\n      }\n      const { firstName, lastName, email, phone, jobTitle, bio, skills, status, profileImageUrl } = req.body;\n      const updateData: any = {};\n      if (firstName !== undefined) updateData.firstName = firstName.trim();\n      if (lastName !== undefined) updateData.lastName = lastName.trim();\n      if (email !== undefined) updateData.email = email?.trim() || null;\n      if (phone !== undefined) updateData.phone = phone?.trim() || null;\n      if (jobTitle !== undefined) updateData.jobTitle = jobTitle?.trim() || null;\n      if (bio !== undefined) updateData.bio = bio?.trim() || null;\n      if (skills !== undefined) updateData.skills = skills?.trim() || null;\n      if (status !== undefined) updateData.status = status;\n      if (profileImageUrl !== undefined) updateData.profileImageUrl = profileImageUrl;\n      const updatedEmployee = await storage.updateRemoteEmployee(employeeId, updateData);\n      res.json(updatedEmployee);\n    } catch (error) {\n      console.error(\"Error updating employee:\", error);\n      res.status(500).json({ message: \"Failed to update employee\" });\n    }\n  });\n\n  app.delete(\"/api/employees/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const employeeId = parseInt(req.params.id);\n      const employee = await storage.getRemoteEmployee(employeeId);\n      if (!employee) {\n        return res.status(404).json({ message: \"Employee not found\" });\n      }\n      const deptResult = await verifyDepartmentOwnership(employee.departmentId, userId);\n      if (deptResult.error) {\n        return res.status(deptResult.error === 'not_found' ? 404 : 403).json({ message: \"Access denied\" });\n      }\n      await storage.deleteRemoteEmployee(employeeId);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting employee:\", error);\n      res.status(500).json({ message: \"Failed to delete employee\" });\n    }\n  });\n\n  // =====================\n  // Subscription Routes\n  // =====================\n  app.get('/api/subscriptions/active', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const subscription = await storage.getActiveSubscription(userId);\n      res.json(subscription || null);\n    } catch (error) {\n      console.error(\"Error fetching active subscription:\", error);\n      res.status(500).json({ message: \"Failed to fetch subscription\" });\n    }\n  });\n\n  app.get('/api/subscriptions/current', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const subscription = await storage.getSubscriptionByUser(userId);\n      res.json(subscription || null);\n    } catch (error) {\n      console.error(\"Error fetching subscription:\", error);\n      res.status(500).json({ message: \"Failed to fetch subscription\" });\n    }\n  });\n\n  app.post('/api/subscriptions', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const data = insertSubscriptionSchema.parse({\n        ...req.body,\n        userId,\n        status: 'active', // Mock: Set to active immediately (real implementation would wait for payment confirmation)\n      });\n      const subscription = await storage.createSubscription(data);\n      res.status(201).json(subscription);\n    } catch (error: any) {\n      if (error.name === 'ZodError') {\n        return res.status(400).json({ message: \"Invalid subscription data\", errors: error.errors });\n      }\n      console.error(\"Error creating subscription:\", error);\n      res.status(500).json({ message: \"Failed to create subscription\" });\n    }\n  });\n\n  app.patch('/api/subscriptions/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const subscriptionId = parseInt(req.params.id);\n      const subscription = await storage.getSubscription(subscriptionId);\n      \n      if (!subscription) {\n        return res.status(404).json({ message: \"Subscription not found\" });\n      }\n      \n      // Verify ownership\n      const userId = req.user.claims.sub;\n      if (subscription.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      const updated = await storage.updateSubscription(subscriptionId, req.body);\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error updating subscription:\", error);\n      res.status(500).json({ message: \"Failed to update subscription\" });\n    }\n  });\n\n  // =====================\n  // Advertisement Routes\n  // =====================\n  \n  // Public: Get all active advertisements (for landing page)\n  app.get('/api/advertisements/active', async (req, res) => {\n    try {\n      const ads = await storage.getActiveAdvertisements();\n      res.json(ads);\n    } catch (error) {\n      console.error(\"Error fetching active advertisements:\", error);\n      res.status(500).json({ message: \"Failed to fetch advertisements\" });\n    }\n  });\n\n  // Get user's advertisements\n  app.get('/api/advertisements/my', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const ads = await storage.getAdvertisementsByUser(userId);\n      res.json(ads);\n    } catch (error) {\n      console.error(\"Error fetching user advertisements:\", error);\n      res.status(500).json({ message: \"Failed to fetch advertisements\" });\n    }\n  });\n\n  // Get single advertisement\n  app.get('/api/advertisements/:id', async (req, res) => {\n    try {\n      const ad = await storage.getAdvertisement(parseInt(req.params.id));\n      if (!ad) {\n        return res.status(404).json({ message: \"Advertisement not found\" });\n      }\n      res.json(ad);\n    } catch (error) {\n      console.error(\"Error fetching advertisement:\", error);\n      res.status(500).json({ message: \"Failed to fetch advertisement\" });\n    }\n  });\n\n  // Create advertisement (requires subscription)\n  app.post('/api/advertisements', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      // Check if user has active subscription\n      const subscription = await storage.getActiveSubscription(userId);\n      if (!subscription) {\n        return res.status(403).json({ message: \"Active subscription required to create advertisements\" });\n      }\n      \n      // Calculate dates\n      const startDate = new Date();\n      const endDate = new Date();\n      endDate.setDate(endDate.getDate() + 3); // 3 days duration\n      \n      const data = insertAdvertisementSchema.parse({\n        ...req.body,\n        userId,\n        price: 500,\n        duration: 3,\n        startDate,\n        endDate,\n        status: 'active', // Mock: Set to active immediately (real implementation would wait for payment)\n      });\n      \n      const ad = await storage.createAdvertisement(data);\n      res.status(201).json(ad);\n    } catch (error: any) {\n      if (error.name === 'ZodError') {\n        return res.status(400).json({ message: \"Invalid advertisement data\", errors: error.errors });\n      }\n      console.error(\"Error creating advertisement:\", error);\n      res.status(500).json({ message: \"Failed to create advertisement\" });\n    }\n  });\n\n  // Update advertisement\n  app.patch('/api/advertisements/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const adId = parseInt(req.params.id);\n      const ad = await storage.getAdvertisement(adId);\n      \n      if (!ad) {\n        return res.status(404).json({ message: \"Advertisement not found\" });\n      }\n      \n      // Verify ownership\n      const userId = req.user.claims.sub;\n      if (ad.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      const updated = await storage.updateAdvertisement(adId, req.body);\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error updating advertisement:\", error);\n      res.status(500).json({ message: \"Failed to update advertisement\" });\n    }\n  });\n\n  // Delete advertisement\n  app.delete('/api/advertisements/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const adId = parseInt(req.params.id);\n      const ad = await storage.getAdvertisement(adId);\n      \n      if (!ad) {\n        return res.status(404).json({ message: \"Advertisement not found\" });\n      }\n      \n      // Verify ownership\n      const userId = req.user.claims.sub;\n      if (ad.userId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      await storage.deleteAdvertisement(adId);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting advertisement:\", error);\n      res.status(500).json({ message: \"Failed to delete advertisement\" });\n    }\n  });\n\n  // Track ad view (public)\n  app.post('/api/advertisements/:id/view', async (req, res) => {\n    try {\n      const adId = parseInt(req.params.id);\n      await storage.incrementAdViews(adId);\n      res.status(200).json({ success: true });\n    } catch (error) {\n      console.error(\"Error tracking ad view:\", error);\n      res.status(500).json({ message: \"Failed to track view\" });\n    }\n  });\n\n  // Track ad click (public)\n  app.post('/api/advertisements/:id/click', async (req, res) => {\n    try {\n      const adId = parseInt(req.params.id);\n      await storage.incrementAdClicks(adId);\n      res.status(200).json({ success: true });\n    } catch (error) {\n      console.error(\"Error tracking ad click:\", error);\n      res.status(500).json({ message: \"Failed to track click\" });\n    }\n  });\n\n  // =====================\n  // n8n Settings Routes (Manager & Admin only)\n  // =====================\n  app.get('/api/n8n/settings', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      let settings = await storage.getN8nSettings(userId);\n      if (!settings) {\n        settings = await storage.createN8nSettings({ userId, isEnabled: false });\n      }\n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error fetching n8n settings:\", error);\n      res.status(500).json({ message: \"Failed to fetch n8n settings\" });\n    }\n  });\n\n  app.put('/api/n8n/settings', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { webhookUrl, apiKey, isEnabled } = req.body;\n      \n      let settings = await storage.getN8nSettings(userId);\n      if (!settings) {\n        settings = await storage.createN8nSettings({\n          userId,\n          webhookUrl,\n          apiKey,\n          isEnabled: isEnabled ?? false,\n        });\n      } else {\n        settings = await storage.updateN8nSettings(userId, {\n          webhookUrl,\n          apiKey,\n          isEnabled,\n        });\n      }\n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error updating n8n settings:\", error);\n      res.status(500).json({ message: \"Failed to update n8n settings\" });\n    }\n  });\n\n  // =====================\n  // Task Automation Routes\n  // =====================\n  app.get('/api/automations', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const automations = await storage.getTaskAutomations(userId);\n      res.json(automations);\n    } catch (error) {\n      console.error(\"Error fetching automations:\", error);\n      res.status(500).json({ message: \"Failed to fetch automations\" });\n    }\n  });\n\n  app.get('/api/automations/pending', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const automations = await storage.getPendingAutomations(userId);\n      res.json(automations);\n    } catch (error) {\n      console.error(\"Error fetching pending automations:\", error);\n      res.status(500).json({ message: \"Failed to fetch pending automations\" });\n    }\n  });\n\n  app.get('/api/automations/task/:taskId', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      const automation = await storage.getTaskAutomationByTask(taskId);\n      res.json(automation || null);\n    } catch (error) {\n      console.error(\"Error fetching task automation:\", error);\n      res.status(500).json({ message: \"Failed to fetch task automation\" });\n    }\n  });\n\n  // Send task to n8n for automation\n  app.post('/api/automations/send', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { taskId } = req.body;\n      \n      if (!taskId) {\n        return res.status(400).json({ message: \"taskId is required\" });\n      }\n\n      const task = await storage.getTask(taskId);\n      if (!task) {\n        return res.status(404).json({ message: \"Task not found\" });\n      }\n\n      const settings = await storage.getN8nSettings(userId);\n      if (!settings || !settings.isEnabled || !settings.webhookUrl) {\n        return res.status(400).json({ message: \"n8n is not configured. Please set up your webhook URL in Settings.\" });\n      }\n\n      // Create automation record with processing status\n      const automation = await storage.createTaskAutomation({\n        taskId,\n        userId,\n        status: 'processing',\n      });\n\n      // Send task to n8n webhook\n      try {\n        const webhookPayload = {\n          automationId: automation.id,\n          taskId: task.id,\n          title: task.title,\n          description: task.description,\n          priority: task.priority,\n          dueDate: task.dueDate,\n          callbackUrl: `${process.env.REPLIT_DOMAINS?.split(',')[0] ? `https://${process.env.REPLIT_DOMAINS.split(',')[0]}` : ''}/api/automations/callback`,\n        };\n\n        const headers: Record<string, string> = {\n          'Content-Type': 'application/json',\n        };\n        if (settings.apiKey) {\n          headers['X-API-Key'] = settings.apiKey;\n        }\n\n        const response = await fetch(settings.webhookUrl, {\n          method: 'POST',\n          headers,\n          body: JSON.stringify(webhookPayload),\n        });\n\n        if (!response.ok) {\n          await storage.updateTaskAutomation(automation.id, { status: 'pending' });\n          return res.status(502).json({ message: \"Failed to send task to n8n. Please check your webhook URL.\" });\n        }\n\n        res.json({ \n          message: \"Task sent to n8n for processing\", \n          automationId: automation.id \n        });\n      } catch (fetchError) {\n        await storage.updateTaskAutomation(automation.id, { status: 'pending' });\n        console.error(\"Error calling n8n webhook:\", fetchError);\n        res.status(502).json({ message: \"Failed to connect to n8n. Please check your webhook URL.\" });\n      }\n    } catch (error) {\n      console.error(\"Error sending task to n8n:\", error);\n      res.status(500).json({ message: \"Failed to send task to n8n\" });\n    }\n  });\n\n  // Callback endpoint for n8n to return AI results (public webhook with API key validation)\n  app.post('/api/automations/callback', async (req, res) => {\n    try {\n      const { automationId, aiSuggestion, aiMetadata, executionId } = req.body;\n      \n      if (!automationId) {\n        return res.status(400).json({ message: \"automationId is required\" });\n      }\n\n      const automation = await storage.getTaskAutomation(automationId);\n      if (!automation) {\n        return res.status(404).json({ message: \"Automation not found\" });\n      }\n\n      // Validate API key from n8n settings\n      const settings = await storage.getN8nSettings(automation.userId);\n      if (settings?.apiKey) {\n        const providedApiKey = req.headers['x-api-key'];\n        if (providedApiKey !== settings.apiKey) {\n          return res.status(401).json({ message: \"Invalid API key\" });\n        }\n      }\n\n      // Only allow updating if automation is in processing state\n      if (automation.status !== 'processing') {\n        return res.status(400).json({ message: \"Automation is not in processing state\" });\n      }\n\n      await storage.updateTaskAutomation(automationId, {\n        aiSuggestion,\n        aiMetadata: aiMetadata || {},\n        status: 'ready',\n        n8nExecutionId: executionId,\n      });\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error processing n8n callback:\", error);\n      res.status(500).json({ message: \"Failed to process callback\" });\n    }\n  });\n\n  // Approve automation result\n  app.post('/api/automations/:id/approve', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const automationId = parseInt(req.params.id);\n      \n      const automation = await storage.getTaskAutomation(automationId);\n      if (!automation) {\n        return res.status(404).json({ message: \"Automation not found\" });\n      }\n\n      if (automation.userId !== userId) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n\n      if (automation.status !== 'ready') {\n        return res.status(400).json({ message: \"Automation is not ready for approval\" });\n      }\n\n      await storage.updateTaskAutomation(automationId, {\n        status: 'approved',\n        approvedBy: userId,\n      });\n\n      // Update the task status to completed\n      if (automation.taskId) {\n        await storage.updateTask(automation.taskId, { status: 'completed' });\n      }\n\n      res.json({ success: true, message: \"Automation approved and task completed\" });\n    } catch (error) {\n      console.error(\"Error approving automation:\", error);\n      res.status(500).json({ message: \"Failed to approve automation\" });\n    }\n  });\n\n  // Reject automation result\n  app.post('/api/automations/:id/reject', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const automationId = parseInt(req.params.id);\n      const { reason } = req.body;\n      \n      const automation = await storage.getTaskAutomation(automationId);\n      if (!automation) {\n        return res.status(404).json({ message: \"Automation not found\" });\n      }\n\n      if (automation.userId !== userId) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n\n      await storage.updateTaskAutomation(automationId, {\n        status: 'rejected',\n        rejectionReason: reason,\n      });\n\n      res.json({ success: true, message: \"Automation rejected\" });\n    } catch (error) {\n      console.error(\"Error rejecting automation:\", error);\n      res.status(500).json({ message: \"Failed to reject automation\" });\n    }\n  });\n\n  // Delete automation\n  app.delete('/api/automations/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const automationId = parseInt(req.params.id);\n      \n      const automation = await storage.getTaskAutomation(automationId);\n      if (!automation) {\n        return res.status(404).json({ message: \"Automation not found\" });\n      }\n\n      if (automation.userId !== userId) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n\n      await storage.deleteTaskAutomation(automationId);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting automation:\", error);\n      res.status(500).json({ message: \"Failed to delete automation\" });\n    }\n  });\n\n  // =====================\n  // Object Storage Routes\n  // =====================\n  app.get(\"/objects/:objectPath(*)\", isAuthenticated, async (req: any, res) => {\n    const userId = req.user?.claims?.sub;\n    const objectStorageService = new ObjectStorageService();\n    try {\n      const objectFile = await objectStorageService.getObjectEntityFile(req.path);\n      const canAccess = await objectStorageService.canAccessObjectEntity({\n        objectFile,\n        userId: userId,\n        requestedPermission: ObjectPermission.READ,\n      });\n      if (!canAccess) {\n        return res.sendStatus(401);\n      }\n      objectStorageService.downloadObject(objectFile, res);\n    } catch (error) {\n      console.error(\"Error checking object access:\", error);\n      if (error instanceof ObjectNotFoundError) {\n        return res.sendStatus(404);\n      }\n      return res.sendStatus(500);\n    }\n  });\n\n  app.post(\"/api/objects/upload\", isAuthenticated, async (req, res) => {\n    try {\n      const objectStorageService = new ObjectStorageService();\n      const uploadURL = await objectStorageService.getObjectEntityUploadURL();\n      res.json({ uploadURL });\n    } catch (error) {\n      console.error(\"Error getting upload URL:\", error);\n      res.status(500).json({ message: \"Failed to get upload URL\" });\n    }\n  });\n\n  app.put(\"/api/media\", isAuthenticated, async (req: any, res) => {\n    if (!req.body.mediaURL) {\n      return res.status(400).json({ error: \"mediaURL is required\" });\n    }\n    const userId = req.user?.claims?.sub;\n    const mediaURL = req.body.mediaURL;\n    \n    try {\n      const objectStorageService = new ObjectStorageService();\n      const privateDir = objectStorageService.getPrivateObjectDir();\n      \n      if (mediaURL.includes(\"storage.googleapis.com\")) {\n        const url = new URL(mediaURL);\n        if (!url.pathname.startsWith(privateDir)) {\n          return res.status(400).json({ error: \"Invalid media URL\" });\n        }\n      }\n      \n      const objectPath = await objectStorageService.trySetObjectEntityAclPolicy(\n        mediaURL,\n        {\n          owner: userId,\n          visibility: \"public\",\n        }\n      );\n      res.status(200).json({ objectPath });\n    } catch (error) {\n      console.error(\"Error setting media ACL:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // =====================\n  // PUBLIC STOREFRONT ROUTES (No Authentication Required)\n  // =====================\n\n  // Get all published offices (public)\n  app.get('/api/public/offices', async (req, res) => {\n    try {\n      const offices = await storage.getPublishedOffices();\n      res.json(offices);\n    } catch (error) {\n      console.error(\"Error fetching public offices:\", error);\n      res.status(500).json({ message: \"Failed to fetch offices\" });\n    }\n  });\n\n  // Get single office by slug (public)\n  app.get('/api/public/offices/:slug', async (req, res) => {\n    try {\n      const office = await storage.getOfficeBySlug(req.params.slug);\n      if (!office || !office.isPublished) {\n        return res.status(404).json({ message: \"Office not found\" });\n      }\n      res.json(office);\n    } catch (error) {\n      console.error(\"Error fetching office:\", error);\n      res.status(500).json({ message: \"Failed to fetch office\" });\n    }\n  });\n\n  // Get all public services across all offices\n  app.get('/api/public/services', async (req, res) => {\n    try {\n      const services = await storage.getAllPublicServices();\n      res.json(services);\n    } catch (error) {\n      console.error(\"Error fetching public services:\", error);\n      res.status(500).json({ message: \"Failed to fetch services\" });\n    }\n  });\n\n  // Get office services (public)\n  app.get('/api/public/offices/:officeId/services', async (req, res) => {\n    try {\n      const officeId = parseInt(req.params.officeId);\n      const services = await storage.getOfficeServices(officeId);\n      const activeServices = services.filter(s => s.isActive);\n      res.json(activeServices);\n    } catch (error) {\n      console.error(\"Error fetching services:\", error);\n      res.status(500).json({ message: \"Failed to fetch services\" });\n    }\n  });\n\n  // Get service ratings and average (public)\n  app.get('/api/public/services/:serviceId/ratings', async (req, res) => {\n    try {\n      const serviceId = parseInt(req.params.serviceId);\n      const [ratings, stats] = await Promise.all([\n        storage.getServiceRatings(serviceId),\n        storage.getServiceAverageRating(serviceId),\n      ]);\n      res.json({ ratings, average: stats.average, count: stats.count });\n    } catch (error) {\n      console.error(\"Error fetching ratings:\", error);\n      res.status(500).json({ message: \"Failed to fetch ratings\" });\n    }\n  });\n\n  // Submit service rating (public - visitor can rate)\n  app.post('/api/public/services/:serviceId/ratings', async (req, res) => {\n    try {\n      const serviceId = parseInt(req.params.serviceId);\n      const { rating, visitorName } = req.body;\n      if (!rating || rating < 1 || rating > 5) {\n        return res.status(400).json({ message: \"Rating must be between 1 and 5\" });\n      }\n      const data = insertServiceRatingSchema.parse({\n        serviceId,\n        rating,\n        visitorName: visitorName || null,\n      });\n      const newRating = await storage.createServiceRating(data);\n      res.status(201).json(newRating);\n    } catch (error) {\n      console.error(\"Error submitting rating:\", error);\n      res.status(400).json({ message: \"Failed to submit rating\" });\n    }\n  });\n\n  // Get service comments (public)\n  app.get('/api/public/services/:serviceId/comments', async (req, res) => {\n    try {\n      const serviceId = parseInt(req.params.serviceId);\n      const comments = await storage.getServiceComments(serviceId);\n      res.json(comments);\n    } catch (error) {\n      console.error(\"Error fetching comments:\", error);\n      res.status(500).json({ message: \"Failed to fetch comments\" });\n    }\n  });\n\n  // Submit service comment (public - visitor can comment)\n  app.post('/api/public/services/:serviceId/comments', async (req, res) => {\n    try {\n      const serviceId = parseInt(req.params.serviceId);\n      const { content, visitorName, visitorEmail, rating } = req.body;\n      if (!content || content.trim().length === 0) {\n        return res.status(400).json({ message: \"Content is required\" });\n      }\n      const data = insertServiceCommentSchema.parse({\n        serviceId,\n        content: content.trim(),\n        visitorName: visitorName || null,\n        visitorEmail: visitorEmail || null,\n        rating: rating || null,\n        status: 'published',\n      });\n      const comment = await storage.createServiceComment(data);\n      res.status(201).json(comment);\n    } catch (error) {\n      console.error(\"Error submitting comment:\", error);\n      res.status(400).json({ message: \"Failed to submit comment\" });\n    }\n  });\n\n  // Submit service request (public - visitor can request a service)\n  app.post('/api/public/services/:serviceId/request', async (req, res) => {\n    try {\n      const serviceId = parseInt(req.params.serviceId);\n      const service = await storage.getOfficeService(serviceId);\n      if (!service) {\n        return res.status(404).json({ message: \"Service not found\" });\n      }\n      const { visitorName, visitorEmail, visitorPhone, message } = req.body;\n      if (!visitorName || !visitorEmail) {\n        return res.status(400).json({ message: \"Name and email are required\" });\n      }\n      const request = await storage.createServiceRequest({\n        serviceId,\n        officeId: service.officeId,\n        visitorName,\n        visitorEmail,\n        visitorPhone: visitorPhone || null,\n        message: message || null,\n        status: 'pending',\n      });\n      res.status(201).json(request);\n    } catch (error) {\n      console.error(\"Error submitting service request:\", error);\n      res.status(400).json({ message: \"Failed to submit request\" });\n    }\n  });\n\n  // Get daily videos (public)\n  app.get('/api/public/videos', async (req, res) => {\n    try {\n      const videos = await storage.getDailyVideos();\n      res.json(videos);\n    } catch (error) {\n      console.error(\"Error fetching videos:\", error);\n      res.status(500).json({ message: \"Failed to fetch videos\" });\n    }\n  });\n\n  // Get announcements (public)\n  app.get('/api/public/announcements', async (req, res) => {\n    try {\n      const announcements = await storage.getAnnouncements();\n      res.json(announcements);\n    } catch (error) {\n      console.error(\"Error fetching announcements:\", error);\n      res.status(500).json({ message: \"Failed to fetch announcements\" });\n    }\n  });\n\n  // Get office media (public)\n  app.get('/api/public/offices/:officeId/media', async (req, res) => {\n    try {\n      const officeId = parseInt(req.params.officeId);\n      const media = await storage.getOfficeMedia(officeId);\n      res.json(media);\n    } catch (error) {\n      console.error(\"Error fetching media:\", error);\n      res.status(500).json({ message: \"Failed to fetch media\" });\n    }\n  });\n\n  // Increment media views (public)\n  app.post('/api/public/media/:id/view', async (req, res) => {\n    try {\n      await storage.incrementMediaViews(parseInt(req.params.id));\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error incrementing views:\", error);\n      res.status(500).json({ message: \"Failed to increment views\" });\n    }\n  });\n\n  // Get all office posts for storefront (public)\n  app.get('/api/public/posts', async (req, res) => {\n    try {\n      const posts = await storage.getAllOfficePosts();\n      res.json(posts);\n    } catch (error) {\n      console.error(\"Error fetching office posts:\", error);\n      res.status(500).json({ message: \"Failed to fetch posts\" });\n    }\n  });\n\n  // Get office posts (public)\n  app.get('/api/public/offices/:officeId/posts', async (req, res) => {\n    try {\n      const officeId = parseInt(req.params.officeId);\n      const posts = await storage.getOfficePosts(officeId);\n      res.json(posts);\n    } catch (error) {\n      console.error(\"Error fetching posts:\", error);\n      res.status(500).json({ message: \"Failed to fetch posts\" });\n    }\n  });\n\n  // Like office post (public)\n  app.post('/api/public/posts/:id/like', async (req, res) => {\n    try {\n      await storage.likeOfficePost(parseInt(req.params.id));\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error liking post:\", error);\n      res.status(500).json({ message: \"Failed to like post\" });\n    }\n  });\n\n  // Office Chat (Receptionist Chat) - Public visitor can chat\n  // Get chat messages for a session\n  app.get('/api/public/offices/:officeId/messages', async (req, res) => {\n    try {\n      const officeId = parseInt(req.params.officeId);\n      const sessionId = req.query.sessionId as string;\n      if (!sessionId) {\n        return res.status(400).json({ message: \"Session ID required\" });\n      }\n      const messages = await storage.getOfficeMessages(officeId, sessionId);\n      res.json(messages);\n    } catch (error) {\n      console.error(\"Error fetching messages:\", error);\n      res.status(500).json({ message: \"Failed to fetch messages\" });\n    }\n  });\n\n  // Send chat message as visitor\n  app.post('/api/public/offices/:officeId/messages', async (req, res) => {\n    try {\n      const officeId = parseInt(req.params.officeId);\n      const { sessionId, content, senderName, senderEmail } = req.body;\n      if (!sessionId || !content || content.trim().length === 0) {\n        return res.status(400).json({ message: \"Session ID and content are required\" });\n      }\n      const data = insertOfficeMessageSchema.parse({\n        officeId,\n        sessionId,\n        senderType: 'visitor',\n        senderName: senderName || null,\n        senderEmail: senderEmail || null,\n        content: content.trim(),\n      });\n      const message = await storage.createOfficeMessage(data);\n      res.status(201).json(message);\n    } catch (error) {\n      console.error(\"Error sending message:\", error);\n      res.status(400).json({ message: \"Failed to send message\" });\n    }\n  });\n\n  // =====================\n  // PUBLIC JOBS / CAREERS ROUTES\n  // =====================\n\n  // Get all published job postings (public)\n  app.get('/api/public/jobs', async (req, res) => {\n    try {\n      const jobs = await storage.getJobPostings();\n      const publishedJobs = jobs.filter((job: any) => job.status === 'published');\n      res.json(publishedJobs);\n    } catch (error) {\n      console.error(\"Error fetching public jobs:\", error);\n      res.status(500).json({ message: \"Failed to fetch jobs\" });\n    }\n  });\n\n  // Apply for a job (public)\n  app.post('/api/public/jobs/:id/apply', async (req, res) => {\n    try {\n      const jobId = parseInt(req.params.id);\n      const { fullName, email, phone, experience, resume, coverLetter, jobTitle, department } = req.body;\n      \n      if (!fullName || !email) {\n        return res.status(400).json({ message: \"Name and email are required\" });\n      }\n      \n      // Check if job exists and is published\n      const job = await storage.getJobPosting(jobId);\n      if (!job || job.status !== 'published') {\n        return res.status(404).json({ message: \"Job posting not found\" });\n      }\n      \n      // Create a service request entry for the job application\n      await storage.createServiceRequest({\n        officeId: 0,\n        serviceId: 0,\n        visitorName: fullName,\n        visitorEmail: email,\n        visitorPhone: phone || null,\n        message: `Job Application for: ${jobTitle || job.title}\\nDepartment: ${department || job.department}\\nExperience: ${experience || 'Not specified'}\\nResume: ${resume || 'Not provided'}\\nCover Letter: ${coverLetter || 'Not provided'}`,\n        status: 'pending',\n      });\n      \n      res.status(201).json({ message: \"Application submitted successfully\" });\n    } catch (error) {\n      console.error(\"Error submitting job application:\", error);\n      res.status(400).json({ message: \"Failed to submit application\" });\n    }\n  });\n\n  // =====================\n  // VIDEO CALL PUBLIC ROUTES (Visitor)\n  // =====================\n\n  // Request a video call as visitor\n  app.post('/api/public/offices/:officeId/video-calls', async (req, res) => {\n    try {\n      const officeId = parseInt(req.params.officeId);\n      if (isNaN(officeId)) {\n        return res.status(400).json({ message: \"Invalid office ID\" });\n      }\n      \n      // Validate request body\n      const parsed = videoCallRequestSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: parsed.error.errors[0]?.message || \"Invalid request\" });\n      }\n      const { sessionId, visitorName } = parsed.data;\n\n      // Verify office exists\n      const office = await storage.getOffice(officeId);\n      if (!office) {\n        return res.status(404).json({ message: \"Office not found\" });\n      }\n\n      // Generate cryptographically secure room ID\n      const crypto = require('crypto');\n      const roomId = `room_${crypto.randomBytes(16).toString('hex')}`;\n      \n      const call = await storage.createVideoCall({\n        officeId,\n        sessionId,\n        visitorName: visitorName || null,\n        roomId,\n        status: 'pending',\n      });\n      \n      res.status(201).json(call);\n    } catch (error) {\n      console.error(\"Error creating video call:\", error);\n      res.status(400).json({ message: \"Failed to request video call\" });\n    }\n  });\n\n  // Get video call status as visitor\n  app.get('/api/public/video-calls/:roomId', async (req, res) => {\n    try {\n      const roomId = req.params.roomId;\n      \n      // Validate roomId format\n      const roomIdResult = roomIdSchema.safeParse(roomId);\n      if (!roomIdResult.success) {\n        return res.status(400).json({ message: \"Invalid room ID format\" });\n      }\n      \n      const call = await storage.getVideoCallByRoom(roomId);\n      \n      if (!call) {\n        return res.status(404).json({ message: \"Video call not found\" });\n      }\n      \n      res.json(call);\n    } catch (error) {\n      console.error(\"Error fetching video call:\", error);\n      res.status(500).json({ message: \"Failed to fetch video call status\" });\n    }\n  });\n\n  // End video call as visitor (requires sessionId verification)\n  app.post('/api/public/video-calls/:roomId/end', async (req, res) => {\n    try {\n      const roomId = req.params.roomId;\n      \n      // Validate roomId format\n      const roomIdResult = roomIdSchema.safeParse(roomId);\n      if (!roomIdResult.success) {\n        return res.status(400).json({ message: \"Invalid room ID format\" });\n      }\n      \n      // Validate request body\n      const parsed = videoCallEndSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: parsed.error.errors[0]?.message || \"Session ID is required\" });\n      }\n      const { sessionId } = parsed.data;\n      \n      const call = await storage.getVideoCallByRoom(roomId);\n      \n      if (!call) {\n        return res.status(404).json({ message: \"Video call not found\" });\n      }\n      \n      // Verify the caller owns this session\n      if (call.sessionId !== sessionId) {\n        return res.status(403).json({ message: \"Not authorized to end this call\" });\n      }\n      \n      const updated = await storage.endVideoCall(call.id);\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error ending video call:\", error);\n      res.status(500).json({ message: \"Failed to end video call\" });\n    }\n  });\n\n  // =====================\n  // AUTHENTICATED OFFICE MANAGEMENT ROUTES (Manager & Admin only)\n  // =====================\n\n  // Get all offices for owner management\n  app.get('/api/offices', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const offices = await storage.getOffices(userId);\n      res.json(offices);\n    } catch (error) {\n      console.error(\"Error fetching offices:\", error);\n      res.status(500).json({ message: \"Failed to fetch offices\" });\n    }\n  });\n\n  // Create new office\n  app.post('/api/offices', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { name, slug, description, category, location, contactEmail, contactPhone, workingHours } = req.body;\n      \n      // Check if slug already exists\n      const existingOffice = await storage.getOfficeBySlug(slug);\n      if (existingOffice) {\n        return res.status(400).json({ message: \"Office with this URL slug already exists\" });\n      }\n      \n      const data = insertOfficeSchema.parse({\n        name,\n        slug: slug.toLowerCase().replace(/[^a-z0-9-]/g, '-'),\n        description: description || null,\n        category: category || 'general',\n        location: location || null,\n        ownerId: userId,\n        contactEmail: contactEmail || null,\n        contactPhone: contactPhone || null,\n        workingHours: workingHours || null,\n        isPublished: false,\n        subscriptionStatus: 'inactive',\n      });\n      const office = await storage.createOffice(data);\n      res.status(201).json(office);\n    } catch (error) {\n      console.error(\"Error creating office:\", error);\n      res.status(400).json({ message: \"Failed to create office\" });\n    }\n  });\n\n  // Update office\n  app.patch('/api/offices/:id', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const officeId = parseInt(req.params.id);\n      const userId = req.user.claims.sub;\n      \n      const office = await storage.getOffice(officeId);\n      if (!office) {\n        return res.status(404).json({ message: \"Office not found\" });\n      }\n      if (office.ownerId !== userId) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n      \n      const updated = await storage.updateOffice(officeId, req.body);\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error updating office:\", error);\n      res.status(500).json({ message: \"Failed to update office\" });\n    }\n  });\n\n  // Delete office\n  app.delete('/api/offices/:id', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const officeId = parseInt(req.params.id);\n      const userId = req.user.claims.sub;\n      \n      const office = await storage.getOffice(officeId);\n      if (!office) {\n        return res.status(404).json({ message: \"Office not found\" });\n      }\n      if (office.ownerId !== userId) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n      \n      await storage.deleteOffice(officeId);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting office:\", error);\n      res.status(500).json({ message: \"Failed to delete office\" });\n    }\n  });\n\n  // Manage office services (Manager & Admin only)\n  app.get('/api/offices/:officeId/services', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const officeId = parseInt(req.params.officeId);\n      const userId = req.user.claims.sub;\n      \n      const office = await storage.getOffice(officeId);\n      if (!office || office.ownerId !== userId) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n      \n      const services = await storage.getOfficeServices(officeId);\n      res.json(services);\n    } catch (error) {\n      console.error(\"Error fetching services:\", error);\n      res.status(500).json({ message: \"Failed to fetch services\" });\n    }\n  });\n\n  app.post('/api/offices/:officeId/services', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const officeId = parseInt(req.params.officeId);\n      const userId = req.user.claims.sub;\n      \n      const office = await storage.getOffice(officeId);\n      if (!office || office.ownerId !== userId) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n      \n      const data = insertOfficeServiceSchema.parse({\n        officeId,\n        ...req.body,\n      });\n      const service = await storage.createOfficeService(data);\n      res.status(201).json(service);\n    } catch (error) {\n      console.error(\"Error creating service:\", error);\n      res.status(400).json({ message: \"Failed to create service\" });\n    }\n  });\n\n  app.patch('/api/offices/:officeId/services/:serviceId', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const serviceId = parseInt(req.params.serviceId);\n      const userId = req.user.claims.sub;\n      \n      const service = await storage.getOfficeService(serviceId);\n      if (!service) {\n        return res.status(404).json({ message: \"Service not found\" });\n      }\n      \n      const office = await storage.getOffice(service.officeId);\n      if (!office || office.ownerId !== userId) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n      \n      const updated = await storage.updateOfficeService(serviceId, req.body);\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error updating service:\", error);\n      res.status(500).json({ message: \"Failed to update service\" });\n    }\n  });\n\n  app.delete('/api/offices/:officeId/services/:serviceId', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const serviceId = parseInt(req.params.serviceId);\n      const userId = req.user.claims.sub;\n      \n      const service = await storage.getOfficeService(serviceId);\n      if (!service) {\n        return res.status(404).json({ message: \"Service not found\" });\n      }\n      \n      const office = await storage.getOffice(service.officeId);\n      if (!office || office.ownerId !== userId) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n      \n      await storage.deleteOfficeService(serviceId);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting service:\", error);\n      res.status(500).json({ message: \"Failed to delete service\" });\n    }\n  });\n\n  // Manage office media (authenticated)\n  app.post('/api/offices/:officeId/media', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const officeId = parseInt(req.params.officeId);\n      const userId = req.user.claims.sub;\n      \n      const office = await storage.getOffice(officeId);\n      if (!office || office.ownerId !== userId) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n      \n      const data = insertOfficeMediaSchema.parse({\n        officeId,\n        ...req.body,\n      });\n      const media = await storage.createOfficeMedia(data);\n      res.status(201).json(media);\n    } catch (error) {\n      console.error(\"Error creating media:\", error);\n      res.status(400).json({ message: \"Failed to create media\" });\n    }\n  });\n\n  app.delete('/api/offices/:officeId/media/:mediaId', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const mediaId = parseInt(req.params.mediaId);\n      const userId = req.user.claims.sub;\n      const officeId = parseInt(req.params.officeId);\n      \n      const office = await storage.getOffice(officeId);\n      if (!office || office.ownerId !== userId) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n      \n      await storage.deleteOfficeMedia(mediaId);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting media:\", error);\n      res.status(500).json({ message: \"Failed to delete media\" });\n    }\n  });\n\n  // Manage office posts (authenticated)\n  app.post('/api/offices/:officeId/posts', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const officeId = parseInt(req.params.officeId);\n      const userId = req.user.claims.sub;\n      \n      const office = await storage.getOffice(officeId);\n      if (!office || office.ownerId !== userId) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n      \n      const data = insertOfficePostSchema.parse({\n        officeId,\n        authorId: userId,\n        ...req.body,\n      });\n      const post = await storage.createOfficePost(data);\n      res.status(201).json(post);\n    } catch (error) {\n      console.error(\"Error creating post:\", error);\n      res.status(400).json({ message: \"Failed to create post\" });\n    }\n  });\n\n  app.delete('/api/offices/:officeId/posts/:postId', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const postId = parseInt(req.params.postId);\n      const userId = req.user.claims.sub;\n      const officeId = parseInt(req.params.officeId);\n      \n      const office = await storage.getOffice(officeId);\n      if (!office || office.ownerId !== userId) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n      \n      await storage.deleteOfficePost(postId);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting post:\", error);\n      res.status(500).json({ message: \"Failed to delete post\" });\n    }\n  });\n\n  // Office chat for receptionist (authenticated - get all messages)\n  app.get('/api/offices/:officeId/messages', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const officeId = parseInt(req.params.officeId);\n      const userId = req.user.claims.sub;\n      \n      const office = await storage.getOffice(officeId);\n      if (!office || (office.ownerId !== userId && office.receptionistId !== userId)) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n      \n      const messages = await storage.getOfficeMessages(officeId);\n      res.json(messages);\n    } catch (error) {\n      console.error(\"Error fetching messages:\", error);\n      res.status(500).json({ message: \"Failed to fetch messages\" });\n    }\n  });\n\n  // Reply to visitor message (receptionist)\n  app.post('/api/offices/:officeId/messages', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const officeId = parseInt(req.params.officeId);\n      const userId = req.user.claims.sub;\n      \n      const office = await storage.getOffice(officeId);\n      if (!office || (office.ownerId !== userId && office.receptionistId !== userId)) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n      \n      const { sessionId, content } = req.body;\n      if (!sessionId || !content) {\n        return res.status(400).json({ message: \"Session ID and content are required\" });\n      }\n      \n      const data = insertOfficeMessageSchema.parse({\n        officeId,\n        sessionId,\n        senderType: 'receptionist',\n        senderId: userId,\n        content: content.trim(),\n      });\n      const message = await storage.createOfficeMessage(data);\n      \n      // Mark visitor messages as read\n      await storage.markOfficeMessagesRead(officeId, sessionId);\n      \n      res.status(201).json(message);\n    } catch (error) {\n      console.error(\"Error sending message:\", error);\n      res.status(400).json({ message: \"Failed to send message\" });\n    }\n  });\n\n  // Get unread message count for office\n  app.get('/api/offices/:officeId/messages/unread', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const officeId = parseInt(req.params.officeId);\n      const userId = req.user.claims.sub;\n      \n      const office = await storage.getOffice(officeId);\n      if (!office || (office.ownerId !== userId && office.receptionistId !== userId)) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n      \n      const count = await storage.getUnreadMessageCount(officeId);\n      res.json({ count });\n    } catch (error) {\n      console.error(\"Error fetching unread count:\", error);\n      res.status(500).json({ message: \"Failed to fetch unread count\" });\n    }\n  });\n\n  // =====================\n  // AUTHENTICATED VIDEO CALL ROUTES (Receptionist/Owner)\n  // =====================\n\n  // Get pending video calls for office\n  app.get('/api/offices/:officeId/video-calls', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const officeIdResult = officeIdParamSchema.safeParse(req.params.officeId);\n      if (!officeIdResult.success) {\n        return res.status(400).json({ message: officeIdResult.error.errors[0]?.message || \"Invalid office ID\" });\n      }\n      const officeId = officeIdResult.data;\n      const userId = req.user.claims.sub;\n      \n      const office = await storage.getOffice(officeId);\n      if (!office || (office.ownerId !== userId && office.receptionistId !== userId)) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n      \n      const calls = await storage.getPendingVideoCallsForOffice(officeId);\n      res.json(calls);\n    } catch (error) {\n      console.error(\"Error fetching video calls:\", error);\n      res.status(500).json({ message: \"Failed to fetch video calls\" });\n    }\n  });\n\n  // Accept/Start video call as receptionist\n  app.post('/api/offices/:officeId/video-calls/:callId/accept', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const officeIdResult = officeIdParamSchema.safeParse(req.params.officeId);\n      const callIdResult = callIdParamSchema.safeParse(req.params.callId);\n      \n      if (!officeIdResult.success) {\n        return res.status(400).json({ message: officeIdResult.error.errors[0]?.message || \"Invalid office ID\" });\n      }\n      if (!callIdResult.success) {\n        return res.status(400).json({ message: callIdResult.error.errors[0]?.message || \"Invalid call ID\" });\n      }\n      \n      const officeId = officeIdResult.data;\n      const callId = callIdResult.data;\n      const userId = req.user.claims.sub;\n      \n      const office = await storage.getOffice(officeId);\n      if (!office || (office.ownerId !== userId && office.receptionistId !== userId)) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n      \n      const call = await storage.getVideoCall(callId);\n      if (!call || call.officeId !== officeId) {\n        return res.status(404).json({ message: \"Video call not found\" });\n      }\n      \n      if (call.status !== 'pending') {\n        return res.status(400).json({ message: \"Video call is no longer pending\" });\n      }\n      \n      const updated = await storage.startVideoCall(callId, userId);\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error accepting video call:\", error);\n      res.status(500).json({ message: \"Failed to accept video call\" });\n    }\n  });\n\n  // Decline video call as receptionist\n  app.post('/api/offices/:officeId/video-calls/:callId/decline', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const officeIdResult = officeIdParamSchema.safeParse(req.params.officeId);\n      const callIdResult = callIdParamSchema.safeParse(req.params.callId);\n      \n      if (!officeIdResult.success) {\n        return res.status(400).json({ message: officeIdResult.error.errors[0]?.message || \"Invalid office ID\" });\n      }\n      if (!callIdResult.success) {\n        return res.status(400).json({ message: callIdResult.error.errors[0]?.message || \"Invalid call ID\" });\n      }\n      \n      const officeId = officeIdResult.data;\n      const callId = callIdResult.data;\n      const userId = req.user.claims.sub;\n      \n      const office = await storage.getOffice(officeId);\n      if (!office || (office.ownerId !== userId && office.receptionistId !== userId)) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n      \n      const call = await storage.getVideoCall(callId);\n      if (!call || call.officeId !== officeId) {\n        return res.status(404).json({ message: \"Video call not found\" });\n      }\n      \n      if (call.status !== 'pending') {\n        return res.status(400).json({ message: \"Video call is no longer pending\" });\n      }\n      \n      const updated = await storage.updateVideoCall(callId, { status: 'declined' });\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error declining video call:\", error);\n      res.status(500).json({ message: \"Failed to decline video call\" });\n    }\n  });\n\n  // End video call as receptionist\n  app.post('/api/offices/:officeId/video-calls/:callId/end', isAuthenticated, requireRole(\"manager\", \"admin\"), async (req: any, res) => {\n    try {\n      const officeIdResult = officeIdParamSchema.safeParse(req.params.officeId);\n      const callIdResult = callIdParamSchema.safeParse(req.params.callId);\n      \n      if (!officeIdResult.success) {\n        return res.status(400).json({ message: officeIdResult.error.errors[0]?.message || \"Invalid office ID\" });\n      }\n      if (!callIdResult.success) {\n        return res.status(400).json({ message: callIdResult.error.errors[0]?.message || \"Invalid call ID\" });\n      }\n      \n      const officeId = officeIdResult.data;\n      const callId = callIdResult.data;\n      const userId = req.user.claims.sub;\n      \n      const office = await storage.getOffice(officeId);\n      if (!office || (office.ownerId !== userId && office.receptionistId !== userId)) {\n        return res.status(403).json({ message: \"Not authorized\" });\n      }\n      \n      const call = await storage.getVideoCall(callId);\n      if (!call || call.officeId !== officeId) {\n        return res.status(404).json({ message: \"Video call not found\" });\n      }\n      \n      if (call.status !== 'active') {\n        return res.status(400).json({ message: \"Video call is not active\" });\n      }\n      \n      const updated = await storage.endVideoCall(callId);\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error ending video call:\", error);\n      res.status(500).json({ message: \"Failed to end video call\" });\n    }\n  });\n\n  // ============================================\n  // Daily Statuses (Stories) API\n  // ============================================\n\n  // Get active statuses (not expired)\n  app.get('/api/statuses', isAuthenticated, async (req: any, res) => {\n    try {\n      const activeStatuses = await storage.getActiveStatuses();\n      \n      // Get author info for each status\n      const statusesWithAuthors = await Promise.all(\n        activeStatuses.map(async (status) => {\n          const author = await storage.getUser(status.authorId);\n          const office = status.officeId ? await storage.getOffice(status.officeId) : null;\n          const replyCount = (await storage.getStatusReplies(status.id)).length;\n          const likeCount = await storage.getStatusLikeCount(status.id);\n          \n          return {\n            ...status,\n            author: author ? {\n              id: author.id,\n              name: `${author.firstName || ''} ${author.lastName || ''}`.trim() || 'Anonymous',\n              avatar: author.profileImageUrl\n            } : null,\n            office: office ? {\n              id: office.id,\n              name: office.name,\n              logo: office.logoUrl\n            } : null,\n            replyCount,\n            likeCount\n          };\n        })\n      );\n      \n      res.json(statusesWithAuthors);\n    } catch (error) {\n      console.error(\"Error fetching statuses:\", error);\n      res.status(500).json({ message: \"Failed to fetch statuses\" });\n    }\n  });\n\n  // Get a single status\n  app.get('/api/statuses/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const statusId = parseInt(req.params.id);\n      if (isNaN(statusId)) {\n        return res.status(400).json({ message: \"Invalid status ID\" });\n      }\n\n      const status = await storage.getStatus(statusId);\n      if (!status) {\n        return res.status(404).json({ message: \"Status not found\" });\n      }\n\n      const author = await storage.getUser(status.authorId);\n      const office = status.officeId ? await storage.getOffice(status.officeId) : null;\n      const userId = req.user.claims.sub;\n      \n      // Record view if not the author\n      if (status.authorId !== userId) {\n        const hasViewed = await storage.hasUserViewedStatus(statusId, userId);\n        if (!hasViewed) {\n          await storage.addStatusView({ statusId, viewerId: userId });\n          await storage.incrementStatusViews(statusId);\n        }\n      }\n\n      // Get view count, like count, and status\n      const views = await storage.getStatusViews(statusId);\n      const likeCount = await storage.getStatusLikeCount(statusId);\n      const isLiked = await storage.hasUserLikedStatus(statusId, userId);\n      const replyCount = (await storage.getStatusReplies(statusId)).length;\n      const isFollowingOffice = office ? await storage.isFollowingOffice(office.id, userId) : false;\n      \n      res.json({\n        ...status,\n        author: author ? {\n          id: author.id,\n          name: `${author.firstName || ''} ${author.lastName || ''}`.trim() || 'Anonymous',\n          avatar: author.profileImageUrl\n        } : null,\n        office: office ? {\n          id: office.id,\n          name: office.name,\n          logo: office.logoUrl\n        } : null,\n        viewCount: views.length,\n        likeCount,\n        isLiked,\n        replyCount,\n        isFollowingOffice\n      });\n    } catch (error) {\n      console.error(\"Error fetching status:\", error);\n      res.status(500).json({ message: \"Failed to fetch status\" });\n    }\n  });\n\n  // Create a new status\n  app.post('/api/statuses', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      \n      // Set expiration to 24 hours from now\n      const expiresAt = new Date();\n      expiresAt.setHours(expiresAt.getHours() + 24);\n      \n      const statusData = insertStatusSchema.safeParse({\n        ...req.body,\n        authorId: userId,\n        expiresAt\n      });\n\n      if (!statusData.success) {\n        return res.status(400).json({ \n          message: \"Invalid status data\",\n          errors: statusData.error.errors \n        });\n      }\n\n      const newStatus = await storage.createStatus(statusData.data);\n      res.status(201).json(newStatus);\n    } catch (error) {\n      console.error(\"Error creating status:\", error);\n      res.status(500).json({ message: \"Failed to create status\" });\n    }\n  });\n\n  // Delete a status\n  app.delete('/api/statuses/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const statusId = parseInt(req.params.id);\n      if (isNaN(statusId)) {\n        return res.status(400).json({ message: \"Invalid status ID\" });\n      }\n\n      const status = await storage.getStatus(statusId);\n      if (!status) {\n        return res.status(404).json({ message: \"Status not found\" });\n      }\n\n      const userId = req.user.claims.sub;\n      if (status.authorId !== userId) {\n        return res.status(403).json({ message: \"Not authorized to delete this status\" });\n      }\n\n      await storage.deleteStatus(statusId);\n      res.json({ message: \"Status deleted\" });\n    } catch (error) {\n      console.error(\"Error deleting status:\", error);\n      res.status(500).json({ message: \"Failed to delete status\" });\n    }\n  });\n\n  // Get replies for a status\n  app.get('/api/statuses/:id/replies', isAuthenticated, async (req: any, res) => {\n    try {\n      const statusId = parseInt(req.params.id);\n      if (isNaN(statusId)) {\n        return res.status(400).json({ message: \"Invalid status ID\" });\n      }\n\n      const status = await storage.getStatus(statusId);\n      if (!status) {\n        return res.status(404).json({ message: \"Status not found\" });\n      }\n\n      const replies = await storage.getStatusReplies(statusId);\n      \n      // Get sender info for each reply\n      const repliesWithSenders = await Promise.all(\n        replies.map(async (reply) => {\n          const sender = await storage.getUser(reply.senderId);\n          return {\n            ...reply,\n            sender: sender ? {\n              id: sender.id,\n              name: `${sender.firstName || ''} ${sender.lastName || ''}`.trim() || 'Anonymous',\n              avatar: sender.profileImageUrl\n            } : null\n          };\n        })\n      );\n      \n      res.json(repliesWithSenders);\n    } catch (error) {\n      console.error(\"Error fetching replies:\", error);\n      res.status(500).json({ message: \"Failed to fetch replies\" });\n    }\n  });\n\n  // Create a reply to a status\n  app.post('/api/statuses/:id/replies', isAuthenticated, async (req: any, res) => {\n    try {\n      const statusId = parseInt(req.params.id);\n      if (isNaN(statusId)) {\n        return res.status(400).json({ message: \"Invalid status ID\" });\n      }\n\n      const status = await storage.getStatus(statusId);\n      if (!status) {\n        return res.status(404).json({ message: \"Status not found\" });\n      }\n\n      const userId = req.user.claims.sub;\n      \n      const replyData = insertStatusReplySchema.safeParse({\n        statusId,\n        senderId: userId,\n        message: req.body.message\n      });\n\n      if (!replyData.success) {\n        return res.status(400).json({ \n          message: \"Invalid reply data\",\n          errors: replyData.error.errors \n        });\n      }\n\n      const newReply = await storage.createStatusReply(replyData.data);\n      \n      // Get sender info\n      const sender = await storage.getUser(userId);\n      \n      res.status(201).json({\n        ...newReply,\n        sender: sender ? {\n          id: sender.id,\n          name: `${sender.firstName || ''} ${sender.lastName || ''}`.trim() || 'Anonymous',\n          avatar: sender.profileImageUrl\n        } : null\n      });\n    } catch (error) {\n      console.error(\"Error creating reply:\", error);\n      res.status(500).json({ message: \"Failed to create reply\" });\n    }\n  });\n\n  // Like a status\n  app.post('/api/statuses/:id/like', isAuthenticated, async (req: any, res) => {\n    try {\n      const statusId = parseInt(req.params.id);\n      if (isNaN(statusId)) {\n        return res.status(400).json({ message: \"Invalid status ID\" });\n      }\n\n      const status = await storage.getStatus(statusId);\n      if (!status) {\n        return res.status(404).json({ message: \"Status not found\" });\n      }\n\n      const userId = req.user.claims.sub;\n      \n      // Check if already liked\n      const existingLike = await storage.getStatusLike(statusId, userId);\n      if (existingLike) {\n        return res.status(400).json({ message: \"Already liked this status\" });\n      }\n\n      const like = await storage.createStatusLike({ statusId, userId });\n      res.status(201).json(like);\n    } catch (error) {\n      console.error(\"Error liking status:\", error);\n      res.status(500).json({ message: \"Failed to like status\" });\n    }\n  });\n\n  // Unlike a status\n  app.delete('/api/statuses/:id/like', isAuthenticated, async (req: any, res) => {\n    try {\n      const statusId = parseInt(req.params.id);\n      if (isNaN(statusId)) {\n        return res.status(400).json({ message: \"Invalid status ID\" });\n      }\n\n      const userId = req.user.claims.sub;\n      \n      const deleted = await storage.deleteStatusLike(statusId, userId);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Like not found\" });\n      }\n\n      res.json({ message: \"Like removed\" });\n    } catch (error) {\n      console.error(\"Error unliking status:\", error);\n      res.status(500).json({ message: \"Failed to unlike status\" });\n    }\n  });\n\n  // Get status views\n  app.get('/api/statuses/:id/views', isAuthenticated, async (req: any, res) => {\n    try {\n      const statusId = parseInt(req.params.id);\n      if (isNaN(statusId)) {\n        return res.status(400).json({ message: \"Invalid status ID\" });\n      }\n\n      const status = await storage.getStatus(statusId);\n      if (!status) {\n        return res.status(404).json({ message: \"Status not found\" });\n      }\n\n      const userId = req.user.claims.sub;\n      if (status.authorId !== userId) {\n        return res.status(403).json({ message: \"Only the author can view who saw the status\" });\n      }\n\n      const views = await storage.getStatusViews(statusId);\n      \n      // Get viewer info\n      const viewsWithViewers = await Promise.all(\n        views.map(async (view) => {\n          const viewer = await storage.getUser(view.viewerId);\n          return {\n            ...view,\n            viewer: viewer ? {\n              id: viewer.id,\n              name: `${viewer.firstName || ''} ${viewer.lastName || ''}`.trim() || 'Anonymous',\n              avatar: viewer.profileImageUrl\n            } : null\n          };\n        })\n      );\n      \n      res.json(viewsWithViewers);\n    } catch (error) {\n      console.error(\"Error fetching views:\", error);\n      res.status(500).json({ message: \"Failed to fetch views\" });\n    }\n  });\n\n  // ============================================\n  // Office Follow API\n  // ============================================\n\n  // Follow an office\n  app.post('/api/offices/:officeId/follow', isAuthenticated, async (req: any, res) => {\n    try {\n      const officeId = parseInt(req.params.officeId);\n      if (isNaN(officeId)) {\n        return res.status(400).json({ message: \"Invalid office ID\" });\n      }\n\n      const office = await storage.getOffice(officeId);\n      if (!office) {\n        return res.status(404).json({ message: \"Office not found\" });\n      }\n\n      const userId = req.user.claims.sub;\n      \n      const isFollowing = await storage.isFollowingOffice(officeId, userId);\n      if (isFollowing) {\n        return res.status(400).json({ message: \"Already following this office\" });\n      }\n\n      const follow = await storage.followOffice(officeId, userId);\n      res.status(201).json({ \n        message: \"Now following office\",\n        followerCount: await storage.getOfficeFollowerCount(officeId)\n      });\n    } catch (error) {\n      console.error(\"Error following office:\", error);\n      res.status(500).json({ message: \"Failed to follow office\" });\n    }\n  });\n\n  // Unfollow an office\n  app.delete('/api/offices/:officeId/follow', isAuthenticated, async (req: any, res) => {\n    try {\n      const officeId = parseInt(req.params.officeId);\n      if (isNaN(officeId)) {\n        return res.status(400).json({ message: \"Invalid office ID\" });\n      }\n\n      const office = await storage.getOffice(officeId);\n      if (!office) {\n        return res.status(404).json({ message: \"Office not found\" });\n      }\n\n      const userId = req.user.claims.sub;\n      \n      const isFollowing = await storage.isFollowingOffice(officeId, userId);\n      if (!isFollowing) {\n        return res.status(400).json({ message: \"Not following this office\" });\n      }\n\n      await storage.unfollowOffice(officeId, userId);\n      res.json({ \n        message: \"Unfollowed office\",\n        followerCount: await storage.getOfficeFollowerCount(officeId)\n      });\n    } catch (error) {\n      console.error(\"Error unfollowing office:\", error);\n      res.status(500).json({ message: \"Failed to unfollow office\" });\n    }\n  });\n\n  // Check if following an office\n  app.get('/api/offices/:officeId/follow', isAuthenticated, async (req: any, res) => {\n    try {\n      const officeId = parseInt(req.params.officeId);\n      if (isNaN(officeId)) {\n        return res.status(400).json({ message: \"Invalid office ID\" });\n      }\n\n      const office = await storage.getOffice(officeId);\n      if (!office) {\n        return res.status(404).json({ message: \"Office not found\" });\n      }\n\n      const userId = req.user.claims.sub;\n      \n      const isFollowing = await storage.isFollowingOffice(officeId, userId);\n      const followerCount = await storage.getOfficeFollowerCount(officeId);\n      \n      res.json({ isFollowing, followerCount });\n    } catch (error) {\n      console.error(\"Error checking follow status:\", error);\n      res.status(500).json({ message: \"Failed to check follow status\" });\n    }\n  });\n\n  // =====================\n  // Internal Email Routes\n  // =====================\n  \n  // Get inbox emails\n  app.get('/api/emails/inbox', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const emails = await storage.getInboxEmails(userId);\n      \n      // Enhance with sender info\n      const emailsWithSender = await Promise.all(emails.map(async (email) => {\n        const sender = await storage.getUser(email.senderId);\n        return { ...email, sender };\n      }));\n      \n      res.json(emailsWithSender);\n    } catch (error) {\n      console.error(\"Error fetching inbox:\", error);\n      res.status(500).json({ message: \"Failed to fetch inbox\" });\n    }\n  });\n\n  // Get sent emails\n  app.get('/api/emails/sent', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const emails = await storage.getSentEmails(userId);\n      \n      // Enhance with recipient info\n      const emailsWithRecipient = await Promise.all(emails.map(async (email) => {\n        const recipient = await storage.getUser(email.recipientId);\n        return { ...email, recipient };\n      }));\n      \n      res.json(emailsWithRecipient);\n    } catch (error) {\n      console.error(\"Error fetching sent emails:\", error);\n      res.status(500).json({ message: \"Failed to fetch sent emails\" });\n    }\n  });\n\n  // Get draft emails\n  app.get('/api/emails/drafts', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const emails = await storage.getDraftEmails(userId);\n      \n      const emailsWithRecipient = await Promise.all(emails.map(async (email) => {\n        const recipient = await storage.getUser(email.recipientId);\n        return { ...email, recipient };\n      }));\n      \n      res.json(emailsWithRecipient);\n    } catch (error) {\n      console.error(\"Error fetching drafts:\", error);\n      res.status(500).json({ message: \"Failed to fetch drafts\" });\n    }\n  });\n\n  // Get starred emails\n  app.get('/api/emails/starred', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const emails = await storage.getStarredEmails(userId);\n      \n      const emailsWithUsers = await Promise.all(emails.map(async (email) => {\n        const sender = await storage.getUser(email.senderId);\n        const recipient = await storage.getUser(email.recipientId);\n        return { ...email, sender, recipient };\n      }));\n      \n      res.json(emailsWithUsers);\n    } catch (error) {\n      console.error(\"Error fetching starred emails:\", error);\n      res.status(500).json({ message: \"Failed to fetch starred emails\" });\n    }\n  });\n\n  // Get archived emails\n  app.get('/api/emails/archived', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const emails = await storage.getArchivedEmails(userId);\n      \n      const emailsWithUsers = await Promise.all(emails.map(async (email) => {\n        const sender = await storage.getUser(email.senderId);\n        const recipient = await storage.getUser(email.recipientId);\n        return { ...email, sender, recipient };\n      }));\n      \n      res.json(emailsWithUsers);\n    } catch (error) {\n      console.error(\"Error fetching archived emails:\", error);\n      res.status(500).json({ message: \"Failed to fetch archived emails\" });\n    }\n  });\n\n  // Get unread email count\n  app.get('/api/emails/unread-count', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const count = await storage.getUnreadEmailCount(userId);\n      res.json({ count });\n    } catch (error) {\n      console.error(\"Error fetching unread count:\", error);\n      res.status(500).json({ message: \"Failed to fetch unread count\" });\n    }\n  });\n\n  // Get single email\n  app.get('/api/emails/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const emailId = parseInt(req.params.id);\n      if (isNaN(emailId)) {\n        return res.status(400).json({ message: \"Invalid email ID\" });\n      }\n      \n      const email = await storage.getInternalEmail(emailId);\n      if (!email) {\n        return res.status(404).json({ message: \"Email not found\" });\n      }\n      \n      const userId = req.user.claims.sub;\n      if (email.senderId !== userId && email.recipientId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      // Mark as read if recipient is viewing\n      if (email.recipientId === userId && !email.isRead) {\n        await storage.markEmailAsRead(emailId);\n      }\n      \n      const sender = await storage.getUser(email.senderId);\n      const recipient = await storage.getUser(email.recipientId);\n      \n      res.json({ ...email, sender, recipient });\n    } catch (error) {\n      console.error(\"Error fetching email:\", error);\n      res.status(500).json({ message: \"Failed to fetch email\" });\n    }\n  });\n\n  // Send or save draft email\n  app.post('/api/emails', isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const { recipientId, subject, body, isDraft } = req.body;\n      \n      if (!recipientId || !subject) {\n        return res.status(400).json({ message: \"Recipient and subject are required\" });\n      }\n      \n      // Verify recipient exists\n      const recipient = await storage.getUser(recipientId);\n      if (!recipient) {\n        return res.status(400).json({ message: \"Recipient not found\" });\n      }\n      \n      const emailData = {\n        senderId: userId,\n        recipientId,\n        subject,\n        body: body || \"\",\n        isDraft: isDraft || false,\n      };\n      \n      const email = await storage.createInternalEmail(emailData);\n      res.status(201).json(email);\n    } catch (error) {\n      console.error(\"Error creating email:\", error);\n      res.status(400).json({ message: \"Failed to create email\" });\n    }\n  });\n\n  // Update email (for drafts)\n  app.patch('/api/emails/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const emailId = parseInt(req.params.id);\n      if (isNaN(emailId)) {\n        return res.status(400).json({ message: \"Invalid email ID\" });\n      }\n      \n      const email = await storage.getInternalEmail(emailId);\n      if (!email) {\n        return res.status(404).json({ message: \"Email not found\" });\n      }\n      \n      const userId = req.user.claims.sub;\n      if (email.senderId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      const { recipientId, subject, body, isDraft } = req.body;\n      \n      const updated = await storage.updateInternalEmail(emailId, {\n        recipientId: recipientId || email.recipientId,\n        subject: subject || email.subject,\n        body: body !== undefined ? body : email.body,\n        isDraft: isDraft !== undefined ? isDraft : email.isDraft,\n      });\n      \n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error updating email:\", error);\n      res.status(400).json({ message: \"Failed to update email\" });\n    }\n  });\n\n  // Delete email\n  app.delete('/api/emails/:id', isAuthenticated, async (req: any, res) => {\n    try {\n      const emailId = parseInt(req.params.id);\n      if (isNaN(emailId)) {\n        return res.status(400).json({ message: \"Invalid email ID\" });\n      }\n      \n      const email = await storage.getInternalEmail(emailId);\n      if (!email) {\n        return res.status(404).json({ message: \"Email not found\" });\n      }\n      \n      const userId = req.user.claims.sub;\n      if (email.senderId !== userId && email.recipientId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      await storage.deleteInternalEmail(emailId);\n      res.json({ message: \"Email deleted\" });\n    } catch (error) {\n      console.error(\"Error deleting email:\", error);\n      res.status(500).json({ message: \"Failed to delete email\" });\n    }\n  });\n\n  // Toggle starred\n  app.post('/api/emails/:id/star', isAuthenticated, async (req: any, res) => {\n    try {\n      const emailId = parseInt(req.params.id);\n      if (isNaN(emailId)) {\n        return res.status(400).json({ message: \"Invalid email ID\" });\n      }\n      \n      const email = await storage.getInternalEmail(emailId);\n      if (!email) {\n        return res.status(404).json({ message: \"Email not found\" });\n      }\n      \n      const userId = req.user.claims.sub;\n      if (email.senderId !== userId && email.recipientId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      await storage.toggleEmailStarred(emailId);\n      const updated = await storage.getInternalEmail(emailId);\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error toggling star:\", error);\n      res.status(500).json({ message: \"Failed to toggle star\" });\n    }\n  });\n\n  // Archive email\n  app.post('/api/emails/:id/archive', isAuthenticated, async (req: any, res) => {\n    try {\n      const emailId = parseInt(req.params.id);\n      if (isNaN(emailId)) {\n        return res.status(400).json({ message: \"Invalid email ID\" });\n      }\n      \n      const email = await storage.getInternalEmail(emailId);\n      if (!email) {\n        return res.status(404).json({ message: \"Email not found\" });\n      }\n      \n      const userId = req.user.claims.sub;\n      if (email.senderId !== userId && email.recipientId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      await storage.moveEmailToArchive(emailId);\n      res.json({ message: \"Email archived\" });\n    } catch (error) {\n      console.error(\"Error archiving email:\", error);\n      res.status(500).json({ message: \"Failed to archive email\" });\n    }\n  });\n\n  // Mark as read\n  app.post('/api/emails/:id/read', isAuthenticated, async (req: any, res) => {\n    try {\n      const emailId = parseInt(req.params.id);\n      if (isNaN(emailId)) {\n        return res.status(400).json({ message: \"Invalid email ID\" });\n      }\n      \n      const email = await storage.getInternalEmail(emailId);\n      if (!email) {\n        return res.status(404).json({ message: \"Email not found\" });\n      }\n      \n      const userId = req.user.claims.sub;\n      if (email.recipientId !== userId) {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      await storage.markEmailAsRead(emailId);\n      res.json({ message: \"Email marked as read\" });\n    } catch (error) {\n      console.error(\"Error marking as read:\", error);\n      res.status(500).json({ message: \"Failed to mark as read\" });\n    }\n  });\n\n  // =====================\n  // n8n Internal Email Webhook (Public endpoint for n8n to send internal emails)\n  // =====================\n  const n8nInternalEmailSchema = z.object({\n    recipientEmail: z.string().email(\"Valid email required\"),\n    subject: z.string().min(1, \"Subject is required\"),\n    body: z.string().min(1, \"Body is required\"),\n    taskId: z.number().optional(),\n    automationId: z.number().optional(),\n  });\n\n  app.post('/api/n8n/internal-email', async (req, res) => {\n    try {\n      const validationResult = n8nInternalEmailSchema.safeParse(req.body);\n      if (!validationResult.success) {\n        return res.status(400).json({ \n          message: \"Invalid request data\",\n          errors: validationResult.error.errors \n        });\n      }\n\n      const { recipientEmail, subject, body, taskId, automationId } = validationResult.data;\n\n      // Find recipient user by email\n      const recipient = await storage.getUserByEmail(recipientEmail);\n      \n      if (!recipient) {\n        return res.status(404).json({ message: \"Recipient not found with email: \" + recipientEmail });\n      }\n\n      // Use system user or first admin as sender\n      const allUsers = await storage.getAllUsers();\n      const admins = allUsers.filter(u => u.role === 'admin');\n      const systemSender = admins[0] || allUsers[0];\n      \n      if (!systemSender) {\n        return res.status(500).json({ message: \"No system sender available\" });\n      }\n\n      // Create internal email\n      const email = await storage.createInternalEmail({\n        senderId: systemSender.id,\n        recipientId: recipient.id,\n        subject,\n        body,\n        isDraft: false,\n      });\n\n      // Also create a notification\n      await storage.createNotification({\n        userId: recipient.id,\n        type: 'n8n_task',\n        title: subject,\n        message: body.substring(0, 200),\n        read: false,\n        data: { taskId, automationId, emailId: email.id },\n      });\n\n      // Update automation status if provided\n      if (automationId) {\n        await storage.updateTaskAutomation(automationId, { \n          status: 'completed',\n          aiMetadata: { emailId: email.id, sentAt: new Date().toISOString(), internalEmailSent: true }\n        });\n      }\n\n      console.log(`n8n internal email sent to ${recipientEmail}: ${subject}`);\n      res.status(201).json({ \n        success: true, \n        message: \"Internal email sent successfully\",\n        emailId: email.id \n      });\n    } catch (error) {\n      console.error(\"Error processing n8n internal email:\", error);\n      res.status(500).json({ message: \"Failed to send internal email\" });\n    }\n  });\n\n  // =====================\n  // n8n AI Task Processing (AI-powered task research and response)\n  // =====================\n  const n8nAiTaskSchema = z.object({\n    taskId: z.number(),\n    automationId: z.number(),\n    title: z.string(),\n    description: z.string().nullable().optional(),\n    priority: z.string().optional(),\n    assigneeEmail: z.string().email().optional(),\n  });\n\n  app.post('/api/n8n/ai-process', async (req, res) => {\n    try {\n      const validationResult = n8nAiTaskSchema.safeParse(req.body);\n      if (!validationResult.success) {\n        return res.status(400).json({ \n          message: \"Invalid request data\",\n          errors: validationResult.error.errors \n        });\n      }\n\n      const { taskId, automationId, title, description, priority, assigneeEmail } = validationResult.data;\n\n      // Import OpenAI\n      const OpenAI = (await import('openai')).default;\n      const openai = new OpenAI({\n        apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY,\n        baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n      });\n\n      // Create AI prompt based on task\n      const taskPrompt = `     .    :\n\n: ${title}\n${description ? `: ${description}` : ''}\n${priority ? `: ${priority}` : ''}\n\n   :\n1.   \n2.    \n3.    \n4.      \n\n     .`;\n\n      console.log(`Processing AI task: ${title}`);\n\n      // Call OpenAI\n      const completion = await openai.chat.completions.create({\n        model: \"gpt-4o-mini\",\n        messages: [\n          { role: \"system\", content: \"      .      .\" },\n          { role: \"user\", content: taskPrompt }\n        ],\n        max_tokens: 2000,\n        temperature: 0.7,\n      });\n\n      const aiResponse = completion.choices[0]?.message?.content || \"     .\";\n\n      // Update task automation with AI response\n      await storage.updateTaskAutomation(automationId, {\n        status: 'ready',\n        aiSuggestion: aiResponse,\n        aiMetadata: { \n          processedAt: new Date().toISOString(),\n          model: \"gpt-4o-mini\",\n          tokensUsed: completion.usage?.total_tokens || 0\n        }\n      });\n\n      // Find recipient and send internal email with AI response\n      let recipientId: string | null = null;\n      if (assigneeEmail) {\n        const recipient = await storage.getUserByEmail(assigneeEmail);\n        if (recipient) {\n          recipientId = recipient.id;\n        }\n      }\n\n      // If no assignee, send to first admin\n      if (!recipientId) {\n        const allUsers = await storage.getAllUsers();\n        const admins = allUsers.filter(u => u.role === 'admin');\n        recipientId = admins[0]?.id || allUsers[0]?.id || null;\n      }\n\n      if (recipientId) {\n        const allUsers = await storage.getAllUsers();\n        const systemSender = allUsers.find(u => u.role === 'admin') || allUsers[0];\n        \n        if (systemSender) {\n          // Send internal email with AI response\n          const email = await storage.createInternalEmail({\n            senderId: systemSender.id,\n            recipientId: recipientId,\n            subject: ` : ${title}`,\n            body: `     :\\n\\n${aiResponse}\\n\\n---\\n    n8n + AI`,\n            isDraft: false,\n          });\n\n          // Create notification\n          await storage.createNotification({\n            userId: recipientId,\n            type: 'ai_task_completed',\n            title: ` : ${title}`,\n            message: aiResponse.substring(0, 200) + '...',\n            read: false,\n            data: { taskId, automationId, emailId: email.id },\n          });\n        }\n      }\n\n      console.log(`AI task processed successfully: ${title}`);\n      res.status(200).json({ \n        success: true, \n        message: \"Task processed by AI successfully\",\n        aiResponse: aiResponse.substring(0, 500) + '...',\n        automationId\n      });\n    } catch (error) {\n      console.error(\"Error processing AI task:\", error);\n      res.status(500).json({ message: \"Failed to process task with AI\" });\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":140485,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/examples/ChatMessage.tsx":{"content":"import { ChatMessage } from \"../ChatMessage\";\n\nexport default function ChatMessageExample() {\n  return (\n    <div className=\"space-y-4 p-4 max-w-md\">\n      <ChatMessage\n        id=\"1\"\n        sender={{ name: \"James Wilson\" }}\n        content=\"Hey team, how's the progress on the new feature?\"\n        timestamp=\"10:30 AM\"\n        isOwn={false}\n      />\n      <ChatMessage\n        id=\"2\"\n        sender={{ name: \"You\" }}\n        content=\"Going well! Should be done by end of day.\"\n        timestamp=\"10:32 AM\"\n        isOwn={true}\n      />\n      <ChatMessage\n        id=\"3\"\n        sender={{ name: \"Maria Garcia\" }}\n        content=\"I'll have the designs ready for review in an hour.\"\n        timestamp=\"10:35 AM\"\n        isOwn={false}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":762,"size_tokens":null},"client/src/components/TopHeader.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { ThemeToggle } from \"./ThemeToggle\";\nimport { NotificationItem } from \"./NotificationItem\";\nimport { Bell, Search } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport type { Notification } from \"@shared/schema\";\n\nexport function TopHeader() {\n  const [searchOpen, setSearchOpen] = useState(false);\n\n  const { data: notifications = [] } = useQuery<Notification[]>({\n    queryKey: [\"/api/notifications\"],\n  });\n\n  const { data: unreadData } = useQuery<{ count: number }>({\n    queryKey: [\"/api/notifications/unread-count\"],\n  });\n\n  const markReadMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"PATCH\", `/api/notifications/${id}/read`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications/unread-count\"] });\n    },\n  });\n\n  const markAllReadMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"POST\", \"/api/notifications/read-all\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications/unread-count\"] });\n    },\n  });\n\n  const unreadCount = unreadData?.count || 0;\n\n  const handleNotificationClick = (id: number) => {\n    markReadMutation.mutate(id);\n  };\n\n  return (\n    <header className=\"flex items-center justify-between gap-4 h-16 px-4 border-b bg-background sticky top-0 z-50\">\n      <div className=\"flex items-center gap-2\">\n        <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n      </div>\n\n      <div className=\"flex-1 max-w-md mx-4\">\n        {searchOpen ? (\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search...\"\n              className=\"pl-9\"\n              autoFocus\n              onBlur={() => setSearchOpen(false)}\n              data-testid=\"input-search\"\n            />\n          </div>\n        ) : (\n          <Button\n            variant=\"outline\"\n            className=\"w-full justify-start text-muted-foreground\"\n            onClick={() => setSearchOpen(true)}\n            data-testid=\"button-search\"\n          >\n            <Search className=\"h-4 w-4 mr-2\" />\n            Search...\n          </Button>\n        )}\n      </div>\n\n      <div className=\"flex items-center gap-1\">\n        <Popover>\n          <PopoverTrigger asChild>\n            <Button variant=\"ghost\" size=\"icon\" className=\"relative\" data-testid=\"button-notifications\">\n              <Bell className=\"h-5 w-5\" />\n              {unreadCount > 0 && (\n                <Badge className=\"absolute -top-1 -right-1 h-5 min-w-5 px-1 text-xs\">\n                  {unreadCount}\n                </Badge>\n              )}\n            </Button>\n          </PopoverTrigger>\n          <PopoverContent align=\"end\" className=\"w-80 p-2\">\n            <div className=\"flex items-center justify-between px-2 pb-2 border-b mb-2\">\n              <span className=\"font-medium\">Notifications</span>\n              {unreadCount > 0 && (\n                <Button \n                  variant=\"ghost\" \n                  size=\"sm\" \n                  className=\"text-xs\"\n                  onClick={() => markAllReadMutation.mutate()}\n                >\n                  Mark all read\n                </Button>\n              )}\n            </div>\n            {notifications.length > 0 ? (\n              <div className=\"space-y-1 max-h-80 overflow-y-auto\">\n                {notifications.map((notification) => (\n                  <NotificationItem\n                    key={notification.id}\n                    id={String(notification.id)}\n                    title={notification.title}\n                    message={notification.message || \"\"}\n                    time={notification.createdAt ? new Date(notification.createdAt).toLocaleString() : \"\"}\n                    isRead={notification.read || false}\n                    onClick={() => handleNotificationClick(notification.id)}\n                  />\n                ))}\n              </div>\n            ) : (\n              <p className=\"text-sm text-muted-foreground text-center py-4\">\n                No notifications\n              </p>\n            )}\n          </PopoverContent>\n        </Popover>\n        <ThemeToggle />\n      </div>\n    </header>\n  );\n}\n","path":null,"size_bytes":4852,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ObjectUploader.tsx":{"content":"import { useState, useRef } from \"react\";\nimport type { ReactNode, ChangeEvent } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Upload, X, Loader2, CheckCircle } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Progress } from \"@/components/ui/progress\";\n\ninterface UploadResult {\n  successful: Array<{ uploadURL: string; meta?: Record<string, any> }>;\n  failed: Array<{ error: string }>;\n}\n\ninterface ObjectUploaderProps {\n  maxNumberOfFiles?: number;\n  maxFileSize?: number;\n  allowedFileTypes?: string[];\n  onGetUploadParameters: () => Promise<{\n    method: \"PUT\";\n    url: string;\n    meta?: Record<string, any>;\n  }>;\n  onComplete?: (result: UploadResult) => void;\n  buttonClassName?: string;\n  buttonVariant?: \"default\" | \"outline\" | \"ghost\" | \"secondary\";\n  buttonSize?: \"default\" | \"sm\" | \"lg\" | \"icon\";\n  children: ReactNode;\n}\n\nexport function ObjectUploader({\n  maxFileSize = 52428800,\n  allowedFileTypes,\n  onGetUploadParameters,\n  onComplete,\n  buttonClassName,\n  buttonVariant = \"outline\",\n  buttonSize = \"sm\",\n  children,\n}: ObjectUploaderProps) {\n  const [showModal, setShowModal] = useState(false);\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [error, setError] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const handleFileChange = (e: ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    if (file.size > maxFileSize) {\n      setError(`File size exceeds ${Math.round(maxFileSize / 1024 / 1024)}MB limit`);\n      return;\n    }\n\n    if (allowedFileTypes && allowedFileTypes.length > 0) {\n      const isAllowed = allowedFileTypes.some(type => {\n        if (type.startsWith('.')) {\n          return file.name.toLowerCase().endsWith(type.toLowerCase());\n        }\n        if (type.includes('*')) {\n          const [mainType] = type.split('/');\n          return file.type.startsWith(mainType);\n        }\n        return file.type === type;\n      });\n      if (!isAllowed) {\n        setError(`File type not allowed. Allowed: ${allowedFileTypes.join(', ')}`);\n        return;\n      }\n    }\n\n    setError(null);\n    setSelectedFile(file);\n  };\n\n  const handleUpload = async () => {\n    if (!selectedFile) return;\n\n    setUploading(true);\n    setProgress(0);\n    setError(null);\n\n    try {\n      const { url, meta } = await onGetUploadParameters();\n      \n      const xhr = new XMLHttpRequest();\n      \n      xhr.upload.addEventListener('progress', (e) => {\n        if (e.lengthComputable) {\n          const percent = Math.round((e.loaded / e.total) * 100);\n          setProgress(percent);\n        }\n      });\n\n      await new Promise<void>((resolve, reject) => {\n        xhr.onload = () => {\n          if (xhr.status >= 200 && xhr.status < 300) {\n            resolve();\n          } else {\n            reject(new Error(`Upload failed with status ${xhr.status}`));\n          }\n        };\n        xhr.onerror = () => reject(new Error('Network error'));\n        \n        xhr.open('PUT', url);\n        xhr.setRequestHeader('Content-Type', selectedFile.type || 'application/octet-stream');\n        xhr.send(selectedFile);\n      });\n\n      const uploadURL = url.split('?')[0];\n      \n      onComplete?.({\n        successful: [{ uploadURL, meta }],\n        failed: [],\n      });\n\n      setShowModal(false);\n      setSelectedFile(null);\n      setProgress(0);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Upload failed');\n      onComplete?.({\n        successful: [],\n        failed: [{ error: err instanceof Error ? err.message : 'Upload failed' }],\n      });\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleClose = () => {\n    if (!uploading) {\n      setShowModal(false);\n      setSelectedFile(null);\n      setProgress(0);\n      setError(null);\n    }\n  };\n\n  const triggerFileSelect = () => {\n    fileInputRef.current?.click();\n  };\n\n  return (\n    <>\n      <Button \n        type=\"button\"\n        onClick={() => setShowModal(true)} \n        className={buttonClassName}\n        variant={buttonVariant}\n        size={buttonSize}\n      >\n        {children}\n      </Button>\n\n      <Dialog open={showModal} onOpenChange={handleClose}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Upload File</DialogTitle>\n          </DialogHeader>\n          \n          <div className=\"space-y-4\">\n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              onChange={handleFileChange}\n              accept={allowedFileTypes?.join(',')}\n              className=\"hidden\"\n              data-testid=\"input-file-upload\"\n            />\n\n            {!selectedFile ? (\n              <div \n                onClick={triggerFileSelect}\n                className=\"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center cursor-pointer hover:border-muted-foreground/50 transition-colors\"\n                data-testid=\"dropzone-upload\"\n              >\n                <Upload className=\"mx-auto h-10 w-10 text-muted-foreground mb-3\" />\n                <p className=\"text-sm text-muted-foreground\">\n                  Click to select a file\n                </p>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  Max size: {Math.round(maxFileSize / 1024 / 1024)}MB\n                </p>\n              </div>\n            ) : (\n              <div className=\"border rounded-lg p-4\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className=\"text-sm truncate max-w-[200px]\">{selectedFile.name}</span>\n                  {!uploading && (\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => setSelectedFile(null)}\n                      data-testid=\"button-remove-selected-file\"\n                    >\n                      <X className=\"h-4 w-4\" />\n                    </Button>\n                  )}\n                </div>\n                <p className=\"text-xs text-muted-foreground\">\n                  {(selectedFile.size / 1024 / 1024).toFixed(2)} MB\n                </p>\n                \n                {uploading && (\n                  <div className=\"mt-3\">\n                    <Progress value={progress} className=\"h-2\" />\n                    <p className=\"text-xs text-muted-foreground mt-1 text-center\">\n                      {progress}%\n                    </p>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {error && (\n              <p className=\"text-sm text-destructive\">{error}</p>\n            )}\n\n            <div className=\"flex justify-end gap-2\">\n              <Button \n                variant=\"outline\" \n                onClick={handleClose}\n                disabled={uploading}\n                data-testid=\"button-cancel-upload\"\n              >\n                Cancel\n              </Button>\n              <Button \n                onClick={handleUpload}\n                disabled={!selectedFile || uploading}\n                data-testid=\"button-confirm-upload\"\n              >\n                {uploading ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Uploading...\n                  </>\n                ) : (\n                  <>\n                    <Upload className=\"mr-2 h-4 w-4\" />\n                    Upload\n                  </>\n                )}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n","path":null,"size_bytes":7814,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    limit: '50mb',\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false, limit: '50mb' }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2594,"size_tokens":null},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","path":null,"size_bytes":483,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4050,"size_tokens":null},"shared/schema.ts":{"content":"import { sql, relations } from \"drizzle-orm\";\nimport {\n  pgTable,\n  text,\n  varchar,\n  timestamp,\n  integer,\n  boolean,\n  index,\n  jsonb,\n  serial,\n} from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// ============================================\n// Session storage table (Required for Replit Auth)\n// ============================================\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// ============================================\n// Users table (Required for Replit Auth)\n// ============================================\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").unique(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  department: varchar(\"department\").default(\"General\"),\n  role: varchar(\"role\").default(\"member\"),\n  status: varchar(\"status\").default(\"offline\"),\n  lastSeenAt: timestamp(\"last_seen_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\n\nexport const validUserRoles = ['admin', 'manager', 'member', 'office_renter', 'visitor'] as const;\nexport type UserRoleType = typeof validUserRoles[number];\n\nexport const updateUserSchema = z.object({\n  role: z.enum(validUserRoles).optional(),\n  department: z.string().max(100).optional(),\n  status: z.enum(['online', 'offline', 'away', 'busy']).optional(),\n}).strict();\nexport type UpdateUser = z.infer<typeof updateUserSchema>;\n\n// ============================================\n// Tasks\n// ============================================\nexport const tasks = pgTable(\"tasks\", {\n  id: serial(\"id\").primaryKey(),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  assigneeId: varchar(\"assignee_id\").references(() => users.id),\n  creatorId: varchar(\"creator_id\").references(() => users.id),\n  priority: varchar(\"priority\").default(\"medium\"),\n  status: varchar(\"status\").default(\"pending\"),\n  dueDate: timestamp(\"due_date\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const tasksRelations = relations(tasks, ({ one }) => ({\n  assignee: one(users, { fields: [tasks.assigneeId], references: [users.id] }),\n  creator: one(users, { fields: [tasks.creatorId], references: [users.id] }),\n}));\n\nexport const insertTaskSchema = createInsertSchema(tasks).omit({ id: true, createdAt: true, updatedAt: true });\nexport type InsertTask = z.infer<typeof insertTaskSchema>;\nexport type Task = typeof tasks.$inferSelect;\n\n// ============================================\n// Tickets (Support)\n// ============================================\nexport const tickets = pgTable(\"tickets\", {\n  id: serial(\"id\").primaryKey(),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  reporterId: varchar(\"reporter_id\").references(() => users.id),\n  assigneeId: varchar(\"assignee_id\").references(() => users.id),\n  priority: varchar(\"priority\").default(\"medium\"),\n  status: varchar(\"status\").default(\"open\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const ticketsRelations = relations(tickets, ({ one }) => ({\n  reporter: one(users, { fields: [tickets.reporterId], references: [users.id] }),\n  assignee: one(users, { fields: [tickets.assigneeId], references: [users.id] }),\n}));\n\nexport const insertTicketSchema = createInsertSchema(tickets).omit({ id: true, createdAt: true, updatedAt: true });\nexport type InsertTicket = z.infer<typeof insertTicketSchema>;\nexport type Ticket = typeof tickets.$inferSelect;\n\n// ============================================\n// Social Profiles\n// ============================================\nexport const profiles = pgTable(\"profiles\", {\n  id: serial(\"id\").primaryKey(),\n  ownerId: varchar(\"owner_id\").references(() => users.id).notNull().unique(),\n  displayName: varchar(\"display_name\"),\n  bio: text(\"bio\"),\n  avatarUrl: varchar(\"avatar_url\"),\n  coverUrl: varchar(\"cover_url\"),\n  website: varchar(\"website\"),\n  location: varchar(\"location\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const profilesRelations = relations(profiles, ({ one, many }) => ({\n  owner: one(users, { fields: [profiles.ownerId], references: [users.id] }),\n  followers: many(followers),\n}));\n\nexport const insertProfileSchema = createInsertSchema(profiles).omit({ id: true, createdAt: true, updatedAt: true });\nexport type InsertProfile = z.infer<typeof insertProfileSchema>;\nexport type Profile = typeof profiles.$inferSelect;\n\n// ============================================\n// Followers\n// ============================================\nexport const followers = pgTable(\"followers\", {\n  id: serial(\"id\").primaryKey(),\n  profileId: integer(\"profile_id\").references(() => profiles.id).notNull(),\n  followerUserId: varchar(\"follower_user_id\").references(() => users.id).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const followersRelations = relations(followers, ({ one }) => ({\n  profile: one(profiles, { fields: [followers.profileId], references: [profiles.id] }),\n  follower: one(users, { fields: [followers.followerUserId], references: [users.id] }),\n}));\n\nexport type Follower = typeof followers.$inferSelect;\n\n// ============================================\n// Social Posts\n// ============================================\nexport const posts = pgTable(\"posts\", {\n  id: serial(\"id\").primaryKey(),\n  authorId: varchar(\"author_id\").references(() => users.id).notNull(),\n  content: text(\"content\").notNull(),\n  mediaUrl: text(\"media_url\"),\n  mediaType: varchar(\"media_type\"),\n  scope: varchar(\"scope\").default(\"public\"),\n  profileId: integer(\"profile_id\").references(() => profiles.id),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const postsRelations = relations(posts, ({ one, many }) => ({\n  author: one(users, { fields: [posts.authorId], references: [users.id] }),\n  profile: one(profiles, { fields: [posts.profileId], references: [profiles.id] }),\n  likes: many(postLikes),\n  comments: many(postComments),\n}));\n\nexport const insertPostSchema = createInsertSchema(posts).omit({ id: true, createdAt: true, updatedAt: true });\nexport type InsertPost = z.infer<typeof insertPostSchema>;\nexport type Post = typeof posts.$inferSelect;\n\n// ============================================\n// Post Likes\n// ============================================\nexport const postLikes = pgTable(\"post_likes\", {\n  id: serial(\"id\").primaryKey(),\n  postId: integer(\"post_id\").references(() => posts.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const postLikesRelations = relations(postLikes, ({ one }) => ({\n  post: one(posts, { fields: [postLikes.postId], references: [posts.id] }),\n  user: one(users, { fields: [postLikes.userId], references: [users.id] }),\n}));\n\n// ============================================\n// Post Comments\n// ============================================\nexport const postComments = pgTable(\"post_comments\", {\n  id: serial(\"id\").primaryKey(),\n  postId: integer(\"post_id\").references(() => posts.id).notNull(),\n  authorId: varchar(\"author_id\").references(() => users.id).notNull(),\n  content: text(\"content\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const postCommentsRelations = relations(postComments, ({ one }) => ({\n  post: one(posts, { fields: [postComments.postId], references: [posts.id] }),\n  author: one(users, { fields: [postComments.authorId], references: [users.id] }),\n}));\n\nexport const insertPostCommentSchema = createInsertSchema(postComments).omit({ id: true, createdAt: true });\nexport type InsertPostComment = z.infer<typeof insertPostCommentSchema>;\nexport type PostComment = typeof postComments.$inferSelect;\n\n// ============================================\n// Chat Threads (WhatsApp-style messaging)\n// ============================================\nexport const chatThreads = pgTable(\"chat_threads\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\").notNull(),\n  type: varchar(\"type\").default(\"group\"), // \"group\" or \"direct\"\n  creatorId: varchar(\"creator_id\").references(() => users.id),\n  avatarUrl: varchar(\"avatar_url\"),\n  description: text(\"description\"),\n  lastMessageId: integer(\"last_message_id\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const chatThreadsRelations = relations(chatThreads, ({ one, many }) => ({\n  creator: one(users, { fields: [chatThreads.creatorId], references: [users.id] }),\n  participants: many(chatParticipants),\n  messages: many(messages),\n}));\n\nexport const insertChatThreadSchema = createInsertSchema(chatThreads).omit({ id: true, createdAt: true, updatedAt: true, lastMessageId: true });\nexport type InsertChatThread = z.infer<typeof insertChatThreadSchema>;\nexport type ChatThread = typeof chatThreads.$inferSelect;\n\n// ============================================\n// Chat Participants\n// ============================================\nexport const chatParticipants = pgTable(\"chat_participants\", {\n  id: serial(\"id\").primaryKey(),\n  threadId: integer(\"thread_id\").references(() => chatThreads.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  isAdmin: boolean(\"is_admin\").default(false),\n  lastReadMessageId: integer(\"last_read_message_id\"),\n  joinedAt: timestamp(\"joined_at\").defaultNow(),\n});\n\nexport const chatParticipantsRelations = relations(chatParticipants, ({ one }) => ({\n  thread: one(chatThreads, { fields: [chatParticipants.threadId], references: [chatThreads.id] }),\n  user: one(users, { fields: [chatParticipants.userId], references: [users.id] }),\n}));\n\nexport type ChatParticipant = typeof chatParticipants.$inferSelect;\n\n// ============================================\n// Messages\n// ============================================\nexport const messages = pgTable(\"messages\", {\n  id: serial(\"id\").primaryKey(),\n  threadId: integer(\"thread_id\").references(() => chatThreads.id).notNull(),\n  senderId: varchar(\"sender_id\").references(() => users.id).notNull(),\n  content: text(\"content\").notNull(),\n  messageType: varchar(\"message_type\").default(\"text\"), // \"text\", \"image\", \"file\"\n  mediaUrl: varchar(\"media_url\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const messagesRelations = relations(messages, ({ one }) => ({\n  thread: one(chatThreads, { fields: [messages.threadId], references: [chatThreads.id] }),\n  sender: one(users, { fields: [messages.senderId], references: [users.id] }),\n}));\n\nexport const insertMessageSchema = createInsertSchema(messages).omit({ id: true, createdAt: true });\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\nexport type Message = typeof messages.$inferSelect;\n\n// ============================================\n// Internal Emails (Company Mail System)\n// ============================================\nexport const internalEmails = pgTable(\"internal_emails\", {\n  id: serial(\"id\").primaryKey(),\n  senderId: varchar(\"sender_id\").references(() => users.id).notNull(),\n  recipientId: varchar(\"recipient_id\").references(() => users.id).notNull(),\n  subject: varchar(\"subject\").notNull(),\n  body: text(\"body\").notNull(),\n  isRead: boolean(\"is_read\").default(false),\n  isStarred: boolean(\"is_starred\").default(false),\n  isArchived: boolean(\"is_archived\").default(false),\n  isDraft: boolean(\"is_draft\").default(false),\n  isDeleted: boolean(\"is_deleted\").default(false),\n  parentEmailId: integer(\"parent_email_id\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const internalEmailsRelations = relations(internalEmails, ({ one }) => ({\n  sender: one(users, { fields: [internalEmails.senderId], references: [users.id] }),\n  recipient: one(users, { fields: [internalEmails.recipientId], references: [users.id] }),\n}));\n\nexport const insertInternalEmailSchema = createInsertSchema(internalEmails).omit({ \n  id: true, \n  createdAt: true, \n  updatedAt: true,\n  isRead: true,\n  isStarred: true,\n  isArchived: true,\n  isDeleted: true,\n});\nexport type InsertInternalEmail = z.infer<typeof insertInternalEmailSchema>;\nexport type InternalEmail = typeof internalEmails.$inferSelect;\n\n// ============================================\n// Meetings\n// ============================================\nexport const meetings = pgTable(\"meetings\", {\n  id: serial(\"id\").primaryKey(),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  organizerId: varchar(\"organizer_id\").references(() => users.id).notNull(),\n  startTime: timestamp(\"start_time\").notNull(),\n  endTime: timestamp(\"end_time\").notNull(),\n  location: varchar(\"location\"),\n  isRecurring: boolean(\"is_recurring\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const meetingsRelations = relations(meetings, ({ one, many }) => ({\n  organizer: one(users, { fields: [meetings.organizerId], references: [users.id] }),\n  attendees: many(meetingAttendees),\n}));\n\nexport const insertMeetingSchema = createInsertSchema(meetings).omit({ id: true, createdAt: true, updatedAt: true });\nexport type InsertMeeting = z.infer<typeof insertMeetingSchema>;\nexport type Meeting = typeof meetings.$inferSelect;\n\n// ============================================\n// Meeting Attendees\n// ============================================\nexport const meetingAttendees = pgTable(\"meeting_attendees\", {\n  id: serial(\"id\").primaryKey(),\n  meetingId: integer(\"meeting_id\").references(() => meetings.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  status: varchar(\"status\").default(\"pending\"),\n});\n\nexport const meetingAttendeesRelations = relations(meetingAttendees, ({ one }) => ({\n  meeting: one(meetings, { fields: [meetingAttendees.meetingId], references: [meetings.id] }),\n  user: one(users, { fields: [meetingAttendees.userId], references: [users.id] }),\n}));\n\n// ============================================\n// Job Postings\n// ============================================\nexport const jobPostings = pgTable(\"job_postings\", {\n  id: serial(\"id\").primaryKey(),\n  title: text(\"title\").notNull(),\n  department: varchar(\"department\").notNull(),\n  location: varchar(\"location\").notNull(),\n  type: varchar(\"type\").default(\"full-time\"),\n  description: text(\"description\"),\n  requirements: text(\"requirements\"),\n  salary: varchar(\"salary\"),\n  creatorId: varchar(\"creator_id\").references(() => users.id).notNull(),\n  status: varchar(\"status\").default(\"draft\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const jobPostingsRelations = relations(jobPostings, ({ one }) => ({\n  creator: one(users, { fields: [jobPostings.creatorId], references: [users.id] }),\n}));\n\nexport const insertJobPostingSchema = createInsertSchema(jobPostings).omit({ id: true, createdAt: true, updatedAt: true });\nexport type InsertJobPosting = z.infer<typeof insertJobPostingSchema>;\nexport type JobPosting = typeof jobPostings.$inferSelect;\n\n// ============================================\n// Transactions (Finance)\n// ============================================\nexport const transactions = pgTable(\"transactions\", {\n  id: serial(\"id\").primaryKey(),\n  description: text(\"description\").notNull(),\n  amount: integer(\"amount\").notNull(),\n  type: varchar(\"type\").default(\"expense\"),\n  category: varchar(\"category\"),\n  submitterId: varchar(\"submitter_id\").references(() => users.id).notNull(),\n  approverId: varchar(\"approver_id\").references(() => users.id),\n  status: varchar(\"status\").default(\"pending\"),\n  receiptUrl: varchar(\"receipt_url\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const transactionsRelations = relations(transactions, ({ one }) => ({\n  submitter: one(users, { fields: [transactions.submitterId], references: [users.id] }),\n  approver: one(users, { fields: [transactions.approverId], references: [users.id] }),\n}));\n\nexport const insertTransactionSchema = createInsertSchema(transactions).omit({ id: true, createdAt: true, updatedAt: true });\nexport type InsertTransaction = z.infer<typeof insertTransactionSchema>;\nexport type Transaction = typeof transactions.$inferSelect;\n\n// ============================================\n// Roles (Access Control)\n// ============================================\nexport const roles = pgTable(\"roles\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\").notNull().unique(),\n  description: text(\"description\"),\n  permissions: jsonb(\"permissions\").default([]),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const insertRoleSchema = createInsertSchema(roles).omit({ id: true, createdAt: true, updatedAt: true });\nexport type InsertRole = z.infer<typeof insertRoleSchema>;\nexport type Role = typeof roles.$inferSelect;\n\n// ============================================\n// User Roles (many-to-many)\n// ============================================\nexport const userRoles = pgTable(\"user_roles\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  roleId: integer(\"role_id\").references(() => roles.id).notNull(),\n  assignedAt: timestamp(\"assigned_at\").defaultNow(),\n});\n\nexport const userRolesRelations = relations(userRoles, ({ one }) => ({\n  user: one(users, { fields: [userRoles.userId], references: [users.id] }),\n  role: one(roles, { fields: [userRoles.roleId], references: [roles.id] }),\n}));\n\n// ============================================\n// Departments (Standalone - Manager Owned)\n// ============================================\nexport const departments = pgTable(\"departments\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\").notNull(),\n  description: text(\"description\"),\n  icon: varchar(\"icon\").default(\"briefcase\"),\n  color: varchar(\"color\").default(\"blue\"),\n  managerId: varchar(\"manager_id\").references(() => users.id).notNull(),\n  password: varchar(\"password\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const departmentsRelations = relations(departments, ({ one, many }) => ({\n  manager: one(users, { fields: [departments.managerId], references: [users.id] }),\n  employees: many(remoteEmployees),\n}));\n\nexport const insertDepartmentSchema = createInsertSchema(departments).omit({ id: true, createdAt: true, updatedAt: true });\nexport type InsertDepartment = z.infer<typeof insertDepartmentSchema>;\nexport type Department = typeof departments.$inferSelect;\n\n// ============================================\n// Remote Employees\n// ============================================\nexport const remoteEmployees = pgTable(\"remote_employees\", {\n  id: serial(\"id\").primaryKey(),\n  username: varchar(\"username\").notNull().unique(),\n  firstName: varchar(\"first_name\").notNull(),\n  lastName: varchar(\"last_name\").notNull(),\n  email: varchar(\"email\"),\n  phone: varchar(\"phone\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  departmentId: integer(\"department_id\").references(() => departments.id).notNull(),\n  jobTitle: varchar(\"job_title\"),\n  bio: text(\"bio\"),\n  skills: text(\"skills\"),\n  status: varchar(\"status\").default(\"active\"),\n  hiredById: varchar(\"hired_by_id\").references(() => users.id).notNull(),\n  startDate: timestamp(\"start_date\").defaultNow(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const remoteEmployeesRelations = relations(remoteEmployees, ({ one }) => ({\n  department: one(departments, { fields: [remoteEmployees.departmentId], references: [departments.id] }),\n  hiredBy: one(users, { fields: [remoteEmployees.hiredById], references: [users.id] }),\n}));\n\nexport const insertRemoteEmployeeSchema = createInsertSchema(remoteEmployees).omit({ id: true, createdAt: true, updatedAt: true });\nexport type InsertRemoteEmployee = z.infer<typeof insertRemoteEmployeeSchema>;\nexport type RemoteEmployee = typeof remoteEmployees.$inferSelect;\n\n// ============================================\n// Notifications\n// ============================================\nexport const notifications = pgTable(\"notifications\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  type: varchar(\"type\").notNull(),\n  title: text(\"title\").notNull(),\n  message: text(\"message\"),\n  read: boolean(\"read\").default(false),\n  data: jsonb(\"data\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const notificationsRelations = relations(notifications, ({ one }) => ({\n  user: one(users, { fields: [notifications.userId], references: [users.id] }),\n}));\n\nexport const insertNotificationSchema = createInsertSchema(notifications).omit({ id: true, createdAt: true });\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\nexport type Notification = typeof notifications.$inferSelect;\n\n// ============================================\n// Subscriptions (Office Plans)\n// ============================================\nexport const subscriptions = pgTable(\"subscriptions\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  billingCycle: varchar(\"billing_cycle\").notNull(), // 'monthly' or 'yearly'\n  basePrice: integer(\"base_price\").notNull(), // 499 monthly or 3000 yearly in riyals\n  addOnCount: integer(\"add_on_count\").default(0),\n  addOnPrice: integer(\"add_on_price\").default(0), // Total add-on price\n  totalPrice: integer(\"total_price\").notNull(),\n  currency: varchar(\"currency\").default(\"SAR\"),\n  paymentMethod: varchar(\"payment_method\").notNull(), // 'apple_pay', 'visa', 'credit_card'\n  status: varchar(\"status\").default(\"pending\"), // 'pending', 'active', 'cancelled', 'expired'\n  addOnServices: jsonb(\"add_on_services\").default([]), // Array of selected add-on service keys\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const subscriptionsRelations = relations(subscriptions, ({ one }) => ({\n  user: one(users, { fields: [subscriptions.userId], references: [users.id] }),\n}));\n\nexport const insertSubscriptionSchema = createInsertSchema(subscriptions).omit({ id: true, createdAt: true, updatedAt: true });\nexport type InsertSubscription = z.infer<typeof insertSubscriptionSchema>;\nexport type Subscription = typeof subscriptions.$inferSelect;\n\n// ============================================\n// Advertisements\n// ============================================\nexport const advertisements = pgTable(\"advertisements\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  title: varchar(\"title\").notNull(),\n  description: text(\"description\"),\n  imageUrl: varchar(\"image_url\"),\n  linkUrl: varchar(\"link_url\"),\n  price: integer(\"price\").default(500), // 500 SAR for 3 days\n  duration: integer(\"duration\").default(3), // Duration in days\n  paymentMethod: varchar(\"payment_method\"), // 'apple_pay', 'visa', 'credit_card'\n  status: varchar(\"status\").default(\"pending\"), // 'pending', 'active', 'expired', 'cancelled'\n  startDate: timestamp(\"start_date\"),\n  endDate: timestamp(\"end_date\"),\n  views: integer(\"views\").default(0),\n  clicks: integer(\"clicks\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const advertisementsRelations = relations(advertisements, ({ one }) => ({\n  user: one(users, { fields: [advertisements.userId], references: [users.id] }),\n}));\n\nexport const insertAdvertisementSchema = createInsertSchema(advertisements).omit({ id: true, createdAt: true, updatedAt: true, views: true, clicks: true });\nexport type InsertAdvertisement = z.infer<typeof insertAdvertisementSchema>;\nexport type Advertisement = typeof advertisements.$inferSelect;\n\n// ============================================\n// n8n Integration Settings\n// ============================================\nexport const n8nSettings = pgTable(\"n8n_settings\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull().unique(),\n  webhookUrl: varchar(\"webhook_url\"), // n8n webhook URL for task automation\n  apiKey: varchar(\"api_key\"), // Optional API key for authentication\n  isEnabled: boolean(\"is_enabled\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const n8nSettingsRelations = relations(n8nSettings, ({ one }) => ({\n  user: one(users, { fields: [n8nSettings.userId], references: [users.id] }),\n}));\n\nexport const insertN8nSettingsSchema = createInsertSchema(n8nSettings).omit({ id: true, createdAt: true, updatedAt: true });\nexport type InsertN8nSettings = z.infer<typeof insertN8nSettingsSchema>;\nexport type N8nSettings = typeof n8nSettings.$inferSelect;\n\n// ============================================\n// Task Automation (AI suggestions from n8n)\n// ============================================\nexport const taskAutomations = pgTable(\"task_automations\", {\n  id: serial(\"id\").primaryKey(),\n  taskId: integer(\"task_id\").references(() => tasks.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  aiSuggestion: text(\"ai_suggestion\"), // AI-generated work/response\n  aiMetadata: jsonb(\"ai_metadata\"), // Additional data from n8n (sources, confidence, etc.)\n  status: varchar(\"status\").default(\"pending\"), // 'pending', 'processing', 'ready', 'approved', 'rejected'\n  approvedAt: timestamp(\"approved_at\"),\n  approvedBy: varchar(\"approved_by\").references(() => users.id),\n  rejectionReason: text(\"rejection_reason\"),\n  n8nExecutionId: varchar(\"n8n_execution_id\"), // Track n8n workflow execution\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const taskAutomationsRelations = relations(taskAutomations, ({ one }) => ({\n  task: one(tasks, { fields: [taskAutomations.taskId], references: [tasks.id] }),\n  user: one(users, { fields: [taskAutomations.userId], references: [users.id] }),\n  approver: one(users, { fields: [taskAutomations.approvedBy], references: [users.id] }),\n}));\n\nexport const insertTaskAutomationSchema = createInsertSchema(taskAutomations).omit({ id: true, createdAt: true, updatedAt: true, approvedAt: true });\nexport type InsertTaskAutomation = z.infer<typeof insertTaskAutomationSchema>;\nexport type TaskAutomation = typeof taskAutomations.$inferSelect;\n\n// ============================================\n// Offices (Virtual Office Storefront)\n// ============================================\nexport const offices = pgTable(\"offices\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\").notNull(),\n  slug: varchar(\"slug\").notNull().unique(),\n  description: text(\"description\"),\n  logoUrl: varchar(\"logo_url\"),\n  coverUrl: varchar(\"cover_url\"),\n  location: varchar(\"location\"),\n  category: varchar(\"category\").default(\"general\"), // e.g., 'legal', 'tech', 'consulting', 'medical'\n  ownerId: varchar(\"owner_id\").references(() => users.id).notNull(),\n  receptionistId: varchar(\"receptionist_id\").references(() => users.id), // Employee acting as receptionist\n  isPublished: boolean(\"is_published\").default(false),\n  subscriptionStatus: varchar(\"subscription_status\").default(\"inactive\"), // 'active', 'inactive', 'expired'\n  contactEmail: varchar(\"contact_email\"),\n  contactPhone: varchar(\"contact_phone\"),\n  workingHours: varchar(\"working_hours\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const officesRelations = relations(offices, ({ one, many }) => ({\n  owner: one(users, { fields: [offices.ownerId], references: [users.id] }),\n  receptionist: one(users, { fields: [offices.receptionistId], references: [users.id] }),\n  services: many(officeServices),\n  media: many(officeMedia),\n  posts: many(officePosts),\n  messages: many(officeMessages),\n}));\n\nexport const insertOfficeSchema = createInsertSchema(offices).omit({ id: true, createdAt: true, updatedAt: true });\nexport type InsertOffice = z.infer<typeof insertOfficeSchema>;\nexport type Office = typeof offices.$inferSelect;\n\n// ============================================\n// Office Services\n// ============================================\nexport const officeServices = pgTable(\"office_services\", {\n  id: serial(\"id\").primaryKey(),\n  officeId: integer(\"office_id\").references(() => offices.id).notNull(),\n  title: varchar(\"title\").notNull(),\n  description: text(\"description\"),\n  price: integer(\"price\"), // Price in SAR (smallest unit)\n  priceType: varchar(\"price_type\").default(\"fixed\"), // 'fixed', 'hourly', 'negotiable', 'free'\n  category: varchar(\"category\"),\n  imageUrl: varchar(\"image_url\"),\n  isFeatured: boolean(\"is_featured\").default(false),\n  isActive: boolean(\"is_active\").default(true),\n  sortOrder: integer(\"sort_order\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const officeServicesRelations = relations(officeServices, ({ one, many }) => ({\n  office: one(offices, { fields: [officeServices.officeId], references: [offices.id] }),\n  ratings: many(serviceRatings),\n  comments: many(serviceComments),\n}));\n\nexport const insertOfficeServiceSchema = createInsertSchema(officeServices).omit({ id: true, createdAt: true, updatedAt: true });\nexport type InsertOfficeService = z.infer<typeof insertOfficeServiceSchema>;\nexport type OfficeService = typeof officeServices.$inferSelect;\n\n// ============================================\n// Service Ratings\n// ============================================\nexport const serviceRatings = pgTable(\"service_ratings\", {\n  id: serial(\"id\").primaryKey(),\n  serviceId: integer(\"service_id\").references(() => officeServices.id).notNull(),\n  visitorName: varchar(\"visitor_name\"), // For anonymous visitors\n  userId: varchar(\"user_id\").references(() => users.id), // For logged-in users\n  rating: integer(\"rating\").notNull(), // 1-5 stars\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const serviceRatingsRelations = relations(serviceRatings, ({ one }) => ({\n  service: one(officeServices, { fields: [serviceRatings.serviceId], references: [officeServices.id] }),\n  user: one(users, { fields: [serviceRatings.userId], references: [users.id] }),\n}));\n\nexport const insertServiceRatingSchema = createInsertSchema(serviceRatings).omit({ id: true, createdAt: true });\nexport type InsertServiceRating = z.infer<typeof insertServiceRatingSchema>;\nexport type ServiceRating = typeof serviceRatings.$inferSelect;\n\n// ============================================\n// Service Comments (Reviews)\n// ============================================\nexport const serviceComments = pgTable(\"service_comments\", {\n  id: serial(\"id\").primaryKey(),\n  serviceId: integer(\"service_id\").references(() => officeServices.id).notNull(),\n  visitorName: varchar(\"visitor_name\"), // For anonymous visitors\n  visitorEmail: varchar(\"visitor_email\"), // For contact\n  userId: varchar(\"user_id\").references(() => users.id), // For logged-in users\n  content: text(\"content\").notNull(),\n  rating: integer(\"rating\"), // Optional rating with comment (1-5)\n  status: varchar(\"status\").default(\"published\"), // 'published', 'pending', 'hidden'\n  parentId: integer(\"parent_id\"), // For reply threading\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const serviceCommentsRelations = relations(serviceComments, ({ one }) => ({\n  service: one(officeServices, { fields: [serviceComments.serviceId], references: [officeServices.id] }),\n  user: one(users, { fields: [serviceComments.userId], references: [users.id] }),\n}));\n\nexport const insertServiceCommentSchema = createInsertSchema(serviceComments).omit({ id: true, createdAt: true });\nexport type InsertServiceComment = z.infer<typeof insertServiceCommentSchema>;\nexport type ServiceComment = typeof serviceComments.$inferSelect;\n\n// ============================================\n// Service Requests (Visitor Inquiries)\n// ============================================\nexport const serviceRequests = pgTable(\"service_requests\", {\n  id: serial(\"id\").primaryKey(),\n  serviceId: integer(\"service_id\").references(() => officeServices.id).notNull(),\n  officeId: integer(\"office_id\").references(() => offices.id).notNull(),\n  visitorName: varchar(\"visitor_name\").notNull(),\n  visitorEmail: varchar(\"visitor_email\").notNull(),\n  visitorPhone: varchar(\"visitor_phone\"),\n  message: text(\"message\"),\n  status: varchar(\"status\").default(\"pending\"), // 'pending', 'contacted', 'completed', 'cancelled'\n  notes: text(\"notes\"), // Internal notes from office staff\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const serviceRequestsRelations = relations(serviceRequests, ({ one }) => ({\n  service: one(officeServices, { fields: [serviceRequests.serviceId], references: [officeServices.id] }),\n  office: one(offices, { fields: [serviceRequests.officeId], references: [offices.id] }),\n}));\n\nexport const insertServiceRequestSchema = createInsertSchema(serviceRequests).omit({ id: true, createdAt: true, updatedAt: true });\nexport type InsertServiceRequest = z.infer<typeof insertServiceRequestSchema>;\nexport type ServiceRequest = typeof serviceRequests.$inferSelect;\n\n// ============================================\n// Office Media (Daily Videos, Announcements)\n// ============================================\nexport const officeMedia = pgTable(\"office_media\", {\n  id: serial(\"id\").primaryKey(),\n  officeId: integer(\"office_id\").references(() => offices.id).notNull(),\n  type: varchar(\"type\").notNull(), // 'video', 'announcement', 'image'\n  title: varchar(\"title\"),\n  content: text(\"content\"), // For announcements\n  mediaUrl: varchar(\"media_url\"), // URL for video/image\n  thumbnailUrl: varchar(\"thumbnail_url\"),\n  duration: integer(\"duration\"), // Video duration in seconds\n  isPinned: boolean(\"is_pinned\").default(false),\n  expiresAt: timestamp(\"expires_at\"), // For story-style content that expires\n  views: integer(\"views\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const officeMediaRelations = relations(officeMedia, ({ one }) => ({\n  office: one(offices, { fields: [officeMedia.officeId], references: [offices.id] }),\n}));\n\nexport const insertOfficeMediaSchema = createInsertSchema(officeMedia).omit({ id: true, createdAt: true, views: true });\nexport type InsertOfficeMedia = z.infer<typeof insertOfficeMediaSchema>;\nexport type OfficeMedia = typeof officeMedia.$inferSelect;\n\n// ============================================\n// Office Posts (Social Media for Office)\n// ============================================\nexport const officePosts = pgTable(\"office_posts\", {\n  id: serial(\"id\").primaryKey(),\n  officeId: integer(\"office_id\").references(() => offices.id).notNull(),\n  authorId: varchar(\"author_id\").references(() => users.id).notNull(),\n  content: text(\"content\").notNull(),\n  mediaUrl: text(\"media_url\"),\n  mediaType: varchar(\"media_type\"),\n  likes: integer(\"likes\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const officePostsRelations = relations(officePosts, ({ one }) => ({\n  office: one(offices, { fields: [officePosts.officeId], references: [offices.id] }),\n  author: one(users, { fields: [officePosts.authorId], references: [users.id] }),\n}));\n\nexport const insertOfficePostSchema = createInsertSchema(officePosts).omit({ id: true, createdAt: true, updatedAt: true, likes: true });\nexport type InsertOfficePost = z.infer<typeof insertOfficePostSchema>;\nexport type OfficePost = typeof officePosts.$inferSelect;\n\n// ============================================\n// Office Messages (Visitor to Receptionist Chat)\n// ============================================\nexport const officeMessages = pgTable(\"office_messages\", {\n  id: serial(\"id\").primaryKey(),\n  officeId: integer(\"office_id\").references(() => offices.id).notNull(),\n  sessionId: varchar(\"session_id\").notNull(), // For tracking visitor session\n  senderType: varchar(\"sender_type\").notNull(), // 'visitor' or 'receptionist'\n  senderName: varchar(\"sender_name\"), // Visitor name\n  senderEmail: varchar(\"sender_email\"), // Visitor email for follow-up\n  senderId: varchar(\"sender_id\").references(() => users.id), // If receptionist\n  content: text(\"content\").notNull(),\n  isRead: boolean(\"is_read\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const officeMessagesRelations = relations(officeMessages, ({ one }) => ({\n  office: one(offices, { fields: [officeMessages.officeId], references: [offices.id] }),\n  sender: one(users, { fields: [officeMessages.senderId], references: [users.id] }),\n}));\n\nexport const insertOfficeMessageSchema = createInsertSchema(officeMessages).omit({ id: true, createdAt: true, isRead: true });\nexport type InsertOfficeMessage = z.infer<typeof insertOfficeMessageSchema>;\nexport type OfficeMessage = typeof officeMessages.$inferSelect;\n\n// ============================================\n// Video Calls (Visitor to Receptionist Video Chat)\n// ============================================\nexport const videoCalls = pgTable(\"video_calls\", {\n  id: serial(\"id\").primaryKey(),\n  officeId: integer(\"office_id\").references(() => offices.id).notNull(),\n  sessionId: varchar(\"session_id\").notNull(), // Visitor session ID\n  visitorName: varchar(\"visitor_name\"),\n  roomId: varchar(\"room_id\").notNull(), // Unique room identifier for the call\n  status: varchar(\"status\").notNull().default(\"pending\"), // 'pending', 'active', 'ended', 'declined'\n  receptionistId: varchar(\"receptionist_id\").references(() => users.id), // Who answered the call\n  startedAt: timestamp(\"started_at\"),\n  endedAt: timestamp(\"ended_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const videoCallsRelations = relations(videoCalls, ({ one }) => ({\n  office: one(offices, { fields: [videoCalls.officeId], references: [offices.id] }),\n  receptionist: one(users, { fields: [videoCalls.receptionistId], references: [users.id] }),\n}));\n\nexport const insertVideoCallSchema = createInsertSchema(videoCalls).omit({ id: true, createdAt: true, startedAt: true, endedAt: true });\nexport type InsertVideoCall = z.infer<typeof insertVideoCallSchema>;\nexport type VideoCall = typeof videoCalls.$inferSelect;\n\n// ============================================\n// Daily Statuses (Stories)\n// ============================================\nexport const statuses = pgTable(\"statuses\", {\n  id: serial(\"id\").primaryKey(),\n  authorId: varchar(\"author_id\").references(() => users.id).notNull(),\n  officeId: integer(\"office_id\").references(() => offices.id),\n  mediaUrl: text(\"media_url\").notNull(),\n  mediaType: varchar(\"media_type\").default(\"video\"),\n  caption: text(\"caption\"),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n  viewCount: integer(\"view_count\").default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const statusesRelations = relations(statuses, ({ one, many }) => ({\n  author: one(users, { fields: [statuses.authorId], references: [users.id] }),\n  office: one(offices, { fields: [statuses.officeId], references: [offices.id] }),\n  replies: many(statusReplies),\n  views: many(statusViews),\n}));\n\nexport const insertStatusSchema = createInsertSchema(statuses).omit({ id: true, createdAt: true, viewCount: true });\nexport type InsertStatus = z.infer<typeof insertStatusSchema>;\nexport type Status = typeof statuses.$inferSelect;\n\n// ============================================\n// Status Replies (Chat Messages on Stories)\n// ============================================\nexport const statusReplies = pgTable(\"status_replies\", {\n  id: serial(\"id\").primaryKey(),\n  statusId: integer(\"status_id\").references(() => statuses.id).notNull(),\n  senderId: varchar(\"sender_id\").references(() => users.id).notNull(),\n  message: text(\"message\").notNull(),\n  isRead: boolean(\"is_read\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const statusRepliesRelations = relations(statusReplies, ({ one }) => ({\n  status: one(statuses, { fields: [statusReplies.statusId], references: [statuses.id] }),\n  sender: one(users, { fields: [statusReplies.senderId], references: [users.id] }),\n}));\n\nexport const insertStatusReplySchema = createInsertSchema(statusReplies).omit({ id: true, createdAt: true, isRead: true });\nexport type InsertStatusReply = z.infer<typeof insertStatusReplySchema>;\nexport type StatusReply = typeof statusReplies.$inferSelect;\n\n// ============================================\n// Status Views (Who Viewed the Story)\n// ============================================\nexport const statusViews = pgTable(\"status_views\", {\n  id: serial(\"id\").primaryKey(),\n  statusId: integer(\"status_id\").references(() => statuses.id).notNull(),\n  viewerId: varchar(\"viewer_id\").references(() => users.id).notNull(),\n  viewedAt: timestamp(\"viewed_at\").defaultNow(),\n});\n\nexport const statusViewsRelations = relations(statusViews, ({ one }) => ({\n  status: one(statuses, { fields: [statusViews.statusId], references: [statuses.id] }),\n  viewer: one(users, { fields: [statusViews.viewerId], references: [users.id] }),\n}));\n\nexport const insertStatusViewSchema = createInsertSchema(statusViews).omit({ id: true, viewedAt: true });\nexport type InsertStatusView = z.infer<typeof insertStatusViewSchema>;\nexport type StatusView = typeof statusViews.$inferSelect;\n\n// ============================================\n// Status Likes (Like a Story)\n// ============================================\nexport const statusLikes = pgTable(\"status_likes\", {\n  id: serial(\"id\").primaryKey(),\n  statusId: integer(\"status_id\").references(() => statuses.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const statusLikesRelations = relations(statusLikes, ({ one }) => ({\n  status: one(statuses, { fields: [statusLikes.statusId], references: [statuses.id] }),\n  user: one(users, { fields: [statusLikes.userId], references: [users.id] }),\n}));\n\nexport const insertStatusLikeSchema = createInsertSchema(statusLikes).omit({ id: true, createdAt: true });\nexport type InsertStatusLike = z.infer<typeof insertStatusLikeSchema>;\nexport type StatusLike = typeof statusLikes.$inferSelect;\n\n// ============================================\n// Office Follows (Follow Office Profile)\n// ============================================\nexport const officeFollowers = pgTable(\"office_followers\", {\n  id: serial(\"id\").primaryKey(),\n  officeId: integer(\"office_id\").references(() => offices.id).notNull(),\n  followerId: varchar(\"follower_id\").references(() => users.id).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const officeFollowersRelations = relations(officeFollowers, ({ one }) => ({\n  office: one(offices, { fields: [officeFollowers.officeId], references: [offices.id] }),\n  follower: one(users, { fields: [officeFollowers.followerId], references: [users.id] }),\n}));\n\nexport const insertOfficeFollowerSchema = createInsertSchema(officeFollowers).omit({ id: true, createdAt: true });\nexport type InsertOfficeFollower = z.infer<typeof insertOfficeFollowerSchema>;\nexport type OfficeFollower = typeof officeFollowers.$inferSelect;\n\n// ============================================\n// Push Subscriptions (Browser Push Notifications)\n// ============================================\nexport const pushSubscriptions = pgTable(\"push_subscriptions\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  endpoint: text(\"endpoint\").notNull(),\n  p256dh: text(\"p256dh\").notNull(),\n  auth: text(\"auth\").notNull(),\n  userAgent: varchar(\"user_agent\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const pushSubscriptionsRelations = relations(pushSubscriptions, ({ one }) => ({\n  user: one(users, { fields: [pushSubscriptions.userId], references: [users.id] }),\n}));\n\nexport const insertPushSubscriptionSchema = createInsertSchema(pushSubscriptions).omit({ id: true, createdAt: true, updatedAt: true });\nexport type InsertPushSubscription = z.infer<typeof insertPushSubscriptionSchema>;\nexport type PushSubscription = typeof pushSubscriptions.$inferSelect;\n","path":null,"size_bytes":44996,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/examples/TicketCard.tsx":{"content":"import { TicketCard } from \"../TicketCard\";\n\nexport default function TicketCardExample() {\n  return (\n    <div className=\"space-y-3\">\n      <TicketCard\n        id=\"T-001\"\n        title=\"Cannot access reports module\"\n        reporter={{ name: \"Emma Thompson\" }}\n        assignee={{ name: \"Sarah Chen\" }}\n        priority=\"high\"\n        status=\"open\"\n        onClick={() => console.log(\"Ticket clicked\")}\n      />\n      <TicketCard\n        id=\"T-002\"\n        title=\"Slow loading on dashboard\"\n        reporter={{ name: \"James Wilson\" }}\n        assignee={{ name: \"David Kim\" }}\n        priority=\"medium\"\n        status=\"in_progress\"\n        onClick={() => console.log(\"Ticket clicked\")}\n      />\n      <TicketCard\n        id=\"T-003\"\n        title=\"Export feature not working\"\n        reporter={{ name: \"Maria Garcia\" }}\n        assignee={null}\n        priority=\"low\"\n        status=\"open\"\n        onClick={() => console.log(\"Ticket clicked\")}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":968,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/components/examples/NotificationItem.tsx":{"content":"import { NotificationItem } from \"../NotificationItem\";\n\nexport default function NotificationItemExample() {\n  return (\n    <div className=\"w-80 space-y-1 p-2 border rounded-md bg-card\">\n      <NotificationItem\n        id=\"1\"\n        title=\"New task assigned\"\n        message=\"You have been assigned to 'Review Q4 reports'\"\n        time=\"5 min ago\"\n        isRead={false}\n        onClick={() => console.log(\"Notification clicked\")}\n      />\n      <NotificationItem\n        id=\"2\"\n        title=\"Meeting reminder\"\n        message=\"Sprint Planning starts in 30 minutes\"\n        time=\"25 min ago\"\n        isRead={false}\n        onClick={() => console.log(\"Notification clicked\")}\n      />\n      <NotificationItem\n        id=\"3\"\n        title=\"Comment on your post\"\n        message=\"James Wilson commented on your update\"\n        time=\"1 hour ago\"\n        isRead={true}\n        onClick={() => console.log(\"Notification clicked\")}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":953,"size_tokens":null},"client/src/components/ThemeToggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"@/contexts/ThemeContext\";\n\nexport function ThemeToggle() {\n  const { theme, toggleTheme } = useTheme();\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      data-testid=\"button-theme-toggle\"\n    >\n      {theme === \"light\" ? (\n        <Moon className=\"h-5 w-5\" />\n      ) : (\n        <Sun className=\"h-5 w-5\" />\n      )}\n    </Button>\n  );\n}\n","path":null,"size_bytes":503,"size_tokens":null},"client/src/components/examples/TaskCard.tsx":{"content":"import { useState } from \"react\";\nimport { TaskCard } from \"../TaskCard\";\n\ntype TaskType = {\n  id: string;\n  title: string;\n  assignee: { name: string };\n  priority: \"high\" | \"medium\" | \"low\";\n  status: \"pending\" | \"in_progress\" | \"completed\";\n  dueDate: string;\n};\n\nexport default function TaskCardExample() {\n  const [tasks, setTasks] = useState<TaskType[]>([\n    { id: \"1\", title: \"Review Q4 reports\", assignee: { name: \"Sarah Chen\" }, priority: \"high\", status: \"in_progress\", dueDate: \"Dec 10\" },\n    { id: \"2\", title: \"Update user documentation\", assignee: { name: \"Maria Garcia\" }, priority: \"medium\", status: \"pending\", dueDate: \"Dec 15\" },\n    { id: \"3\", title: \"Fix login authentication bug\", assignee: { name: \"David Kim\" }, priority: \"high\", status: \"completed\", dueDate: \"Dec 5\" },\n  ]);\n\n  const handleToggle = (id: string) => {\n    setTasks(prev =>\n      prev.map(task =>\n        task.id === id\n          ? { ...task, status: (task.status === \"completed\" ? \"pending\" : \"completed\") as \"pending\" | \"in_progress\" | \"completed\" }\n          : task\n      )\n    );\n  };\n\n  return (\n    <div className=\"space-y-2\">\n      {tasks.map(task => (\n        <TaskCard key={task.id} {...task} onToggle={handleToggle} />\n      ))}\n    </div>\n  );\n}\n","path":null,"size_bytes":1246,"size_tokens":null},"client/src/components/examples/TransactionRow.tsx":{"content":"import { TransactionRow } from \"../TransactionRow\";\n\nexport default function TransactionRowExample() {\n  return (\n    <div className=\"border rounded-md bg-card\">\n      <TransactionRow\n        id=\"1\"\n        description=\"Software subscription\"\n        amount={-299.00}\n        category=\"Software\"\n        date=\"Dec 1, 2024\"\n        status=\"approved\"\n      />\n      <TransactionRow\n        id=\"2\"\n        description=\"Team lunch expense\"\n        amount={-156.50}\n        category=\"Meals\"\n        date=\"Nov 28, 2024\"\n        status=\"pending\"\n        showApprovalActions\n        onApprove={(id) => console.log(\"Approved:\", id)}\n        onReject={(id) => console.log(\"Rejected:\", id)}\n      />\n      <TransactionRow\n        id=\"3\"\n        description=\"Client payment received\"\n        amount={5000.00}\n        category=\"Revenue\"\n        date=\"Nov 25, 2024\"\n        status=\"approved\"\n      />\n      <TransactionRow\n        id=\"4\"\n        description=\"Office supplies\"\n        amount={-89.99}\n        category=\"Supplies\"\n        date=\"Nov 20, 2024\"\n        status=\"pending\"\n        showApprovalActions\n        onApprove={(id) => console.log(\"Approved:\", id)}\n        onReject={(id) => console.log(\"Rejected:\", id)}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":1235,"size_tokens":null},"client/src/components/examples/MeetingCard.tsx":{"content":"import { MeetingCard } from \"../MeetingCard\";\n\nexport default function MeetingCardExample() {\n  return (\n    <div className=\"space-y-3 max-w-md\">\n      <MeetingCard\n        id=\"1\"\n        title=\"Sprint Planning\"\n        time=\"10:00 AM - 11:00 AM\"\n        date=\"Today\"\n        participants={[{ name: \"Sarah Chen\" }, { name: \"James Wilson\" }, { name: \"David Kim\" }]}\n        room=\"Virtual Room A\"\n        onJoin={() => console.log(\"Join meeting\")}\n      />\n      <MeetingCard\n        id=\"2\"\n        title=\"Design Review\"\n        time=\"2:00 PM - 3:00 PM\"\n        date=\"Today\"\n        participants={[{ name: \"Maria Garcia\" }, { name: \"James Wilson\" }]}\n        room=\"Virtual Room B\"\n        onJoin={() => console.log(\"Join meeting\")}\n      />\n      <MeetingCard\n        id=\"3\"\n        title=\"1:1 with Manager\"\n        time=\"4:00 PM - 4:30 PM\"\n        date=\"Tomorrow\"\n        participants={[{ name: \"Sarah Chen\" }, { name: \"James Wilson\" }]}\n        room=\"Virtual Room A\"\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":994,"size_tokens":null},"client/src/components/examples/KPICard.tsx":{"content":"import { KPICard } from \"../KPICard\";\nimport { CheckCircle, Users, FolderOpen, Clock } from \"lucide-react\";\n\nexport default function KPICardExample() {\n  return (\n    <div className=\"grid grid-cols-2 gap-4\">\n      <KPICard\n        label=\"Tasks Completed\"\n        value={47}\n        trend={12}\n        trendUp={true}\n        icon={<CheckCircle className=\"h-5 w-5\" />}\n      />\n      <KPICard\n        label=\"Active Projects\"\n        value={8}\n        trend={2}\n        trendUp={true}\n        icon={<FolderOpen className=\"h-5 w-5\" />}\n      />\n      <KPICard\n        label=\"Team Members\"\n        value={24}\n        icon={<Users className=\"h-5 w-5\" />}\n      />\n      <KPICard\n        label=\"Pending Reviews\"\n        value={5}\n        trend={-3}\n        trendUp={false}\n        icon={<Clock className=\"h-5 w-5\" />}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":838,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/pages/Tasks.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { TaskCard } from \"@/components/TaskCard\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { \n  Plus, \n  Search, \n  Zap, \n  Clock, \n  CheckCircle, \n  XCircle, \n  AlertCircle,\n  Loader2,\n  Send,\n  Bot,\n  Eye,\n  ListTodo,\n  Sparkles,\n  Filter,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Task, User, TaskAutomation, N8nSettings } from \"@shared/schema\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\nexport default function Tasks() {\n  const { language } = useLanguage();\n  const t = translations[language];\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const [filter, setFilter] = useState(\"all\");\n  const [search, setSearch] = useState(\"\");\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [newTask, setNewTask] = useState({ title: \"\", description: \"\", assigneeId: \"\", priority: \"medium\", dueDate: \"\" });\n  const [reviewDialogOpen, setReviewDialogOpen] = useState(false);\n  const [selectedAutomation, setSelectedAutomation] = useState<TaskAutomation | null>(null);\n  const [selectedTask, setSelectedTask] = useState<Task | null>(null);\n\n  const { data: tasks = [], isLoading } = useQuery<Task[]>({\n    queryKey: [\"/api/tasks\"],\n  });\n\n  const { data: users = [] } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const { data: n8nSettings } = useQuery<N8nSettings>({\n    queryKey: [\"/api/n8n/settings\"],\n  });\n\n  const { data: pendingAutomations = [] } = useQuery<TaskAutomation[]>({\n    queryKey: [\"/api/automations/pending\"],\n    refetchInterval: 10000,\n  });\n\n  const { data: allAutomations = [] } = useQuery<TaskAutomation[]>({\n    queryKey: [\"/api/automations\"],\n  });\n\n  const createTaskMutation = useMutation({\n    mutationFn: async (data: { title: string; description?: string; assigneeId?: string; priority: string; dueDate?: string }) => {\n      return await apiRequest(\"POST\", \"/api/tasks\", {\n        title: data.title,\n        description: data.description || null,\n        assigneeId: data.assigneeId || null,\n        priority: data.priority,\n        dueDate: data.dueDate ? new Date(data.dueDate).toISOString() : null,\n        status: \"pending\",\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tasks\"] });\n      setNewTask({ title: \"\", description: \"\", assigneeId: \"\", priority: \"medium\", dueDate: \"\" });\n      setDialogOpen(false);\n      toast({ title: \"Task created\", description: \"Your new task has been added.\" });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to create task.\", variant: \"destructive\" });\n    },\n  });\n\n  const updateTaskMutation = useMutation({\n    mutationFn: async ({ id, status }: { id: number; status: string }) => {\n      return await apiRequest(\"PATCH\", `/api/tasks/${id}`, { status });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tasks\"] });\n    },\n  });\n\n  const sendToN8nMutation = useMutation({\n    mutationFn: async (taskId: number) => {\n      return await apiRequest(\"POST\", \"/api/automations/send\", { taskId });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/automations\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/automations/pending\"] });\n      toast({ \n        title: \"Task sent to n8n\", \n        description: \"The AI is now processing your task. You'll be notified when it's ready for review.\" \n      });\n    },\n    onError: (error: any) => {\n      const message = error.message?.includes(\"n8n is not configured\") \n        ? \"Please configure your n8n webhook URL in the settings first.\"\n        : \"Failed to send task to n8n. Please check your configuration.\";\n      toast({ title: \"Error\", description: message, variant: \"destructive\" });\n    },\n  });\n\n  const approveMutation = useMutation({\n    mutationFn: async (automationId: number) => {\n      return await apiRequest(\"POST\", `/api/automations/${automationId}/approve`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/automations\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/automations/pending\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/tasks\"] });\n      setReviewDialogOpen(false);\n      setSelectedAutomation(null);\n      toast({ title: \"Approved\", description: \"The AI suggestion has been approved and the task is complete.\" });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to approve automation.\", variant: \"destructive\" });\n    },\n  });\n\n  const rejectMutation = useMutation({\n    mutationFn: async ({ id, reason }: { id: number; reason?: string }) => {\n      return await apiRequest(\"POST\", `/api/automations/${id}/reject`, { reason });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/automations\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/automations/pending\"] });\n      setReviewDialogOpen(false);\n      setSelectedAutomation(null);\n      toast({ title: \"Rejected\", description: \"The AI suggestion has been rejected.\" });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to reject automation.\", variant: \"destructive\" });\n    },\n  });\n\n  const handleToggle = (id: string) => {\n    const task = tasks.find(t => String(t.id) === id);\n    if (task) {\n      const newStatus = task.status === \"completed\" ? \"pending\" : \"completed\";\n      updateTaskMutation.mutate({ id: task.id, status: newStatus });\n    }\n  };\n\n  const handleCreateTask = () => {\n    if (newTask.title) {\n      createTaskMutation.mutate({\n        title: newTask.title,\n        description: newTask.description || undefined,\n        assigneeId: newTask.assigneeId || undefined,\n        priority: newTask.priority,\n        dueDate: newTask.dueDate || undefined,\n      });\n    }\n  };\n\n  const handleSendToN8n = (taskId: number) => {\n    if (!n8nSettings?.isEnabled) {\n      toast({ \n        title: \"n8n not configured\", \n        description: \"Please enable n8n integration in the settings first.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    sendToN8nMutation.mutate(taskId);\n  };\n\n  const handleReview = (automation: TaskAutomation) => {\n    const task = tasks.find(t => t.id === automation.taskId);\n    setSelectedTask(task || null);\n    setSelectedAutomation(automation);\n    setReviewDialogOpen(true);\n  };\n\n  const getUserById = (userId: string | null) => {\n    if (!userId) return null;\n    return users.find(u => u.id === userId);\n  };\n\n  const getTaskById = (taskId: number | null) => {\n    if (!taskId) return null;\n    return tasks.find(t => t.id === taskId);\n  };\n\n  const getAutomationForTask = (taskId: number) => {\n    return allAutomations.find(a => a.taskId === taskId);\n  };\n\n  const getStatusIcon = (status: string | null) => {\n    switch (status) {\n      case 'processing':\n        return <Loader2 className=\"h-4 w-4 animate-spin text-cyan-400\" />;\n      case 'ready':\n        return <AlertCircle className=\"h-4 w-4 text-amber-400\" />;\n      case 'approved':\n        return <CheckCircle className=\"h-4 w-4 text-emerald-400\" />;\n      case 'rejected':\n        return <XCircle className=\"h-4 w-4 text-red-400\" />;\n      default:\n        return <Clock className=\"h-4 w-4 text-muted-foreground\" />;\n    }\n  };\n\n  const filteredTasks = tasks.filter((task) => {\n    const matchesFilter = filter === \"all\" || task.status === filter;\n    const matchesSearch = task.title.toLowerCase().includes(search.toLowerCase());\n    return matchesFilter && matchesSearch;\n  });\n\n  const isN8nConfigured = n8nSettings?.isEnabled && n8nSettings?.webhookUrl;\n\n  const taskStats = {\n    total: tasks.length,\n    pending: tasks.filter(t => t.status === \"pending\").length,\n    inProgress: tasks.filter(t => t.status === \"in_progress\").length,\n    completed: tasks.filter(t => t.status === \"completed\").length,\n  };\n\n  return (\n    <div className=\"p-4 md:p-6 space-y-6 w-full overflow-x-hidden\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"p-2.5 rounded-xl bg-gradient-to-br from-cyan-500 to-teal-500\">\n            <ListTodo className=\"h-5 w-5 text-white\" />\n          </div>\n          <div>\n            <h1 className=\"text-2xl font-bold tracking-tight\" data-testid=\"text-tasks-title\">{t.tasks?.title || \"Tasks\"}</h1>\n            <p className=\"text-muted-foreground text-sm\">{t.tasks?.subtitle || \"Manage and track your team's work\"}</p>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-3 flex-wrap\">\n          {pendingAutomations.length > 0 && (\n            <Badge variant=\"outline\" className=\"gap-2 px-3 py-1.5 border-amber-500/30 bg-amber-500/10\">\n              <Bot className=\"h-3 w-3 text-amber-400\" />\n              <span className=\"text-amber-400 text-xs\">{pendingAutomations.length} {t.tasks?.pendingReview || \"pending review\"}</span>\n            </Badge>\n          )}\n          <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n            <DialogTrigger asChild>\n              <Button className=\"gap-2\" data-testid=\"button-new-task\">\n                <Plus className=\"h-4 w-4\" />\n                {t.tasks?.newTask || \"New Task\"}\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"glass border-white/10\">\n              <DialogHeader>\n                <DialogTitle className=\"flex items-center gap-2\">\n                  <Sparkles className=\"h-5 w-5 text-cyan-400\" />\n                  {t.tasks?.createNewTask || \"Create New Task\"}\n                </DialogTitle>\n              </DialogHeader>\n              <div className=\"space-y-4 pt-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"title\">{t.tasks?.taskTitle || \"Title\"}</Label>\n                  <Input\n                    id=\"title\"\n                    placeholder={t.tasks?.titlePlaceholder || \"What needs to be done?\"}\n                    value={newTask.title}\n                    onChange={(e) => setNewTask({ ...newTask, title: e.target.value })}\n                    className=\"bg-white/5 border-white/10 focus:border-cyan-500/50\"\n                    data-testid=\"input-task-title\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"description\">{t.tasks?.description || \"Description\"}</Label>\n                  <Textarea\n                    id=\"description\"\n                    placeholder={t.tasks?.descriptionPlaceholder || \"Add more details...\"}\n                    value={newTask.description}\n                    onChange={(e) => setNewTask({ ...newTask, description: e.target.value })}\n                    className=\"bg-white/5 border-white/10 focus:border-cyan-500/50 min-h-[100px]\"\n                    data-testid=\"input-task-description\"\n                  />\n                </div>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"assignee\">{t.tasks?.assignee || \"Assignee\"}</Label>\n                    <Select\n                      value={newTask.assigneeId}\n                      onValueChange={(value) => setNewTask({ ...newTask, assigneeId: value })}\n                    >\n                      <SelectTrigger className=\"bg-white/5 border-white/10\" data-testid=\"select-task-assignee\">\n                        <SelectValue placeholder={t.tasks?.selectAssignee || \"Select...\"} />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {users.map((user) => (\n                          <SelectItem key={user.id} value={user.id}>\n                            {`${user.firstName || ''} ${user.lastName || ''}`.trim() || user.email}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"priority\">{t.tasks?.priority || \"Priority\"}</Label>\n                    <Select\n                      value={newTask.priority}\n                      onValueChange={(value) => setNewTask({ ...newTask, priority: value })}\n                    >\n                      <SelectTrigger className=\"bg-white/5 border-white/10\" data-testid=\"select-task-priority\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"high\">{t.tasks?.priorityHigh || \"High\"}</SelectItem>\n                        <SelectItem value=\"medium\">{t.tasks?.priorityMedium || \"Medium\"}</SelectItem>\n                        <SelectItem value=\"low\">{t.tasks?.priorityLow || \"Low\"}</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"dueDate\">{t.tasks?.dueDate || \"Due Date\"}</Label>\n                  <Input\n                    id=\"dueDate\"\n                    type=\"date\"\n                    value={newTask.dueDate}\n                    onChange={(e) => setNewTask({ ...newTask, dueDate: e.target.value })}\n                    className=\"bg-white/5 border-white/10\"\n                    data-testid=\"input-task-due-date\"\n                  />\n                </div>\n                <Button \n                  className=\"w-full\" \n                  onClick={handleCreateTask}\n                  disabled={createTaskMutation.isPending}\n                  data-testid=\"button-create-task\"\n                >\n                  {createTaskMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                      {t.tasks?.creating || \"Creating...\"}\n                    </>\n                  ) : (t.tasks?.createTask || \"Create Task\")}\n                </Button>\n              </div>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        {[\n          { label: t.tasks?.total || \"Total\", value: taskStats.total, color: \"from-slate-500 to-slate-600\" },\n          { label: t.tasks?.pending || \"Pending\", value: taskStats.pending, color: \"from-amber-500 to-orange-500\" },\n          { label: t.tasks?.inProgress || \"In Progress\", value: taskStats.inProgress, color: \"from-cyan-500 to-blue-500\" },\n          { label: t.tasks?.completed || \"Completed\", value: taskStats.completed, color: \"from-emerald-500 to-green-500\" },\n        ].map((stat) => (\n          <div key={stat.label} className=\"glass rounded-xl p-4 border border-white/5\">\n            <p className=\"text-xs text-muted-foreground\">{stat.label}</p>\n            <p className={`text-2xl font-bold bg-gradient-to-r ${stat.color} bg-clip-text text-transparent`}>\n              {stat.value}\n            </p>\n          </div>\n        ))}\n      </div>\n\n      <Tabs defaultValue=\"tasks\" className=\"w-full\">\n        <TabsList className=\"bg-white/5 border border-white/10\">\n          <TabsTrigger value=\"tasks\" className=\"data-[state=active]:bg-white/10\" data-testid=\"tab-tasks\">\n            {t.tasks?.allTasks || \"All Tasks\"}\n          </TabsTrigger>\n          <TabsTrigger value=\"automation\" className=\"gap-2 data-[state=active]:bg-white/10\" data-testid=\"tab-automation\">\n            <Zap className=\"h-4 w-4\" />\n            {t.tasks?.aiAutomation || \"AI Automation\"}\n            {pendingAutomations.length > 0 && (\n              <Badge variant=\"secondary\" className=\"ml-1 bg-amber-500/20 text-amber-400\">{pendingAutomations.length}</Badge>\n            )}\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"tasks\" className=\"mt-6 space-y-4\">\n          <div className=\"flex flex-col sm:flex-row gap-4\">\n            <div className=\"relative flex-1 max-w-md\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder={t.tasks?.searchTasks || \"Search tasks...\"}\n                value={search}\n                onChange={(e) => setSearch(e.target.value)}\n                className=\"pl-10 bg-white/5 border-white/10 focus:border-cyan-500/50\"\n                data-testid=\"input-search-tasks\"\n              />\n            </div>\n            <Select value={filter} onValueChange={setFilter}>\n              <SelectTrigger className=\"w-[180px] bg-white/5 border-white/10\" data-testid=\"select-task-filter\">\n                <Filter className=\"h-4 w-4 mr-2\" />\n                <SelectValue placeholder={t.tasks?.filter || \"Filter\"} />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">{t.tasks?.allTasks || \"All Tasks\"}</SelectItem>\n                <SelectItem value=\"pending\">{t.tasks?.pending || \"Pending\"}</SelectItem>\n                <SelectItem value=\"in_progress\">{t.tasks?.inProgress || \"In Progress\"}</SelectItem>\n                <SelectItem value=\"completed\">{t.tasks?.completed || \"Completed\"}</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <Card className=\"glass border-white/5\">\n            <CardContent className=\"p-4 space-y-3\">\n              {isLoading ? (\n                Array(5).fill(0).map((_, i) => (\n                  <Skeleton key={i} className=\"h-16 w-full bg-white/5\" />\n                ))\n              ) : filteredTasks.length > 0 ? (\n                filteredTasks.map((task) => {\n                  const assignee = getUserById(task.assigneeId);\n                  const automation = getAutomationForTask(task.id);\n                  return (\n                    <div key={task.id} className=\"flex items-center gap-3\">\n                      <div className=\"flex-1\">\n                        <TaskCard\n                          id={String(task.id)}\n                          title={task.title}\n                          assignee={assignee ? {\n                            name: `${assignee.firstName || ''} ${assignee.lastName || ''}`.trim() || assignee.email || (t.tasks?.unassigned || 'Unassigned'),\n                            avatar: assignee.profileImageUrl\n                          } : { name: t.tasks?.unassigned || \"Unassigned\" }}\n                          priority={task.priority as \"high\" | \"medium\" | \"low\"}\n                          status={task.status as \"pending\" | \"in_progress\" | \"completed\"}\n                          dueDate={task.dueDate ? new Date(task.dueDate).toLocaleDateString(language === 'ar' ? \"ar-SA\" : \"en-US\", { month: \"short\", day: \"numeric\" }) : (t.tasks?.noDate || \"No date\")}\n                          onToggle={() => handleToggle(String(task.id))}\n                        />\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        {automation && (\n                          <Badge \n                            variant=\"outline\" \n                            className=\"gap-1.5 cursor-pointer border-white/10 hover:bg-white/5\"\n                            onClick={() => automation.status === 'ready' && handleReview(automation)}\n                            data-testid={`badge-automation-${task.id}`}\n                          >\n                            {getStatusIcon(automation.status)}\n                            <span className=\"text-xs capitalize\">{automation.status}</span>\n                          </Badge>\n                        )}\n                        {isN8nConfigured && task.status !== 'completed' && !automation && (\n                          <Button \n                            variant=\"ghost\" \n                            size=\"icon\" \n                            className=\"h-8 w-8 hover:bg-cyan-500/10 hover:text-cyan-400\"\n                            onClick={() => handleSendToN8n(task.id)}\n                            disabled={sendToN8nMutation.isPending}\n                            data-testid={`button-send-n8n-${task.id}`}\n                          >\n                            {sendToN8nMutation.isPending ? (\n                              <Loader2 className=\"h-4 w-4 animate-spin\" />\n                            ) : (\n                              <Send className=\"h-4 w-4\" />\n                            )}\n                          </Button>\n                        )}\n                      </div>\n                    </div>\n                  );\n                })\n              ) : (\n                <div className=\"text-center py-12 text-muted-foreground\">\n                  <ListTodo className=\"h-12 w-12 mx-auto mb-3 opacity-30\" />\n                  <p className=\"text-sm mb-1\">{search ? (t.tasks?.noTasksMatch || \"No tasks match your search\") : (t.tasks?.noTasksYet || \"No tasks yet\")}</p>\n                  <p className=\"text-xs\">{t.tasks?.createFirstTask || \"Create your first task to get started\"}</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"automation\" className=\"mt-6 space-y-4\">\n          {!isN8nConfigured && (\n            <Card className=\"glass border-white/5 border-dashed\">\n              <CardContent className=\"p-8 text-center\">\n                <div className=\"w-16 h-16 rounded-2xl bg-gradient-to-br from-violet-500/20 to-purple-500/20 flex items-center justify-center mx-auto mb-4\">\n                  <Zap className=\"h-8 w-8 text-violet-400\" />\n                </div>\n                <h3 className=\"text-lg font-semibold mb-2\">{t.tasks?.n8nNotConfigured || \"n8n Integration Not Configured\"}</h3>\n                <p className=\"text-muted-foreground mb-6 max-w-md mx-auto\">\n                  {t.tasks?.n8nDescription || \"Connect your n8n instance to automate tasks with AI-powered workflows\"}\n                </p>\n                <Button onClick={() => setLocation(\"/n8n-settings\")} className=\"gap-2\" data-testid=\"button-configure-n8n\">\n                  <Zap className=\"h-4 w-4\" />\n                  {t.tasks?.configureN8n || \"Configure n8n\"}\n                </Button>\n              </CardContent>\n            </Card>\n          )}\n\n          {isN8nConfigured && (\n            <div className=\"grid gap-4\">\n              {pendingAutomations.length > 0 && (\n                <Card className=\"glass border-amber-500/20\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"flex items-center gap-2 text-lg\">\n                      <AlertCircle className=\"h-5 w-5 text-amber-400\" />\n                      {t.tasks?.pendingReviewTitle || \"Pending Review\"}\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-3\">\n                    {pendingAutomations.map((automation) => {\n                      const task = getTaskById(automation.taskId);\n                      return (\n                        <div \n                          key={automation.id} \n                          className=\"flex items-center justify-between p-4 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition-colors cursor-pointer\"\n                          onClick={() => handleReview(automation)}\n                          data-testid={`card-pending-automation-${automation.id}`}\n                        >\n                          <div className=\"flex items-center gap-3\">\n                            <div className=\"p-2 rounded-lg bg-cyan-500/10\">\n                              <Bot className=\"h-5 w-5 text-cyan-400\" />\n                            </div>\n                            <div>\n                              <p className=\"font-medium\">{task?.title || (t.tasks?.unknownTask || 'Unknown Task')}</p>\n                              <p className=\"text-sm text-muted-foreground\">\n                                {t.tasks?.aiSuggestionReady || \"AI suggestion ready for review\"}\n                              </p>\n                            </div>\n                          </div>\n                          <Button variant=\"outline\" size=\"sm\" className=\"gap-2\" data-testid={`button-review-${automation.id}`}>\n                            <Eye className=\"h-4 w-4\" />\n                            {t.tasks?.review || \"Review\"}\n                          </Button>\n                        </div>\n                      );\n                    })}\n                  </CardContent>\n                </Card>\n              )}\n\n              <Card className=\"glass border-white/5\">\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-lg\">{t.tasks?.automationHistory || \"Automation History\"}</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  {allAutomations.length === 0 ? (\n                    <div className=\"text-center py-8 text-muted-foreground\">\n                      <Bot className=\"h-10 w-10 mx-auto mb-3 opacity-30\" />\n                      <p className=\"text-sm\">{t.tasks?.noAutomationsYet || \"No automations yet\"}</p>\n                      <p className=\"text-xs mt-1\">{t.tasks?.sendTaskToN8n || \"Send a task to n8n to get started\"}</p>\n                    </div>\n                  ) : (\n                    <div className=\"space-y-2\">\n                      {allAutomations.map((automation) => {\n                        const task = getTaskById(automation.taskId);\n                        return (\n                          <div \n                            key={automation.id} \n                            className=\"flex items-center justify-between p-3 rounded-xl bg-white/5 border border-white/5\"\n                            data-testid={`card-automation-history-${automation.id}`}\n                          >\n                            <div className=\"flex items-center gap-3\">\n                              {getStatusIcon(automation.status)}\n                              <div>\n                                <p className=\"font-medium text-sm\">{task?.title || (t.tasks?.unknownTask || 'Unknown Task')}</p>\n                                <p className=\"text-xs text-muted-foreground capitalize\">\n                                  {automation.status}  {new Date(automation.createdAt!).toLocaleDateString(language === 'ar' ? 'ar-SA' : 'en-US')}\n                                </p>\n                              </div>\n                            </div>\n                            {automation.status === 'ready' && (\n                              <Button \n                                variant=\"outline\" \n                                size=\"sm\"\n                                onClick={() => handleReview(automation)}\n                                data-testid={`button-view-automation-${automation.id}`}\n                              >\n                                {t.tasks?.review || \"Review\"}\n                              </Button>\n                            )}\n                          </div>\n                        );\n                      })}\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n          )}\n        </TabsContent>\n      </Tabs>\n\n      <Dialog open={reviewDialogOpen} onOpenChange={setReviewDialogOpen}>\n        <DialogContent className=\"max-w-2xl glass border-white/10\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Bot className=\"h-5 w-5 text-cyan-400\" />\n              Review AI Suggestion\n            </DialogTitle>\n            <DialogDescription>\n              {selectedTask?.title || 'Task'}\n            </DialogDescription>\n          </DialogHeader>\n          \n          {selectedAutomation && (\n            <div className=\"space-y-4 pt-4\">\n              <div className=\"p-4 rounded-xl bg-white/5 border border-white/10\">\n                <h4 className=\"text-sm font-medium mb-2\">AI Response:</h4>\n                <p className=\"text-sm text-muted-foreground whitespace-pre-wrap\">\n                  {selectedAutomation.aiSuggestion || \"No response available\"}\n                </p>\n              </div>\n              \n              <div className=\"flex gap-3\">\n                <Button \n                  className=\"flex-1 bg-emerald-500 hover:bg-emerald-600\"\n                  onClick={() => approveMutation.mutate(selectedAutomation.id)}\n                  disabled={approveMutation.isPending}\n                  data-testid=\"button-approve-automation\"\n                >\n                  {approveMutation.isPending ? (\n                    <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                  ) : (\n                    <CheckCircle className=\"h-4 w-4 mr-2\" />\n                  )}\n                  Approve\n                </Button>\n                <Button \n                  variant=\"outline\"\n                  className=\"flex-1 border-red-500/30 text-red-400 hover:bg-red-500/10\"\n                  onClick={() => rejectMutation.mutate({ id: selectedAutomation.id })}\n                  disabled={rejectMutation.isPending}\n                  data-testid=\"button-reject-automation\"\n                >\n                  {rejectMutation.isPending ? (\n                    <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                  ) : (\n                    <XCircle className=\"h-4 w-4 mr-2\" />\n                  )}\n                  Reject\n                </Button>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":30337,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/pages/Meetings.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { MeetingCard } from \"@/components/MeetingCard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { \n  Plus, \n  Calendar, \n  Clock, \n  Video, \n  Loader2,\n  CalendarDays,\n  MapPin,\n  Users,\n  Sparkles,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useLanguage } from \"@/lib/i18n\";\nimport { translations } from \"@/lib/i18n\";\nimport type { Meeting } from \"@shared/schema\";\n\nexport default function Meetings() {\n  const { toast } = useToast();\n  const { language } = useLanguage();\n  const t = translations[language];\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [newMeeting, setNewMeeting] = useState({\n    title: \"\",\n    description: \"\",\n    date: \"\",\n    startTime: \"\",\n    endTime: \"\",\n    room: \"Virtual Room A\",\n  });\n\n  const { data: meetings = [], isLoading } = useQuery<Meeting[]>({\n    queryKey: [\"/api/meetings\"],\n  });\n\n  const createMeetingMutation = useMutation({\n    mutationFn: async (data: typeof newMeeting) => {\n      if (!data.date || !data.startTime) {\n        throw new Error(\"Date and start time are required\");\n      }\n      \n      const startDateTime = new Date(`${data.date}T${data.startTime}`);\n      if (isNaN(startDateTime.getTime())) {\n        throw new Error(\"Invalid date or time\");\n      }\n      \n      let endDateTime: Date | null = null;\n      if (data.endTime) {\n        endDateTime = new Date(`${data.date}T${data.endTime}`);\n        if (isNaN(endDateTime.getTime())) {\n          endDateTime = null;\n        }\n      }\n      \n      return await apiRequest(\"POST\", \"/api/meetings\", {\n        title: data.title,\n        description: data.description || null,\n        startTime: startDateTime.toISOString(),\n        endTime: endDateTime ? endDateTime.toISOString() : null,\n        location: data.room || null,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/meetings\"] });\n      setNewMeeting({ title: \"\", description: \"\", date: \"\", startTime: \"\", endTime: \"\", room: \"Virtual Room A\" });\n      setDialogOpen(false);\n      toast({ title: t.meetings?.meetingCreated || \"Meeting scheduled\", description: t.meetings?.meetingCreatedDesc || \"Your meeting has been created.\" });\n    },\n    onError: () => {\n      toast({ title: t.meetings?.error || \"Error\", description: t.meetings?.failedCreate || \"Failed to create meeting.\", variant: \"destructive\" });\n    },\n  });\n\n  const handleCreateMeeting = () => {\n    if (!newMeeting.title.trim()) {\n      toast({ title: t.meetings?.error || \"Error\", description: t.meetings?.titleRequired || \"Meeting title is required.\", variant: \"destructive\" });\n      return;\n    }\n    if (!newMeeting.date || !newMeeting.startTime) {\n      toast({ title: t.meetings?.error || \"Error\", description: t.meetings?.dateTimeRequired || \"Date and start time are required.\", variant: \"destructive\" });\n      return;\n    }\n    createMeetingMutation.mutate(newMeeting);\n  };\n\n  const handleJoinMeeting = (meetingId: string, meetingTitle: string) => {\n    const roomName = `CloudOffice-${meetingId}-${meetingTitle.replace(/\\s+/g, '-').replace(/[^a-zA-Z0-9-]/g, '')}`;\n    const jitsiUrl = `https://meet.jit.si/${roomName}`;\n    window.open(jitsiUrl, '_blank');\n    toast({ \n      title: t.meetings?.joiningMeeting || \"Joining Meeting\", \n      description: t.meetings?.openingConference || \"Opening video conference in a new tab...\" \n    });\n  };\n\n  const deleteMeetingMutation = useMutation({\n    mutationFn: async (meetingId: number) => {\n      return await apiRequest(\"DELETE\", `/api/meetings/${meetingId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/meetings\"] });\n      toast({ title: t.meetings?.meetingDeleted || \"Meeting deleted\", description: t.meetings?.meetingRemovedDesc || \"The meeting has been removed.\" });\n    },\n    onError: () => {\n      toast({ title: t.meetings?.error || \"Error\", description: t.meetings?.failedDelete || \"Failed to delete meeting.\", variant: \"destructive\" });\n    },\n  });\n\n  const handleDeleteMeeting = (meetingId: number) => {\n    if (confirm(t.meetings?.confirmDelete || \"Are you sure you want to delete this meeting?\")) {\n      deleteMeetingMutation.mutate(meetingId);\n    }\n  };\n\n  const formatMeeting = (meeting: Meeting) => {\n    const startTime = meeting.startTime ? new Date(meeting.startTime) : null;\n    const today = new Date();\n    const isToday = startTime && \n      startTime.getDate() === today.getDate() &&\n      startTime.getMonth() === today.getMonth() &&\n      startTime.getFullYear() === today.getFullYear();\n    \n    const locale = language === \"ar\" ? \"ar-SA\" : \"en-US\";\n    \n    return {\n      id: String(meeting.id),\n      title: meeting.title,\n      time: startTime ? startTime.toLocaleTimeString(locale, { hour: \"numeric\", minute: \"2-digit\" }) : \"\",\n      date: isToday ? (t.meetings?.today || \"Today\") : startTime?.toLocaleDateString(locale, { weekday: \"short\", month: \"short\", day: \"numeric\" }) || \"\",\n      participants: [] as Array<{ name: string; avatar?: string | null }>,\n      room: meeting.location || (t.meetings?.virtualRoom || \"Virtual\"),\n    };\n  };\n\n  const now = new Date();\n  const todayMeetings = meetings.filter(m => {\n    if (!m.startTime) return false;\n    const start = new Date(m.startTime);\n    return start.toDateString() === now.toDateString();\n  });\n\n  const upcomingMeetings = meetings.filter(m => {\n    if (!m.startTime) return false;\n    const start = new Date(m.startTime);\n    return start > now && start.toDateString() !== now.toDateString();\n  });\n\n  const meetingStats = {\n    total: meetings.length,\n    today: todayMeetings.length,\n    upcoming: upcomingMeetings.length,\n  };\n\n  return (\n    <div className=\"p-6 md:p-8 space-y-6 max-w-7xl mx-auto\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"p-2.5 rounded-xl bg-gradient-to-br from-violet-500 to-purple-500\">\n            <Video className=\"h-5 w-5 text-white\" />\n          </div>\n          <div>\n            <h1 className=\"text-2xl font-bold tracking-tight\" data-testid=\"text-meetings-title\">{t.meetings?.title || \"Meetings\"}</h1>\n            <p className=\"text-muted-foreground text-sm\">{t.meetings?.subtitle || \"Schedule and join virtual meetings\"}</p>\n          </div>\n        </div>\n        <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n          <DialogTrigger asChild>\n            <Button className=\"gap-2\" data-testid=\"button-new-meeting\">\n              <Plus className=\"h-4 w-4\" />\n              {t.meetings?.scheduleMeeting || \"Schedule Meeting\"}\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"glass border-white/10 max-w-md\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <Sparkles className=\"h-5 w-5 text-violet-400\" />\n                {t.meetings?.scheduleNewMeeting || \"Schedule New Meeting\"}\n              </DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4 pt-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"title\">{t.meetings?.meetingTitle || \"Meeting Title\"}</Label>\n                <Input\n                  id=\"title\"\n                  placeholder={t.meetings?.titlePlaceholder || \"Weekly team sync\"}\n                  value={newMeeting.title}\n                  onChange={(e) => setNewMeeting({ ...newMeeting, title: e.target.value })}\n                  className=\"bg-white/5 border-white/10 focus:border-violet-500/50\"\n                  data-testid=\"input-meeting-title\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"description\">{t.meetings?.descriptionOptional || \"Description (optional)\"}</Label>\n                <Textarea\n                  id=\"description\"\n                  placeholder={t.meetings?.descriptionPlaceholder || \"Meeting agenda...\"}\n                  value={newMeeting.description}\n                  onChange={(e) => setNewMeeting({ ...newMeeting, description: e.target.value })}\n                  className=\"bg-white/5 border-white/10 focus:border-violet-500/50 min-h-[80px]\"\n                  data-testid=\"input-meeting-description\"\n                />\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"date\">{t.meetings?.date || \"Date\"}</Label>\n                  <Input\n                    id=\"date\"\n                    type=\"date\"\n                    value={newMeeting.date}\n                    onChange={(e) => setNewMeeting({ ...newMeeting, date: e.target.value })}\n                    className=\"bg-white/5 border-white/10\"\n                    data-testid=\"input-meeting-date\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"room\">{t.meetings?.room || \"Room\"}</Label>\n                  <Input\n                    id=\"room\"\n                    placeholder={t.meetings?.virtualRoom || \"Virtual Room\"}\n                    value={newMeeting.room}\n                    onChange={(e) => setNewMeeting({ ...newMeeting, room: e.target.value })}\n                    className=\"bg-white/5 border-white/10\"\n                    data-testid=\"input-meeting-room\"\n                  />\n                </div>\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"startTime\">{t.meetings?.startTime || \"Start Time\"}</Label>\n                  <Input\n                    id=\"startTime\"\n                    type=\"time\"\n                    value={newMeeting.startTime}\n                    onChange={(e) => setNewMeeting({ ...newMeeting, startTime: e.target.value })}\n                    className=\"bg-white/5 border-white/10\"\n                    data-testid=\"input-meeting-start-time\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"endTime\">{t.meetings?.endTime || \"End Time\"}</Label>\n                  <Input\n                    id=\"endTime\"\n                    type=\"time\"\n                    value={newMeeting.endTime}\n                    onChange={(e) => setNewMeeting({ ...newMeeting, endTime: e.target.value })}\n                    className=\"bg-white/5 border-white/10\"\n                    data-testid=\"input-meeting-end-time\"\n                  />\n                </div>\n              </div>\n              <Button \n                className=\"w-full\" \n                onClick={handleCreateMeeting}\n                disabled={createMeetingMutation.isPending}\n                data-testid=\"button-create-meeting\"\n              >\n                {createMeetingMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                    {t.meetings?.creating || \"Creating...\"}\n                  </>\n                ) : (t.meetings?.scheduleMeeting || \"Schedule Meeting\")}\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"grid grid-cols-3 gap-4\">\n        {[\n          { label: t.meetings?.totalMeetings || \"Total Meetings\", value: meetingStats.total, icon: CalendarDays, color: \"from-slate-500 to-slate-600\" },\n          { label: t.meetings?.today || \"Today\", value: meetingStats.today, icon: Clock, color: \"from-violet-500 to-purple-500\" },\n          { label: t.meetings?.upcoming || \"Upcoming\", value: meetingStats.upcoming, icon: Calendar, color: \"from-cyan-500 to-teal-500\" },\n        ].map((stat) => (\n          <div key={stat.label} className=\"glass rounded-xl p-4 border border-white/5\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <stat.icon className=\"h-4 w-4 text-muted-foreground\" />\n              <span className=\"text-xs text-muted-foreground\">{stat.label}</span>\n            </div>\n            <p className={`text-2xl font-bold bg-gradient-to-r ${stat.color} bg-clip-text text-transparent`}>\n              {stat.value}\n            </p>\n          </div>\n        ))}\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card className=\"glass border-white/5\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <div className=\"p-1.5 rounded-lg bg-violet-500/10\">\n                <Clock className=\"h-4 w-4 text-violet-400\" />\n              </div>\n              {t.meetings?.todaysMeetings || \"Today's Meetings\"}\n              {todayMeetings.length > 0 && (\n                <Badge variant=\"outline\" className=\"ml-2 bg-violet-500/10 text-violet-400 border-violet-500/30\">\n                  {todayMeetings.length}\n                </Badge>\n              )}\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {isLoading ? (\n              Array(3).fill(0).map((_, i) => (\n                <Skeleton key={i} className=\"h-20 w-full bg-white/5\" />\n              ))\n            ) : todayMeetings.length > 0 ? (\n              todayMeetings.map((meeting) => {\n                const formatted = formatMeeting(meeting);\n                return (\n                  <div \n                    key={meeting.id}\n                    className=\"p-4 rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 transition-colors cursor-pointer\"\n                    data-testid={`card-meeting-today-${meeting.id}`}\n                  >\n                    <div className=\"flex items-start justify-between mb-2\">\n                      <h4 className=\"font-medium\">{formatted.title}</h4>\n                      <Badge variant=\"outline\" className=\"text-xs bg-violet-500/10 text-violet-400 border-violet-500/30\">\n                        {formatted.time}\n                      </Badge>\n                    </div>\n                    <div className=\"flex items-center gap-4 text-xs text-muted-foreground\">\n                      <span className=\"flex items-center gap-1\">\n                        <MapPin className=\"h-3 w-3\" />\n                        {formatted.room}\n                      </span>\n                      <span className=\"flex items-center gap-1\">\n                        <Users className=\"h-3 w-3\" />\n                        {formatted.participants.length || 0} {t.meetings?.attendees || \"attendees\"}\n                      </span>\n                    </div>\n                  </div>\n                );\n              })\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Clock className=\"h-10 w-10 mx-auto mb-3 opacity-30\" />\n                <p className=\"text-sm\">{t.meetings?.noTodayMeetings || \"No meetings scheduled for today\"}</p>\n                <p className=\"text-xs mt-1\">{t.meetings?.scheduleFirst || \"Schedule your first meeting\"}</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card className=\"glass border-white/5\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <div className=\"p-1.5 rounded-lg bg-cyan-500/10\">\n                <Calendar className=\"h-4 w-4 text-cyan-400\" />\n              </div>\n              {t.meetings?.upcomingMeetings || \"Upcoming Meetings\"}\n              {upcomingMeetings.length > 0 && (\n                <Badge variant=\"outline\" className=\"ml-2 bg-cyan-500/10 text-cyan-400 border-cyan-500/30\">\n                  {upcomingMeetings.length}\n                </Badge>\n              )}\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {isLoading ? (\n              Array(3).fill(0).map((_, i) => (\n                <Skeleton key={i} className=\"h-20 w-full bg-white/5\" />\n              ))\n            ) : upcomingMeetings.length > 0 ? (\n              upcomingMeetings.slice(0, 5).map((meeting) => {\n                const formatted = formatMeeting(meeting);\n                return (\n                  <div \n                    key={meeting.id}\n                    className=\"p-4 rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 transition-colors cursor-pointer\"\n                    data-testid={`card-meeting-upcoming-${meeting.id}`}\n                  >\n                    <div className=\"flex items-start justify-between mb-2\">\n                      <h4 className=\"font-medium\">{formatted.title}</h4>\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        {formatted.date}\n                      </Badge>\n                    </div>\n                    <div className=\"flex items-center gap-4 text-xs text-muted-foreground\">\n                      <span className=\"flex items-center gap-1\">\n                        <Clock className=\"h-3 w-3\" />\n                        {formatted.time}\n                      </span>\n                      <span className=\"flex items-center gap-1\">\n                        <MapPin className=\"h-3 w-3\" />\n                        {formatted.room}\n                      </span>\n                    </div>\n                  </div>\n                );\n              })\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Calendar className=\"h-10 w-10 mx-auto mb-3 opacity-30\" />\n                <p className=\"text-sm\">{t.meetings?.noUpcomingMeetings || \"No upcoming meetings\"}</p>\n                <p className=\"text-xs mt-1\">{t.meetings?.planAhead || \"Plan your schedule ahead\"}</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {meetings.length > 0 && (\n        <Card className=\"glass border-white/5\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <div className=\"p-1.5 rounded-lg bg-emerald-500/10\">\n                <Video className=\"h-4 w-4 text-emerald-400\" />\n              </div>\n              {t.meetings?.allMeetings || \"All Meetings\"}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {meetings.map((meeting) => {\n                const formatted = formatMeeting(meeting);\n                return (\n                  <MeetingCard\n                    key={meeting.id}\n                    {...formatted}\n                    onJoin={() => handleJoinMeeting(formatted.id, meeting.title)}\n                    onDelete={() => handleDeleteMeeting(meeting.id)}\n                  />\n                );\n              })}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":19429,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"replit.md":{"content":"# CloudOffice - Virtual Workspace\n\n## Overview\n\nCloudOffice is a comprehensive virtual cloud office platform designed for remote teams. It unifies task management, support ticketing, team communication, meeting scheduling, job postings, financial tracking, and access control into a single integrated workspace. The application provides a professional, productivity-focused interface combining Linear's clean task management aesthetics with Material Design's robust component patterns.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\n**Framework & Build System**\n- React 18+ with TypeScript for type safety\n- Vite as the build tool and development server\n- Wouter for lightweight client-side routing\n- React Query (TanStack Query) for server state management and data fetching\n\n**UI Component System**\n- Shadcn/ui component library (New York style preset) built on Radix UI primitives\n- Tailwind CSS for utility-first styling with custom design tokens\n- CSS variables for theming with light/dark mode support\n- Inter font family via Google Fonts CDN\n\n**Design System**\n- Modern dark-first theme with glass-morphism effects\n- Deep charcoal backgrounds (#0B0F19) with cyan (#06B6D4) and teal (#14B8A6) accents\n- Glass effect cards with backdrop-blur and 40% opacity backgrounds\n- Gradient text effects for headings and KPI values\n- Custom utility classes: `glass`, `gradient-text`, `hover-glow`, `glow`\n- Custom spacing primitives (2, 4, 6, 8, 12, 16 Tailwind units)\n- Card-based content containers with subtle borders (border-white/5)\n- Responsive breakpoints for mobile-first development\n\n**State Management**\n- React Query for server state with infinite stale time and disabled refetch\n- Context API for theme management (light/dark mode)\n- Zustand for language state management with localStorage persistence\n- Local component state for UI interactions\n\n**Internationalization (i18n)**\n- Language switcher supporting Arabic and English\n- Zustand store with localStorage persistence (`cloudoffice-language` key)\n- RTL/LTR layout support with automatic document direction switching\n- Translation system in `client/src/lib/i18n.ts`\n- Available on Landing page (for visitors) and Welcome page (for logged-in visitors)\n\n### Backend Architecture\n\n**Server Framework**\n- Express.js for REST API endpoints\n- HTTP server with middleware for JSON parsing and URL encoding\n- Custom logging middleware for request/response tracking\n\n**Authentication & Session Management**\n- Replit Auth integration using OpenID Connect (OIDC)\n- Passport.js with OpenID Client strategy\n- Session storage via connect-pg-simple (PostgreSQL-backed sessions)\n- Session-based authentication with HTTP-only secure cookies (7-day TTL)\n\n**Role-Based Access Control (RBAC)**\n- Five-tier role system: visitor < member (default) < office_renter < manager < admin\n- Frontend: AppSidebar/VisitorSidebar filters navigation by user.role; RoleGuard component protects routes\n- Backend: requireRole() middleware validates roles before API access\n- Role permissions matrix:\n  - visitor: Welcome Page, Browse Offices, View Services, Find Jobs, Contact, Profile (public-facing experience)\n  - member: Dashboard, Employee Profile, Tasks, Tickets, Social, Messages, Meetings, Team, Departments\n  - office_renter: Dashboard + Business Services (My Office, My Services, My Subscriptions)\n  - manager/admin: All member access + n8n Automation, Office Management, Job Postings\n  - admin only: Finances, Advertising, Access Control, User Roles management\n\n**Visitor Role Redirection**\n- Users with role=\"visitor\" are redirected to /welcome after login (not Dashboard)\n- VisitorSidebar shows \"Welcome Portal\" branding with visitor-specific navigation\n- Welcome page provides quick actions: Browse Offices, View Services, Find Jobs, Contact\n- Visitor routes: /welcome, /visitor/offices, /visitor/services, /visitor/contact, /careers, /profile\n\n**Office Renter Role (Business Services)**\n- Only users with role=\"office_renter\" see \"Business Services\" subtitle in sidebar\n- All other roles see \"Virtual Workspace\" subtitle\n- Business Services navigation items (My Office, My Services, My Subscriptions) are restricted to office_renter only\n- OfficeRenterRouter provides dedicated routes: /, /my-office, /my-services, /my-subscriptions, /profile\n\n**API Design**\n- RESTful endpoints organized by resource type:\n  - `/api/auth/*` - Authentication endpoints\n  - `/api/users/*` - User management\n  - `/api/tasks/*` - Task CRUD operations\n  - `/api/tickets/*` - Support ticket management\n  - `/api/posts/*` - Social feed posts and comments\n  - `/api/threads/*` - Chat threads and messages\n  - `/api/meetings/*` - Meeting scheduling\n  - `/api/jobs/*` - Job posting management\n  - `/api/transactions/*` - Financial transaction tracking\n  - `/api/notifications/*` - User notifications\n  - `/api/subscriptions/*` - Office subscription management\n  - `/api/n8n/*` - n8n integration settings and management\n  - `/api/automations/*` - Task automation workflows (send, approve, reject)\n- Consistent error handling with status code and message formatting\n- Request body validation using Zod schemas\n\n### Data Layer\n\n**ORM & Database**\n- Drizzle ORM for type-safe database queries\n- PostgreSQL as the primary database (via Neon serverless)\n- WebSocket-based connection pooling for serverless environments\n- Schema-first approach with TypeScript type inference\n\n**Database Schema**\nCore tables include:\n- `users` - User profiles with role-based access\n- `sessions` - PostgreSQL session storage\n- `tasks` - Task management with assignees and priorities\n- `tickets` - Support ticket tracking\n- `posts`, `post_comments`, `post_likes` - Social feed engagement\n- `chat_threads`, `chat_participants`, `messages` - Team messaging\n- `meetings`, `meeting_attendees` - Calendar scheduling\n- `job_postings` - Internal job listings\n- `transactions` - Financial tracking and approvals\n- `roles`, `user_roles` - Access control system\n- `notifications` - User notification queue\n- `departments`, `remote_employees` - Department management system\n- `subscriptions` - Office subscription plans (499 SAR/month or 3000 SAR/year)\n- `advertisements` - Homepage ad placements (500 SAR for 3-day placements, requires subscription)\n- `push_subscriptions` - Browser push notification subscriptions per user\n\n**Push Notifications**\n- Web Push API integration using `web-push` npm package\n- VAPID authentication with public/private key pair (stored in environment secrets)\n- Service Worker (`public/sw.js`) handles push events and notification clicks\n- Frontend utilities in `client/src/lib/notifications.ts`:\n  - `subscribeToPush()` / `unsubscribeFromPush()` - Manage browser subscriptions\n  - `isPushSupported()` / `isSubscribedToPush()` - Check browser support and status\n  - VAPID key fetched dynamically from `/api/push/vapid-public-key`\n- UI Components in `client/src/components/NotificationPermission.tsx`:\n  - `NotificationPermission` - Banner prompting users to enable notifications (authenticated users only)\n  - `NotificationToggle` - Toggle button for settings pages\n- Server Push Service (`server/pushService.ts`):\n  - `sendPushNotification(userId, payload)` - Send to specific user\n  - `sendPushToAllUsers(payload)` - Broadcast to all subscribed users\n  - Auto-cleanup of invalid/expired subscriptions\n- API Routes (authenticated):\n  - `POST /api/push/subscribe` - Register a push subscription\n  - `POST /api/push/unsubscribe` - Remove subscription (user can only delete their own)\n  - `GET /api/push/vapid-public-key` - Get VAPID public key\n\n**Data Access Pattern**\n- Storage abstraction layer (`server/storage.ts`) providing CRUD interfaces\n- Zod validation schemas (`drizzle-zod`) for insert/update operations\n- Relational queries using Drizzle's query builder with joins\n\n### Build & Deployment\n\n**Development Mode**\n- Vite dev server with HMR (Hot Module Replacement)\n- TSX for running TypeScript server code directly\n- Development-only plugins: runtime error overlay, cartographer, dev banner\n\n**Production Build**\n- Client: Vite builds React app to `dist/public`\n- Server: esbuild bundles TypeScript server to `dist/index.cjs`\n- Selective dependency bundling (allowlist for critical packages, externals for others)\n- Single-file server bundle for reduced cold start times\n\n**File Structure**\n- `/client` - Frontend React application\n- `/server` - Express backend and API routes\n- `/shared` - Shared TypeScript types and Zod schemas\n- `/migrations` - Drizzle database migration files\n\n## External Dependencies\n\n### Core Infrastructure\n- **Neon Database** - Serverless PostgreSQL database with WebSocket connections\n- **Replit Auth** - OpenID Connect authentication provider\n\n### UI Component Libraries\n- **Radix UI** - Headless accessible component primitives (17 different components)\n- **Shadcn/ui** - Pre-built component variants on top of Radix\n- **Tailwind CSS** - Utility-first CSS framework\n- **Google Fonts** - Inter font family\n\n### Development & Build Tools\n- **Vite** - Frontend build tool and dev server\n- **esbuild** - Server-side bundler\n- **Drizzle Kit** - Database migration tooling\n- **TypeScript** - Type checking and compilation\n\n### Backend Libraries\n- **Passport.js** - Authentication middleware\n- **OpenID Client** - OIDC protocol implementation\n- **connect-pg-simple** - PostgreSQL session store\n- **ws** - WebSocket library for Neon connections\n\n### Data & Validation\n- **Zod** - Runtime type validation\n- **drizzle-zod** - Schema-to-Zod converter\n- **date-fns** - Date manipulation utilities\n\n### Optional Integrations (Dependencies Present)\n- **Stripe** - Payment processing (not yet implemented)\n- **Nodemailer** - Email sending (not yet implemented)\n- **Multer** - File uploads (not yet implemented)\n- **OpenAI / Google Generative AI** - AI integrations (not yet implemented)\n- **XLSX** - Spreadsheet operations (not yet implemented)","path":null,"size_bytes":9962,"size_tokens":null},"client/src/components/KPICard.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { TrendingUp, TrendingDown } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface KPICardProps {\n  label: string;\n  value: number | string;\n  trend?: number;\n  trendUp?: boolean;\n  icon?: React.ReactNode;\n}\n\nexport function KPICard({ label, value, trend, trendUp, icon }: KPICardProps) {\n  return (\n    <Card data-testid={`card-kpi-${label.toLowerCase().replace(/\\s/g, \"-\")}`}>\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-center justify-between gap-4\">\n          <div className=\"space-y-1\">\n            <p className=\"text-sm text-muted-foreground\">{label}</p>\n            <p className=\"text-3xl font-semibold tracking-tight\">{value}</p>\n            {trend !== undefined && (\n              <div className=\"flex items-center gap-1\">\n                {trendUp ? (\n                  <TrendingUp className=\"h-4 w-4 text-green-500\" />\n                ) : (\n                  <TrendingDown className=\"h-4 w-4 text-red-500\" />\n                )}\n                <span\n                  className={cn(\n                    \"text-xs font-medium\",\n                    trendUp ? \"text-green-500\" : \"text-red-500\"\n                  )}\n                >\n                  {trendUp ? \"+\" : \"\"}{trend}%\n                </span>\n              </div>\n            )}\n          </div>\n          {icon && (\n            <div className=\"p-3 rounded-md bg-primary/10 text-primary\">\n              {icon}\n            </div>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":1568,"size_tokens":null},"client/src/components/NotificationItem.tsx":{"content":"import { cn } from \"@/lib/utils\";\n\ninterface NotificationItemProps {\n  id: string;\n  title: string;\n  message: string;\n  time: string;\n  isRead: boolean;\n  onClick?: () => void;\n}\n\nexport function NotificationItem({ id, title, message, time, isRead, onClick }: NotificationItemProps) {\n  return (\n    <button\n      onClick={onClick}\n      className={cn(\n        \"w-full text-left p-3 rounded-md hover-elevate\",\n        !isRead && \"bg-primary/5\"\n      )}\n      data-testid={`notification-${id}`}\n    >\n      <div className=\"flex items-start gap-2\">\n        {!isRead && (\n          <span className=\"mt-1.5 h-2 w-2 rounded-full bg-primary flex-shrink-0\" />\n        )}\n        <div className={cn(\"flex-1 min-w-0\", isRead && \"ml-4\")}>\n          <p className={cn(\"text-sm font-medium truncate\", !isRead && \"text-foreground\")}>\n            {title}\n          </p>\n          <p className=\"text-sm text-muted-foreground truncate mt-0.5\">{message}</p>\n          <p className=\"text-xs text-muted-foreground mt-1\">{time}</p>\n        </div>\n      </div>\n    </button>\n  );\n}\n","path":null,"size_bytes":1061,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/lib/mockData.ts":{"content":"// todo: remove mock functionality - replace with real API data\n\nexport const mockUser = {\n  id: \"1\",\n  name: \"Sarah Chen\",\n  email: \"sarah.chen@company.com\",\n  role: \"admin\" as const,\n  avatar: null,\n  department: \"Engineering\",\n  status: \"online\" as const,\n};\n\nexport const mockUsers = [\n  { id: \"1\", name: \"Sarah Chen\", role: \"admin\", avatar: null, department: \"Engineering\", status: \"online\" as const },\n  { id: \"2\", name: \"James Wilson\", role: \"manager\", avatar: null, department: \"Product\", status: \"online\" as const },\n  { id: \"3\", name: \"Maria Garcia\", role: \"employee\", avatar: null, department: \"Design\", status: \"away\" as const },\n  { id: \"4\", name: \"David Kim\", role: \"employee\", avatar: null, department: \"Engineering\", status: \"busy\" as const },\n  { id: \"5\", name: \"Emma Thompson\", role: \"employee\", avatar: null, department: \"Marketing\", status: \"offline\" as const },\n];\n\nexport const mockTasks = [\n  { id: \"1\", title: \"Review Q4 reports\", assignee: mockUsers[0], priority: \"high\" as const, status: \"in_progress\" as const, dueDate: \"2024-12-10\" },\n  { id: \"2\", title: \"Update user documentation\", assignee: mockUsers[2], priority: \"medium\" as const, status: \"pending\" as const, dueDate: \"2024-12-15\" },\n  { id: \"3\", title: \"Fix login authentication bug\", assignee: mockUsers[3], priority: \"high\" as const, status: \"completed\" as const, dueDate: \"2024-12-05\" },\n  { id: \"4\", title: \"Design new dashboard layout\", assignee: mockUsers[2], priority: \"low\" as const, status: \"pending\" as const, dueDate: \"2024-12-20\" },\n];\n\nexport const mockTickets = [\n  { id: \"T-001\", title: \"Cannot access reports module\", reporter: mockUsers[4], assignee: mockUsers[0], priority: \"high\" as const, status: \"open\" as const },\n  { id: \"T-002\", title: \"Slow loading on dashboard\", reporter: mockUsers[1], assignee: mockUsers[3], priority: \"medium\" as const, status: \"in_progress\" as const },\n  { id: \"T-003\", title: \"Export feature not working\", reporter: mockUsers[2], assignee: null, priority: \"low\" as const, status: \"open\" as const },\n];\n\nexport const mockPosts = [\n  { id: \"1\", author: mockUsers[1], content: \"Excited to announce our new product launch next week! The team has been working incredibly hard.\", likes: 24, comments: 8, timestamp: \"2 hours ago\" },\n  { id: \"2\", author: mockUsers[0], content: \"Great sprint retrospective today. Keep up the amazing work everyone!\", likes: 15, comments: 3, timestamp: \"5 hours ago\" },\n  { id: \"3\", author: mockUsers[2], content: \"Just completed the new design system documentation. Check it out in the shared drive.\", likes: 32, comments: 12, timestamp: \"1 day ago\" },\n];\n\nexport const mockStories = [\n  { id: \"1\", user: mockUsers[0], content: \"Working on API integration\", isViewed: false },\n  { id: \"2\", user: mockUsers[1], content: \"Team meeting at 3pm\", isViewed: false },\n  { id: \"3\", user: mockUsers[2], content: \"Designing new components\", isViewed: true },\n  { id: \"4\", user: mockUsers[3], content: \"Code review session\", isViewed: true },\n];\n\nexport const mockMessages = [\n  { id: \"1\", sender: mockUsers[1], content: \"Hey team, how's the progress on the new feature?\", timestamp: \"10:30 AM\", isOwn: false },\n  { id: \"2\", sender: mockUsers[0], content: \"Going well! Should be done by end of day.\", timestamp: \"10:32 AM\", isOwn: true },\n  { id: \"3\", sender: mockUsers[2], content: \"I'll have the designs ready for review in an hour.\", timestamp: \"10:35 AM\", isOwn: false },\n];\n\nexport const mockChatThreads = [\n  { id: \"1\", name: \"Engineering Team\", lastMessage: \"Great work on the release!\", participants: [mockUsers[0], mockUsers[3]], unread: 2, timestamp: \"10 min ago\" },\n  { id: \"2\", name: \"Product Discussion\", lastMessage: \"Let's schedule a sync\", participants: [mockUsers[1], mockUsers[2]], unread: 0, timestamp: \"1 hour ago\" },\n  { id: \"3\", name: \"All Hands\", lastMessage: \"Reminder: Town hall tomorrow\", participants: mockUsers, unread: 5, timestamp: \"3 hours ago\" },\n];\n\nexport const mockMeetings = [\n  { id: \"1\", title: \"Sprint Planning\", time: \"10:00 AM - 11:00 AM\", date: \"Today\", participants: [mockUsers[0], mockUsers[1], mockUsers[3]], room: \"Virtual Room A\" },\n  { id: \"2\", title: \"Design Review\", time: \"2:00 PM - 3:00 PM\", date: \"Today\", participants: [mockUsers[2], mockUsers[1]], room: \"Virtual Room B\" },\n  { id: \"3\", title: \"1:1 with Manager\", time: \"4:00 PM - 4:30 PM\", date: \"Tomorrow\", participants: [mockUsers[0], mockUsers[1]], room: \"Virtual Room A\" },\n];\n\nexport const mockJobs = [\n  { id: \"1\", title: \"Senior Frontend Developer\", department: \"Engineering\", location: \"Remote\", type: \"Full-time\", salary: \"$120k - $150k\", postedDays: 3, isPublished: true },\n  { id: \"2\", title: \"Product Designer\", department: \"Design\", location: \"Remote\", type: \"Full-time\", salary: \"$90k - $120k\", postedDays: 7, isPublished: true },\n  { id: \"3\", title: \"Marketing Manager\", department: \"Marketing\", location: \"Hybrid\", type: \"Full-time\", salary: \"$80k - $100k\", postedDays: 1, isPublished: false },\n];\n\nexport const mockTransactions = [\n  { id: \"1\", description: \"Software subscription\", amount: -299.00, category: \"Software\", date: \"Dec 1, 2024\", status: \"approved\" as const },\n  { id: \"2\", description: \"Team lunch expense\", amount: -156.50, category: \"Meals\", date: \"Nov 28, 2024\", status: \"pending\" as const },\n  { id: \"3\", description: \"Client payment received\", amount: 5000.00, category: \"Revenue\", date: \"Nov 25, 2024\", status: \"approved\" as const },\n  { id: \"4\", description: \"Office supplies\", amount: -89.99, category: \"Supplies\", date: \"Nov 20, 2024\", status: \"pending\" as const },\n];\n\nexport const mockKPIs = [\n  { label: \"Tasks Completed\", value: 47, trend: 12, trendUp: true },\n  { label: \"Active Projects\", value: 8, trend: 2, trendUp: true },\n  { label: \"Team Members\", value: 24, trend: 0, trendUp: true },\n  { label: \"Pending Reviews\", value: 5, trend: -3, trendUp: false },\n];\n\nexport const mockNotifications = [\n  { id: \"1\", title: \"New task assigned\", message: \"You have been assigned to 'Review Q4 reports'\", time: \"5 min ago\", isRead: false },\n  { id: \"2\", title: \"Meeting reminder\", message: \"Sprint Planning starts in 30 minutes\", time: \"25 min ago\", isRead: false },\n  { id: \"3\", title: \"Comment on your post\", message: \"James Wilson commented on your update\", time: \"1 hour ago\", isRead: true },\n];\n","path":null,"size_bytes":6292,"size_tokens":null},"server/objectAcl.ts":{"content":"import { File } from \"@google-cloud/storage\";\n\nconst ACL_POLICY_METADATA_KEY = \"custom:aclPolicy\";\n\nexport enum ObjectAccessGroupType {}\n\nexport interface ObjectAccessGroup {\n  type: ObjectAccessGroupType;\n  id: string;\n}\n\nexport enum ObjectPermission {\n  READ = \"read\",\n  WRITE = \"write\",\n}\n\nexport interface ObjectAclRule {\n  group: ObjectAccessGroup;\n  permission: ObjectPermission;\n}\n\nexport interface ObjectAclPolicy {\n  owner: string;\n  visibility: \"public\" | \"private\";\n  aclRules?: Array<ObjectAclRule>;\n}\n\nfunction isPermissionAllowed(\n  requested: ObjectPermission,\n  granted: ObjectPermission,\n): boolean {\n  if (requested === ObjectPermission.READ) {\n    return [ObjectPermission.READ, ObjectPermission.WRITE].includes(granted);\n  }\n  return granted === ObjectPermission.WRITE;\n}\n\nabstract class BaseObjectAccessGroup implements ObjectAccessGroup {\n  constructor(\n    public readonly type: ObjectAccessGroupType,\n    public readonly id: string,\n  ) {}\n  public abstract hasMember(userId: string): Promise<boolean>;\n}\n\nfunction createObjectAccessGroup(\n  group: ObjectAccessGroup,\n): BaseObjectAccessGroup {\n  switch (group.type) {\n    default:\n      throw new Error(`Unknown access group type: ${group.type}`);\n  }\n}\n\nexport async function setObjectAclPolicy(\n  objectFile: File,\n  aclPolicy: ObjectAclPolicy,\n): Promise<void> {\n  const [exists] = await objectFile.exists();\n  if (!exists) {\n    throw new Error(`Object not found: ${objectFile.name}`);\n  }\n  await objectFile.setMetadata({\n    metadata: {\n      [ACL_POLICY_METADATA_KEY]: JSON.stringify(aclPolicy),\n    },\n  });\n}\n\nexport async function getObjectAclPolicy(\n  objectFile: File,\n): Promise<ObjectAclPolicy | null> {\n  const [metadata] = await objectFile.getMetadata();\n  const aclPolicy = metadata?.metadata?.[ACL_POLICY_METADATA_KEY];\n  if (!aclPolicy) {\n    return null;\n  }\n  return JSON.parse(aclPolicy as string);\n}\n\nexport async function canAccessObject({\n  userId,\n  objectFile,\n  requestedPermission,\n}: {\n  userId?: string;\n  objectFile: File;\n  requestedPermission: ObjectPermission;\n}): Promise<boolean> {\n  const aclPolicy = await getObjectAclPolicy(objectFile);\n  if (!aclPolicy) {\n    return false;\n  }\n  if (\n    aclPolicy.visibility === \"public\" &&\n    requestedPermission === ObjectPermission.READ\n  ) {\n    return true;\n  }\n  if (!userId) {\n    return false;\n  }\n  if (aclPolicy.owner === userId) {\n    return true;\n  }\n  for (const rule of aclPolicy.aclRules || []) {\n    const accessGroup = createObjectAccessGroup(rule.group);\n    if (\n      (await accessGroup.hasMember(userId)) &&\n      isPermissionAllowed(requestedPermission, rule.permission)\n    ) {\n      return true;\n    }\n  }\n  return false;\n}\n","path":null,"size_bytes":2700,"size_tokens":null},"client/src/components/CreatePostComposer.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { UserAvatar } from \"./UserAvatar\";\nimport { Image, Smile, Send } from \"lucide-react\";\n\ninterface CreatePostComposerProps {\n  user: { name: string; avatar?: string | null };\n  onPost?: (content: string) => void;\n}\n\nexport function CreatePostComposer({ user, onPost }: CreatePostComposerProps) {\n  const [content, setContent] = useState(\"\");\n\n  const handleSubmit = () => {\n    if (content.trim()) {\n      onPost?.(content);\n      setContent(\"\");\n    }\n  };\n\n  return (\n    <Card>\n      <CardContent className=\"p-4\">\n        <div className=\"flex gap-3\">\n          <UserAvatar name={user.name} avatar={user.avatar} size=\"md\" />\n          <div className=\"flex-1\">\n            <Textarea\n              placeholder=\"What's on your mind?\"\n              value={content}\n              onChange={(e) => setContent(e.target.value)}\n              className=\"resize-none border-0 text-base focus-visible:ring-0 min-h-[60px]\"\n              data-testid=\"textarea-post\"\n            />\n            <div className=\"flex items-center justify-between mt-2\">\n              <div className=\"flex items-center gap-1\">\n                <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-attach-image\">\n                  <Image className=\"h-5 w-5 text-muted-foreground\" />\n                </Button>\n                <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-add-emoji\">\n                  <Smile className=\"h-5 w-5 text-muted-foreground\" />\n                </Button>\n              </div>\n              <Button\n                size=\"sm\"\n                disabled={!content.trim()}\n                onClick={handleSubmit}\n                data-testid=\"button-submit-post\"\n              >\n                <Send className=\"h-4 w-4 mr-1\" />\n                Post\n              </Button>\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2060,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"@neondatabase/serverless\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1439,"size_tokens":null},"client/src/components/TaskCard.tsx":{"content":"import { Checkbox } from \"@/components/ui/checkbox\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { UserAvatar } from \"./UserAvatar\";\nimport { Calendar } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface TaskCardProps {\n  id: string;\n  title: string;\n  assignee: { name: string; avatar?: string | null };\n  priority: \"high\" | \"medium\" | \"low\";\n  status: \"pending\" | \"in_progress\" | \"completed\";\n  dueDate: string;\n  onToggle?: (id: string) => void;\n}\n\nconst priorityStyles = {\n  high: \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\",\n  medium: \"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400\",\n  low: \"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\",\n};\n\nexport function TaskCard({ id, title, assignee, priority, status, dueDate, onToggle }: TaskCardProps) {\n  const isCompleted = status === \"completed\";\n\n  return (\n    <div\n      className={cn(\n        \"flex items-center gap-4 p-4 rounded-md border bg-card hover-elevate\",\n        isCompleted && \"opacity-60\"\n      )}\n      data-testid={`card-task-${id}`}\n    >\n      <Checkbox\n        checked={isCompleted}\n        onCheckedChange={() => onToggle?.(id)}\n        data-testid={`checkbox-task-${id}`}\n      />\n      <div className=\"flex-1 min-w-0\">\n        <p className={cn(\"font-medium truncate\", isCompleted && \"line-through text-muted-foreground\")}>\n          {title}\n        </p>\n        <div className=\"flex items-center gap-3 mt-1 flex-wrap\">\n          <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n            <Calendar className=\"h-3 w-3\" />\n            <span>{dueDate}</span>\n          </div>\n          <Badge variant=\"secondary\" className={cn(\"text-xs\", priorityStyles[priority])}>\n            {priority}\n          </Badge>\n        </div>\n      </div>\n      <UserAvatar name={assignee.name} avatar={assignee.avatar} size=\"sm\" />\n    </div>\n  );\n}\n","path":null,"size_bytes":1922,"size_tokens":null},"client/src/pages/SocialFeed.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { UserAvatar } from \"@/components/UserAvatar\";\nimport { ObjectUploader } from \"@/components/ObjectUploader\";\nimport { Send, Image, Video, X } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { SocialPostCard } from \"@/components/SocialPostCard\";\nimport type { Post, User } from \"@shared/schema\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\nexport default function SocialFeed() {\n  const { language } = useLanguage();\n  const t = translations[language];\n  const { toast } = useToast();\n  const { user: currentUser } = useAuth();\n  const [newPostContent, setNewPostContent] = useState(\"\");\n  const [mediaUrl, setMediaUrl] = useState<string | null>(null);\n  const [mediaType, setMediaType] = useState<\"image\" | \"video\" | null>(null);\n\n  const { data: posts = [], isLoading: postsLoading } = useQuery<Post[]>({\n    queryKey: [\"/api/posts\"],\n  });\n\n  const { data: users = [] } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const createPostMutation = useMutation({\n    mutationFn: async (data: { content: string; mediaUrl?: string; mediaType?: string }) => {\n      return await apiRequest(\"POST\", \"/api/posts\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/posts\"] });\n      setNewPostContent(\"\");\n      setMediaUrl(null);\n      setMediaType(null);\n      toast({ title: t.socialFeed?.posted || \"Posted!\", description: t.socialFeed?.postedDesc || \"Your update has been shared.\" });\n    },\n    onError: () => {\n      toast({ title: t.socialFeed?.error || \"Error\", description: t.socialFeed?.failedPost || \"Failed to create post.\", variant: \"destructive\" });\n    },\n  });\n\n  const handlePost = () => {\n    if (newPostContent.trim() || mediaUrl) {\n      createPostMutation.mutate({\n        content: newPostContent || \"\",\n        mediaUrl: mediaUrl || undefined,\n        mediaType: mediaType || undefined,\n      });\n    }\n  };\n\n  const handleMediaUploadComplete = async (result: any, type: \"image\" | \"video\") => {\n    if (result.successful && result.successful.length > 0) {\n      const uploadedUrl = result.successful[0].uploadURL;\n      try {\n        const response = await apiRequest(\"PUT\", \"/api/media\", { mediaURL: uploadedUrl });\n        const data = await response.json();\n        setMediaUrl(data.objectPath);\n        setMediaType(type);\n        const typeLabel = type === \"image\" ? (t.socialFeed?.photo || \"Photo\") : (t.socialFeed?.video || \"Video\");\n        toast({ title: t.socialFeed?.uploaded || \"Uploaded!\", description: `${typeLabel} ${t.socialFeed?.readyToPost || \"ready to post.\"}` });\n      } catch (error) {\n        toast({ title: t.socialFeed?.uploadFailed || \"Upload Failed\", description: t.socialFeed?.uploadFailedDesc || \"Could not process the uploaded file. Please try again.\", variant: \"destructive\" });\n      }\n    }\n  };\n\n  const getUploadParams = async () => {\n    const response = await apiRequest(\"POST\", \"/api/objects/upload\");\n    const data = await response.json();\n    return { method: \"PUT\" as const, url: data.uploadURL };\n  };\n\n  const getUserById = (userId: string | null) => {\n    if (!userId) return null;\n    return users.find(u => u.id === userId);\n  };\n\n  const currentUserName = currentUser \n    ? `${currentUser.firstName || ''} ${currentUser.lastName || ''}`.trim() || currentUser.email || (t.common?.you || 'You')\n    : (t.common?.you || 'You');\n\n  const clearMedia = () => {\n    setMediaUrl(null);\n    setMediaType(null);\n  };\n\n  return (\n    <div className=\"p-6 space-y-6 max-w-3xl mx-auto\" dir={language === 'ar' ? 'rtl' : 'ltr'}>\n      <div>\n        <h1 className=\"text-3xl font-semibold\">{t.socialFeed?.title || \"Social Feed\"}</h1>\n        <p className=\"text-muted-foreground mt-1\">{t.socialFeed?.subtitle || \"Share updates, photos, and videos with your team\"}</p>\n      </div>\n\n      <Card>\n        <CardContent className=\"p-4\">\n          <div className=\"flex gap-3\">\n            <UserAvatar \n              name={currentUserName} \n              avatar={currentUser?.profileImageUrl} \n              size=\"md\" \n            />\n            <div className=\"flex-1 space-y-3\">\n              <Textarea\n                placeholder={t.socialFeed?.whatsOnMind || \"What's on your mind?\"}\n                value={newPostContent}\n                onChange={(e) => setNewPostContent(e.target.value)}\n                className=\"resize-none min-h-[80px]\"\n                data-testid=\"input-post-content\"\n              />\n              \n              {mediaUrl && (\n                <div className=\"relative rounded-lg overflow-hidden bg-muted\">\n                  <Button\n                    variant=\"secondary\"\n                    size=\"icon\"\n                    className=\"absolute top-2 right-2 z-10 h-8 w-8\"\n                    onClick={clearMedia}\n                    data-testid=\"button-remove-media\"\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                  {mediaType === \"image\" ? (\n                    <img \n                      src={mediaUrl} \n                      alt={t.socialFeed?.uploadPreview || \"Upload preview\"} \n                      className=\"max-h-64 w-full object-contain\"\n                    />\n                  ) : (\n                    <video \n                      src={mediaUrl} \n                      controls \n                      className=\"max-h-64 w-full\"\n                    />\n                  )}\n                </div>\n              )}\n\n              <div className=\"flex items-center justify-between gap-2\">\n                <div className=\"flex gap-2\">\n                  <ObjectUploader\n                    maxNumberOfFiles={1}\n                    maxFileSize={10485760}\n                    allowedFileTypes={[\"image/*\"]}\n                    onGetUploadParameters={getUploadParams}\n                    onComplete={(result) => handleMediaUploadComplete(result, \"image\")}\n                    buttonVariant=\"ghost\"\n                    buttonSize=\"sm\"\n                  >\n                    <Image className={`h-4 w-4 ${language === 'ar' ? 'ml-1' : 'mr-1'}`} />\n                    {t.socialFeed?.photo || \"Photo\"}\n                  </ObjectUploader>\n                  <ObjectUploader\n                    maxNumberOfFiles={1}\n                    maxFileSize={52428800}\n                    allowedFileTypes={[\"video/*\"]}\n                    onGetUploadParameters={getUploadParams}\n                    onComplete={(result) => handleMediaUploadComplete(result, \"video\")}\n                    buttonVariant=\"ghost\"\n                    buttonSize=\"sm\"\n                  >\n                    <Video className={`h-4 w-4 ${language === 'ar' ? 'ml-1' : 'mr-1'}`} />\n                    {t.socialFeed?.video || \"Video\"}\n                  </ObjectUploader>\n                </div>\n                <Button \n                  onClick={handlePost} \n                  disabled={(!newPostContent.trim() && !mediaUrl) || createPostMutation.isPending}\n                  data-testid=\"button-post\"\n                >\n                  <Send className={`h-4 w-4 ${language === 'ar' ? 'ml-2' : 'mr-2'}`} />\n                  {createPostMutation.isPending ? (t.socialFeed?.posting || \"Posting...\") : (t.socialFeed?.post || \"Post\")}\n                </Button>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"space-y-4\">\n        {postsLoading ? (\n          Array(5).fill(0).map((_, i) => (\n            <Skeleton key={i} className=\"h-48 w-full\" />\n          ))\n        ) : posts.length > 0 ? (\n          posts.map((post) => {\n            const author = getUserById(post.authorId);\n            return (\n              <SocialPostCard\n                key={post.id}\n                post={post}\n                author={author}\n                currentUserId={currentUser?.id}\n              />\n            );\n          })\n        ) : (\n          <Card>\n            <CardContent className=\"py-12 text-center text-muted-foreground\">\n              <p className=\"text-lg mb-2\">{t.socialFeed?.noPostsYet || \"No posts yet\"}</p>\n              <p className=\"text-sm\">{t.socialFeed?.beFirst || \"Be the first to share an update with your team!\"}</p>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":8695,"size_tokens":null},"client/src/pages/Messages.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { UserAvatar } from \"@/components/UserAvatar\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { VoiceRecorder } from \"@/components/VoiceRecorder\";\nimport { \n  Search, \n  Send, \n  MessageCircle, \n  Loader2,\n  Users,\n  Plus,\n  User as UserIcon,\n  MoreVertical,\n  Phone,\n  Video,\n  Check,\n  CheckCheck,\n  ArrowLeft,\n  Mic,\n  Image as ImageIcon,\n  X,\n  Trash2,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport type { ChatThread, Message, User } from \"@shared/schema\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\ninterface EnhancedThread extends ChatThread {\n  lastMessage?: Message;\n  unreadCount?: number;\n  participants?: User[];\n}\n\nexport default function Messages() {\n  const { language } = useLanguage();\n  const t = translations[language];\n  const { user: currentUser } = useAuth();\n  const { toast } = useToast();\n  const [activeThreadId, setActiveThreadId] = useState<number | null>(null);\n  const [search, setSearch] = useState(\"\");\n  const [newMessage, setNewMessage] = useState(\"\");\n  const [showNewChat, setShowNewChat] = useState(false);\n  const [showNewGroup, setShowNewGroup] = useState(false);\n  const [selectedUsers, setSelectedUsers] = useState<string[]>([]);\n  const [groupName, setGroupName] = useState(\"\");\n  const [showVoiceRecorder, setShowVoiceRecorder] = useState(false);\n  const [isUploadingMedia, setIsUploadingMedia] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const imageInputRef = useRef<HTMLInputElement>(null);\n  const videoInputRef = useRef<HTMLInputElement>(null);\n\n  const { data: threads = [], isLoading: threadsLoading } = useQuery<EnhancedThread[]>({\n    queryKey: [\"/api/threads\"],\n    refetchInterval: 5000,\n  });\n\n  const { data: users = [] } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const { data: messages = [], isLoading: messagesLoading } = useQuery<Message[]>({\n    queryKey: [\"/api/threads\", activeThreadId, \"messages\"],\n    enabled: !!activeThreadId,\n    refetchInterval: 3000,\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async ({ content, messageType, mediaUrl }: { content: string; messageType?: string; mediaUrl?: string }) => {\n      return await apiRequest(\"POST\", `/api/threads/${activeThreadId}/messages`, { \n        content, \n        messageType: messageType || \"text\",\n        mediaUrl \n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/threads\", activeThreadId, \"messages\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/threads\"] });\n      setNewMessage(\"\");\n    },\n  });\n\n  const uploadMedia = async (file: Blob, fileType: string): Promise<string> => {\n    console.log(\"Starting media upload, fileType:\", fileType);\n    const response = await apiRequest(\"POST\", \"/api/upload/media\", { fileType });\n    const data = await response.json();\n    console.log(\"Got upload URL response:\", data);\n    const { uploadURL, objectPath } = data;\n    \n    if (!uploadURL || !objectPath) {\n      console.error(\"Missing uploadURL or objectPath in response\");\n      throw new Error(\"Invalid upload response\");\n    }\n    \n    console.log(\"Uploading to:\", uploadURL);\n    const uploadResponse = await fetch(uploadURL, {\n      method: \"PUT\",\n      body: file,\n      headers: {\n        \"Content-Type\": file.type,\n      },\n    });\n    \n    console.log(\"Upload response status:\", uploadResponse.status);\n    if (!uploadResponse.ok) {\n      const errorText = await uploadResponse.text();\n      console.error(\"Upload failed:\", errorText);\n      throw new Error(\"Failed to upload file\");\n    }\n    \n    console.log(\"Upload successful, objectPath:\", objectPath);\n    return objectPath;\n  };\n\n  const createDirectChatMutation = useMutation({\n    mutationFn: async (targetUserId: string) => {\n      return await apiRequest(\"POST\", \"/api/threads/direct\", { targetUserId });\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/threads\"] });\n      setActiveThreadId(data.id);\n      setShowNewChat(false);\n      toast({ title: \"Chat created successfully\" });\n    },\n  });\n\n  const createGroupMutation = useMutation({\n    mutationFn: async ({ name, participantIds }: { name: string; participantIds: string[] }) => {\n      return await apiRequest(\"POST\", \"/api/threads\", { name, participantIds, type: \"group\" });\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/threads\"] });\n      setActiveThreadId(data.id);\n      setShowNewGroup(false);\n      setSelectedUsers([]);\n      setGroupName(\"\");\n      toast({ title: \"Group created successfully\" });\n    },\n  });\n\n  const deleteThreadMutation = useMutation({\n    mutationFn: async (threadId: number) => {\n      return await apiRequest(\"DELETE\", `/api/threads/${threadId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/threads\"] });\n      if (activeThreadId) setActiveThreadId(null);\n      toast({ title: \"Chat deleted successfully\" });\n    },\n  });\n\n  const deleteMessageMutation = useMutation({\n    mutationFn: async (messageId: number) => {\n      return await apiRequest(\"DELETE\", `/api/threads/${activeThreadId}/messages/${messageId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/threads\", activeThreadId, \"messages\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/threads\"] });\n      toast({ title: \"Message deleted\" });\n    },\n    onError: () => {\n      toast({ title: \"Failed to delete message\", variant: \"destructive\" });\n    },\n  });\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  const handleSend = () => {\n    if (newMessage.trim() && activeThreadId) {\n      sendMessageMutation.mutate({ content: newMessage });\n    }\n  };\n\n  const handleVoiceRecordingComplete = async (audioBlob: Blob) => {\n    if (!activeThreadId) return;\n    \n    setIsUploadingMedia(true);\n    try {\n      const fileType = audioBlob.type.includes('webm') ? 'webm' : 'ogg';\n      const mediaUrl = await uploadMedia(audioBlob, fileType);\n      await sendMessageMutation.mutateAsync({ \n        content: \"Voice message\", \n        messageType: \"voice\",\n        mediaUrl \n      });\n      setShowVoiceRecorder(false);\n      toast({ title: \"Voice message sent\" });\n    } catch (error) {\n      console.error(\"Error sending voice message:\", error);\n      toast({ title: \"Failed to send voice message\", variant: \"destructive\" });\n    } finally {\n      setIsUploadingMedia(false);\n    }\n  };\n\n  const handleImageUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file || !activeThreadId) return;\n\n    setIsUploadingMedia(true);\n    try {\n      const fileType = file.name.split('.').pop() || 'jpg';\n      const mediaUrl = await uploadMedia(file, fileType);\n      await sendMessageMutation.mutateAsync({ \n        content: \" Image\", \n        messageType: \"image\",\n        mediaUrl \n      });\n      toast({ title: \"Image sent\" });\n    } catch (error) {\n      console.error(\"Error sending image:\", error);\n      toast({ title: \"Failed to send image\", variant: \"destructive\" });\n    } finally {\n      setIsUploadingMedia(false);\n      if (imageInputRef.current) {\n        imageInputRef.current.value = '';\n      }\n    }\n  };\n\n  const handleVideoUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file || !activeThreadId) return;\n\n    setIsUploadingMedia(true);\n    try {\n      const fileType = file.name.split('.').pop() || 'mp4';\n      const mediaUrl = await uploadMedia(file, fileType);\n      await sendMessageMutation.mutateAsync({ \n        content: \" Video\", \n        messageType: \"video\",\n        mediaUrl \n      });\n      toast({ title: \"Video sent\" });\n    } catch (error) {\n      console.error(\"Error sending video:\", error);\n      toast({ title: \"Failed to send video\", variant: \"destructive\" });\n    } finally {\n      setIsUploadingMedia(false);\n      if (videoInputRef.current) {\n        videoInputRef.current.value = '';\n      }\n    }\n  };\n\n  const getUserById = (userId: string | null) => {\n    if (!userId) return null;\n    return users.find(u => u.id === userId);\n  };\n\n  const getOtherParticipant = (thread: EnhancedThread) => {\n    if (thread.type !== \"direct\" || !thread.participants) return null;\n    return thread.participants.find(p => p.id !== currentUser?.id);\n  };\n\n  const getThreadDisplayName = (thread: EnhancedThread) => {\n    if (thread.type === \"direct\") {\n      const otherUser = getOtherParticipant(thread);\n      if (otherUser) {\n        return `${otherUser.firstName || ''} ${otherUser.lastName || ''}`.trim() || otherUser.email || 'User';\n      }\n    }\n    return thread.name;\n  };\n\n  const getThreadAvatar = (thread: EnhancedThread) => {\n    if (thread.type === \"direct\") {\n      const otherUser = getOtherParticipant(thread);\n      return otherUser?.profileImageUrl || null;\n    }\n    return thread.avatarUrl || null;\n  };\n\n  const activeThread = threads.find(t => t.id === activeThreadId);\n\n  const filteredThreads = threads.filter((thread) =>\n    getThreadDisplayName(thread).toLowerCase().includes(search.toLowerCase())\n  );\n\n  const otherUsers = users.filter(u => u.id !== currentUser?.id);\n\n  const handleCreateGroup = () => {\n    if (groupName.trim() && selectedUsers.length > 0) {\n      createGroupMutation.mutate({ name: groupName, participantIds: selectedUsers });\n    }\n  };\n\n  const formatMessageTime = (date: Date | string) => {\n    const d = new Date(date);\n    const now = new Date();\n    const diffDays = Math.floor((now.getTime() - d.getTime()) / (1000 * 60 * 60 * 24));\n    \n    if (diffDays === 0) {\n      return d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n    } else if (diffDays === 1) {\n      return 'Yesterday';\n    } else if (diffDays < 7) {\n      return d.toLocaleDateString([], { weekday: 'short' });\n    }\n    return d.toLocaleDateString([], { month: 'short', day: 'numeric' });\n  };\n\n  return (\n    <div className=\"flex h-[calc(100vh-4rem)]\">\n      <div className={cn(\n        \"w-full md:w-96 border-r border-white/5 flex flex-col bg-sidebar\",\n        activeThreadId && \"hidden md:flex\"\n      )}>\n        <div className=\"p-4 border-b border-white/5\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"p-2 rounded-lg bg-gradient-to-br from-cyan-500 to-teal-500\">\n                <MessageCircle className=\"h-4 w-4 text-white\" />\n              </div>\n              <h2 className=\"font-semibold\">{t.messages?.title || \"Messages\"}</h2>\n            </div>\n            <div className=\"flex gap-2\">\n              <Dialog open={showNewChat} onOpenChange={setShowNewChat}>\n                <DialogTrigger asChild>\n                  <Button size=\"icon\" variant=\"ghost\" className=\"h-9 w-9\" data-testid=\"button-new-chat\">\n                    <UserIcon className=\"h-4 w-4\" />\n                  </Button>\n                </DialogTrigger>\n                <DialogContent>\n                  <DialogHeader>\n                    <DialogTitle>{t.messages?.newChat || \"New Chat\"}</DialogTitle>\n                  </DialogHeader>\n                  <div className=\"space-y-4 mt-4\">\n                    <p className=\"text-sm text-muted-foreground\">{t.messages?.selectUser || \"Select a user to start a conversation\"}</p>\n                    <ScrollArea className=\"h-64\">\n                      <div className=\"space-y-2\">\n                        {otherUsers.map((user) => (\n                          <button\n                            key={user.id}\n                            onClick={() => createDirectChatMutation.mutate(user.id)}\n                            disabled={createDirectChatMutation.isPending}\n                            className=\"w-full p-3 rounded-xl hover:bg-white/5 text-left transition-colors flex items-center gap-3\"\n                            data-testid={`button-start-chat-${user.id}`}\n                          >\n                            <UserAvatar\n                              name={`${user.firstName || ''} ${user.lastName || ''}`.trim() || user.email || 'User'}\n                              avatar={user.profileImageUrl}\n                              size=\"sm\"\n                            />\n                            <div className=\"flex-1 min-w-0\">\n                              <p className=\"font-medium truncate\">\n                                {`${user.firstName || ''} ${user.lastName || ''}`.trim() || user.email}\n                              </p>\n                              <p className=\"text-xs text-muted-foreground truncate\">{user.email}</p>\n                            </div>\n                          </button>\n                        ))}\n                      </div>\n                    </ScrollArea>\n                  </div>\n                </DialogContent>\n              </Dialog>\n\n              <Dialog open={showNewGroup} onOpenChange={setShowNewGroup}>\n                <DialogTrigger asChild>\n                  <Button size=\"icon\" variant=\"ghost\" className=\"h-9 w-9\" data-testid=\"button-new-group\">\n                    <Plus className=\"h-4 w-4\" />\n                  </Button>\n                </DialogTrigger>\n                <DialogContent>\n                  <DialogHeader>\n                    <DialogTitle>{t.messages?.createGroup || \"Create Group\"}</DialogTitle>\n                  </DialogHeader>\n                  <div className=\"space-y-4 mt-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"groupName\">{t.messages?.groupName || \"Group Name\"}</Label>\n                      <Input\n                        id=\"groupName\"\n                        placeholder={t.messages?.enterGroupName || \"Enter group name...\"}\n                        value={groupName}\n                        onChange={(e) => setGroupName(e.target.value)}\n                        data-testid=\"input-group-name\"\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label>{t.messages?.selectMembers || \"Select Members\"}</Label>\n                      <ScrollArea className=\"h-48 border rounded-lg p-2\">\n                        {otherUsers.map((user) => (\n                          <div key={user.id} className=\"flex items-center gap-3 p-2 rounded-lg hover:bg-white/5\">\n                            <Checkbox\n                              id={`user-${user.id}`}\n                              checked={selectedUsers.includes(user.id)}\n                              onCheckedChange={(checked) => {\n                                if (checked) {\n                                  setSelectedUsers([...selectedUsers, user.id]);\n                                } else {\n                                  setSelectedUsers(selectedUsers.filter(id => id !== user.id));\n                                }\n                              }}\n                              data-testid={`checkbox-user-${user.id}`}\n                            />\n                            <UserAvatar\n                              name={`${user.firstName || ''} ${user.lastName || ''}`.trim() || user.email || 'User'}\n                              avatar={user.profileImageUrl}\n                              size=\"sm\"\n                            />\n                            <label htmlFor={`user-${user.id}`} className=\"flex-1 cursor-pointer\">\n                              <p className=\"font-medium text-sm\">\n                                {`${user.firstName || ''} ${user.lastName || ''}`.trim() || user.email}\n                              </p>\n                            </label>\n                          </div>\n                        ))}\n                      </ScrollArea>\n                    </div>\n                    <Button\n                      onClick={handleCreateGroup}\n                      disabled={!groupName.trim() || selectedUsers.length === 0 || createGroupMutation.isPending}\n                      className=\"w-full\"\n                      data-testid=\"button-create-group\"\n                    >\n                      {createGroupMutation.isPending ? (\n                        <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                      ) : null}\n                      {t.messages?.createGroupBtn || \"Create Group\"} ({selectedUsers.length} {t.messages?.members || \"members\"})\n                    </Button>\n                  </div>\n                </DialogContent>\n              </Dialog>\n            </div>\n          </div>\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder={t.messages?.searchConversations || \"Search conversations...\"}\n              value={search}\n              onChange={(e) => setSearch(e.target.value)}\n              className=\"pl-9 bg-white/5 border-white/10 focus:border-cyan-500/50\"\n              data-testid=\"input-search-messages\"\n            />\n          </div>\n        </div>\n        <ScrollArea className=\"flex-1\">\n          <div className=\"p-2 space-y-1\">\n            {threadsLoading ? (\n              Array(5).fill(0).map((_, i) => (\n                <Skeleton key={i} className=\"h-16 w-full bg-white/5\" />\n              ))\n            ) : filteredThreads.length > 0 ? (\n              filteredThreads.map((thread) => (\n                <button\n                  key={thread.id}\n                  onClick={() => setActiveThreadId(thread.id)}\n                  className={cn(\n                    \"w-full p-3 rounded-xl text-left transition-all duration-200\",\n                    activeThreadId === thread.id\n                      ? \"bg-white/10 border border-cyan-500/30\"\n                      : \"hover:bg-white/5 border border-transparent\"\n                  )}\n                  data-testid={`button-thread-${thread.id}`}\n                >\n                  <div className=\"flex items-center gap-3\">\n                    {thread.type === \"group\" ? (\n                      <div className={cn(\n                        \"h-12 w-12 rounded-full flex items-center justify-center shrink-0\",\n                        activeThreadId === thread.id\n                          ? \"bg-gradient-to-br from-cyan-500 to-teal-500\"\n                          : \"bg-white/10\"\n                      )}>\n                        <Users className={cn(\n                          \"h-5 w-5\",\n                          activeThreadId === thread.id ? \"text-white\" : \"text-muted-foreground\"\n                        )} />\n                      </div>\n                    ) : (\n                      <UserAvatar\n                        name={getThreadDisplayName(thread)}\n                        avatar={getThreadAvatar(thread)}\n                        size=\"md\"\n                      />\n                    )}\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center justify-between gap-2\">\n                        <p className={cn(\n                          \"font-medium truncate\",\n                          activeThreadId === thread.id && \"text-cyan-400\"\n                        )}>{getThreadDisplayName(thread)}</p>\n                        {thread.lastMessage && (\n                          <span className=\"text-xs text-muted-foreground shrink-0\">\n                            {formatMessageTime(thread.lastMessage.createdAt!)}\n                          </span>\n                        )}\n                      </div>\n                      <div className=\"flex items-center justify-between gap-2 mt-0.5\">\n                        <p className=\"text-sm text-muted-foreground truncate\">\n                          {thread.lastMessage ? (\n                            <>\n                              {thread.lastMessage.senderId === currentUser?.id && (\n                                <span className=\"text-cyan-400 mr-1\">\n                                  <CheckCheck className=\"h-3 w-3 inline\" />\n                                </span>\n                              )}\n                              {thread.lastMessage.content}\n                            </>\n                          ) : (\n                            <span className=\"italic\">{t.messages?.noMessagesYet || \"No messages yet\"}</span>\n                          )}\n                        </p>\n                        {thread.unreadCount && thread.unreadCount > 0 ? (\n                          <Badge variant=\"default\" className=\"bg-cyan-500 text-white text-xs min-w-[20px] h-5 justify-center\">\n                            {thread.unreadCount}\n                          </Badge>\n                        ) : null}\n                      </div>\n                    </div>\n                  </div>\n                </button>\n              ))\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <MessageCircle className=\"h-10 w-10 mx-auto mb-2 opacity-30\" />\n                <p className=\"text-sm\">{search ? (t.messages?.noConversationsFound || \"No conversations found\") : (t.messages?.noConversations || \"No conversations yet\")}</p>\n                <p className=\"text-xs mt-2\">{t.messages?.startConversation || \"Click the + button to start a new chat\"}</p>\n              </div>\n            )}\n          </div>\n        </ScrollArea>\n      </div>\n\n      <div className={cn(\n        \"flex-1 flex flex-col bg-background\",\n        !activeThreadId && \"hidden md:flex\"\n      )}>\n        {activeThread ? (\n          <>\n            <div className=\"h-16 border-b border-white/5 px-4 flex items-center gap-3 bg-card/50 backdrop-blur-sm\">\n              <Button\n                size=\"icon\"\n                variant=\"ghost\"\n                className=\"md:hidden\"\n                onClick={() => setActiveThreadId(null)}\n                data-testid=\"button-back-to-list\"\n              >\n                <ArrowLeft className=\"h-5 w-5\" />\n              </Button>\n              \n              {activeThread.type === \"group\" ? (\n                <div className=\"h-10 w-10 rounded-full bg-gradient-to-br from-cyan-500 to-teal-500 flex items-center justify-center\">\n                  <Users className=\"h-5 w-5 text-white\" />\n                </div>\n              ) : (\n                <UserAvatar\n                  name={getThreadDisplayName(activeThread)}\n                  avatar={getThreadAvatar(activeThread)}\n                  size=\"sm\"\n                />\n              )}\n              <div className=\"flex-1\">\n                <p className=\"font-semibold\">{getThreadDisplayName(activeThread)}</p>\n                <p className=\"text-xs text-muted-foreground\">\n                  {activeThread.type === \"group\" \n                    ? `${activeThread.participants?.length || 0} members`\n                    : \"Online\"\n                  }\n                </p>\n              </div>\n              <div className=\"flex items-center gap-1\">\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-9 w-9\" data-testid=\"button-video-call\">\n                  <Video className=\"h-4 w-4\" />\n                </Button>\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-9 w-9\" data-testid=\"button-voice-call\">\n                  <Phone className=\"h-4 w-4\" />\n                </Button>\n                <DropdownMenu>\n                  <DropdownMenuTrigger asChild>\n                    <Button size=\"icon\" variant=\"ghost\" className=\"h-9 w-9\" data-testid=\"button-thread-menu\">\n                      <MoreVertical className=\"h-4 w-4\" />\n                    </Button>\n                  </DropdownMenuTrigger>\n                  <DropdownMenuContent align=\"end\">\n                    <DropdownMenuItem\n                      className=\"text-destructive\"\n                      onClick={() => deleteThreadMutation.mutate(activeThread.id)}\n                      data-testid=\"button-delete-thread\"\n                    >\n                      Delete Chat\n                    </DropdownMenuItem>\n                  </DropdownMenuContent>\n                </DropdownMenu>\n              </div>\n            </div>\n\n            <ScrollArea className=\"flex-1 p-4\">\n              <div className=\"space-y-3 max-w-3xl mx-auto\">\n                {messagesLoading ? (\n                  Array(3).fill(0).map((_, i) => (\n                    <Skeleton key={i} className=\"h-16 w-3/4 bg-white/5\" />\n                  ))\n                ) : messages.length > 0 ? (\n                  messages.map((message, index) => {\n                    const sender = getUserById(message.senderId);\n                    const isOwn = message.senderId === currentUser?.id;\n                    const showAvatar = !isOwn && (\n                      index === 0 || \n                      messages[index - 1]?.senderId !== message.senderId\n                    );\n                    const isLastInGroup = index === messages.length - 1 || \n                      messages[index + 1]?.senderId !== message.senderId;\n                    \n                    return (\n                      <div\n                        key={message.id}\n                        className={cn(\n                          \"flex gap-2 group\",\n                          isOwn ? \"justify-end\" : \"justify-start\"\n                        )}\n                        data-testid={`message-${message.id}`}\n                      >\n                        {!isOwn && (\n                          <div className=\"w-8 shrink-0\">\n                            {showAvatar && (\n                              <UserAvatar\n                                name={sender ? `${sender.firstName || ''} ${sender.lastName || ''}`.trim() || sender.email || 'User' : 'User'}\n                                avatar={sender?.profileImageUrl}\n                                size=\"sm\"\n                              />\n                            )}\n                          </div>\n                        )}\n                        <div className={cn(\n                          \"max-w-[70%]\",\n                          isOwn && \"items-end\"\n                        )}>\n                          {!isOwn && showAvatar && activeThread.type === \"group\" && (\n                            <p className=\"text-xs text-cyan-400 mb-1 px-2\">\n                              {sender ? `${sender.firstName || ''} ${sender.lastName || ''}`.trim() || sender.email : 'User'}\n                            </p>\n                          )}\n                          <div className={cn(\n                            \"px-4 py-2 rounded-2xl relative\",\n                            isOwn \n                              ? \"bg-gradient-to-r from-cyan-500 to-teal-500 text-white\" \n                              : \"bg-white/10 dark:bg-white/5\",\n                            isOwn \n                              ? (isLastInGroup ? \"rounded-br-md\" : \"\")\n                              : (isLastInGroup ? \"rounded-bl-md\" : \"\"),\n                            message.messageType === \"image\" && \"p-1\"\n                          )}>\n                            {message.messageType === \"voice\" && message.mediaUrl ? (\n                              <audio \n                                src={message.mediaUrl} \n                                controls \n                                className=\"max-w-[200px]\"\n                                data-testid={`audio-message-${message.id}`}\n                              />\n                            ) : message.messageType === \"image\" && message.mediaUrl ? (\n                              <img \n                                src={message.mediaUrl} \n                                alt=\"Shared image\"\n                                className=\"max-w-[250px] rounded-xl cursor-pointer\"\n                                onClick={() => window.open(message.mediaUrl!, '_blank')}\n                                data-testid={`image-message-${message.id}`}\n                              />\n                            ) : message.messageType === \"video\" && message.mediaUrl ? (\n                              <video \n                                src={message.mediaUrl} \n                                controls \n                                className=\"max-w-[250px] rounded-xl\"\n                                data-testid={`video-message-${message.id}`}\n                              />\n                            ) : (\n                              <p className=\"text-sm whitespace-pre-wrap break-words\">{message.content}</p>\n                            )}\n                            <div className={cn(\n                              \"flex items-center gap-1 mt-1\",\n                              isOwn ? \"justify-end\" : \"\"\n                            )}>\n                              <span className={cn(\n                                \"text-[10px]\",\n                                isOwn ? \"text-white/70\" : \"text-muted-foreground\"\n                              )}>\n                                {new Date(message.createdAt!).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                              </span>\n                              {isOwn && (\n                                <CheckCheck className={cn(\n                                  \"h-3 w-3\",\n                                  \"text-white/70\"\n                                )} />\n                              )}\n                            </div>\n                          </div>\n                          {isOwn && (\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity shrink-0 self-center\"\n                              onClick={() => deleteMessageMutation.mutate(message.id)}\n                              disabled={deleteMessageMutation.isPending}\n                              data-testid={`button-delete-message-${message.id}`}\n                            >\n                              <Trash2 className=\"h-3 w-3 text-destructive\" />\n                            </Button>\n                          )}\n                        </div>\n                      </div>\n                    );\n                  })\n                ) : (\n                  <div className=\"text-center py-12 text-muted-foreground\">\n                    <div className=\"w-16 h-16 rounded-full bg-gradient-to-br from-cyan-500/20 to-teal-500/20 flex items-center justify-center mx-auto mb-3\">\n                      <MessageCircle className=\"h-8 w-8 text-cyan-400/50\" />\n                    </div>\n                    <p className=\"text-sm font-medium\">No messages yet</p>\n                    <p className=\"text-xs mt-1\">Say hello to start the conversation!</p>\n                  </div>\n                )}\n                <div ref={messagesEndRef} />\n              </div>\n            </ScrollArea>\n\n            <div className=\"p-4 border-t border-white/5 bg-card/50 backdrop-blur-sm\">\n              <div className=\"max-w-3xl mx-auto\">\n                {showVoiceRecorder ? (\n                  <VoiceRecorder\n                    onRecordingComplete={handleVoiceRecordingComplete}\n                    onCancel={() => setShowVoiceRecorder(false)}\n                    isUploading={isUploadingMedia}\n                  />\n                ) : (\n                  <div className=\"flex gap-2 items-center\">\n                    <input\n                      type=\"file\"\n                      ref={imageInputRef}\n                      onChange={handleImageUpload}\n                      accept=\"image/*\"\n                      className=\"hidden\"\n                      data-testid=\"input-image-upload\"\n                    />\n                    <Button \n                      size=\"icon\"\n                      variant=\"ghost\"\n                      onClick={() => imageInputRef.current?.click()}\n                      disabled={isUploadingMedia}\n                      className=\"h-9 w-9 shrink-0\"\n                      data-testid=\"button-upload-image\"\n                    >\n                      {isUploadingMedia ? (\n                        <Loader2 className=\"h-4 w-4 animate-spin\" />\n                      ) : (\n                        <ImageIcon className=\"h-4 w-4\" />\n                      )}\n                    </Button>\n                    <input\n                      type=\"file\"\n                      ref={videoInputRef}\n                      onChange={handleVideoUpload}\n                      accept=\"video/*\"\n                      className=\"hidden\"\n                      data-testid=\"input-video-upload\"\n                    />\n                    <Button \n                      size=\"icon\"\n                      variant=\"ghost\"\n                      onClick={() => videoInputRef.current?.click()}\n                      disabled={isUploadingMedia}\n                      className=\"h-9 w-9 shrink-0\"\n                      data-testid=\"button-upload-video\"\n                    >\n                      <Video className=\"h-4 w-4\" />\n                    </Button>\n                    <Input\n                      placeholder=\"Type a message...\"\n                      value={newMessage}\n                      onChange={(e) => setNewMessage(e.target.value)}\n                      onKeyDown={(e) => e.key === \"Enter\" && !e.shiftKey && handleSend()}\n                      className=\"flex-1 bg-white/5 border-white/10 focus:border-cyan-500/50 rounded-full px-5\"\n                      data-testid=\"input-new-message\"\n                    />\n                    {newMessage.trim() ? (\n                      <Button \n                        size=\"icon\"\n                        onClick={handleSend} \n                        disabled={sendMessageMutation.isPending}\n                        className=\"rounded-full bg-gradient-to-r from-cyan-500 to-teal-500 hover:from-cyan-600 hover:to-teal-600 shrink-0\"\n                        data-testid=\"button-send-message\"\n                      >\n                        {sendMessageMutation.isPending ? (\n                          <Loader2 className=\"h-4 w-4 animate-spin\" />\n                        ) : (\n                          <Send className=\"h-4 w-4\" />\n                        )}\n                      </Button>\n                    ) : (\n                      <Button \n                        size=\"icon\"\n                        variant=\"ghost\"\n                        onClick={() => setShowVoiceRecorder(true)}\n                        className=\"h-9 w-9 shrink-0\"\n                        data-testid=\"button-voice-recorder\"\n                      >\n                        <Mic className=\"h-4 w-4\" />\n                      </Button>\n                    )}\n                  </div>\n                )}\n              </div>\n            </div>\n          </>\n        ) : (\n          <div className=\"flex-1 flex items-center justify-center text-muted-foreground\">\n            <div className=\"text-center\">\n              <div className=\"w-24 h-24 rounded-full bg-gradient-to-br from-cyan-500/20 to-teal-500/20 flex items-center justify-center mx-auto mb-4\">\n                <MessageCircle className=\"h-12 w-12 text-cyan-400/50\" />\n              </div>\n              <h3 className=\"text-xl font-semibold mb-2\">Welcome to Messages</h3>\n              <p className=\"text-sm max-w-xs mx-auto\">\n                Send and receive messages with your team. Start a new conversation or select an existing chat.\n              </p>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":36361,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/components/examples/ThemeToggle.tsx":{"content":"import { ThemeToggle } from \"../ThemeToggle\";\nimport { ThemeProvider } from \"@/contexts/ThemeContext\";\n\nexport default function ThemeToggleExample() {\n  return (\n    <ThemeProvider>\n      <ThemeToggle />\n    </ThemeProvider>\n  );\n}\n","path":null,"size_bytes":232,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { AlertCircle, Home, ArrowLeft } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\nexport default function NotFound() {\n  const { language } = useLanguage();\n  const t = translations[language];\n  const isRTL = language === 'ar';\n\n  return (\n    <div \n      className=\"min-h-screen w-full flex items-center justify-center bg-background\"\n      dir={isRTL ? 'rtl' : 'ltr'}\n    >\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6 text-center\">\n          <div className=\"flex flex-col items-center gap-4 mb-6\">\n            <div className=\"p-4 rounded-full bg-destructive/10\">\n              <AlertCircle className=\"h-12 w-12 text-destructive\" />\n            </div>\n            <div>\n              <h1 className=\"text-4xl font-bold text-foreground mb-2\">404</h1>\n              <h2 className=\"text-xl font-semibold text-foreground\" data-testid=\"text-not-found-title\">\n                {isRTL ? \"  \" : \"Page Not Found\"}\n              </h2>\n            </div>\n          </div>\n\n          <p className=\"text-sm text-muted-foreground mb-6\" data-testid=\"text-not-found-description\">\n            {isRTL \n              ? \"         .\"\n              : \"Sorry, the page you're looking for doesn't exist or has been moved.\"}\n          </p>\n\n          <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\n            <Button \n              variant=\"outline\" \n              onClick={() => window.history.back()}\n              data-testid=\"button-go-back\"\n            >\n              <ArrowLeft className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n              {isRTL ? \"\" : \"Go Back\"}\n            </Button>\n            <Link href=\"/\">\n              <Button data-testid=\"button-go-home\">\n                <Home className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n                {isRTL ? \" \" : \"Go Home\"}\n              </Button>\n            </Link>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":2265,"size_tokens":null},"client/src/components/SocialPost.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { UserAvatar } from \"./UserAvatar\";\nimport { Heart, MessageCircle, Share2 } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface SocialPostProps {\n  id: string;\n  author: { name: string; avatar?: string | null; department?: string };\n  content: string;\n  likes: number;\n  comments: number;\n  timestamp: string;\n  compact?: boolean;\n}\n\nexport function SocialPost({ id, author, content, likes: initialLikes, comments, timestamp, compact }: SocialPostProps) {\n  const [liked, setLiked] = useState(false);\n  const [likes, setLikes] = useState(initialLikes);\n\n  const handleLike = () => {\n    setLiked(!liked);\n    setLikes(prev => liked ? prev - 1 : prev + 1);\n  };\n\n  return (\n    <Card data-testid={`card-post-${id}`}>\n      <CardContent className=\"p-4\">\n        <div className=\"flex gap-3\">\n          <UserAvatar name={author.name} avatar={author.avatar} size=\"md\" />\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 flex-wrap\">\n              <span className=\"font-medium\">{author.name}</span>\n              {author.department && (\n                <span className=\"text-xs text-muted-foreground\">{author.department}</span>\n              )}\n              <span className=\"text-xs text-muted-foreground\">{timestamp}</span>\n            </div>\n            <p className=\"mt-2 text-sm leading-relaxed\">{content}</p>\n            <div className=\"flex items-center gap-1 mt-3\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className={cn(\"gap-1\", liked && \"text-red-500\")}\n                onClick={handleLike}\n                data-testid={`button-like-${id}`}\n              >\n                <Heart className={cn(\"h-4 w-4\", liked && \"fill-current\")} />\n                <span className=\"text-xs\">{likes}</span>\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" className=\"gap-1\" data-testid={`button-comment-${id}`}>\n                <MessageCircle className=\"h-4 w-4\" />\n                <span className=\"text-xs\">{comments}</span>\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" data-testid={`button-share-${id}`}>\n                <Share2 className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2469,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/AppSidebar.tsx":{"content":"import { useLocation, Link } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarHeader,\n  SidebarFooter,\n} from \"@/components/ui/sidebar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { UserAvatar } from \"./UserAvatar\";\nimport {\n  LayoutDashboard,\n  CheckSquare,\n  Ticket,\n  MessageSquare,\n  Users,\n  Video,\n  Briefcase,\n  DollarSign,\n  Shield,\n  Rss,\n  LogOut,\n  Building2,\n  User,\n  Megaphone,\n  Zap,\n  Store,\n  Package,\n  ChevronRight,\n  Sparkles,\n  Mail,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { cn } from \"@/lib/utils\";\nimport { LanguageSwitcher } from \"./LanguageSwitcher\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\ntype UserRole = \"member\" | \"manager\" | \"admin\" | \"office_renter\" | \"visitor\";\n\ninterface NavItem {\n  titleKey: string;\n  url: string;\n  icon: typeof LayoutDashboard;\n  categoryKey: string;\n  allowedRoles: UserRole[];\n}\n\nconst navigationItems: NavItem[] = [\n  { titleKey: \"dashboard\", url: \"/\", icon: LayoutDashboard, categoryKey: \"overview\", allowedRoles: [\"member\", \"manager\", \"admin\"] },\n  { titleKey: \"employeeProfile\", url: \"/my-profile\", icon: Briefcase, categoryKey: \"overview\", allowedRoles: [\"member\", \"manager\", \"admin\"] },\n  { titleKey: \"tasks\", url: \"/tasks\", icon: CheckSquare, categoryKey: \"productivity\", allowedRoles: [\"member\", \"manager\", \"admin\"] },\n  { titleKey: \"tickets\", url: \"/tickets\", icon: Ticket, categoryKey: \"productivity\", allowedRoles: [\"member\", \"manager\", \"admin\"] },\n  { titleKey: \"n8nAutomation\", url: \"/n8n-settings\", icon: Zap, categoryKey: \"productivity\", allowedRoles: [\"manager\", \"admin\"] },\n  { titleKey: \"socialProfile\", url: \"/profile\", icon: User, categoryKey: \"communication\", allowedRoles: [\"member\", \"manager\", \"admin\"] },\n  { titleKey: \"socialFeed\", url: \"/feed\", icon: Rss, categoryKey: \"communication\", allowedRoles: [\"member\", \"manager\", \"admin\"] },\n  { titleKey: \"messages\", url: \"/messages\", icon: MessageSquare, categoryKey: \"communication\", allowedRoles: [\"member\", \"manager\", \"admin\"] },\n  { titleKey: \"internalMail\", url: \"/mail\", icon: Mail, categoryKey: \"communication\", allowedRoles: [\"member\", \"manager\", \"admin\", \"office_renter\"] },\n  { titleKey: \"meetings\", url: \"/meetings\", icon: Video, categoryKey: \"communication\", allowedRoles: [\"member\", \"manager\", \"admin\"] },\n  { titleKey: \"team\", url: \"/team\", icon: Users, categoryKey: \"organization\", allowedRoles: [\"member\", \"manager\", \"admin\"] },\n  { titleKey: \"departments\", url: \"/departments\", icon: Building2, categoryKey: \"organization\", allowedRoles: [\"member\", \"manager\", \"admin\"] },\n  { titleKey: \"officeManagement\", url: \"/office-management\", icon: Store, categoryKey: \"management\", allowedRoles: [\"manager\", \"admin\"] },\n  { titleKey: \"servicesShowcase\", url: \"/services-showcase\", icon: Package, categoryKey: \"management\", allowedRoles: [\"manager\", \"admin\"] },\n  { titleKey: \"jobPostings\", url: \"/jobs\", icon: Briefcase, categoryKey: \"management\", allowedRoles: [\"manager\", \"admin\"] },\n  { titleKey: \"finances\", url: \"/finances\", icon: DollarSign, categoryKey: \"admin\", allowedRoles: [\"admin\"] },\n  { titleKey: \"advertising\", url: \"/advertising\", icon: Megaphone, categoryKey: \"admin\", allowedRoles: [\"admin\"] },\n  { titleKey: \"accessControl\", url: \"/access\", icon: Shield, categoryKey: \"admin\", allowedRoles: [\"admin\"] },\n  { titleKey: \"myOffice\", url: \"/my-office\", icon: Store, categoryKey: \"businessServices\", allowedRoles: [\"office_renter\"] },\n  { titleKey: \"myServices\", url: \"/my-services\", icon: Package, categoryKey: \"businessServices\", allowedRoles: [\"office_renter\"] },\n  { titleKey: \"mySubscriptions\", url: \"/my-subscriptions\", icon: DollarSign, categoryKey: \"businessServices\", allowedRoles: [\"office_renter\"] },\n];\n\nfunction hasAccess(userRole: string | null | undefined, allowedRoles: UserRole[]): boolean {\n  const role = (userRole || \"member\") as UserRole;\n  return allowedRoles.includes(role);\n}\n\ninterface AppSidebarProps {\n  user?: {\n    id?: string;\n    firstName?: string | null;\n    lastName?: string | null;\n    email?: string | null;\n    profileImageUrl?: string | null;\n    role?: string | null;\n    department?: string | null;\n  };\n}\n\nexport function AppSidebar({ user }: AppSidebarProps) {\n  const displayName = user ? `${user.firstName || ''} ${user.lastName || ''}`.trim() || user.email || 'User' : 'User';\n  const displayRole = user?.role || 'member';\n  const avatar = user?.profileImageUrl;\n  const [location] = useLocation();\n  const { language } = useLanguage();\n  const t = translations[language];\n\n  // Fetch unread counts for notification badges\n  const { data: threads } = useQuery<{ id: number; unreadCount: number }[]>({\n    queryKey: ['/api/threads'],\n    refetchInterval: 30000, // Refresh every 30 seconds\n  });\n\n  const { data: emailUnreadData } = useQuery<{ count: number }>({\n    queryKey: ['/api/emails/unread-count'],\n    refetchInterval: 30000,\n  });\n\n  const { data: tasks } = useQuery<{ id: number; status: string }[]>({\n    queryKey: ['/api/tasks'],\n    refetchInterval: 30000,\n  });\n\n  const { data: tickets } = useQuery<{ id: number; status: string }[]>({\n    queryKey: ['/api/tickets'],\n    refetchInterval: 30000,\n  });\n\n  // Calculate unread counts\n  const messageUnreadCount = threads?.reduce((sum, thread) => sum + (thread.unreadCount || 0), 0) || 0;\n  const emailUnreadCount = emailUnreadData?.count || 0;\n  const pendingTaskCount = tasks?.filter(task => task.status === 'pending' || task.status === 'in_progress').length || 0;\n  const openTicketCount = tickets?.filter(ticket => ticket.status === 'open' || ticket.status === 'in_progress').length || 0;\n\n  // Map titleKeys to their notification counts\n  const notificationCounts: Record<string, number> = {\n    tasks: pendingTaskCount,\n    tickets: openTicketCount,\n    messages: messageUnreadCount,\n    internalMail: emailUnreadCount,\n  };\n\n  const filteredItems = navigationItems.filter(item => hasAccess(user?.role, item.allowedRoles));\n  \n  const groupedItems = filteredItems.reduce((acc, item) => {\n    if (!acc[item.categoryKey]) acc[item.categoryKey] = [];\n    acc[item.categoryKey].push(item);\n    return acc;\n  }, {} as Record<string, NavItem[]>);\n\n  const categoryIcons: Record<string, typeof Sparkles> = {\n    overview: LayoutDashboard,\n    productivity: Zap,\n    communication: MessageSquare,\n    organization: Users,\n    management: Store,\n    admin: Shield,\n    businessServices: Store,\n  };\n\n  const getCategoryLabel = (categoryKey: string) => {\n    const labels: Record<string, string> = {\n      overview: t.sidebar?.overview || \"Overview\",\n      productivity: t.sidebar?.productivity || \"Productivity\",\n      communication: t.sidebar?.communication || \"Communication\",\n      organization: t.sidebar?.organization || \"Organization\",\n      management: t.sidebar?.management || \"Management\",\n      admin: t.sidebar?.admin || \"Admin\",\n      businessServices: t.sidebar?.businessServices || \"Business Services\",\n    };\n    return labels[categoryKey] || categoryKey;\n  };\n\n  const getItemLabel = (titleKey: string) => {\n    const labels: Record<string, string> = {\n      dashboard: t.sidebar?.dashboard || \"Dashboard\",\n      employeeProfile: t.sidebar?.employeeProfile || \"Employee Profile\",\n      tasks: t.sidebar?.tasks || \"Tasks\",\n      tickets: t.sidebar?.tickets || \"Tickets\",\n      n8nAutomation: t.sidebar?.n8nAutomation || \"n8n Automation\",\n      socialProfile: t.sidebar?.socialProfile || \"Social Profile\",\n      socialFeed: t.sidebar?.socialFeed || \"Social Feed\",\n      messages: t.sidebar?.messages || \"Messages\",\n      internalMail: t.sidebar?.internalMail || \"Internal Mail\",\n      meetings: t.sidebar?.meetings || \"Meetings\",\n      team: t.sidebar?.team || \"Team\",\n      departments: t.sidebar?.departments || \"Departments\",\n      officeManagement: t.sidebar?.officeManagement || \"Office Management\",\n      servicesShowcase: t.sidebar?.servicesShowcase || \"Services Showcase\",\n      jobPostings: t.sidebar?.jobPostings || \"Job Postings\",\n      finances: t.sidebar?.finances || \"Finances\",\n      advertising: t.sidebar?.advertising || \"Advertising\",\n      accessControl: t.sidebar?.accessControl || \"Access Control\",\n      myOffice: t.sidebar?.myOffice || \"My Office\",\n      myServices: t.sidebar?.myServices || \"My Services\",\n      mySubscriptions: t.sidebar?.mySubscriptions || \"My Subscriptions\",\n    };\n    return labels[titleKey] || titleKey;\n  };\n\n  const isOfficeRenter = displayRole === \"office_renter\";\n\n  return (\n    <Sidebar className=\"border-r border-white/5\">\n      <SidebarHeader className=\"p-5 border-b border-white/5\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"relative\">\n              <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-500 to-teal-500 flex items-center justify-center\">\n                <Sparkles className=\"h-5 w-5 text-white\" />\n              </div>\n              <div className=\"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-emerald-500 rounded-full border-2 border-sidebar\" />\n            </div>\n            <div>\n              <h1 className=\"font-bold text-lg tracking-tight\">CloudOffice</h1>\n              <p className=\"text-xs text-muted-foreground\">\n                {isOfficeRenter ? t.sidebar?.businessServices || \"Business Services\" : t.sidebar?.virtualWorkspace || \"Virtual Workspace\"}\n              </p>\n            </div>\n          </div>\n          <LanguageSwitcher size=\"icon\" showLabel={false} />\n        </div>\n      </SidebarHeader>\n\n      <SidebarContent className=\"px-3 py-4\">\n        {Object.entries(groupedItems).map(([categoryKey, items]) => {\n          const CategoryIcon = categoryIcons[categoryKey] || Sparkles;\n          return (\n            <SidebarGroup key={categoryKey} className=\"mb-2\">\n              <SidebarGroupLabel className=\"flex items-center gap-2 text-xs font-medium text-muted-foreground/70 uppercase tracking-wider px-3 mb-1\">\n                <CategoryIcon className=\"h-3 w-3\" />\n                {getCategoryLabel(categoryKey)}\n              </SidebarGroupLabel>\n              <SidebarGroupContent>\n                <SidebarMenu>\n                  {items.map((item) => {\n                    const isActive = location === item.url;\n                    const itemLabel = getItemLabel(item.titleKey);\n                    const notifCount = notificationCounts[item.titleKey] || 0;\n                    return (\n                      <SidebarMenuItem key={item.titleKey}>\n                        <SidebarMenuButton\n                          asChild\n                          className={cn(\n                            \"group relative rounded-lg transition-all duration-200\",\n                            isActive \n                              ? \"bg-primary/10 text-primary\" \n                              : \"text-muted-foreground hover:text-foreground hover:bg-white/5\"\n                          )}\n                        >\n                          <Link \n                            href={item.url} \n                            data-testid={`link-nav-${item.titleKey.toLowerCase().replace(/\\s/g, \"-\")}`}\n                            className=\"flex items-center gap-3 px-3 py-2.5\"\n                          >\n                            {isActive && (\n                              <span className=\"absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 bg-primary rounded-r-full glow\" />\n                            )}\n                            <item.icon className={cn(\n                              \"h-4 w-4 transition-colors\",\n                              isActive ? \"text-primary\" : \"text-muted-foreground group-hover:text-foreground\"\n                            )} />\n                            <span className=\"font-medium text-sm\">{itemLabel}</span>\n                            {notifCount > 0 && (\n                              <Badge \n                                variant=\"destructive\" \n                                className=\"ml-auto h-5 min-w-5 px-1.5 text-xs font-semibold\"\n                                data-testid={`badge-${item.titleKey.toLowerCase()}-count`}\n                              >\n                                {notifCount > 99 ? '99+' : notifCount}\n                              </Badge>\n                            )}\n                            {isActive && notifCount === 0 && (\n                              <ChevronRight className=\"ml-auto h-4 w-4 text-primary/50\" />\n                            )}\n                          </Link>\n                        </SidebarMenuButton>\n                      </SidebarMenuItem>\n                    );\n                  })}\n                </SidebarMenu>\n              </SidebarGroupContent>\n            </SidebarGroup>\n          );\n        })}\n      </SidebarContent>\n\n      <SidebarFooter className=\"p-4 border-t border-white/5\">\n        <div className=\"glass rounded-xl p-3\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"relative\">\n              <UserAvatar name={displayName} avatar={avatar} size=\"md\" status=\"online\" />\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-sm font-semibold truncate\">{displayName}</p>\n              <p className=\"text-xs text-muted-foreground truncate capitalize flex items-center gap-1\">\n                <span className=\"w-1.5 h-1.5 rounded-full bg-primary\" />\n                {displayRole}\n              </p>\n            </div>\n            <Button \n              variant=\"ghost\" \n              size=\"icon\"\n              className=\"h-8 w-8 rounded-lg hover:bg-destructive/10 hover:text-destructive\"\n              data-testid=\"button-logout\"\n              onClick={() => window.location.href = '/api/logout'}\n            >\n              <LogOut className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","path":null,"size_bytes":14060,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/SocialPostCard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { UserAvatar } from \"./UserAvatar\";\nimport { Heart, MessageCircle, Share2, Send, ChevronDown, ChevronUp, Trash2, MoreVertical } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Post, User, PostComment } from \"@shared/schema\";\n\ninterface SocialPostCardProps {\n  post: Post;\n  author: User | null | undefined;\n  currentUserId?: string;\n}\n\nexport function SocialPostCard({ post, author, currentUserId }: SocialPostCardProps) {\n  const { toast } = useToast();\n  const [liked, setLiked] = useState(false);\n  const [showComments, setShowComments] = useState(false);\n  const [newComment, setNewComment] = useState(\"\");\n  const [likesCount, setLikesCount] = useState(0);\n\n  const { data: comments = [], isLoading: commentsLoading } = useQuery<PostComment[]>({\n    queryKey: [\"/api/posts\", post.id, \"comments\"],\n    enabled: showComments,\n  });\n\n  const { data: users = [] } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const likeMutation = useMutation({\n    mutationFn: async () => {\n      if (liked) {\n        return apiRequest(\"DELETE\", `/api/posts/${post.id}/like`);\n      } else {\n        return apiRequest(\"POST\", `/api/posts/${post.id}/like`);\n      }\n    },\n    onMutate: () => {\n      setLiked(!liked);\n      setLikesCount(prev => liked ? prev - 1 : prev + 1);\n    },\n    onError: () => {\n      setLiked(!liked);\n      setLikesCount(prev => liked ? prev + 1 : prev - 1);\n      toast({ title: \"Error\", description: \"Failed to update like.\", variant: \"destructive\" });\n    },\n  });\n\n  const commentMutation = useMutation({\n    mutationFn: async (content: string) => {\n      return apiRequest(\"POST\", `/api/posts/${post.id}/comments`, { content });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/posts\", post.id, \"comments\"] });\n      setNewComment(\"\");\n      toast({ title: \"Comment added\", description: \"Your comment was posted.\" });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to add comment.\", variant: \"destructive\" });\n    },\n  });\n\n  const deletePostMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"DELETE\", `/api/posts/${post.id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/posts\"] });\n      toast({ title: \"Deleted\", description: \"Post has been removed.\" });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to delete post.\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteCommentMutation = useMutation({\n    mutationFn: async (commentId: number) => {\n      return apiRequest(\"DELETE\", `/api/posts/${post.id}/comments/${commentId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/posts\", post.id, \"comments\"] });\n      toast({ title: \"Deleted\", description: \"Comment removed.\" });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to delete comment.\", variant: \"destructive\" });\n    },\n  });\n\n  const handleLike = () => {\n    likeMutation.mutate();\n  };\n\n  const handleComment = () => {\n    if (newComment.trim()) {\n      commentMutation.mutate(newComment);\n    }\n  };\n\n  const getUserById = (userId: string | null) => {\n    if (!userId) return null;\n    return users.find(u => u.id === userId);\n  };\n\n  const authorName = author \n    ? `${author.firstName || ''} ${author.lastName || ''}`.trim() || author.email || 'Unknown'\n    : 'Unknown';\n\n  const formatTimestamp = (date: Date | string | null) => {\n    if (!date) return \"\";\n    const d = new Date(date);\n    const now = new Date();\n    const diff = now.getTime() - d.getTime();\n    const minutes = Math.floor(diff / 60000);\n    const hours = Math.floor(diff / 3600000);\n    const days = Math.floor(diff / 86400000);\n    \n    if (minutes < 1) return \"Just now\";\n    if (minutes < 60) return `${minutes}m ago`;\n    if (hours < 24) return `${hours}h ago`;\n    if (days < 7) return `${days}d ago`;\n    return d.toLocaleDateString();\n  };\n\n  return (\n    <Card data-testid={`card-post-${post.id}`}>\n      <CardContent className=\"p-4\">\n        <div className=\"flex gap-3\">\n          <UserAvatar name={authorName} avatar={author?.profileImageUrl} size=\"md\" />\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center justify-between gap-2\">\n              <div className=\"flex items-center gap-2 flex-wrap\">\n                <span className=\"font-medium\" data-testid={`text-author-${post.id}`}>{authorName}</span>\n                {author?.department && (\n                  <span className=\"text-xs text-muted-foreground\">{author.department}</span>\n                )}\n                <span className=\"text-xs text-muted-foreground\">{formatTimestamp(post.createdAt)}</span>\n              </div>\n              {currentUserId === post.authorId && (\n                <DropdownMenu>\n                  <DropdownMenuTrigger asChild>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" data-testid={`button-post-menu-${post.id}`}>\n                      <MoreVertical className=\"h-4 w-4\" />\n                    </Button>\n                  </DropdownMenuTrigger>\n                  <DropdownMenuContent align=\"end\">\n                    <DropdownMenuItem\n                      className=\"text-destructive\"\n                      onClick={() => deletePostMutation.mutate()}\n                      disabled={deletePostMutation.isPending}\n                      data-testid={`button-delete-post-${post.id}`}\n                    >\n                      <Trash2 className=\"h-4 w-4 mr-2\" />\n                      Delete Post\n                    </DropdownMenuItem>\n                  </DropdownMenuContent>\n                </DropdownMenu>\n              )}\n            </div>\n            \n            {post.content && (\n              <p className=\"mt-2 text-sm leading-relaxed\" data-testid={`text-content-${post.id}`}>{post.content}</p>\n            )}\n            \n            {post.mediaUrl && (\n              <div className=\"mt-3 rounded-lg overflow-hidden bg-muted\">\n                {post.mediaType === \"video\" ? (\n                  <video \n                    src={post.mediaUrl} \n                    controls \n                    className=\"max-h-96 w-full object-contain\"\n                    data-testid={`video-media-${post.id}`}\n                  />\n                ) : (\n                  <img \n                    src={post.mediaUrl} \n                    alt=\"Post media\" \n                    className=\"max-h-96 w-full object-contain\"\n                    data-testid={`img-media-${post.id}`}\n                  />\n                )}\n              </div>\n            )}\n            \n            <div className=\"flex items-center gap-1 mt-3\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className={cn(\"gap-1\", liked && \"text-red-500\")}\n                onClick={handleLike}\n                disabled={likeMutation.isPending}\n                data-testid={`button-like-${post.id}`}\n              >\n                <Heart className={cn(\"h-4 w-4\", liked && \"fill-current\")} />\n                <span className=\"text-xs\">{likesCount}</span>\n              </Button>\n              <Button \n                variant=\"ghost\" \n                size=\"sm\" \n                className=\"gap-1\" \n                onClick={() => setShowComments(!showComments)}\n                data-testid={`button-toggle-comments-${post.id}`}\n              >\n                <MessageCircle className=\"h-4 w-4\" />\n                <span className=\"text-xs\">{comments.length || 0}</span>\n                {showComments ? <ChevronUp className=\"h-3 w-3\" /> : <ChevronDown className=\"h-3 w-3\" />}\n              </Button>\n              <Button variant=\"ghost\" size=\"sm\" data-testid={`button-share-${post.id}`}>\n                <Share2 className=\"h-4 w-4\" />\n              </Button>\n            </div>\n            \n            {showComments && (\n              <div className=\"mt-4 space-y-3 border-t pt-3\">\n                {currentUserId && (\n                  <div className=\"flex gap-2\">\n                    <Input\n                      placeholder=\"Write a comment...\"\n                      value={newComment}\n                      onChange={(e) => setNewComment(e.target.value)}\n                      onKeyDown={(e) => {\n                        if (e.key === \"Enter\" && !e.shiftKey) {\n                          e.preventDefault();\n                          handleComment();\n                        }\n                      }}\n                      className=\"flex-1\"\n                      data-testid={`input-comment-${post.id}`}\n                    />\n                    <Button \n                      size=\"icon\" \n                      onClick={handleComment}\n                      disabled={!newComment.trim() || commentMutation.isPending}\n                      data-testid={`button-submit-comment-${post.id}`}\n                    >\n                      <Send className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                )}\n                \n                {commentsLoading ? (\n                  <div className=\"text-sm text-muted-foreground\">Loading comments...</div>\n                ) : comments.length > 0 ? (\n                  <div className=\"space-y-3\">\n                    {comments.map((comment) => {\n                      const commentAuthor = getUserById(comment.authorId);\n                      const commentAuthorName = commentAuthor \n                        ? `${commentAuthor.firstName || ''} ${commentAuthor.lastName || ''}`.trim() || commentAuthor.email || 'Unknown'\n                        : 'Unknown';\n                      return (\n                        <div key={comment.id} className=\"flex gap-2 group\" data-testid={`comment-${comment.id}`}>\n                          <UserAvatar \n                            name={commentAuthorName} \n                            avatar={commentAuthor?.profileImageUrl} \n                            size=\"sm\" \n                          />\n                          <div className=\"flex-1 bg-muted rounded-lg p-2\">\n                            <div className=\"flex items-center justify-between gap-2\">\n                              <div className=\"flex items-center gap-2\">\n                                <span className=\"text-sm font-medium\">{commentAuthorName}</span>\n                                <span className=\"text-xs text-muted-foreground\">\n                                  {formatTimestamp(comment.createdAt)}\n                                </span>\n                              </div>\n                              {currentUserId === comment.authorId && (\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"icon\"\n                                  className=\"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity\"\n                                  onClick={() => deleteCommentMutation.mutate(comment.id)}\n                                  disabled={deleteCommentMutation.isPending}\n                                  data-testid={`button-delete-comment-${comment.id}`}\n                                >\n                                  <Trash2 className=\"h-3 w-3 text-destructive\" />\n                                </Button>\n                              )}\n                            </div>\n                            <p className=\"text-sm mt-1\">{comment.content}</p>\n                          </div>\n                        </div>\n                      );\n                    })}\n                  </div>\n                ) : (\n                  <div className=\"text-sm text-muted-foreground text-center py-2\">\n                    No comments yet. Be the first to comment!\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":12395,"size_tokens":null},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}\n","path":null,"size_bytes":116,"size_tokens":null},"client/src/components/ChatInput.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Paperclip, Smile, Send } from \"lucide-react\";\n\ninterface ChatInputProps {\n  onSend?: (message: string) => void;\n  placeholder?: string;\n}\n\nexport function ChatInput({ onSend, placeholder = \"Type a message...\" }: ChatInputProps) {\n  const [message, setMessage] = useState(\"\");\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (message.trim()) {\n      onSend?.(message);\n      setMessage(\"\");\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"flex items-center gap-2 p-4 border-t bg-background\">\n      <Button type=\"button\" variant=\"ghost\" size=\"icon\" data-testid=\"button-attach\">\n        <Paperclip className=\"h-5 w-5\" />\n      </Button>\n      <Input\n        value={message}\n        onChange={(e) => setMessage(e.target.value)}\n        placeholder={placeholder}\n        className=\"flex-1\"\n        data-testid=\"input-chat-message\"\n      />\n      <Button type=\"button\" variant=\"ghost\" size=\"icon\" data-testid=\"button-emoji\">\n        <Smile className=\"h-5 w-5\" />\n      </Button>\n      <Button type=\"submit\" size=\"icon\" disabled={!message.trim()} data-testid=\"button-send\">\n        <Send className=\"h-5 w-5\" />\n      </Button>\n    </form>\n  );\n}\n","path":null,"size_bytes":1331,"size_tokens":null},"client/src/pages/Team.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { UserAvatar } from \"@/components/UserAvatar\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { \n  Search, \n  Mail, \n  MessageSquare, \n  Users, \n  Briefcase, \n  Activity,\n  ChevronDown,\n  ChevronUp,\n} from \"lucide-react\";\nimport type { User, Task } from \"@shared/schema\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\nfunction getEffectiveStatus(user: User): \"online\" | \"away\" | \"offline\" | \"busy\" {\n  const INACTIVE_THRESHOLD = 5 * 60 * 1000; // 5 minutes\n  \n  if (user.status === \"online\" && user.lastSeenAt) {\n    const lastSeen = new Date(user.lastSeenAt).getTime();\n    const now = Date.now();\n    if (now - lastSeen > INACTIVE_THRESHOLD) {\n      return \"offline\";\n    }\n  }\n  \n  return (user.status as \"online\" | \"away\" | \"offline\" | \"busy\") || \"offline\";\n}\n\nexport default function Team() {\n  const { language } = useLanguage();\n  const t = translations[language];\n  const [search, setSearch] = useState(\"\");\n  const [selectedMember, setSelectedMember] = useState<string | null>(null);\n\n  const { data: users = [], isLoading } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const { data: tasks = [] } = useQuery<Task[]>({\n    queryKey: [\"/api/tasks\"],\n  });\n\n  const filteredMembers = users.filter(\n    (user) =>\n      (`${user.firstName || ''} ${user.lastName || ''}`.toLowerCase().includes(search.toLowerCase())) ||\n      (user.department?.toLowerCase().includes(search.toLowerCase()) || false)\n  );\n\n  const departments = Array.from(new Set(users.map((u) => u.department).filter(Boolean)));\n\n  const getUserStats = (userId: string) => {\n    const userTasks = tasks.filter(t => t.assigneeId === userId);\n    const completed = userTasks.filter(t => t.status === \"completed\").length;\n    return { tasksCompleted: completed, total: userTasks.length };\n  };\n\n  const teamStats = {\n    total: users.length,\n    departments: departments.length,\n    online: users.filter(u => getEffectiveStatus(u) === \"online\").length,\n  };\n\n  return (\n    <div className=\"p-6 md:p-8 space-y-6 max-w-7xl mx-auto\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"p-2.5 rounded-xl bg-gradient-to-br from-emerald-500 to-green-500\">\n            <Users className=\"h-5 w-5 text-white\" />\n          </div>\n          <div>\n            <h1 className=\"text-2xl font-bold tracking-tight\" data-testid=\"text-team-title\">{t.team?.title || \"Team\"}</h1>\n            <p className=\"text-muted-foreground text-sm\">{t.team?.subtitle || \"View team members and performance metrics\"}</p>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-3 gap-4\">\n        {[\n          { label: t.team?.totalMembers || \"Total Members\", value: teamStats.total, icon: Users, color: \"from-emerald-500 to-green-500\" },\n          { label: t.team?.departments || \"Departments\", value: teamStats.departments, icon: Briefcase, color: \"from-violet-500 to-purple-500\" },\n          { label: t.team?.onlineNow || \"Online Now\", value: teamStats.online, icon: Activity, color: \"from-cyan-500 to-teal-500\" },\n        ].map((stat) => (\n          <div key={stat.label} className=\"glass rounded-xl p-4 border border-white/5\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <stat.icon className=\"h-4 w-4 text-muted-foreground\" />\n              <span className=\"text-xs text-muted-foreground\">{stat.label}</span>\n            </div>\n            <p className={`text-2xl font-bold bg-gradient-to-r ${stat.color} bg-clip-text text-transparent`}>\n              {stat.value}\n            </p>\n          </div>\n        ))}\n      </div>\n\n      <div className=\"flex items-center gap-4\">\n        <div className=\"relative flex-1 max-w-md\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder={t.team?.searchPlaceholder || \"Search by name or department...\"}\n            className=\"pl-10 bg-white/5 border-white/10 focus:border-emerald-500/50\"\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n            data-testid=\"input-search-team\"\n          />\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n        {isLoading ? (\n          Array(6).fill(0).map((_, i) => (\n            <Skeleton key={i} className=\"h-40 w-full bg-white/5\" />\n          ))\n        ) : filteredMembers.length > 0 ? (\n          filteredMembers.map((member) => {\n            const displayName = `${member.firstName || ''} ${member.lastName || ''}`.trim() || member.email || 'Unknown';\n            const stats = getUserStats(member.id);\n            const isExpanded = selectedMember === member.id;\n            const effectiveStatus = getEffectiveStatus(member);\n            \n            return (\n              <Card\n                key={member.id}\n                className=\"glass border-white/5 hover-glow cursor-pointer transition-all duration-300\"\n                onClick={() => setSelectedMember(isExpanded ? null : member.id)}\n                data-testid={`card-member-${member.id}`}\n              >\n                <CardContent className=\"p-5\">\n                  <div className=\"flex items-start gap-4\">\n                    <UserAvatar\n                      name={displayName}\n                      avatar={member.profileImageUrl}\n                      size=\"lg\"\n                      status={effectiveStatus}\n                    />\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"font-semibold\">{displayName}</p>\n                      <p className=\"text-sm text-muted-foreground capitalize\">{member.role || (t.team?.member || \"member\")}</p>\n                      <div className=\"flex items-center gap-2 mt-2.5 flex-wrap\">\n                        {member.department && (\n                          <Badge variant=\"outline\" className=\"text-xs bg-white/5 border-white/10\">\n                            {member.department}\n                          </Badge>\n                        )}\n                        <Badge \n                          variant=\"outline\" \n                          className={`text-xs capitalize ${\n                            effectiveStatus === 'online' \n                              ? 'bg-emerald-500/10 text-emerald-400 border-emerald-500/30' \n                              : effectiveStatus === 'away'\n                              ? 'bg-amber-500/10 text-amber-400 border-amber-500/30'\n                              : 'bg-slate-500/10 text-slate-400 border-slate-500/30'\n                          }`}\n                        >\n                          <span className={`w-1.5 h-1.5 rounded-full mr-1.5 ${\n                            effectiveStatus === 'online' ? 'bg-emerald-400' \n                            : effectiveStatus === 'away' ? 'bg-amber-400' \n                            : 'bg-slate-400'\n                          }`} />\n                          {effectiveStatus === 'online' ? (t.team?.online || \"online\") : effectiveStatus === 'away' ? (t.team?.away || \"away\") : (t.team?.offline || \"offline\")}\n                        </Badge>\n                      </div>\n                    </div>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n                      {isExpanded ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\n                    </Button>\n                  </div>\n\n                  {isExpanded && (\n                    <div className=\"mt-4 pt-4 border-t border-white/5 space-y-3\">\n                      <div className=\"grid grid-cols-2 gap-3\">\n                        <div className=\"p-3 rounded-lg bg-white/5\">\n                          <p className=\"text-xs text-muted-foreground\">{t.team?.completed || \"Completed\"}</p>\n                          <p className=\"text-lg font-semibold text-emerald-400\">{stats.tasksCompleted}</p>\n                        </div>\n                        <div className=\"p-3 rounded-lg bg-white/5\">\n                          <p className=\"text-xs text-muted-foreground\">{t.team?.totalTasks || \"Total Tasks\"}</p>\n                          <p className=\"text-lg font-semibold\">{stats.total}</p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2 pt-2\">\n                        <Button size=\"sm\" variant=\"outline\" className=\"flex-1 gap-1.5\" data-testid={`button-email-${member.id}`}>\n                          <Mail className=\"h-4 w-4\" />\n                          {t.team?.email || \"Email\"}\n                        </Button>\n                        <Button size=\"sm\" variant=\"outline\" className=\"flex-1 gap-1.5\" data-testid={`button-message-${member.id}`}>\n                          <MessageSquare className=\"h-4 w-4\" />\n                          {t.team?.message || \"Message\"}\n                        </Button>\n                      </div>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            );\n          })\n        ) : (\n          <Card className=\"col-span-full glass border-white/5\">\n            <CardContent className=\"py-12 text-center text-muted-foreground\">\n              <Users className=\"h-12 w-12 mx-auto mb-3 opacity-30\" />\n              <p className=\"text-sm mb-1\">{search ? (t.team?.noSearchResults || \"No team members match your search\") : (t.team?.noMembers || \"No team members yet\")}</p>\n              <p className=\"text-xs\">{t.team?.inviteFirst || \"Invite your team to get started\"}</p>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":9971,"size_tokens":null},"client/src/components/TicketCard.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { UserAvatar } from \"./UserAvatar\";\nimport { cn } from \"@/lib/utils\";\n\ninterface TicketCardProps {\n  id: string;\n  title: string;\n  reporter: { name: string; avatar?: string | null };\n  assignee?: { name: string; avatar?: string | null } | null;\n  priority: \"high\" | \"medium\" | \"low\";\n  status: \"open\" | \"in_progress\" | \"resolved\" | \"closed\";\n  onClick?: () => void;\n}\n\nconst priorityStyles = {\n  high: \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\",\n  medium: \"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400\",\n  low: \"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\",\n};\n\nconst statusStyles = {\n  open: \"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400\",\n  in_progress: \"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400\",\n  resolved: \"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\",\n  closed: \"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400\",\n};\n\nexport function TicketCard({ id, title, reporter, assignee, priority, status, onClick }: TicketCardProps) {\n  return (\n    <Card\n      className=\"hover-elevate cursor-pointer\"\n      onClick={onClick}\n      data-testid={`card-ticket-${id}`}\n    >\n      <CardContent className=\"p-4\">\n        <div className=\"flex items-start justify-between gap-4\">\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <span className=\"text-xs font-mono text-muted-foreground\">{id}</span>\n              <Badge variant=\"secondary\" className={cn(\"text-xs\", statusStyles[status])}>\n                {status.replace(\"_\", \" \")}\n              </Badge>\n            </div>\n            <p className=\"font-medium truncate\">{title}</p>\n            <div className=\"flex items-center gap-2 mt-2 flex-wrap\">\n              <Badge variant=\"secondary\" className={cn(\"text-xs\", priorityStyles[priority])}>\n                {priority}\n              </Badge>\n              <span className=\"text-xs text-muted-foreground\">by {reporter.name}</span>\n            </div>\n          </div>\n          {assignee ? (\n            <UserAvatar name={assignee.name} avatar={assignee.avatar} size=\"sm\" />\n          ) : (\n            <span className=\"text-xs text-muted-foreground italic\">Unassigned</span>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2482,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/JobPostingCard.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { MapPin, Briefcase, DollarSign, Pencil } from \"lucide-react\";\n\ninterface JobPostingCardProps {\n  id: string;\n  title: string;\n  department: string;\n  location: string;\n  type: string;\n  salary: string;\n  postedDays: number;\n  isPublished: boolean;\n  isEditable?: boolean;\n  onTogglePublish?: (id: string, published: boolean) => void;\n  onEdit?: (id: string) => void;\n}\n\nexport function JobPostingCard({\n  id,\n  title,\n  department,\n  location,\n  type,\n  salary,\n  postedDays,\n  isPublished,\n  isEditable = false,\n  onTogglePublish,\n  onEdit,\n}: JobPostingCardProps) {\n  return (\n    <Card data-testid={`card-job-${id}`}>\n      <CardContent className=\"p-4\">\n        <div className=\"flex items-start justify-between gap-4\">\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 flex-wrap\">\n              <h3 className=\"font-semibold\">{title}</h3>\n              <Badge variant=\"secondary\">{department}</Badge>\n            </div>\n            <div className=\"flex items-center gap-4 mt-2 text-sm text-muted-foreground flex-wrap\">\n              <span className=\"flex items-center gap-1\">\n                <MapPin className=\"h-3.5 w-3.5\" />\n                {location}\n              </span>\n              <span className=\"flex items-center gap-1\">\n                <Briefcase className=\"h-3.5 w-3.5\" />\n                {type}\n              </span>\n              <span className=\"flex items-center gap-1\">\n                <DollarSign className=\"h-3.5 w-3.5\" />\n                {salary}\n              </span>\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-2\">\n              Posted {postedDays} {postedDays === 1 ? \"day\" : \"days\"} ago\n            </p>\n          </div>\n          {isEditable && (\n            <div className=\"flex items-center gap-3\">\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-xs text-muted-foreground\">\n                  {isPublished ? \"Published\" : \"Draft\"}\n                </span>\n                <Switch\n                  checked={isPublished}\n                  onCheckedChange={(checked) => onTogglePublish?.(id, checked)}\n                  data-testid={`switch-publish-${id}`}\n                />\n              </div>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => onEdit?.(id)}\n                data-testid={`button-edit-job-${id}`}\n              >\n                <Pencil className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2815,"size_tokens":null},"client/src/components/examples/SocialPost.tsx":{"content":"import { SocialPost } from \"../SocialPost\";\n\nexport default function SocialPostExample() {\n  return (\n    <div className=\"space-y-4 max-w-xl\">\n      <SocialPost\n        id=\"1\"\n        author={{ name: \"James Wilson\", department: \"Product\" }}\n        content=\"Excited to announce our new product launch next week! The team has been working incredibly hard on this release.\"\n        likes={24}\n        comments={8}\n        timestamp=\"2 hours ago\"\n      />\n      <SocialPost\n        id=\"2\"\n        author={{ name: \"Sarah Chen\", department: \"Engineering\" }}\n        content=\"Great sprint retrospective today. Keep up the amazing work everyone!\"\n        likes={15}\n        comments={3}\n        timestamp=\"5 hours ago\"\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":739,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/pages/Tickets.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { \n  Plus, \n  Search, \n  Ticket as TicketIcon, \n  Filter,\n  AlertCircle,\n  CheckCircle2,\n  Clock,\n  Loader2,\n  MessageSquare,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Ticket, User } from \"@shared/schema\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\nconst statusColors: Record<string, string> = {\n  open: \"bg-cyan-500/10 text-cyan-400 border-cyan-500/30\",\n  in_progress: \"bg-amber-500/10 text-amber-400 border-amber-500/30\",\n  resolved: \"bg-emerald-500/10 text-emerald-400 border-emerald-500/30\",\n  closed: \"bg-slate-500/10 text-slate-400 border-slate-500/30\",\n};\n\nconst priorityColors: Record<string, string> = {\n  high: \"bg-red-500/10 text-red-400 border-red-500/30\",\n  medium: \"bg-amber-500/10 text-amber-400 border-amber-500/30\",\n  low: \"bg-emerald-500/10 text-emerald-400 border-emerald-500/30\",\n};\n\nconst statusIcons: Record<string, typeof AlertCircle> = {\n  open: AlertCircle,\n  in_progress: Clock,\n  resolved: CheckCircle2,\n  closed: CheckCircle2,\n};\n\nexport default function Tickets() {\n  const { language } = useLanguage();\n  const t = translations[language];\n  const { toast } = useToast();\n  const [filter, setFilter] = useState(\"all\");\n  const [search, setSearch] = useState(\"\");\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [newTicket, setNewTicket] = useState({ title: \"\", description: \"\", priority: \"medium\" });\n\n  const { data: tickets = [], isLoading } = useQuery<Ticket[]>({\n    queryKey: [\"/api/tickets\"],\n  });\n\n  const { data: users = [] } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const createTicketMutation = useMutation({\n    mutationFn: async (data: { title: string; description: string; priority: string }) => {\n      return await apiRequest(\"POST\", \"/api/tickets\", {\n        title: data.title,\n        description: data.description,\n        priority: data.priority,\n        status: \"open\",\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tickets\"] });\n      setNewTicket({ title: \"\", description: \"\", priority: \"medium\" });\n      setDialogOpen(false);\n      toast({ title: t.tickets?.ticketCreated || \"Ticket created\", description: t.tickets?.ticketCreatedDesc || \"Your support ticket has been submitted.\" });\n    },\n    onError: () => {\n      toast({ title: t.tickets?.error || \"Error\", description: t.tickets?.failedCreate || \"Failed to create ticket.\", variant: \"destructive\" });\n    },\n  });\n\n  const handleCreateTicket = () => {\n    if (newTicket.title) {\n      createTicketMutation.mutate(newTicket);\n    }\n  };\n\n  const getUserById = (userId: string | null) => {\n    if (!userId) return null;\n    return users.find(u => u.id === userId);\n  };\n\n  const filteredTickets = tickets.filter((ticket) => {\n    const matchesFilter = filter === \"all\" || ticket.status === filter;\n    const matchesSearch = ticket.title.toLowerCase().includes(search.toLowerCase());\n    return matchesFilter && matchesSearch;\n  });\n\n  const ticketStats = {\n    total: tickets.length,\n    open: tickets.filter(t => t.status === \"open\").length,\n    inProgress: tickets.filter(t => t.status === \"in_progress\").length,\n    resolved: tickets.filter(t => t.status === \"resolved\" || t.status === \"closed\").length,\n  };\n\n  return (\n    <div className=\"p-6 md:p-8 space-y-6 max-w-7xl mx-auto\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"p-2.5 rounded-xl bg-gradient-to-br from-violet-500 to-purple-500\">\n            <TicketIcon className=\"h-5 w-5 text-white\" />\n          </div>\n          <div>\n            <h1 className=\"text-2xl font-bold tracking-tight\" data-testid=\"text-tickets-title\">{t.tickets?.title || \"Support Tickets\"}</h1>\n            <p className=\"text-muted-foreground text-sm\">{t.tickets?.subtitle || \"Track and manage support requests\"}</p>\n          </div>\n        </div>\n        <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n          <DialogTrigger asChild>\n            <Button className=\"gap-2\" data-testid=\"button-new-ticket\">\n              <Plus className=\"h-4 w-4\" />\n              {t.tickets?.newTicket || \"New Ticket\"}\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"glass border-white/10\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <MessageSquare className=\"h-5 w-5 text-violet-400\" />\n                {t.tickets?.createTicket || \"Create Support Ticket\"}\n              </DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4 pt-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"title\">{t.tickets?.ticketTitle || \"Title\"}</Label>\n                <Input\n                  id=\"title\"\n                  placeholder={t.tickets?.titlePlaceholder || \"Brief description of the issue\"}\n                  value={newTicket.title}\n                  onChange={(e) => setNewTicket({ ...newTicket, title: e.target.value })}\n                  className=\"bg-white/5 border-white/10 focus:border-violet-500/50\"\n                  data-testid=\"input-ticket-title\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"description\">{t.tickets?.description || \"Description\"}</Label>\n                <Textarea\n                  id=\"description\"\n                  placeholder={t.tickets?.descriptionPlaceholder || \"Provide more details about your issue...\"}\n                  value={newTicket.description}\n                  onChange={(e) => setNewTicket({ ...newTicket, description: e.target.value })}\n                  className=\"bg-white/5 border-white/10 focus:border-violet-500/50 min-h-[120px]\"\n                  data-testid=\"input-ticket-description\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"priority\">{t.tickets?.priority || \"Priority\"}</Label>\n                <Select\n                  value={newTicket.priority}\n                  onValueChange={(value) => setNewTicket({ ...newTicket, priority: value })}\n                >\n                  <SelectTrigger className=\"bg-white/5 border-white/10\" data-testid=\"select-ticket-priority\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"high\">{t.tickets?.highPriority || \"High Priority\"}</SelectItem>\n                    <SelectItem value=\"medium\">{t.tickets?.mediumPriority || \"Medium Priority\"}</SelectItem>\n                    <SelectItem value=\"low\">{t.tickets?.lowPriority || \"Low Priority\"}</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <Button \n                className=\"w-full\" \n                onClick={handleCreateTicket}\n                disabled={createTicketMutation.isPending}\n                data-testid=\"button-create-ticket\"\n              >\n                {createTicketMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                    {t.tickets?.submitting || \"Submitting...\"}\n                  </>\n                ) : (t.tickets?.submitTicket || \"Submit Ticket\")}\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        {[\n          { label: t.tickets?.total || \"Total\", value: ticketStats.total, color: \"from-slate-500 to-slate-600\" },\n          { label: t.tickets?.open || \"Open\", value: ticketStats.open, color: \"from-cyan-500 to-blue-500\" },\n          { label: t.tickets?.inProgress || \"In Progress\", value: ticketStats.inProgress, color: \"from-amber-500 to-orange-500\" },\n          { label: t.tickets?.resolved || \"Resolved\", value: ticketStats.resolved, color: \"from-emerald-500 to-green-500\" },\n        ].map((stat) => (\n          <div key={stat.label} className=\"glass rounded-xl p-4 border border-white/5\">\n            <p className=\"text-xs text-muted-foreground\">{stat.label}</p>\n            <p className={`text-2xl font-bold bg-gradient-to-r ${stat.color} bg-clip-text text-transparent`}>\n              {stat.value}\n            </p>\n          </div>\n        ))}\n      </div>\n\n      <div className=\"flex flex-col sm:flex-row gap-4\">\n        <div className=\"relative flex-1 max-w-md\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder={t.tickets?.searchTickets || \"Search tickets...\"}\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n            className=\"pl-10 bg-white/5 border-white/10 focus:border-violet-500/50\"\n            data-testid=\"input-search-tickets\"\n          />\n        </div>\n        <Select value={filter} onValueChange={setFilter}>\n          <SelectTrigger className=\"w-[180px] bg-white/5 border-white/10\" data-testid=\"select-ticket-filter\">\n            <Filter className=\"h-4 w-4 mr-2\" />\n            <SelectValue placeholder={t.tickets?.filter || \"Filter\"} />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\">{t.tickets?.allTickets || \"All Tickets\"}</SelectItem>\n            <SelectItem value=\"open\">{t.tickets?.open || \"Open\"}</SelectItem>\n            <SelectItem value=\"in_progress\">{t.tickets?.inProgress || \"In Progress\"}</SelectItem>\n            <SelectItem value=\"resolved\">{t.tickets?.resolved || \"Resolved\"}</SelectItem>\n            <SelectItem value=\"closed\">{t.tickets?.closed || \"Closed\"}</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div className=\"space-y-3\">\n        {isLoading ? (\n          Array(5).fill(0).map((_, i) => (\n            <Skeleton key={i} className=\"h-24 w-full bg-white/5\" />\n          ))\n        ) : filteredTickets.length > 0 ? (\n          filteredTickets.map((ticket) => {\n            const reporter = getUserById(ticket.reporterId);\n            const assignee = getUserById(ticket.assigneeId);\n            const StatusIcon = statusIcons[ticket.status as string] || AlertCircle;\n            \n            return (\n              <Card \n                key={ticket.id} \n                className=\"glass border-white/5 hover-glow cursor-pointer transition-all duration-300\"\n                data-testid={`card-ticket-${ticket.id}`}\n              >\n                <CardContent className=\"p-5\">\n                  <div className=\"flex items-start justify-between gap-4\">\n                    <div className=\"flex items-start gap-4 flex-1 min-w-0\">\n                      <div className={`p-2.5 rounded-xl ${statusColors[ticket.status as string]?.split(' ')[0] || 'bg-slate-500/10'}`}>\n                        <StatusIcon className={`h-5 w-5 ${statusColors[ticket.status as string]?.split(' ')[1] || 'text-slate-400'}`} />\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2 flex-wrap mb-1\">\n                          <span className=\"text-xs font-mono text-muted-foreground bg-white/5 px-2 py-0.5 rounded\">\n                            T-{String(ticket.id).padStart(3, \"0\")}\n                          </span>\n                          <h3 className=\"font-semibold truncate\">{ticket.title}</h3>\n                        </div>\n                        <p className=\"text-sm text-muted-foreground\">\n                          {t.tickets?.reportedBy || \"Reported by\"} {reporter ? `${reporter.firstName || ''} ${reporter.lastName || ''}`.trim() || reporter.email : (t.tickets?.unknown || 'Unknown')}\n                          {assignee && (\n                            <span className=\"text-cyan-400\">\n                              {' '}  {t.tickets?.assignedTo || \"Assigned to\"} {`${assignee.firstName || ''} ${assignee.lastName || ''}`.trim() || assignee.email}\n                            </span>\n                          )}\n                        </p>\n                        {ticket.description && (\n                          <p className=\"text-sm text-muted-foreground mt-2 line-clamp-2\">\n                            {ticket.description}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-2 flex-shrink-0\">\n                      <Badge variant=\"outline\" className={priorityColors[ticket.priority as string] || priorityColors.medium}>\n                        {ticket.priority}\n                      </Badge>\n                      <Badge variant=\"outline\" className={statusColors[ticket.status as string] || statusColors.open}>\n                        {ticket.status?.replace(\"_\", \" \")}\n                      </Badge>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })\n        ) : (\n          <Card className=\"glass border-white/5\">\n            <CardContent className=\"py-12 text-center text-muted-foreground\">\n              <TicketIcon className=\"h-12 w-12 mx-auto mb-3 opacity-30\" />\n              <p className=\"text-sm mb-1\">{search ? (t.tickets?.noTicketsMatch || \"No tickets match your search\") : (t.tickets?.noTicketsYet || \"No tickets yet\")}</p>\n              <p className=\"text-xs\">{t.tickets?.createFirstTicket || \"Create your first support ticket to get started\"}</p>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":14346,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/pages/Jobs.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { JobPostingCard } from \"@/components/JobPostingCard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Plus, Search, UserPlus, Upload, Mail, Phone, Briefcase } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\nimport type { JobPosting } from \"@shared/schema\";\n\nexport default function Jobs() {\n  const { toast } = useToast();\n  const { language } = useLanguage();\n  const t = translations[language];\n  const isRTL = language === 'ar';\n  \n  const [filter, setFilter] = useState(\"all\");\n  const [search, setSearch] = useState(\"\");\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [registerDialogOpen, setRegisterDialogOpen] = useState(false);\n  const [newJob, setNewJob] = useState({\n    title: \"\",\n    department: \"\",\n    location: \"Remote\",\n    type: \"full-time\",\n    salary: \"\",\n    description: \"\",\n    requirements: \"\",\n  });\n  const [applicant, setApplicant] = useState({\n    fullName: \"\",\n    email: \"\",\n    phone: \"\",\n    position: \"\",\n    experience: \"\",\n    resume: \"\",\n    coverLetter: \"\",\n  });\n\n  const { data: jobs = [], isLoading } = useQuery<JobPosting[]>({\n    queryKey: [\"/api/jobs\"],\n  });\n\n  const createJobMutation = useMutation({\n    mutationFn: async (data: typeof newJob) => {\n      return await apiRequest(\"POST\", \"/api/jobs\", {\n        title: data.title,\n        department: data.department,\n        location: data.location,\n        type: data.type,\n        salary: data.salary,\n        description: data.description,\n        requirements: data.requirements,\n        status: \"draft\",\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/jobs\"] });\n      setNewJob({ title: \"\", department: \"\", location: \"Remote\", type: \"full-time\", salary: \"\", description: \"\", requirements: \"\" });\n      setDialogOpen(false);\n      toast({ title: t.jobs.jobCreated, description: t.jobs.jobCreatedDesc });\n    },\n    onError: () => {\n      toast({ title: t.jobs.error, description: t.jobs.failedCreate, variant: \"destructive\" });\n    },\n  });\n\n  const updateJobMutation = useMutation({\n    mutationFn: async ({ id, status }: { id: number; status: string }) => {\n      return await apiRequest(\"PATCH\", `/api/jobs/${id}`, { status });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/jobs\"] });\n    },\n  });\n\n  const handleCreateJob = () => {\n    if (newJob.title && newJob.department) {\n      createJobMutation.mutate(newJob);\n    }\n  };\n\n  const handleTogglePublish = (id: string, published: boolean) => {\n    updateJobMutation.mutate({ id: parseInt(id), status: published ? \"published\" : \"draft\" });\n  };\n\n  const handleRegisterApplicant = () => {\n    if (applicant.fullName && applicant.email && applicant.position) {\n      toast({ \n        title: t.jobs.applicationSubmitted, \n        description: t.jobs.applicationSubmittedDesc \n      });\n      setApplicant({\n        fullName: \"\",\n        email: \"\",\n        phone: \"\",\n        position: \"\",\n        experience: \"\",\n        resume: \"\",\n        coverLetter: \"\",\n      });\n      setRegisterDialogOpen(false);\n    } else {\n      toast({ \n        title: t.jobs.missingInfo, \n        description: t.jobs.fillRequired, \n        variant: \"destructive\" \n      });\n    }\n  };\n\n  const filteredJobs = jobs.filter((job) => {\n    const matchesFilter =\n      filter === \"all\" ||\n      (filter === \"published\" && job.status === \"published\") ||\n      (filter === \"draft\" && job.status === \"draft\");\n    const matchesSearch = job.title.toLowerCase().includes(search.toLowerCase());\n    return matchesFilter && matchesSearch;\n  });\n\n  const publishedCount = jobs.filter((j) => j.status === \"published\").length;\n  const draftCount = jobs.filter((j) => j.status === \"draft\").length;\n\n  const formatJob = (job: JobPosting) => {\n    const daysAgo = job.createdAt ? Math.floor((Date.now() - new Date(job.createdAt).getTime()) / (1000 * 60 * 60 * 24)) : 0;\n    return {\n      id: String(job.id),\n      title: job.title,\n      department: job.department,\n      location: job.location || t.jobs.remote,\n      type: job.type || t.jobs.fullTime,\n      salary: job.salary || \"Competitive\",\n      postedDays: daysAgo,\n      isPublished: job.status === \"published\",\n    };\n  };\n\n  const iconMargin = isRTL ? \"ml-1\" : \"mr-1\";\n  const iconMargin2 = isRTL ? \"ml-2\" : \"mr-2\";\n  const searchIconPosition = isRTL ? \"right-3\" : \"left-3\";\n  const searchInputPadding = isRTL ? \"pr-9\" : \"pl-9\";\n\n  return (\n    <div className=\"p-6 space-y-6\" dir={isRTL ? 'rtl' : 'ltr'}>\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-3xl font-semibold\">{t.jobs.title}</h1>\n          <p className=\"text-muted-foreground mt-1\">{t.jobs.subtitle}</p>\n        </div>\n        <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-create-job\">\n              <Plus className={`h-4 w-4 ${iconMargin}`} />\n              {t.jobs.newJobPosting}\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-lg\">\n            <DialogHeader>\n              <DialogTitle>{t.jobs.createJobPosting}</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4 py-4 max-h-[60vh] overflow-y-auto\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"title\">{t.jobs.jobTitle}</Label>\n                <Input\n                  id=\"title\"\n                  placeholder={t.jobs.jobTitlePlaceholder}\n                  value={newJob.title}\n                  onChange={(e) => setNewJob({ ...newJob, title: e.target.value })}\n                  data-testid=\"input-job-title\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"department\">{t.jobs.department}</Label>\n                <Select value={newJob.department} onValueChange={(v) => setNewJob({ ...newJob, department: v })}>\n                  <SelectTrigger data-testid=\"select-department\">\n                    <SelectValue placeholder={t.jobs.selectDepartment} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"Engineering\">{t.jobs.engineering}</SelectItem>\n                    <SelectItem value=\"Design\">{t.jobs.design}</SelectItem>\n                    <SelectItem value=\"Product\">{t.jobs.product}</SelectItem>\n                    <SelectItem value=\"Marketing\">{t.jobs.marketing}</SelectItem>\n                    <SelectItem value=\"Sales\">{t.jobs.sales}</SelectItem>\n                    <SelectItem value=\"HR\">{t.jobs.hr}</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"location\">{t.jobs.location}</Label>\n                  <Select value={newJob.location} onValueChange={(v) => setNewJob({ ...newJob, location: v })}>\n                    <SelectTrigger data-testid=\"select-location\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"Remote\">{t.jobs.remote}</SelectItem>\n                      <SelectItem value=\"Hybrid\">{t.jobs.hybrid}</SelectItem>\n                      <SelectItem value=\"On-site\">{t.jobs.onSite}</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"type\">{t.jobs.type}</Label>\n                  <Select value={newJob.type} onValueChange={(v) => setNewJob({ ...newJob, type: v })}>\n                    <SelectTrigger data-testid=\"select-type\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"full-time\">{t.jobs.fullTime}</SelectItem>\n                      <SelectItem value=\"part-time\">{t.jobs.partTime}</SelectItem>\n                      <SelectItem value=\"contract\">{t.jobs.contract}</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"salary\">{t.jobs.salary}</Label>\n                <Input\n                  id=\"salary\"\n                  placeholder={t.jobs.salaryPlaceholder}\n                  value={newJob.salary}\n                  onChange={(e) => setNewJob({ ...newJob, salary: e.target.value })}\n                  data-testid=\"input-salary\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"description\">{t.jobs.description}</Label>\n                <Textarea\n                  id=\"description\"\n                  placeholder={t.jobs.descriptionPlaceholder}\n                  value={newJob.description}\n                  onChange={(e) => setNewJob({ ...newJob, description: e.target.value })}\n                  className=\"min-h-[100px]\"\n                  data-testid=\"textarea-job-description\"\n                />\n              </div>\n            </div>\n            <DialogFooter>\n              <Button variant=\"outline\" onClick={() => setDialogOpen(false)}>{t.jobs.cancel}</Button>\n              <Button \n                onClick={handleCreateJob} \n                disabled={createJobMutation.isPending}\n                data-testid=\"button-submit-job\"\n              >\n                {createJobMutation.isPending ? t.jobs.creating : t.jobs.createDraft}\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"flex items-center gap-4 flex-wrap\">\n        <div className=\"relative flex-1 min-w-[200px] max-w-sm\">\n          <Search className={`absolute ${searchIconPosition} top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground`} />\n          <Input\n            placeholder={t.jobs.searchJobs}\n            className={searchInputPadding}\n            value={search}\n            onChange={(e) => setSearch(e.target.value)}\n            data-testid=\"input-search-jobs\"\n          />\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button\n            variant={filter === \"all\" ? \"default\" : \"outline\"}\n            size=\"sm\"\n            onClick={() => setFilter(\"all\")}\n          >\n            {t.jobs.all} ({jobs.length})\n          </Button>\n          <Button\n            variant={filter === \"published\" ? \"default\" : \"outline\"}\n            size=\"sm\"\n            onClick={() => setFilter(\"published\")}\n          >\n            {t.jobs.published} ({publishedCount})\n          </Button>\n          <Button\n            variant={filter === \"draft\" ? \"default\" : \"outline\"}\n            size=\"sm\"\n            onClick={() => setFilter(\"draft\")}\n          >\n            {t.jobs.drafts} ({draftCount})\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"space-y-3\">\n        {isLoading ? (\n          Array(3).fill(0).map((_, i) => (\n            <Skeleton key={i} className=\"h-24 w-full\" />\n          ))\n        ) : filteredJobs.length > 0 ? (\n          filteredJobs.map((job) => (\n            <JobPostingCard\n              key={job.id}\n              {...formatJob(job)}\n              isEditable\n              onTogglePublish={handleTogglePublish}\n              onEdit={(id) => console.log(\"Edit job:\", id)}\n            />\n          ))\n        ) : (\n          <div className=\"text-center py-12 text-muted-foreground\">\n            {search ? t.jobs.noJobsMatch : `${t.jobs.noJobs} ${t.jobs.createFirst}`}\n          </div>\n        )}\n      </div>\n\n      <Card className=\"border-primary/20 bg-gradient-to-br from-primary/5 to-primary/10\" data-testid=\"card-job-registration\">\n        <CardHeader>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2 rounded-lg bg-primary/10\">\n              <UserPlus className=\"h-6 w-6 text-primary\" />\n            </div>\n            <div>\n              <CardTitle className=\"text-xl\">{t.jobs.jobRegistration}</CardTitle>\n              <CardDescription>{t.jobs.jobRegistrationDesc}</CardDescription>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <Briefcase className=\"h-4 w-4\" />\n                <span>{publishedCount} {t.jobs.openPositions}</span>\n              </div>\n              <p className=\"text-sm text-muted-foreground\">\n                {t.jobs.submitApplicationDesc}\n              </p>\n            </div>\n            <Dialog open={registerDialogOpen} onOpenChange={setRegisterDialogOpen}>\n              <DialogTrigger asChild>\n                <Button className=\"shrink-0\" data-testid=\"button-open-registration\">\n                  <UserPlus className={`h-4 w-4 ${iconMargin2}`} />\n                  {t.jobs.registerNow}\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-lg\">\n                <DialogHeader>\n                  <DialogTitle className=\"flex items-center gap-2\">\n                    <UserPlus className=\"h-5 w-5 text-primary\" />\n                    {t.jobs.applicationForm}\n                  </DialogTitle>\n                </DialogHeader>\n                <div className=\"space-y-4 py-4 max-h-[60vh] overflow-y-auto\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"fullName\">{t.jobs.fullName} *</Label>\n                    <Input\n                      id=\"fullName\"\n                      placeholder={t.jobs.fullNamePlaceholder}\n                      value={applicant.fullName}\n                      onChange={(e) => setApplicant({ ...applicant, fullName: e.target.value })}\n                      data-testid=\"input-applicant-name\"\n                    />\n                  </div>\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"email\">{t.jobs.email} *</Label>\n                      <div className=\"relative\">\n                        <Mail className={`absolute ${searchIconPosition} top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground`} />\n                        <Input\n                          id=\"email\"\n                          type=\"email\"\n                          placeholder={t.jobs.emailPlaceholder}\n                          className={searchInputPadding}\n                          value={applicant.email}\n                          onChange={(e) => setApplicant({ ...applicant, email: e.target.value })}\n                          data-testid=\"input-applicant-email\"\n                        />\n                      </div>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"phone\">{t.jobs.phone}</Label>\n                      <div className=\"relative\">\n                        <Phone className={`absolute ${searchIconPosition} top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground`} />\n                        <Input\n                          id=\"phone\"\n                          type=\"tel\"\n                          placeholder={t.jobs.phonePlaceholder}\n                          className={searchInputPadding}\n                          value={applicant.phone}\n                          onChange={(e) => setApplicant({ ...applicant, phone: e.target.value })}\n                          data-testid=\"input-applicant-phone\"\n                        />\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"position\">{t.jobs.positionInterested} *</Label>\n                    <Select \n                      value={applicant.position} \n                      onValueChange={(v) => setApplicant({ ...applicant, position: v })}\n                    >\n                      <SelectTrigger data-testid=\"select-applicant-position\">\n                        <SelectValue placeholder={t.jobs.selectPosition} />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {jobs.filter(j => j.status === \"published\").map((job) => (\n                          <SelectItem key={job.id} value={job.title}>\n                            {job.title} - {job.department}\n                          </SelectItem>\n                        ))}\n                        <SelectItem value=\"General Application\">{t.jobs.generalApplication}</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"experience\">{t.jobs.yearsExperience}</Label>\n                    <Select \n                      value={applicant.experience} \n                      onValueChange={(v) => setApplicant({ ...applicant, experience: v })}\n                    >\n                      <SelectTrigger data-testid=\"select-applicant-experience\">\n                        <SelectValue placeholder={t.jobs.selectExperience} />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"0-1\">{t.jobs.exp01}</SelectItem>\n                        <SelectItem value=\"1-3\">{t.jobs.exp13}</SelectItem>\n                        <SelectItem value=\"3-5\">{t.jobs.exp35}</SelectItem>\n                        <SelectItem value=\"5-10\">{t.jobs.exp510}</SelectItem>\n                        <SelectItem value=\"10+\">{t.jobs.exp10plus}</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"resume\">{t.jobs.resumeLink}</Label>\n                    <div className=\"relative\">\n                      <Upload className={`absolute ${searchIconPosition} top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground`} />\n                      <Input\n                        id=\"resume\"\n                        placeholder={t.jobs.resumePlaceholder}\n                        className={searchInputPadding}\n                        value={applicant.resume}\n                        onChange={(e) => setApplicant({ ...applicant, resume: e.target.value })}\n                        data-testid=\"input-applicant-resume\"\n                      />\n                    </div>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"coverLetter\">{t.jobs.coverLetter}</Label>\n                    <Textarea\n                      id=\"coverLetter\"\n                      placeholder={t.jobs.coverLetterPlaceholder}\n                      value={applicant.coverLetter}\n                      onChange={(e) => setApplicant({ ...applicant, coverLetter: e.target.value })}\n                      className=\"min-h-[100px]\"\n                      data-testid=\"textarea-applicant-cover\"\n                    />\n                  </div>\n                </div>\n                <DialogFooter>\n                  <Button variant=\"outline\" onClick={() => setRegisterDialogOpen(false)}>\n                    {t.jobs.cancel}\n                  </Button>\n                  <Button onClick={handleRegisterApplicant} data-testid=\"button-submit-application\">\n                    {t.jobs.submitApplication}\n                  </Button>\n                </DialogFooter>\n              </DialogContent>\n            </Dialog>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":20510,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/examples/TopHeader.tsx":{"content":"import { TopHeader } from \"../TopHeader\";\nimport { ThemeProvider } from \"@/contexts/ThemeContext\";\nimport { SidebarProvider } from \"@/components/ui/sidebar\";\n\nconst mockNotifications = [\n  { id: \"1\", title: \"New task assigned\", message: \"You have been assigned to 'Review Q4 reports'\", time: \"5 min ago\", isRead: false },\n  { id: \"2\", title: \"Meeting reminder\", message: \"Sprint Planning starts in 30 minutes\", time: \"25 min ago\", isRead: false },\n  { id: \"3\", title: \"Comment on your post\", message: \"James Wilson commented on your update\", time: \"1 hour ago\", isRead: true },\n];\n\nexport default function TopHeaderExample() {\n  return (\n    <ThemeProvider>\n      <SidebarProvider>\n        <div className=\"w-full\">\n          <TopHeader\n            notifications={mockNotifications}\n            onNotificationClick={(id) => console.log(\"Clicked notification:\", id)}\n          />\n        </div>\n      </SidebarProvider>\n    </ThemeProvider>\n  );\n}\n","path":null,"size_bytes":946,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/pages/Finances.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { TransactionRow } from \"@/components/TransactionRow\";\nimport { KPICard } from \"@/components/KPICard\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Plus, DollarSign, TrendingUp, Clock, CheckCircle } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Transaction } from \"@shared/schema\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\nexport default function Finances() {\n  const { language } = useLanguage();\n  const t = translations[language];\n  const { toast } = useToast();\n  const [dialogOpen, setDialogOpen] = useState(false);\n  const [newExpense, setNewExpense] = useState({\n    description: \"\",\n    amount: \"\",\n    category: \"Supplies\",\n  });\n\n  const categoryOptions = [\n    { value: \"Software\", label: t.finances?.categorySoftware || \"Software\" },\n    { value: \"Meals\", label: t.finances?.categoryMeals || \"Meals\" },\n    { value: \"Supplies\", label: t.finances?.categorySupplies || \"Supplies\" },\n    { value: \"Travel\", label: t.finances?.categoryTravel || \"Travel\" },\n    { value: \"Other\", label: t.finances?.categoryOther || \"Other\" },\n  ];\n\n  const { data: transactions = [], isLoading } = useQuery<Transaction[]>({\n    queryKey: [\"/api/transactions\"],\n  });\n\n  const createTransactionMutation = useMutation({\n    mutationFn: async (data: typeof newExpense) => {\n      const amountValue = parseFloat(data.amount);\n      if (isNaN(amountValue) || amountValue <= 0) {\n        throw new Error(\"Invalid amount\");\n      }\n      return await apiRequest(\"POST\", \"/api/transactions\", {\n        description: data.description,\n        amount: -Math.round(amountValue * 100),\n        type: \"expense\",\n        category: data.category,\n        status: \"pending\",\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/transactions\"] });\n      setNewExpense({ description: \"\", amount: \"\", category: \"Supplies\" });\n      setDialogOpen(false);\n      toast({ title: t.finances?.expenseSubmitted || \"Expense submitted\", description: t.finances?.expenseSubmittedDesc || \"Your expense has been submitted for approval.\" });\n    },\n    onError: () => {\n      toast({ title: t.finances?.error || \"Error\", description: t.finances?.failedSubmitExpense || \"Failed to submit expense.\", variant: \"destructive\" });\n    },\n  });\n\n  const updateTransactionMutation = useMutation({\n    mutationFn: async ({ id, status }: { id: number; status: string }) => {\n      return await apiRequest(\"PATCH\", `/api/transactions/${id}`, { status });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/transactions\"] });\n      toast({ title: t.finances?.transactionUpdated || \"Transaction updated\", description: t.finances?.transactionUpdatedDesc || \"The transaction has been updated.\" });\n    },\n  });\n\n  const handleSubmitExpense = () => {\n    if (!newExpense.description.trim()) {\n      toast({ title: t.finances?.error || \"Error\", description: t.finances?.descriptionRequired || \"Description is required.\", variant: \"destructive\" });\n      return;\n    }\n    if (!newExpense.amount || parseFloat(newExpense.amount) <= 0) {\n      toast({ title: t.finances?.error || \"Error\", description: t.finances?.invalidAmount || \"Please enter a valid amount.\", variant: \"destructive\" });\n      return;\n    }\n    createTransactionMutation.mutate(newExpense);\n  };\n\n  const handleApprove = (id: string) => {\n    updateTransactionMutation.mutate({ id: parseInt(id), status: \"approved\" });\n  };\n\n  const handleReject = (id: string) => {\n    updateTransactionMutation.mutate({ id: parseInt(id), status: \"rejected\" });\n  };\n\n  const pendingTransactions = transactions.filter((t) => t.status === \"pending\");\n  const approvedTransactions = transactions.filter((t) => t.status === \"approved\");\n\n  const formatAmount = (cents: number) => (cents / 100).toFixed(2);\n\n  const totalRevenue = transactions\n    .filter((t) => t.amount > 0 && t.status === \"approved\")\n    .reduce((sum, t) => sum + t.amount, 0) / 100;\n\n  const totalExpenses = transactions\n    .filter((t) => t.amount < 0 && t.status === \"approved\")\n    .reduce((sum, t) => sum + Math.abs(t.amount), 0) / 100;\n\n  const pendingAmount = pendingTransactions\n    .filter((t) => t.amount < 0)\n    .reduce((sum, t) => sum + Math.abs(t.amount), 0) / 100;\n\n  const getCategoryLabel = (category: string | null) => {\n    const found = categoryOptions.find(opt => opt.value === category);\n    return found?.label || category || (t.finances?.categoryOther || \"Other\");\n  };\n\n  const formatTransaction = (tx: Transaction) => ({\n    id: String(tx.id),\n    description: tx.description,\n    amount: tx.amount / 100,\n    category: getCategoryLabel(tx.category),\n    date: tx.createdAt ? new Date(tx.createdAt).toLocaleDateString(language === 'ar' ? 'ar-SA' : 'en-US', { month: \"short\", day: \"numeric\", year: \"numeric\" }) : \"\",\n    status: tx.status as \"pending\" | \"approved\" | \"rejected\",\n  });\n\n  return (\n    <div className=\"p-6 space-y-6\" dir={language === 'ar' ? 'rtl' : 'ltr'}>\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-3xl font-semibold\">{t.finances?.title || \"Financial Review\"}</h1>\n          <p className=\"text-muted-foreground mt-1\">{t.finances?.subtitle || \"Manage expenses and approvals\"}</p>\n        </div>\n        <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-submit-expense\">\n              <Plus className={`h-4 w-4 ${language === 'ar' ? 'ml-1' : 'mr-1'}`} />\n              {t.finances?.submitExpense || \"Submit Expense\"}\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>{t.finances?.submitExpense || \"Submit Expense\"}</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4 py-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"description\">{t.finances?.description || \"Description\"}</Label>\n                <Input\n                  id=\"description\"\n                  placeholder={t.finances?.descriptionPlaceholder || \"What is this expense for?\"}\n                  value={newExpense.description}\n                  onChange={(e) => setNewExpense({ ...newExpense, description: e.target.value })}\n                  data-testid=\"input-expense-description\"\n                />\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"amount\">{t.finances?.amount || \"Amount ($)\"}</Label>\n                  <Input\n                    id=\"amount\"\n                    type=\"number\"\n                    placeholder=\"0.00\"\n                    value={newExpense.amount}\n                    onChange={(e) => setNewExpense({ ...newExpense, amount: e.target.value })}\n                    data-testid=\"input-expense-amount\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"category\">{t.finances?.category || \"Category\"}</Label>\n                  <Select value={newExpense.category} onValueChange={(v) => setNewExpense({ ...newExpense, category: v })}>\n                    <SelectTrigger data-testid=\"select-expense-category\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {categoryOptions.map(opt => (\n                        <SelectItem key={opt.value} value={opt.value}>{opt.label}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n            </div>\n            <DialogFooter>\n              <Button variant=\"outline\" onClick={() => setDialogOpen(false)}>{t.finances?.cancel || \"Cancel\"}</Button>\n              <Button \n                onClick={handleSubmitExpense} \n                disabled={createTransactionMutation.isPending}\n                data-testid=\"button-confirm-expense\"\n              >\n                {createTransactionMutation.isPending ? (t.finances?.submitting || \"Submitting...\") : (t.finances?.submit || \"Submit\")}\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <KPICard\n          label={t.finances?.totalRevenue || \"Total Revenue\"}\n          value={totalRevenue.toLocaleString(language === 'ar' ? 'ar-SA' : 'en-US', { style: \"currency\", currency: \"USD\" })}\n          trend={15}\n          trendUp\n          icon={<TrendingUp className=\"h-5 w-5\" />}\n        />\n        <KPICard\n          label={t.finances?.totalExpenses || \"Total Expenses\"}\n          value={totalExpenses.toLocaleString(language === 'ar' ? 'ar-SA' : 'en-US', { style: \"currency\", currency: \"USD\" })}\n          icon={<DollarSign className=\"h-5 w-5\" />}\n        />\n        <KPICard\n          label={t.finances?.pendingApproval || \"Pending Approval\"}\n          value={pendingAmount.toLocaleString(language === 'ar' ? 'ar-SA' : 'en-US', { style: \"currency\", currency: \"USD\" })}\n          icon={<Clock className=\"h-5 w-5\" />}\n        />\n        <KPICard\n          label={t.finances?.approvedThisMonth || \"Approved This Month\"}\n          value={approvedTransactions.length}\n          icon={<CheckCircle className=\"h-5 w-5\" />}\n        />\n      </div>\n\n      <Tabs defaultValue=\"pending\" className=\"space-y-4\">\n        <TabsList>\n          <TabsTrigger value=\"pending\" data-testid=\"tab-pending\">\n            {t.finances?.pendingApproval || \"Pending Approval\"} ({pendingTransactions.length})\n          </TabsTrigger>\n          <TabsTrigger value=\"all\" data-testid=\"tab-all\">\n            {t.finances?.allTransactions || \"All Transactions\"}\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"pending\">\n          <Card>\n            <CardHeader>\n              <CardTitle>{t.finances?.awaitingApproval || \"Awaiting Your Approval\"}</CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              {isLoading ? (\n                Array(3).fill(0).map((_, i) => (\n                  <Skeleton key={i} className=\"h-16 w-full m-4\" />\n                ))\n              ) : pendingTransactions.length > 0 ? (\n                pendingTransactions.map((transaction) => (\n                  <TransactionRow\n                    key={transaction.id}\n                    {...formatTransaction(transaction)}\n                    showApprovalActions\n                    onApprove={handleApprove}\n                    onReject={handleReject}\n                  />\n                ))\n              ) : (\n                <div className=\"text-center py-12 text-muted-foreground\">\n                  {t.finances?.noPendingApprovals || \"No pending approvals\"}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"all\">\n          <Card>\n            <CardHeader>\n              <CardTitle>{t.finances?.transactionHistory || \"Transaction History\"}</CardTitle>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              {isLoading ? (\n                Array(5).fill(0).map((_, i) => (\n                  <Skeleton key={i} className=\"h-16 w-full m-4\" />\n                ))\n              ) : transactions.length > 0 ? (\n                transactions.map((transaction) => (\n                  <TransactionRow key={transaction.id} {...formatTransaction(transaction)} />\n                ))\n              ) : (\n                <div className=\"text-center py-12 text-muted-foreground\">\n                  {t.finances?.noTransactions || \"No transactions yet\"}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":12601,"size_tokens":null},"client/src/components/examples/ChatThread.tsx":{"content":"import { useState } from \"react\";\nimport { ChatThreadItem } from \"../ChatThread\";\n\nconst mockThreads = [\n  { id: \"1\", name: \"Engineering Team\", lastMessage: \"Great work on the release!\", participants: [{ name: \"Sarah Chen\" }, { name: \"David Kim\" }], unread: 2, timestamp: \"10 min ago\" },\n  { id: \"2\", name: \"Product Discussion\", lastMessage: \"Let's schedule a sync\", participants: [{ name: \"James Wilson\" }, { name: \"Maria Garcia\" }], unread: 0, timestamp: \"1 hour ago\" },\n  { id: \"3\", name: \"All Hands\", lastMessage: \"Reminder: Town hall tomorrow\", participants: [{ name: \"Emma Thompson\" }, { name: \"Sarah Chen\" }, { name: \"James Wilson\" }], unread: 5, timestamp: \"3 hours ago\" },\n];\n\nexport default function ChatThreadExample() {\n  const [activeId, setActiveId] = useState(\"1\");\n\n  return (\n    <div className=\"w-80 space-y-1 p-2 bg-sidebar rounded-md\">\n      {mockThreads.map(thread => (\n        <ChatThreadItem\n          key={thread.id}\n          {...thread}\n          isActive={activeId === thread.id}\n          onClick={() => setActiveId(thread.id)}\n        />\n      ))}\n    </div>\n  );\n}\n","path":null,"size_bytes":1095,"size_tokens":null},"client/src/components/StatusStory.tsx":{"content":"import { UserAvatar } from \"./UserAvatar\";\nimport { cn } from \"@/lib/utils\";\n\ninterface StatusStoryProps {\n  user: { name: string; avatar?: string | null };\n  isViewed?: boolean;\n  isOwn?: boolean;\n  onClick?: () => void;\n}\n\nexport function StatusStory({ user, isViewed = false, isOwn = false, onClick }: StatusStoryProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"flex flex-col items-center gap-1 p-2 hover-elevate rounded-md\"\n      data-testid={`button-story-${user.name.toLowerCase().replace(/\\s/g, \"-\")}`}\n    >\n      <div\n        className={cn(\n          \"p-0.5 rounded-full\",\n          isViewed ? \"bg-muted\" : \"bg-gradient-to-tr from-primary to-blue-400\"\n        )}\n      >\n        <div className=\"p-0.5 rounded-full bg-background\">\n          <UserAvatar name={user.name} avatar={user.avatar} size=\"lg\" />\n        </div>\n      </div>\n      <span className=\"text-xs text-center truncate w-16\">\n        {isOwn ? \"Your Story\" : user.name.split(\" \")[0]}\n      </span>\n    </button>\n  );\n}\n\ninterface StatusStoriesRowProps {\n  stories: Array<{\n    id: string;\n    user: { name: string; avatar?: string | null };\n    isViewed?: boolean;\n  }>;\n  currentUser?: { name: string; avatar?: string | null };\n  onStoryClick?: (id: string) => void;\n  onAddStory?: () => void;\n}\n\nexport function StatusStoriesRow({ stories, currentUser, onStoryClick, onAddStory }: StatusStoriesRowProps) {\n  return (\n    <div className=\"flex gap-2 overflow-x-auto pb-2 scrollbar-hide\">\n      {currentUser && (\n        <StatusStory user={currentUser} isOwn onClick={onAddStory} />\n      )}\n      {stories.map((story) => (\n        <StatusStory\n          key={story.id}\n          user={story.user}\n          isViewed={story.isViewed}\n          onClick={() => onStoryClick?.(story.id)}\n        />\n      ))}\n    </div>\n  );\n}\n","path":null,"size_bytes":1819,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"design_guidelines.md":{"content":"# Design Guidelines: CloudOffice Virtual Workspace & Marketplace\n\n## Design Approach\n\n**System:** Linear's minimalist productivity UX adapted for dark mode, combined with Discord's sophisticated glass-morphism and depth layering.\n\n**Core Principles:**\n1. Dark-first design with premium glass effects\n2. Depth through layering, not harsh borders\n3. Vibrant accents guide attention efficiently\n4. Professional polish with futuristic edge\n5. Clear information hierarchy in low-light\n\n---\n\n## Color Palette\n\n**Backgrounds:**\n- App Shell: #0B0F19 (deep charcoal)\n- Cards/Panels: #151B2B with 40% opacity glass effect\n- Elevated Elements: #1A2235 with subtle cyan glow\n- Input Fields: #0F1419 with border glow on focus\n\n**Accents:**\n- Primary: Cyan #06B6D4 (interactive elements, CTAs)\n- Secondary: Teal #14B8A6 (success states, confirmations)\n- Gradient Overlays: Linear from cyan to teal at 45deg, 20% opacity\n- Glow Effects: Cyan shadow with 24px blur on hover\n\n**Text:**\n- Primary: #F1F5F9 (near white)\n- Secondary: #94A3B8 (slate gray)\n- Muted/Labels: #64748B\n- Disabled: #475569\n\n**Functional:**\n- Error: #EF4444, Warning: #F59E0B, Success: #10B981\n- Borders: #1E293B with 30% opacity\n\n---\n\n## Typography\n\n**Font:** Inter via Google Fonts\n\n**Hierarchy:**\n- Hero/Marketing: text-5xl font-bold with cyan gradient text effect\n- Page Titles: text-3xl font-semibold text-gray-50\n- Section Headers: text-xl font-semibold\n- Body: text-base font-normal leading-relaxed\n- Labels: text-sm font-medium text-gray-400\n- Metadata: text-xs text-gray-500\n\n---\n\n## Layout System\n\n**Spacing Units:** 2, 4, 6, 8, 12, 16, 20, 24 (Tailwind scale)\n\n**Shell Structure:**\n- Sidebar: w-64, glass background with subtle border-r glow\n- Top Bar: h-16, glass effect with bottom border glow\n- Content: px-8 py-6, max-w-7xl containers\n- Marketplace pages: Full-width hero with gradient overlay, contained content sections below\n\n**Grid Patterns:**\n- Dashboard: 3-column on lg, 2-column on md, stacked mobile\n- Marketplace listings: 4-column grid (xl), 3-column (lg), masonry on mobile\n- Task boards: Flexible column widths with gap-6\n\n---\n\n## Component Library\n\n### Glass-Morphism Cards\n- Background: bg-slate-900/40 with backdrop-blur-xl\n- Border: 1px solid white/10 with subtle cyan glow\n- Padding: p-6 for standard, p-8 for feature cards\n- Rounded: rounded-xl\n- Shadow: Drop shadow with cyan tint\n\n### Buttons\n- Primary: Solid cyan fill, white text, rounded-lg px-6 py-3, glow on hover\n- Secondary: Glass background with cyan border, cyan text\n- Ghost: Transparent with hover glass effect\n- Icon buttons: p-2.5 rounded-lg with hover glow\n\n### Navigation\n- Sidebar items: Icon (20px Heroicons) + label, active state with cyan accent bar and glass background\n- Logo area at top with gradient treatment\n- User profile at bottom with status indicator ring\n\n### Data Tables\n- Glass header row (sticky)\n- Alternating row opacity (bg-slate-800/20)\n- Hover: Cyan glow from left edge\n- Action buttons right-aligned, icon-only\n\n### Forms\n- Inputs: Dark fill with cyan border glow on focus, rounded-lg\n- Labels: text-sm text-gray-300 above inputs\n- Grouped sections: Glass panel with p-6\n- Form actions: Right-aligned button group\n\n### Marketplace Components\n- Office Listing Cards: Large preview image (aspect-video), glass overlay with pricing badge (top-right), amenities icons row, \"Book Tour\" CTA\n- Category filters: Horizontal pill navigation with active cyan underline glow\n- Hero search bar: Large glass panel with location/date/capacity inputs, prominent search button\n\n### Specialized Widgets\n- KPI Cards: Large metric (text-4xl gradient), trend arrow, sparkline chart placeholder\n- Activity Feed: Avatar with cyan ring for active users, glass message bubbles, timestamp positioning\n- Meeting Cards: Glass panel with participant avatars (stacked), join button with pulse effect\n- Status Stories: Circular avatars (64px) with gradient ring, horizontal scroll\n\n### Chat Interface\n- Left panel (w-80): Thread list with glass backgrounds\n- Message area: Right-aligned sent (cyan accent), left-aligned received (glass)\n- Input bar: Fixed bottom, glass with cyan focus glow\n- Typing indicators: Animated dots in cyan\n\n---\n\n## Visual Effects\n\n**Gradients:** Subtle overlays on hero sections, card backgrounds (10-20% opacity)\n**Glow:** Cyan shadow (0 0 24px cyan/30) on hover states\n**Glass:** backdrop-blur-xl with bg opacity 40%\n**Borders:** 1px with 10% white opacity, cyan glow on interactive elements\n\n---\n\n## Images\n\n**Hero Section:** Full-width (h-screen), futuristic office space imagery with dark gradient overlay (from transparent to charcoal). Search bar centered with glass treatment. CTAs use glass buttons with blurred backgrounds.\n\n**Marketplace Listings:** High-quality office interior photos, aspect-video ratio\n\n**Dashboard:** Placeholder charts/graphs with cyan accent colors\n\n**Team/Profile:** Circular avatars with subtle cyan glow border for online status\n\n---\n\n## Accessibility\n\n- Focus rings: 2px cyan outline\n- Sufficient contrast (WCAG AA on dark backgrounds)\n- Hover states: Subtle glow, no color-only indicators\n- Disabled: 40% opacity with cursor-not-allowed\n\n---\n\nThis dark-themed system creates a premium, professional workspace environment with futuristic sophistication suitable for both internal productivity tools and public marketplace presentation.","path":null,"size_bytes":5350,"size_tokens":null},"client/src/pages/Landing.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea, ScrollBar } from \"@/components/ui/scroll-area\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { \n  Building2, \n  Users, \n  Clock, \n  TrendingUp,\n  Search,\n  MapPin,\n  Wifi,\n  Coffee,\n  Monitor,\n  ArrowRight,\n  Diamond,\n  FileText,\n  Award,\n  Phone,\n  Car,\n  Heart,\n  MessageCircle,\n  Share2,\n  Star,\n  UserPlus,\n  Eye,\n  Briefcase,\n  Megaphone,\n  ExternalLink,\n  ClipboardList,\n} from \"lucide-react\";\nimport logoUrl from \"@assets/Photoroom___1764761955587.png\";\nimport { useState, useEffect } from \"react\";\nimport { Link } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { Advertisement, Office } from \"@shared/schema\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\nimport { LanguageSwitcher } from \"@/components/LanguageSwitcher\";\n\nconst partners = [\n  { id: 1, name: \"Starfire\", avatar: \"https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&h=100&fit=crop\" },\n  { id: 2, name: \"Legal Hub\", avatar: \"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop\" },\n  { id: 3, name: \"Finance Pro\", avatar: \"https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&h=100&fit=crop\" },\n  { id: 4, name: \"Fraseca Pro\", avatar: \"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop\" },\n  { id: 5, name: \"Davea Pro\", avatar: \"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop\" },\n  { id: 6, name: \"JoJea Guide\", avatar: \"https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=100&h=100&fit=crop\" },\n  { id: 7, name: \"Stylejobs\", avatar: \"https://images.unsplash.com/photo-1519345182560-3f2917c472ef?w=100&h=100&fit=crop\" },\n];\n\n\nconst availableOffices = [\n  {\n    id: 1,\n    name: \"Skyline Virtual\",\n    location: \"Downtown Financial District\",\n    price: \"$149/mo\",\n    status: \"available\",\n    type: \"premium\",\n    amenities: [\"wifi\", \"phone\", \"mail\"],\n    logo: \"https://images.unsplash.com/photo-1560179707-f14e90ef3623?w=120&h=120&fit=crop\",\n    rating: 4.8,\n    reviews: 124,\n  },\n  {\n    id: 2,\n    name: \"Metro Business Hub\",\n    location: \"Midtown Business Center\",\n    price: \"$199/mo\",\n    status: \"available\",\n    type: \"standard\",\n    amenities: [\"wifi\", \"mail\"],\n    logo: \"https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=120&h=120&fit=crop\",\n    rating: 4.5,\n    reviews: 89,\n  },\n  {\n    id: 3,\n    name: \"Innovation Tower\",\n    location: \"Innovation Tower, Suite 500\",\n    price: \"$249/mo\",\n    status: \"newly_rented\",\n    type: \"premium\",\n    amenities: [\"wifi\", \"phone\", \"car\"],\n    logo: \"https://images.unsplash.com/photo-1554469384-e58fac16e23a?w=120&h=120&fit=crop\",\n    rating: 4.9,\n    reviews: 156,\n  },\n  {\n    id: 4,\n    name: \"Executive Suites Co\",\n    location: \"Corporate Business Park\",\n    price: \"$399/mo\",\n    status: \"available\",\n    type: \"premium\",\n    amenities: [\"wifi\", \"phone\", \"coffee\"],\n    logo: \"https://images.unsplash.com/photo-1497366811353-6870744d04b2?w=120&h=120&fit=crop\",\n    rating: 5.0,\n    reviews: 201,\n  },\n  {\n    id: 5,\n    name: \"StartupSpace\",\n    location: \"Tech Innovation Hub\",\n    price: \"$99/mo\",\n    status: \"newly_rented\",\n    type: \"standard\",\n    amenities: [\"wifi\"],\n    logo: \"https://images.unsplash.com/photo-1497215842964-222b430dc094?w=120&h=120&fit=crop\",\n    rating: 4.3,\n    reviews: 67,\n  },\n  {\n    id: 6,\n    name: \"WorkHub Central\",\n    location: \"Metro Central Plaza\",\n    price: \"$79/mo\",\n    status: \"available\",\n    type: \"standard\",\n    amenities: [\"wifi\", \"coffee\"],\n    logo: \"https://images.unsplash.com/photo-1504384308090-c894fdcc538d?w=120&h=120&fit=crop\",\n    rating: 4.6,\n    reviews: 112,\n  },\n];\n\nconst amenityIcons: Record<string, typeof Wifi> = {\n  wifi: Wifi,\n  coffee: Coffee,\n  monitor: Monitor,\n  phone: Phone,\n  car: Car,\n  mail: FileText,\n};\n\n\nexport default function Landing() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [activeFilter, setActiveFilter] = useState(\"All\");\n  const [viewedAds, setViewedAds] = useState<Set<number>>(new Set());\n  const { language, isRTL } = useLanguage();\n  const t = translations[language];\n\n  const dailyStats = [\n    { label: t.landing.stats.activeOffices, value: \"24\", icon: Building2, trend: `+3 ${t.landing.stats.today}` },\n    { label: t.landing.stats.onlineMembers, value: \"156\", icon: Users, trend: \"+12%\" },\n    { label: t.landing.stats.hoursLogged, value: \"1,240\", icon: Clock, trend: \"+8%\" },\n    { label: t.landing.stats.productivity, value: \"94%\", icon: TrendingUp, trend: \"+5%\" },\n  ];\n\n  const filterTabs = [\n    { key: \"All\", label: t.landing.filters.all },\n    { key: \"Premium\", label: t.landing.filters.premium },\n    { key: \"Standard\", label: t.landing.filters.standard },\n    { key: \"Available\", label: t.landing.filters.available },\n    { key: \"Newly Rented\", label: t.landing.filters.newlyRented },\n  ];\n\n  const achievements = [\n    { id: 1, icon: Diamond, title: t.landing.achievements.premiumPartner, subtitle: t.landing.achievements.premiumPartnerDesc },\n    { id: 2, icon: FileText, title: t.landing.achievements.completeDoc, subtitle: t.landing.achievements.completeDocDesc },\n    { id: 3, icon: Award, title: t.landing.achievements.topRated, subtitle: t.landing.achievements.topRatedDesc },\n  ];\n\n  const socialPosts = [\n    {\n      id: 1,\n      author: t.landing.socialPosts.post1Author,\n      avatar: \"https://images.unsplash.com/photo-1560250097-0b93528c311a?w=100&h=100&fit=crop\",\n      content: t.landing.socialPosts.post1Content,\n      likes: 24,\n      comments: 8,\n      time: t.landing.socialPosts.post1Time\n    },\n    {\n      id: 2,\n      author: t.landing.socialPosts.post2Author,\n      avatar: \"https://images.unsplash.com/photo-1573497019940-1c28c88b4f3e?w=100&h=100&fit=crop\",\n      content: t.landing.socialPosts.post2Content,\n      likes: 18,\n      comments: 5,\n      time: t.landing.socialPosts.post2Time\n    },\n  ];\n\n  const { data: activeAds = [] } = useQuery<Advertisement[]>({\n    queryKey: ['/api/advertisements/active'],\n  });\n\n  // Fetch real offices from database\n  const { data: realOffices = [] } = useQuery<Office[]>({\n    queryKey: ['/api/public/offices'],\n  });\n\n  const trackAdView = async (adId: number) => {\n    if (!viewedAds.has(adId)) {\n      setViewedAds(prev => new Set(prev).add(adId));\n      try {\n        await apiRequest('POST', `/api/advertisements/${adId}/view`);\n      } catch (error) {\n        console.error('Failed to track ad view:', error);\n      }\n    }\n  };\n\n  const handleAdClick = async (ad: Advertisement) => {\n    try {\n      await apiRequest('POST', `/api/advertisements/${ad.id}/click`);\n    } catch (error) {\n      console.error('Failed to track ad click:', error);\n    }\n    if (ad.linkUrl) {\n      window.open(ad.linkUrl, '_blank', 'noopener,noreferrer');\n    }\n  };\n\n  useEffect(() => {\n    if (activeAds && activeAds.length > 0) {\n      activeAds.forEach(ad => trackAdView(ad.id));\n    }\n  }, [activeAds]);\n\n  const handleLogin = (redirectTo?: string) => {\n    if (redirectTo) {\n      localStorage.setItem(\"cloudoffice_redirect\", redirectTo);\n    }\n    window.location.href = \"/api/login\";\n  };\n\n  // Combine real offices with mock offices for display\n  const displayOffices = realOffices.length > 0 \n    ? realOffices.map(office => ({\n        id: office.id,\n        name: office.name,\n        slug: office.slug,\n        location: office.location || \"Virtual Office\",\n        price: \"Contact for pricing\",\n        status: \"available\" as const,\n        type: \"premium\" as const,\n        amenities: [\"wifi\", \"phone\", \"mail\"] as string[],\n        logo: office.logoUrl || \"https://images.unsplash.com/photo-1560179707-f14e90ef3623?w=120&h=120&fit=crop\",\n        rating: 4.8,\n        reviews: 0,\n      }))\n    : availableOffices.map(office => ({\n        ...office,\n        slug: office.name.toLowerCase().replace(/\\s+/g, '-'),\n      }));\n\n  const filteredOffices = displayOffices.filter(office => {\n    const matchesSearch = office.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      office.location.toLowerCase().includes(searchQuery.toLowerCase());\n    \n    if (activeFilter === \"All\") return matchesSearch;\n    if (activeFilter === \"Premium\") return matchesSearch && office.type === \"premium\";\n    if (activeFilter === \"Standard\") return matchesSearch && office.type === \"standard\";\n    if (activeFilter === \"Available\") return matchesSearch && office.status === \"available\";\n    if (activeFilter === \"Newly Rented\") return matchesSearch && office.status === \"newly_rented\";\n    return matchesSearch;\n  });\n\n  return (\n    <div className={`min-h-screen bg-background ${isRTL ? 'rtl' : 'ltr'}`} dir={isRTL ? 'rtl' : 'ltr'}>\n      <header className=\"sticky top-0 z-50 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n        <div className=\"container mx-auto flex items-center justify-between h-16 px-4\">\n          <div className=\"flex items-center gap-2\">\n            <img src={logoUrl} alt=\"CloudOffice\" className=\"h-10 w-10 object-contain\" />\n            <span className=\"font-semibold text-xl\">CloudOffice</span>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <LanguageSwitcher />\n            <Button onClick={() => handleLogin()} data-testid=\"button-login-header\">\n              {t.landing.signIn}\n              <ArrowRight className={`h-4 w-4 ${isRTL ? 'mr-2 rotate-180' : 'ml-2'}`} />\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"container mx-auto p-4 md:p-6 space-y-6 max-w-7xl\">\n        <section className=\"py-6 md:py-10\">\n          <div className=\"text-center mb-8\">\n            <h1 className=\"text-2xl md:text-4xl font-bold mb-3\">{t.landing.welcomeTitle}</h1>\n            <p className=\"text-muted-foreground max-w-2xl mx-auto\">\n              {t.landing.welcomeSubtitle}\n            </p>\n          </div>\n          \n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 max-w-5xl mx-auto\">\n            <Card \n              className=\"hover-elevate cursor-pointer group text-center\"\n              onClick={() => handleLogin(\"/subscription\")}\n              data-testid=\"card-register-office\"\n            >\n              <CardContent className=\"p-6\">\n                <div className=\"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4 group-hover:bg-primary/20 transition-colors\">\n                  <Building2 className=\"h-8 w-8 text-primary\" />\n                </div>\n                <h3 className=\"font-semibold text-lg mb-2\">{t.landing.registerOffice}</h3>\n                <p className=\"text-sm text-muted-foreground mb-4\">\n                  {t.landing.registerOfficeDesc}\n                </p>\n                <Button className=\"w-full\" data-testid=\"button-register-office\">\n                  {t.landing.getStarted}\n                  <ArrowRight className={`h-4 w-4 ${isRTL ? 'mr-2 rotate-180' : 'ml-2'}`} />\n                </Button>\n              </CardContent>\n            </Card>\n\n            <Link href=\"/visitor\" data-testid=\"link-visitor\">\n              <Card \n                className=\"hover-elevate cursor-pointer group text-center h-full\"\n                data-testid=\"card-visitor\"\n              >\n                <CardContent className=\"p-6\">\n                  <div className=\"w-16 h-16 rounded-full bg-violet-500/10 flex items-center justify-center mx-auto mb-4 group-hover:bg-violet-500/20 transition-colors\">\n                    <Eye className=\"h-8 w-8 text-violet-500\" />\n                  </div>\n                  <h3 className=\"font-semibold text-lg mb-2\">{t.landing.visitor}</h3>\n                  <p className=\"text-sm text-muted-foreground mb-4\">\n                    {t.landing.visitorDesc}\n                  </p>\n                  <Button variant=\"outline\" className=\"w-full border-violet-500/50 text-violet-600 hover:bg-violet-500/10\" data-testid=\"button-visitor\">\n                    {t.landing.explore}\n                    <ArrowRight className={`h-4 w-4 ${isRTL ? 'mr-2 rotate-180' : 'ml-2'}`} />\n                  </Button>\n                </CardContent>\n              </Card>\n            </Link>\n\n            <Link href=\"/careers\" data-testid=\"link-careers\">\n              <Card \n                className=\"hover-elevate cursor-pointer group text-center h-full\"\n                data-testid=\"card-jobs\"\n              >\n                <CardContent className=\"p-6\">\n                  <div className=\"w-16 h-16 rounded-full bg-orange-500/10 flex items-center justify-center mx-auto mb-4 group-hover:bg-orange-500/20 transition-colors\">\n                    <Briefcase className=\"h-8 w-8 text-orange-500\" />\n                  </div>\n                  <h3 className=\"font-semibold text-lg mb-2\">{t.landing.jobOpportunities}</h3>\n                  <p className=\"text-sm text-muted-foreground mb-4\">\n                    {t.landing.jobOpportunitiesDesc}\n                  </p>\n                  <Button variant=\"outline\" className=\"w-full border-orange-500/50 text-orange-600 hover:bg-orange-500/10\" data-testid=\"button-jobs\">\n                    {t.landing.viewJobs}\n                    <ArrowRight className={`h-4 w-4 ${isRTL ? 'mr-2 rotate-180' : 'ml-2'}`} />\n                  </Button>\n                </CardContent>\n              </Card>\n            </Link>\n\n            <Link href=\"/employee-portal\" data-testid=\"link-employee-portal\">\n              <Card \n                className=\"hover-elevate cursor-pointer group text-center h-full\"\n                data-testid=\"card-employee-portal\"\n              >\n                <CardContent className=\"p-6\">\n                  <div className=\"w-16 h-16 rounded-full bg-emerald-500/10 flex items-center justify-center mx-auto mb-4 group-hover:bg-emerald-500/20 transition-colors\">\n                    <ClipboardList className=\"h-8 w-8 text-emerald-500\" />\n                  </div>\n                  <h3 className=\"font-semibold text-lg mb-2\">{t.landing.employeePortal}</h3>\n                  <p className=\"text-sm text-muted-foreground mb-4\">\n                    {t.landing.employeePortalDesc}\n                  </p>\n                  <Button variant=\"outline\" className=\"w-full border-emerald-500/50 text-emerald-600 hover:bg-emerald-500/10\" data-testid=\"button-employee-portal\">\n                    {t.landing.enter}\n                    <ArrowRight className={`h-4 w-4 ${isRTL ? 'mr-2 rotate-180' : 'ml-2'}`} />\n                  </Button>\n                </CardContent>\n              </Card>\n            </Link>\n          </div>\n        </section>\n\n        <div className=\"relative\">\n          <Search className={`absolute top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground ${isRTL ? 'right-3' : 'left-3'}`} />\n          <Input\n            placeholder={t.landing.searchPlaceholder}\n            className={`h-11 bg-card border-border ${isRTL ? 'pr-9' : 'pl-9'}`}\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            data-testid=\"input-search-offices\"\n          />\n        </div>\n\n        <ScrollArea className=\"w-full whitespace-nowrap\">\n          <div className=\"flex gap-4 pb-2\">\n            {partners.map((partner) => (\n              <div key={partner.id} className=\"flex flex-col items-center gap-2 cursor-pointer group\" data-testid={`partner-${partner.id}`}>\n                <div className=\"relative p-0.5 rounded-full bg-gradient-to-tr from-primary via-primary/80 to-primary/60\">\n                  <Avatar className=\"h-14 w-14 border-2 border-background\">\n                    <AvatarImage src={partner.avatar} alt={partner.name} />\n                    <AvatarFallback>{partner.name.slice(0, 2)}</AvatarFallback>\n                  </Avatar>\n                </div>\n                <span className=\"text-xs text-muted-foreground group-hover:text-foreground transition-colors truncate max-w-16\">\n                  {partner.name}\n                </span>\n              </div>\n            ))}\n          </div>\n          <ScrollBar orientation=\"horizontal\" />\n        </ScrollArea>\n\n        <section className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n          {dailyStats.map((stat, index) => (\n            <Card key={stat.label} className=\"hover-elevate cursor-pointer\" data-testid={`stat-card-${index}`}>\n              <CardContent className=\"p-3 md:p-4\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 rounded-lg bg-primary/10 text-primary\">\n                    <stat.icon className=\"h-4 w-4 md:h-5 md:w-5\" />\n                  </div>\n                  <div>\n                    <p className=\"text-lg md:text-xl font-bold\" data-testid={`stat-value-${index}`}>{stat.value}</p>\n                    <p className=\"text-xs text-muted-foreground\">{stat.label}</p>\n                  </div>\n                </div>\n                <p className=\"text-xs text-primary mt-2\">{stat.trend}</p>\n              </CardContent>\n            </Card>\n          ))}\n        </section>\n\n        {activeAds.length > 0 && (\n          <section data-testid=\"section-advertisements\">\n            <div className=\"flex items-center gap-2 mb-4\">\n              <Megaphone className=\"h-5 w-5 text-primary\" />\n              <h2 className=\"text-lg font-semibold\">{t.landing.featuredPromotions}</h2>\n              <Badge variant=\"secondary\" className=\"text-xs\">{t.landing.ad}</Badge>\n            </div>\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {activeAds.map((ad) => (\n                <Card \n                  key={ad.id} \n                  className=\"hover-elevate cursor-pointer group overflow-hidden\"\n                  onClick={() => handleAdClick(ad)}\n                  data-testid={`ad-card-${ad.id}`}\n                >\n                  {ad.imageUrl && (\n                    <div className=\"h-32 overflow-hidden\">\n                      <img \n                        src={ad.imageUrl} \n                        alt={ad.title}\n                        className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300\"\n                      />\n                    </div>\n                  )}\n                  <CardContent className={`p-4 ${!ad.imageUrl ? 'pt-4' : ''}`}>\n                    <div className=\"flex items-start justify-between gap-2\">\n                      <div className=\"min-w-0 flex-1\">\n                        <h3 className=\"font-semibold text-sm line-clamp-1\">{ad.title}</h3>\n                        {ad.description && (\n                          <p className=\"text-xs text-muted-foreground mt-1 line-clamp-2\">\n                            {ad.description}\n                          </p>\n                        )}\n                      </div>\n                      {ad.linkUrl && (\n                        <ExternalLink className=\"h-4 w-4 text-muted-foreground shrink-0\" />\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </section>\n        )}\n\n        <section className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          <div className=\"space-y-4\">\n            <Card className=\"overflow-hidden hover-elevate cursor-pointer\" data-testid=\"card-featured-hero\">\n              <div className=\"relative h-48 md:h-56\">\n                <img\n                  src=\"https://images.unsplash.com/photo-1497366216548-37526070297c?w=600&h=400&fit=crop\"\n                  alt=\"Professional Office Services\"\n                  className=\"w-full h-full object-cover\"\n                />\n                <div className=\"absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent\" />\n                <div className={`absolute bottom-0 p-4 md:p-6 ${isRTL ? 'right-0' : 'left-0'}`}>\n                  <h3 className=\"text-xl md:text-2xl font-bold text-white mb-1\">{t.landing.globalReach}</h3>\n                  <h3 className=\"text-xl md:text-2xl font-bold text-white mb-3\">{t.landing.businessPartner}</h3>\n                  <p className=\"text-sm text-white/80 mb-4 max-w-xs\">{t.landing.globalReachDesc}</p>\n                  <Button className=\"bg-primary hover:bg-primary/90\" onClick={() => handleLogin()} data-testid=\"button-explore-now\">\n                    {t.landing.exploreNow}\n                  </Button>\n                </div>\n              </div>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n                  <Users className=\"h-4 w-4 text-primary\" />\n                  {t.landing.socialUpdates}\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                {socialPosts.map((post) => (\n                  <div key={post.id} className=\"p-3 rounded-lg bg-muted/50\" data-testid={`social-post-${post.id}`}>\n                    <div className=\"flex gap-3\">\n                      <Avatar className=\"h-10 w-10\">\n                        <AvatarImage src={post.avatar} alt={post.author} />\n                        <AvatarFallback>{post.author.slice(0, 2)}</AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"font-medium text-sm\">{post.author}</span>\n                          <span className=\"text-xs text-muted-foreground\">{post.time}</span>\n                        </div>\n                        <p className=\"text-sm mt-1 text-muted-foreground line-clamp-2\">{post.content}</p>\n                        <div className=\"flex items-center gap-3 mt-2\">\n                          <button className=\"flex items-center gap-1 text-xs text-muted-foreground hover:text-primary transition-colors\" data-testid={`button-like-${post.id}`}>\n                            <Heart className=\"h-3.5 w-3.5\" />\n                            {post.likes}\n                          </button>\n                          <button className=\"flex items-center gap-1 text-xs text-muted-foreground hover:text-primary transition-colors\" data-testid={`button-comment-${post.id}`}>\n                            <MessageCircle className=\"h-3.5 w-3.5\" />\n                            {post.comments}\n                          </button>\n                          <button className=\"flex items-center gap-1 text-xs text-muted-foreground hover:text-primary transition-colors\" data-testid={`button-share-${post.id}`}>\n                            <Share2 className=\"h-3.5 w-3.5\" />\n                          </button>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </CardContent>\n            </Card>\n          </div>\n\n          <Card>\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"flex items-center gap-2\">\n                <Diamond className=\"h-5 w-5 text-primary\" />\n                {t.landing.achievementsTitle}\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              {achievements.map((achievement) => (\n                <div\n                  key={achievement.id}\n                  className=\"flex items-center gap-4 p-3 rounded-lg bg-muted/50 hover-elevate cursor-pointer\"\n                  data-testid={`achievement-${achievement.id}`}\n                >\n                  <div className=\"p-2 rounded-lg bg-card border border-border\">\n                    <achievement.icon className=\"h-5 w-5 text-muted-foreground\" />\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"font-medium text-sm\">{achievement.title}</p>\n                    <p className=\"text-xs text-muted-foreground\">{achievement.subtitle}</p>\n                  </div>\n                  <ArrowRight className=\"h-4 w-4 text-muted-foreground\" />\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n        </section>\n\n        <section>\n          <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-4\">\n            <h2 className=\"text-lg font-semibold flex items-center gap-2\">\n              <Building2 className=\"h-5 w-5 text-primary\" />\n              {t.landing.availableOffices}\n            </h2>\n          </div>\n\n          <ScrollArea className=\"w-full whitespace-nowrap mb-4\">\n            <div className=\"flex gap-2 pb-2\">\n              {filterTabs.map((tab) => (\n                <Button\n                  key={tab.key}\n                  variant={activeFilter === tab.key ? \"default\" : \"outline\"}\n                  size=\"sm\"\n                  onClick={() => setActiveFilter(tab.key)}\n                  className=\"rounded-full\"\n                  data-testid={`filter-${tab.key.toLowerCase().replace(\" \", \"-\")}`}\n                >\n                  {tab.label}\n                </Button>\n              ))}\n            </div>\n            <ScrollBar orientation=\"horizontal\" />\n          </ScrollArea>\n\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4\">\n            {filteredOffices.map((office) => (\n              <Card key={office.id} className=\"hover-elevate cursor-pointer group overflow-hidden\" data-testid={`office-card-${office.id}`}>\n                <CardContent className=\"p-4 flex flex-col items-center text-center\">\n                  <div className=\"relative mb-3\">\n                    <div className=\"w-16 h-16 md:w-20 md:h-20 rounded-xl overflow-hidden border-2 border-border shadow-sm\">\n                      <img \n                        src={office.logo} \n                        alt={office.name}\n                        className=\"w-full h-full object-cover\"\n                      />\n                    </div>\n                    <Badge \n                      variant=\"secondary\"\n                      className={`absolute -bottom-1 left-1/2 -translate-x-1/2 text-[10px] px-1.5 py-0 ${\n                        office.status === \"newly_rented\" \n                          ? \"bg-primary/10 text-primary border-primary/20\" \n                          : \"bg-emerald-500/10 text-emerald-500 border-emerald-500/20\"\n                      }`}\n                    >\n                      {office.status === \"newly_rented\" ? t.landing.rented : t.landing.open}\n                    </Badge>\n                  </div>\n                  \n                  <h3 className=\"font-semibold text-sm leading-tight mb-1 line-clamp-1\" data-testid={`office-name-${office.id}`}>\n                    {office.name}\n                  </h3>\n                  \n                  <div className=\"flex items-center gap-0.5 mb-1\">\n                    {[...Array(5)].map((_, i) => (\n                      <Star\n                        key={i}\n                        className={`h-3 w-3 ${\n                          i < Math.floor(office.rating)\n                            ? \"fill-amber-400 text-amber-400\"\n                            : i < office.rating\n                            ? \"fill-amber-400/50 text-amber-400\"\n                            : \"text-muted-foreground/30\"\n                        }`}\n                      />\n                    ))}\n                  </div>\n                  \n                  <p className=\"text-xs text-muted-foreground mb-3\" data-testid={`office-rating-${office.id}`}>\n                    {office.rating} ({office.reviews} {t.landing.reviews})\n                  </p>\n                  \n                  <Link href={`/office/${office.slug}`}>\n                    <Button \n                      size=\"sm\" \n                      className=\"w-full\"\n                      data-testid={`button-view-${office.id}`}\n                    >\n                      {t.landing.viewOffice}\n                    </Button>\n                  </Link>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n\n          {filteredOffices.length === 0 && (\n            <Card className=\"p-8 text-center\">\n              <Building2 className=\"h-12 w-12 mx-auto text-muted-foreground opacity-50 mb-2\" />\n              <p className=\"text-muted-foreground\">{t.landing.noOfficesMatch}</p>\n            </Card>\n          )}\n        </section>\n\n        <section className=\"py-8\">\n          <Card className=\"p-6 md:p-8 bg-primary text-primary-foreground text-center\">\n            <h2 className=\"text-2xl md:text-3xl font-bold mb-3\">{t.landing.readyToStart}</h2>\n            <p className=\"text-primary-foreground/80 mb-6 max-w-xl mx-auto\">\n              {t.landing.readyToStartDesc}\n            </p>\n            <Button \n              size=\"lg\" \n              variant=\"secondary\" \n              onClick={() => handleLogin()}\n              data-testid=\"button-sign-in-cta\"\n            >\n              {t.landing.signInNow}\n              <ArrowRight className={`h-4 w-4 ${isRTL ? 'mr-2 rotate-180' : 'ml-2'}`} />\n            </Button>\n          </Card>\n        </section>\n      </main>\n\n      <footer className=\"border-t bg-muted/50 py-8\">\n        <div className=\"container mx-auto px-4 text-center text-muted-foreground\">\n          <p>&copy; {new Date().getFullYear()} CloudOffice. {t.landing.allRightsReserved}</p>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","path":null,"size_bytes":29641,"size_tokens":null},"client/src/components/ChatMessage.tsx":{"content":"import { UserAvatar } from \"./UserAvatar\";\nimport { cn } from \"@/lib/utils\";\n\ninterface ChatMessageProps {\n  id: string;\n  sender: { name: string; avatar?: string | null };\n  content: string;\n  timestamp: string;\n  isOwn?: boolean;\n}\n\nexport function ChatMessage({ id, sender, content, timestamp, isOwn }: ChatMessageProps) {\n  return (\n    <div\n      className={cn(\"flex gap-2 max-w-[80%]\", isOwn && \"ml-auto flex-row-reverse\")}\n      data-testid={`message-${id}`}\n    >\n      {!isOwn && <UserAvatar name={sender.name} avatar={sender.avatar} size=\"sm\" />}\n      <div>\n        <div\n          className={cn(\n            \"px-3 py-2 rounded-lg\",\n            isOwn ? \"bg-primary text-primary-foreground\" : \"bg-muted\"\n          )}\n        >\n          <p className=\"text-sm\">{content}</p>\n        </div>\n        <p className={cn(\"text-xs text-muted-foreground mt-1\", isOwn && \"text-right\")}>\n          {timestamp}\n        </p>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":952,"size_tokens":null},"client/src/components/examples/ChatInput.tsx":{"content":"import { ChatInput } from \"../ChatInput\";\n\nexport default function ChatInputExample() {\n  return (\n    <div className=\"max-w-md border rounded-md\">\n      <ChatInput onSend={(msg) => console.log(\"Send:\", msg)} />\n    </div>\n  );\n}\n","path":null,"size_bytes":230,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/contexts/ThemeContext.tsx":{"content":"import { createContext, useContext, useState, useEffect, type ReactNode } from \"react\";\n\ntype Theme = \"light\" | \"dark\";\n\ninterface ThemeContextType {\n  theme: Theme;\n  toggleTheme: () => void;\n}\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\nexport function ThemeProvider({ children }: { children: ReactNode }) {\n  const [theme, setTheme] = useState<Theme>(() => {\n    if (typeof window !== \"undefined\") {\n      const stored = localStorage.getItem(\"theme\") as Theme;\n      if (stored) return stored;\n      return window.matchMedia(\"(prefers-color-scheme: dark)\").matches ? \"dark\" : \"light\";\n    }\n    return \"light\";\n  });\n\n  useEffect(() => {\n    const root = document.documentElement;\n    root.classList.remove(\"light\", \"dark\");\n    root.classList.add(theme);\n    localStorage.setItem(\"theme\", theme);\n  }, [theme]);\n\n  const toggleTheme = () => {\n    setTheme(prev => prev === \"light\" ? \"dark\" : \"light\");\n  };\n\n  return (\n    <ThemeContext.Provider value={{ theme, toggleTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (!context) {\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":1255,"size_tokens":null},"client/src/index.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');\n\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* MODERN DARK THEME - CloudOffice */\n:root {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  \n  /* Deep charcoal backgrounds */\n  --background: 222 47% 6%;\n  --foreground: 210 40% 96%;\n  \n  /* Borders with subtle visibility */\n  --border: 217 32% 17%;\n  \n  /* Card - Glass effect base */\n  --card: 222 47% 9%;\n  --card-foreground: 210 40% 96%;\n  --card-border: 217 32% 15%;\n  \n  /* Sidebar - Darker glass */\n  --sidebar: 222 47% 7%;\n  --sidebar-foreground: 210 40% 96%;\n  --sidebar-border: 217 32% 12%;\n  --sidebar-primary: 187 92% 43%;\n  --sidebar-primary-foreground: 222 47% 6%;\n  --sidebar-accent: 217 32% 14%;\n  --sidebar-accent-foreground: 210 40% 96%;\n  --sidebar-ring: 187 92% 43%;\n  \n  /* Popover */\n  --popover: 222 47% 10%;\n  --popover-foreground: 210 40% 96%;\n  --popover-border: 217 32% 18%;\n  \n  /* Primary - Cyan accent */\n  --primary: 187 92% 43%;\n  --primary-foreground: 222 47% 6%;\n  \n  /* Secondary */\n  --secondary: 217 32% 15%;\n  --secondary-foreground: 210 40% 96%;\n  \n  /* Muted */\n  --muted: 217 32% 13%;\n  --muted-foreground: 215 20% 55%;\n  \n  /* Accent - Teal */\n  --accent: 173 80% 35%;\n  --accent-foreground: 210 40% 96%;\n  \n  /* Destructive */\n  --destructive: 0 84% 60%;\n  --destructive-foreground: 210 40% 98%;\n  \n  /* Input */\n  --input: 217 32% 20%;\n  \n  /* Ring - Cyan glow */\n  --ring: 187 92% 43%;\n  \n  /* Charts - Vibrant colors */\n  --chart-1: 187 92% 50%;\n  --chart-2: 173 80% 45%;\n  --chart-3: 43 96% 56%;\n  --chart-4: 280 65% 60%;\n  --chart-5: 340 82% 52%;\n  \n  /* Typography */\n  --font-sans: 'Inter', system-ui, -apple-system, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: 'JetBrains Mono', Menlo, monospace;\n  \n  /* Radius */\n  --radius: 0.75rem;\n  \n  /* Shadows with cyan glow */\n  --shadow-2xs: 0 1px 2px rgba(0, 0, 0, 0.3);\n  --shadow-xs: 0 1px 3px rgba(0, 0, 0, 0.4);\n  --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.3), 0 1px 2px rgba(0, 0, 0, 0.2);\n  --shadow: 0 4px 6px rgba(0, 0, 0, 0.3), 0 2px 4px rgba(0, 0, 0, 0.2);\n  --shadow-md: 0 6px 10px rgba(0, 0, 0, 0.3), 0 3px 6px rgba(0, 0, 0, 0.2);\n  --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.4), 0 6px 6px rgba(0, 0, 0, 0.2);\n  --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.4), 0 10px 10px rgba(0, 0, 0, 0.2);\n  --shadow-2xl: 0 25px 50px rgba(0, 0, 0, 0.5);\n  \n  /* Glow effects */\n  --glow-cyan: 0 0 20px rgba(6, 182, 212, 0.3);\n  --glow-cyan-strong: 0 0 30px rgba(6, 182, 212, 0.5);\n  --glow-teal: 0 0 20px rgba(20, 184, 166, 0.3);\n  \n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Border fallbacks */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --primary-border: hsl(var(--primary));\n  --secondary-border: hsl(var(--secondary));\n  --muted-border: hsl(var(--muted));\n  --accent-border: hsl(var(--accent));\n  --destructive-border: hsl(var(--destructive));\n}\n\n/* Light mode - rarely used, still available */\n.light {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 0 0% 100%;\n  --foreground: 222 47% 11%;\n  --border: 214 32% 91%;\n  --card: 0 0% 100%;\n  --card-foreground: 222 47% 11%;\n  --card-border: 214 32% 91%;\n  --sidebar: 210 40% 98%;\n  --sidebar-foreground: 222 47% 11%;\n  --sidebar-border: 214 32% 91%;\n  --sidebar-primary: 187 92% 43%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 210 40% 96%;\n  --sidebar-accent-foreground: 222 47% 11%;\n  --sidebar-ring: 187 92% 43%;\n  --popover: 0 0% 100%;\n  --popover-foreground: 222 47% 11%;\n  --popover-border: 214 32% 91%;\n  --primary: 187 92% 43%;\n  --primary-foreground: 0 0% 100%;\n  --secondary: 210 40% 96%;\n  --secondary-foreground: 222 47% 11%;\n  --muted: 210 40% 96%;\n  --muted-foreground: 215 16% 47%;\n  --accent: 173 80% 40%;\n  --accent-foreground: 0 0% 100%;\n  --destructive: 0 84% 60%;\n  --destructive-foreground: 0 0% 100%;\n  --input: 214 32% 91%;\n  --ring: 187 92% 43%;\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  html {\n    @apply scroll-smooth;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n    font-feature-settings: \"cv11\", \"ss01\";\n    font-variation-settings: \"opsz\" 32;\n  }\n\n  /* Custom scrollbar for dark theme */\n  ::-webkit-scrollbar {\n    width: 8px;\n    height: 8px;\n  }\n\n  ::-webkit-scrollbar-track {\n    background: hsl(var(--background));\n  }\n\n  ::-webkit-scrollbar-thumb {\n    background: hsl(var(--muted));\n    border-radius: 4px;\n  }\n\n  ::-webkit-scrollbar-thumb:hover {\n    background: hsl(var(--muted-foreground) / 0.5);\n  }\n}\n\n@layer components {\n  /* Glass morphism card */\n  .glass {\n    @apply bg-card/40 backdrop-blur-xl border border-white/10;\n  }\n\n  .glass-strong {\n    @apply bg-card/60 backdrop-blur-2xl border border-white/15;\n  }\n\n  /* Gradient text */\n  .gradient-text {\n    @apply bg-gradient-to-r from-cyan-400 to-teal-400 bg-clip-text text-transparent;\n  }\n\n  /* Glow effects */\n  .glow {\n    box-shadow: var(--glow-cyan);\n  }\n\n  .glow-strong {\n    box-shadow: var(--glow-cyan-strong);\n  }\n\n  .glow-teal {\n    box-shadow: var(--glow-teal);\n  }\n\n  /* Animated gradient border */\n  .gradient-border {\n    position: relative;\n  }\n\n  .gradient-border::before {\n    content: \"\";\n    position: absolute;\n    inset: 0;\n    border-radius: inherit;\n    padding: 1px;\n    background: linear-gradient(135deg, hsl(var(--primary)), hsl(var(--accent)));\n    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);\n    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);\n    -webkit-mask-composite: xor;\n    mask-composite: exclude;\n    pointer-events: none;\n  }\n\n  /* Hover glow effect */\n  .hover-glow {\n    @apply transition-shadow duration-300;\n  }\n\n  .hover-glow:hover {\n    box-shadow: var(--glow-cyan);\n  }\n\n  /* Status indicators */\n  .status-online {\n    @apply bg-emerald-500;\n    box-shadow: 0 0 8px rgba(16, 185, 129, 0.6);\n  }\n\n  .status-away {\n    @apply bg-amber-500;\n    box-shadow: 0 0 8px rgba(245, 158, 11, 0.6);\n  }\n\n  .status-offline {\n    @apply bg-slate-500;\n  }\n\n  /* Pulse animation for notifications */\n  .pulse-glow {\n    animation: pulse-glow 2s infinite;\n  }\n\n  @keyframes pulse-glow {\n    0%, 100% {\n      box-shadow: 0 0 5px rgba(6, 182, 212, 0.4);\n    }\n    50% {\n      box-shadow: 0 0 20px rgba(6, 182, 212, 0.8);\n    }\n  }\n\n  /* Shimmer loading effect */\n  .shimmer {\n    @apply relative overflow-hidden;\n  }\n\n  .shimmer::after {\n    content: \"\";\n    position: absolute;\n    inset: 0;\n    background: linear-gradient(\n      90deg,\n      transparent,\n      rgba(255, 255, 255, 0.05),\n      transparent\n    );\n    animation: shimmer 2s infinite;\n  }\n\n  @keyframes shimmer {\n    0% {\n      transform: translateX(-100%);\n    }\n    100% {\n      transform: translateX(100%);\n    }\n  }\n\n  /* Hero gradient overlay */\n  .hero-gradient {\n    @apply bg-gradient-to-b from-transparent via-background/50 to-background;\n  }\n\n  /* Sidebar active indicator */\n  .sidebar-active-indicator {\n    @apply relative;\n  }\n\n  .sidebar-active-indicator::before {\n    content: \"\";\n    position: absolute;\n    left: 0;\n    top: 50%;\n    transform: translateY(-50%);\n    width: 3px;\n    height: 60%;\n    border-radius: 0 2px 2px 0;\n    background: hsl(var(--primary));\n    box-shadow: var(--glow-cyan);\n  }\n\n  /* KPI card */\n  .kpi-card {\n    @apply glass rounded-xl p-6 hover-glow transition-all duration-300;\n  }\n\n  .kpi-value {\n    @apply text-4xl font-bold gradient-text;\n  }\n\n  /* Input focus glow */\n  .input-glow:focus {\n    box-shadow: 0 0 0 2px hsl(var(--background)), 0 0 0 4px hsl(var(--primary) / 0.3);\n  }\n}\n\n@layer utilities {\n  /* Hide ugly search cancel button in Chrome */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* Elevation escape hatches */\n  .no-default-hover-elevate {}\n  .no-default-active-elevate {}\n\n  /* Toggle elevation system */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    border-radius: inherit;\n    z-index: -1;\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Hover/Active elevation */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    border-radius: inherit;\n    z-index: 999;\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after {\n    inset: -1px;\n  }\n\n  /* Fade in animation */\n  .fade-in {\n    animation: fadeIn 0.3s ease-out;\n  }\n\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n      transform: translateY(10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n\n  /* Slide in from left */\n  .slide-in-left {\n    animation: slideInLeft 0.3s ease-out;\n  }\n\n  @keyframes slideInLeft {\n    from {\n      opacity: 0;\n      transform: translateX(-20px);\n    }\n    to {\n      opacity: 1;\n      transform: translateX(0);\n    }\n  }\n\n  /* Scale in */\n  .scale-in {\n    animation: scaleIn 0.2s ease-out;\n  }\n\n  @keyframes scaleIn {\n    from {\n      opacity: 0;\n      transform: scale(0.95);\n    }\n    to {\n      opacity: 1;\n      transform: scale(1);\n    }\n  }\n\n  /* Text balance for better headlines */\n  .text-balance {\n    text-wrap: balance;\n  }\n\n  /* Hide scrollbar but keep functionality */\n  .scrollbar-hide {\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n  }\n\n  .scrollbar-hide::-webkit-scrollbar {\n    display: none;\n  }\n\n  /* Truncate multiline */\n  .line-clamp-2 {\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n  }\n\n  .line-clamp-3 {\n    display: -webkit-box;\n    -webkit-line-clamp: 3;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n  }\n}\n","path":null,"size_bytes":11387,"size_tokens":null},"client/src/pages/Dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { \n  Building2, \n  Users, \n  TrendingUp,\n  TrendingDown,\n  CheckCircle2,\n  AlertCircle,\n  Calendar,\n  DollarSign,\n  Briefcase,\n  TicketCheck,\n  ArrowRight,\n  Target,\n  BarChart3,\n  PieChart,\n  Activity,\n  Layers,\n  Zap,\n  Clock,\n  Sparkles,\n} from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport type { Task, Ticket, Meeting, Transaction, Department, User } from \"@shared/schema\";\nimport { useState } from \"react\";\nimport { StatusVideoRecorder, FloatingVideoButton } from \"@/components/StatusVideoRecorder\";\nimport { StatusStoriesRow } from \"@/components/StatusViewer\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\nimport { \n  BarChart, \n  Bar, \n  XAxis, \n  YAxis, \n  CartesianGrid, \n  Tooltip, \n  ResponsiveContainer,\n  PieChart as RechartsPieChart,\n  Pie,\n  Cell,\n  Legend,\n  AreaChart,\n  Area,\n} from \"recharts\";\n\nconst departmentIcons: Record<string, typeof Briefcase> = {\n  briefcase: Briefcase,\n  calculator: DollarSign,\n  users: Users,\n  hearthandshake: Users,\n};\n\nconst departmentColors: Record<string, string> = {\n  blue: \"from-blue-500 to-blue-600\",\n  green: \"from-emerald-500 to-emerald-600\",\n  purple: \"from-purple-500 to-purple-600\",\n  orange: \"from-orange-500 to-orange-600\",\n  red: \"from-red-500 to-red-600\",\n  pink: \"from-pink-500 to-pink-600\",\n  yellow: \"from-amber-500 to-amber-600\",\n  cyan: \"from-cyan-500 to-cyan-600\",\n};\n\nconst priorityColors: Record<string, string> = {\n  high: \"text-red-400 bg-red-500/10 border-red-500/20\",\n  medium: \"text-amber-400 bg-amber-500/10 border-amber-500/20\",\n  low: \"text-emerald-400 bg-emerald-500/10 border-emerald-500/20\",\n};\n\nconst statusColors: Record<string, string> = {\n  pending: \"bg-amber-500/10 text-amber-400 border-amber-500/20\",\n  in_progress: \"bg-cyan-500/10 text-cyan-400 border-cyan-500/20\",\n  completed: \"bg-emerald-500/10 text-emerald-400 border-emerald-500/20\",\n  cancelled: \"bg-muted text-muted-foreground\",\n};\n\nexport default function Dashboard() {\n  const [videoRecorderOpen, setVideoRecorderOpen] = useState(false);\n  const { language } = useLanguage();\n  const t = translations[language];\n\n  const { data: currentUser } = useQuery<User>({\n    queryKey: [\"/api/auth/user\"],\n  });\n\n  const { data: tasks = [], isLoading: tasksLoading } = useQuery<Task[]>({\n    queryKey: [\"/api/tasks\"],\n  });\n\n  const { data: tickets = [], isLoading: ticketsLoading } = useQuery<Ticket[]>({\n    queryKey: [\"/api/tickets\"],\n  });\n\n  const { data: meetings = [], isLoading: meetingsLoading } = useQuery<Meeting[]>({\n    queryKey: [\"/api/meetings\"],\n  });\n\n  const { data: transactions = [], isLoading: transactionsLoading } = useQuery<Transaction[]>({\n    queryKey: [\"/api/transactions\"],\n  });\n\n  const { data: users = [] } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const { data: departments = [], isLoading: departmentsLoading } = useQuery<Department[]>({\n    queryKey: [\"/api/departments\"],\n  });\n\n  const pendingTasks = tasks.filter(t => t.status === \"pending\").length;\n  const inProgressTasks = tasks.filter(t => t.status === \"in_progress\").length;\n  const completedTasks = tasks.filter(t => t.status === \"completed\").length;\n  const totalTasks = tasks.length;\n  const taskCompletionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;\n\n  const openTickets = tickets.filter(t => t.status === \"open\").length;\n  const resolvedTickets = tickets.filter(t => t.status === \"resolved\" || t.status === \"closed\").length;\n\n  const upcomingMeetings = meetings.filter(m => new Date(m.startTime) > new Date()).length;\n\n  const totalRevenue = transactions.filter(t => t.type === \"income\").reduce((acc, t) => acc + (t.amount || 0), 0);\n  const totalExpenses = transactions.filter(t => t.type === \"expense\").reduce((acc, t) => acc + Math.abs(t.amount || 0), 0);\n  const netBalance = totalRevenue - totalExpenses;\n\n  const taskStatusData = [\n    { name: t.dashboard?.Pending || \"Pending\", value: pendingTasks, fill: \"#f59e0b\" },\n    { name: t.dashboard?.inProgress || \"In Progress\", value: inProgressTasks, fill: \"#06b6d4\" },\n    { name: t.dashboard?.Completed || \"Completed\", value: completedTasks, fill: \"#10b981\" },\n  ].filter(d => d.value > 0);\n\n  const [activityPeriod, setActivityPeriod] = useState<'weekly' | 'monthly' | 'yearly'>('weekly');\n\n  const weeklyActivityData = [\n    { day: language === 'ar' ? \"\" : \"Mon\", tasks: 4, tickets: 2 },\n    { day: language === 'ar' ? \"\" : \"Tue\", tasks: 6, tickets: 3 },\n    { day: language === 'ar' ? \"\" : \"Wed\", tasks: 8, tickets: 1 },\n    { day: language === 'ar' ? \"\" : \"Thu\", tasks: 5, tickets: 4 },\n    { day: language === 'ar' ? \"\" : \"Fri\", tasks: 7, tickets: 2 },\n    { day: language === 'ar' ? \"\" : \"Sat\", tasks: 2, tickets: 0 },\n    { day: language === 'ar' ? \"\" : \"Sun\", tasks: 1, tickets: 1 },\n  ];\n\n  const monthlyActivityData = [\n    { day: language === 'ar' ? \" 1\" : \"Week 1\", tasks: 25, tickets: 12 },\n    { day: language === 'ar' ? \" 2\" : \"Week 2\", tasks: 32, tickets: 18 },\n    { day: language === 'ar' ? \" 3\" : \"Week 3\", tasks: 28, tickets: 15 },\n    { day: language === 'ar' ? \" 4\" : \"Week 4\", tasks: 35, tickets: 20 },\n  ];\n\n  const yearlyActivityData = [\n    { day: language === 'ar' ? \"\" : \"Jan\", tasks: 120, tickets: 45 },\n    { day: language === 'ar' ? \"\" : \"Feb\", tasks: 98, tickets: 38 },\n    { day: language === 'ar' ? \"\" : \"Mar\", tasks: 145, tickets: 52 },\n    { day: language === 'ar' ? \"\" : \"Apr\", tasks: 132, tickets: 48 },\n    { day: language === 'ar' ? \"\" : \"May\", tasks: 156, tickets: 61 },\n    { day: language === 'ar' ? \"\" : \"Jun\", tasks: 142, tickets: 55 },\n    { day: language === 'ar' ? \"\" : \"Jul\", tasks: 168, tickets: 72 },\n    { day: language === 'ar' ? \"\" : \"Aug\", tasks: 175, tickets: 68 },\n    { day: language === 'ar' ? \"\" : \"Sep\", tasks: 158, tickets: 58 },\n    { day: language === 'ar' ? \"\" : \"Oct\", tasks: 182, tickets: 75 },\n    { day: language === 'ar' ? \"\" : \"Nov\", tasks: 195, tickets: 82 },\n    { day: language === 'ar' ? \"\" : \"Dec\", tasks: 210, tickets: 90 },\n  ];\n\n  const getActivityData = () => {\n    switch (activityPeriod) {\n      case 'monthly': return monthlyActivityData;\n      case 'yearly': return yearlyActivityData;\n      default: return weeklyActivityData;\n    }\n  };\n\n  const getActivityTitle = () => {\n    switch (activityPeriod) {\n      case 'monthly': return language === 'ar' ? \" \" : \"Monthly Activity\";\n      case 'yearly': return language === 'ar' ? \" \" : \"Yearly Activity\";\n      default: return t.dashboard?.weeklyActivity || \"Weekly Activity\";\n    }\n  };\n\n  const kpis = [\n    { \n      label: t.dashboard?.taskCompletion || \"Task Completion\", \n      value: `${taskCompletionRate}%`, \n      icon: Target, \n      trend: completedTasks > 0 ? `${completedTasks} ${t.dashboard?.completed || \"completed\"}` : (t.tasks?.noTasksYet || \"No tasks yet\"),\n      trendUp: taskCompletionRate >= 50,\n      gradient: \"from-cyan-500 to-teal-500\",\n      iconBg: \"bg-cyan-500/10\",\n    },\n    { \n      label: t.dashboard?.activeTasks || \"Active Tasks\", \n      value: inProgressTasks.toString(), \n      icon: Zap, \n      trend: `${pendingTasks} ${t.dashboard?.pending || \"pending\"}`,\n      trendUp: null,\n      gradient: \"from-blue-500 to-indigo-500\",\n      iconBg: \"bg-blue-500/10\",\n    },\n    { \n      label: t.dashboard?.openTickets || \"Open Tickets\", \n      value: openTickets.toString(), \n      icon: TicketCheck, \n      trend: resolvedTickets > 0 ? `${resolvedTickets} ${t.dashboard?.resolved || \"resolved\"}` : (t.tickets?.noTicketsYet || \"No tickets yet\"),\n      trendUp: openTickets === 0,\n      gradient: \"from-amber-500 to-orange-500\",\n      iconBg: \"bg-amber-500/10\",\n    },\n    { \n      label: t.dashboard?.teamMembers || \"Team Members\", \n      value: users.length.toString(), \n      icon: Users, \n      trend: t.dashboard?.activeNow || \"Active now\",\n      trendUp: true,\n      gradient: \"from-emerald-500 to-green-500\",\n      iconBg: \"bg-emerald-500/10\",\n    },\n    { \n      label: t.dashboard?.meetings || \"Meetings\", \n      value: upcomingMeetings.toString(), \n      icon: Calendar, \n      trend: t.dashboard?.upcoming || \"Upcoming\",\n      trendUp: null,\n      gradient: \"from-violet-500 to-purple-500\",\n      iconBg: \"bg-violet-500/10\",\n    },\n    { \n      label: t.dashboard?.departments || \"Departments\", \n      value: departments.length.toString(), \n      icon: Building2, \n      trend: t.dashboard?.active || \"Active\",\n      trendUp: departments.length > 0,\n      gradient: \"from-pink-500 to-rose-500\",\n      iconBg: \"bg-pink-500/10\",\n    },\n  ];\n\n  const activeTasks = tasks\n    .filter(t => t.status === \"pending\" || t.status === \"in_progress\")\n    .slice(0, 5);\n\n  const getUserName = (userId: string | null | undefined) => {\n    if (!userId) return \"Unassigned\";\n    const user = users.find(u => u.id === userId);\n    if (!user) return \"Unknown\";\n    return `${user.firstName || ''} ${user.lastName || ''}`.trim() || user.email || \"Unknown\";\n  };\n\n  const isLoading = tasksLoading || ticketsLoading || meetingsLoading || transactionsLoading;\n\n  return (\n    <div className=\"p-6 md:p-8 space-y-8 max-w-7xl mx-auto\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n        <div className=\"space-y-1\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-500 to-teal-500 flex items-center justify-center\">\n              <Sparkles className=\"h-5 w-5 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"text-2xl font-bold tracking-tight\" data-testid=\"text-dashboard-title\">{t.dashboard?.title || \"Dashboard\"}</h1>\n              <p className=\"text-muted-foreground text-sm\">{t.dashboard?.welcomeBack || \"Welcome back to your workspace\"}</p>\n            </div>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-3\">\n          <Badge variant=\"outline\" className=\"gap-2 px-3 py-1.5 border-emerald-500/30 bg-emerald-500/10\">\n            <span className=\"w-2 h-2 rounded-full bg-emerald-500 animate-pulse\" />\n            <span className=\"text-emerald-400 text-xs font-medium\">{t.dashboard?.systemOnline || \"System Online\"}</span>\n          </Badge>\n          <Badge variant=\"outline\" className=\"gap-2 px-3 py-1.5\">\n            <Clock className=\"h-3 w-3\" />\n            <span className=\"text-xs\">{new Date().toLocaleDateString()}</span>\n          </Badge>\n        </div>\n      </div>\n\n      <section className=\"glass rounded-xl p-4 border border-white/5\" data-testid=\"section-stories\">\n        <div className=\"flex items-center gap-2 mb-3\">\n          <h3 className=\"text-sm font-medium text-muted-foreground\">{t.dashboard?.dailyStories || \"Daily Stories\"}</h3>\n        </div>\n        <StatusStoriesRow \n          currentUser={currentUser ? {\n            id: currentUser.id,\n            name: `${currentUser.firstName || ''} ${currentUser.lastName || ''}`.trim() || currentUser.email || 'User',\n            avatar: currentUser.profileImageUrl\n          } : undefined}\n          onAddStory={() => setVideoRecorderOpen(true)}\n        />\n      </section>\n\n      <section className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4\" data-testid=\"section-kpis\">\n        {kpis.map((kpi, index) => (\n          <div \n            key={kpi.label} \n            className=\"glass rounded-xl p-4 hover-glow transition-all duration-300 cursor-pointer group\"\n            data-testid={`kpi-card-${index}`}\n          >\n            <div className=\"flex items-center gap-3 mb-3\">\n              <div className={`p-2 rounded-lg ${kpi.iconBg}`}>\n                <kpi.icon className={`h-4 w-4 bg-gradient-to-r ${kpi.gradient} bg-clip-text text-transparent`} style={{ color: kpi.gradient.includes('cyan') ? '#06b6d4' : kpi.gradient.includes('blue') ? '#3b82f6' : kpi.gradient.includes('amber') ? '#f59e0b' : kpi.gradient.includes('emerald') ? '#10b981' : kpi.gradient.includes('violet') ? '#8b5cf6' : '#ec4899' }} />\n              </div>\n            </div>\n            <div>\n              {isLoading ? (\n                <Skeleton className=\"h-8 w-16 mb-1\" />\n              ) : (\n                <p className={`text-2xl font-bold bg-gradient-to-r ${kpi.gradient} bg-clip-text text-transparent`} data-testid={`kpi-value-${index}`}>\n                  {kpi.value}\n                </p>\n              )}\n              <p className=\"text-xs text-muted-foreground mt-1\">{kpi.label}</p>\n            </div>\n            <div className=\"flex items-center gap-1.5 mt-3 pt-3 border-t border-white/5\">\n              {kpi.trendUp !== null && (\n                kpi.trendUp ? \n                  <TrendingUp className=\"h-3 w-3 text-emerald-400\" /> : \n                  <TrendingDown className=\"h-3 w-3 text-red-400\" />\n              )}\n              <span className=\"text-xs text-muted-foreground\">{kpi.trend}</span>\n            </div>\n          </div>\n        ))}\n      </section>\n\n      <section className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\" data-testid=\"section-analytics\">\n        <Card className=\"lg:col-span-2 glass border-white/5\">\n          <CardHeader className=\"pb-2\">\n            <div className=\"flex items-center justify-between flex-wrap gap-2\">\n              <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n                <div className=\"p-1.5 rounded-lg bg-cyan-500/10\">\n                  <BarChart3 className=\"h-4 w-4 text-cyan-400\" />\n                </div>\n                {getActivityTitle()}\n              </CardTitle>\n              <div className=\"flex gap-1\">\n                <Button \n                  size=\"sm\" \n                  variant={activityPeriod === 'weekly' ? 'default' : 'ghost'}\n                  onClick={() => setActivityPeriod('weekly')}\n                  className=\"h-7 px-2 text-xs\"\n                  data-testid=\"btn-activity-weekly\"\n                >\n                  {language === 'ar' ? '' : 'Weekly'}\n                </Button>\n                <Button \n                  size=\"sm\" \n                  variant={activityPeriod === 'monthly' ? 'default' : 'ghost'}\n                  onClick={() => setActivityPeriod('monthly')}\n                  className=\"h-7 px-2 text-xs\"\n                  data-testid=\"btn-activity-monthly\"\n                >\n                  {language === 'ar' ? '' : 'Monthly'}\n                </Button>\n                <Button \n                  size=\"sm\" \n                  variant={activityPeriod === 'yearly' ? 'default' : 'ghost'}\n                  onClick={() => setActivityPeriod('yearly')}\n                  className=\"h-7 px-2 text-xs\"\n                  data-testid=\"btn-activity-yearly\"\n                >\n                  {language === 'ar' ? '' : 'Yearly'}\n                </Button>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <div className=\"h-64\">\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <AreaChart data={getActivityData()} margin={{ top: 10, right: 10, left: -20, bottom: 0 }}>\n                  <defs>\n                    <linearGradient id=\"tasksGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                      <stop offset=\"5%\" stopColor=\"#06b6d4\" stopOpacity={0.3}/>\n                      <stop offset=\"95%\" stopColor=\"#06b6d4\" stopOpacity={0}/>\n                    </linearGradient>\n                    <linearGradient id=\"ticketsGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                      <stop offset=\"5%\" stopColor=\"#14b8a6\" stopOpacity={0.3}/>\n                      <stop offset=\"95%\" stopColor=\"#14b8a6\" stopOpacity={0}/>\n                    </linearGradient>\n                  </defs>\n                  <CartesianGrid strokeDasharray=\"3 3\" stroke=\"rgba(255,255,255,0.05)\" />\n                  <XAxis dataKey=\"day\" tick={{ fill: '#64748b', fontSize: 12 }} axisLine={false} tickLine={false} />\n                  <YAxis tick={{ fill: '#64748b', fontSize: 12 }} axisLine={false} tickLine={false} />\n                  <Tooltip \n                    contentStyle={{ \n                      backgroundColor: 'hsl(222, 47%, 9%)', \n                      border: '1px solid rgba(255,255,255,0.1)',\n                      borderRadius: '12px',\n                      boxShadow: '0 4px 20px rgba(0,0,0,0.5)'\n                    }}\n                    labelStyle={{ color: '#f1f5f9' }}\n                  />\n                  <Area \n                    type=\"monotone\" \n                    dataKey=\"tasks\" \n                    name=\"Tasks\" \n                    stroke=\"#06b6d4\" \n                    strokeWidth={2}\n                    fill=\"url(#tasksGradient)\" \n                  />\n                  <Area \n                    type=\"monotone\" \n                    dataKey=\"tickets\" \n                    name=\"Tickets\" \n                    stroke=\"#14b8a6\" \n                    strokeWidth={2}\n                    fill=\"url(#ticketsGradient)\" \n                  />\n                </AreaChart>\n              </ResponsiveContainer>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"glass border-white/5\">\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n              <div className=\"p-1.5 rounded-lg bg-teal-500/10\">\n                <PieChart className=\"h-4 w-4 text-teal-400\" />\n              </div>\n              {t.dashboard?.taskDistribution || \"Task Distribution\"}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"h-48\">\n              {taskStatusData.length > 0 ? (\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <RechartsPieChart>\n                    <Pie\n                      data={taskStatusData}\n                      cx=\"50%\"\n                      cy=\"50%\"\n                      innerRadius={45}\n                      outerRadius={70}\n                      paddingAngle={4}\n                      dataKey=\"value\"\n                      stroke=\"none\"\n                    >\n                      {taskStatusData.map((entry, index) => (\n                        <Cell key={`cell-${index}`} fill={entry.fill} />\n                      ))}\n                    </Pie>\n                    <Tooltip \n                      contentStyle={{ \n                        backgroundColor: 'hsl(222, 47%, 9%)', \n                        border: '1px solid rgba(255,255,255,0.1)',\n                        borderRadius: '12px'\n                      }} \n                    />\n                  </RechartsPieChart>\n                </ResponsiveContainer>\n              ) : (\n                <div className=\"h-full flex items-center justify-center text-muted-foreground\">\n                  <div className=\"text-center\">\n                    <Layers className=\"h-10 w-10 mx-auto mb-2 opacity-30\" />\n                    <p className=\"text-sm\">{t.dashboard?.noTaskData || \"No task data yet\"}</p>\n                  </div>\n                </div>\n              )}\n            </div>\n            <div className=\"flex flex-wrap justify-center gap-4 mt-4\">\n              {taskStatusData.map((item) => (\n                <div key={item.name} className=\"flex items-center gap-2 text-xs\">\n                  <div className=\"w-3 h-3 rounded-full\" style={{ backgroundColor: item.fill }} />\n                  <span className=\"text-muted-foreground\">{item.name}</span>\n                  <span className=\"font-semibold\">{item.value}</span>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      </section>\n\n      <section className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\" data-testid=\"section-projects\">\n        <Card className=\"glass border-white/5\">\n          <CardHeader className=\"pb-2\">\n            <div className=\"flex items-center justify-between gap-2\">\n              <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n                <div className=\"p-1.5 rounded-lg bg-blue-500/10\">\n                  <Briefcase className=\"h-4 w-4 text-blue-400\" />\n                </div>\n                {t.dashboard?.activeTasks || \"Active Tasks\"}\n              </CardTitle>\n              <Link href=\"/tasks\">\n                <Button variant=\"ghost\" size=\"sm\" className=\"text-xs hover:bg-white/5\" data-testid=\"link-view-all-tasks\">\n                  {t.dashboard?.viewAll || \"View all\"} <ArrowRight className=\"h-3 w-3 ml-1\" />\n                </Button>\n              </Link>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {tasksLoading ? (\n              Array(3).fill(0).map((_, i) => (\n                <Skeleton key={i} className=\"h-16 w-full\" />\n              ))\n            ) : activeTasks.length > 0 ? (\n              activeTasks.map((task) => (\n                <div\n                  key={task.id}\n                  className=\"flex items-center gap-3 p-3 rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 transition-colors cursor-pointer\"\n                  data-testid={`task-item-${task.id}`}\n                >\n                  <div className={`p-2 rounded-lg border ${priorityColors[task.priority || 'medium']}`}>\n                    {task.priority === 'high' ? (\n                      <AlertCircle className=\"h-4 w-4\" />\n                    ) : (\n                      <CheckCircle2 className=\"h-4 w-4\" />\n                    )}\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <p className=\"font-medium text-sm truncate\">{task.title}</p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {getUserName(task.assigneeId)}\n                    </p>\n                  </div>\n                  <Badge variant=\"outline\" className={`text-xs border ${statusColors[task.status || 'pending']}`}>\n                    {task.status === 'in_progress' ? 'In Progress' : (task.status || 'pending').charAt(0).toUpperCase() + (task.status || 'pending').slice(1)}\n                  </Badge>\n                </div>\n              ))\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Briefcase className=\"h-10 w-10 mx-auto mb-3 opacity-30\" />\n                <p className=\"text-sm\">{t.dashboard?.noActiveTasks || \"No active tasks\"}</p>\n                <Link href=\"/tasks\">\n                  <Button variant=\"outline\" size=\"sm\" className=\"mt-4\" data-testid=\"button-create-task\">\n                    {t.dashboard?.createTask || \"Create a task\"}\n                  </Button>\n                </Link>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card className=\"glass border-white/5\">\n          <CardHeader className=\"pb-2\">\n            <div className=\"flex items-center justify-between gap-2\">\n              <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n                <div className=\"p-1.5 rounded-lg bg-emerald-500/10\">\n                  <DollarSign className=\"h-4 w-4 text-emerald-400\" />\n                </div>\n                {t.dashboard?.financialOverview || \"Financial Overview\"}\n              </CardTitle>\n              <Link href=\"/finances\">\n                <Button variant=\"ghost\" size=\"sm\" className=\"text-xs hover:bg-white/5\" data-testid=\"link-view-finance\">\n                  {t.dashboard?.details || \"Details\"} <ArrowRight className=\"h-3 w-3 ml-1\" />\n                </Button>\n              </Link>\n            </div>\n          </CardHeader>\n          <CardContent>\n            {transactionsLoading ? (\n              <div className=\"space-y-3\">\n                <Skeleton className=\"h-20 w-full\" />\n                <Skeleton className=\"h-20 w-full\" />\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-3\">\n                  <div className=\"p-4 rounded-xl bg-emerald-500/10 border border-emerald-500/20\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <TrendingUp className=\"h-4 w-4 text-emerald-400\" />\n                      <p className=\"text-xs text-emerald-400\">{t.dashboard?.revenue || \"Revenue\"}</p>\n                    </div>\n                    <p className=\"text-xl font-bold text-emerald-400\" data-testid=\"text-revenue\">\n                      ${(totalRevenue / 100).toLocaleString()}\n                    </p>\n                  </div>\n                  <div className=\"p-4 rounded-xl bg-red-500/10 border border-red-500/20\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <TrendingDown className=\"h-4 w-4 text-red-400\" />\n                      <p className=\"text-xs text-red-400\">{t.dashboard?.expenses || \"Expenses\"}</p>\n                    </div>\n                    <p className=\"text-xl font-bold text-red-400\" data-testid=\"text-expenses\">\n                      ${(totalExpenses / 100).toLocaleString()}\n                    </p>\n                  </div>\n                </div>\n                <div className=\"p-4 rounded-xl bg-white/5 border border-white/10\">\n                  <div className=\"flex items-center justify-between mb-3\">\n                    <p className=\"text-sm font-medium\">{t.dashboard?.netBalance || \"Net Balance\"}</p>\n                    {netBalance >= 0 ? (\n                      <Badge variant=\"outline\" className=\"bg-emerald-500/10 text-emerald-400 border-emerald-500/30\">\n                        {t.dashboard?.profitable || \"Profitable\"}\n                      </Badge>\n                    ) : (\n                      <Badge variant=\"outline\" className=\"bg-red-500/10 text-red-400 border-red-500/30\">\n                        {t.dashboard?.loss || \"Loss\"}\n                      </Badge>\n                    )}\n                  </div>\n                  <p className={`text-2xl font-bold ${netBalance >= 0 ? 'text-emerald-400' : 'text-red-400'}`} data-testid=\"text-balance\">\n                    ${(Math.abs(netBalance) / 100).toLocaleString()}\n                  </p>\n                  <Progress \n                    value={totalRevenue > 0 ? (totalRevenue / (totalRevenue + totalExpenses)) * 100 : 50} \n                    className=\"mt-3 h-2 bg-white/10\"\n                  />\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </section>\n\n      <section data-testid=\"section-departments\">\n        <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-2.5 rounded-xl bg-gradient-to-br from-violet-500 to-purple-500\">\n              <Building2 className=\"h-5 w-5 text-white\" />\n            </div>\n            <div>\n              <h2 className=\"text-lg font-semibold\">{t.dashboard?.departments || \"Departments\"}</h2>\n              <p className=\"text-sm text-muted-foreground\">\n                {departments.length} {t.dashboard?.departmentsInOrg || \"department(s) in your organization\"}\n              </p>\n            </div>\n          </div>\n          <Link href=\"/departments\">\n            <Button variant=\"outline\" size=\"sm\" className=\"gap-2\" data-testid=\"button-view-all-departments\">\n              {t.dashboard?.viewAll || \"View All\"} <ArrowRight className=\"h-3 w-3\" />\n            </Button>\n          </Link>\n        </div>\n\n        {departmentsLoading ? (\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {Array(3).fill(0).map((_, i) => (\n              <Skeleton key={i} className=\"h-32 w-full\" />\n            ))}\n          </div>\n        ) : departments.length === 0 ? (\n          <Card className=\"glass border-white/5 p-8 text-center\" data-testid=\"card-no-departments\">\n            <Building2 className=\"h-12 w-12 mx-auto text-muted-foreground opacity-30 mb-3\" />\n            <p className=\"text-muted-foreground mb-1\">{t.dashboard?.noDepartments || \"No departments yet\"}</p>\n            <p className=\"text-xs text-muted-foreground mb-4\">\n              {t.dashboard?.createDepartment || \"Create a department to organize your team\"}\n            </p>\n            <Link href=\"/departments\">\n              <Button data-testid=\"button-create-department\">\n                {t.dashboard?.addDepartment || \"Add Department\"}\n              </Button>\n            </Link>\n          </Card>\n        ) : (\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {departments.slice(0, 6).map((dept) => {\n              const IconComponent = departmentIcons[dept.icon || \"briefcase\"] || Briefcase;\n              const gradientClass = departmentColors[dept.color || \"blue\"] || departmentColors.blue;\n\n              return (\n                <Link key={dept.id} href={`/departments/${dept.id}`}>\n                  <Card \n                    className=\"glass border-white/5 hover-glow cursor-pointer h-full transition-all duration-300\" \n                    data-testid={`department-card-${dept.id}`}\n                  >\n                    <CardContent className=\"p-5\">\n                      <div className=\"flex items-start gap-4\">\n                        <div className={`p-3 rounded-xl bg-gradient-to-br ${gradientClass} flex-shrink-0`}>\n                          <IconComponent className=\"h-5 w-5 text-white\" />\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-start justify-between gap-2\">\n                            <div>\n                              <h3 className=\"font-semibold\">{dept.name}</h3>\n                              {dept.description && (\n                                <p className=\"text-xs text-muted-foreground mt-1 line-clamp-2\">\n                                  {dept.description}\n                                </p>\n                              )}\n                            </div>\n                            {dept.password && (\n                              <Badge variant=\"outline\" className=\"text-xs border-amber-500/30 text-amber-400\">\n                                Protected\n                              </Badge>\n                            )}\n                          </div>\n                          <div className=\"flex items-center justify-between mt-4 pt-3 border-t border-white/5\">\n                            <div className=\"flex items-center gap-1.5 text-muted-foreground\">\n                              <Users className=\"h-3.5 w-3.5\" />\n                              <span className=\"text-xs\">Team</span>\n                            </div>\n                            <ArrowRight className=\"h-4 w-4 text-muted-foreground\" />\n                          </div>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                </Link>\n              );\n            })}\n          </div>\n        )}\n      </section>\n\n      <FloatingVideoButton onClick={() => setVideoRecorderOpen(true)} />\n      <StatusVideoRecorder \n        open={videoRecorderOpen} \n        onOpenChange={setVideoRecorderOpen} \n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":31651,"size_tokens":null},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(claims: any) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n    status: \"online\",\n    lastSeenAt: new Date(),\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  const registeredStrategies = new Set<string>();\n\n  const ensureStrategy = (domain: string) => {\n    const strategyName = `replitauth:${domain}`;\n    if (!registeredStrategies.has(strategyName)) {\n      const strategy = new Strategy(\n        {\n          name: strategyName,\n          config,\n          scope: \"openid email profile offline_access\",\n          callbackURL: `https://${domain}/api/callback`,\n        },\n        verify,\n      );\n      passport.use(strategy);\n      registeredStrategies.add(strategyName);\n    }\n  };\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", async (req, res) => {\n    const user = req.user as any;\n    if (user?.claims?.sub) {\n      await storage.updateUserStatus(user.claims.sub, \"offline\");\n    }\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","path":null,"size_bytes":4557,"size_tokens":null},"server/storage.ts":{"content":"import {\n  users,\n  tasks,\n  tickets,\n  profiles,\n  followers,\n  posts,\n  postLikes,\n  postComments,\n  chatThreads,\n  chatParticipants,\n  messages,\n  meetings,\n  meetingAttendees,\n  jobPostings,\n  transactions,\n  roles,\n  userRoles,\n  notifications,\n  departments,\n  remoteEmployees,\n  subscriptions,\n  advertisements,\n  n8nSettings,\n  taskAutomations,\n  offices,\n  officeServices,\n  serviceRatings,\n  serviceComments,\n  serviceRequests,\n  officeMedia,\n  officePosts,\n  officeMessages,\n  videoCalls,\n  type User,\n  type UpsertUser,\n  type Task,\n  type InsertTask,\n  type Ticket,\n  type InsertTicket,\n  type Profile,\n  type InsertProfile,\n  type Follower,\n  type Post,\n  type InsertPost,\n  type PostComment,\n  type InsertPostComment,\n  type ChatThread,\n  type InsertChatThread,\n  type Message,\n  type InsertMessage,\n  type Meeting,\n  type InsertMeeting,\n  type JobPosting,\n  type InsertJobPosting,\n  type Transaction,\n  type InsertTransaction,\n  type Role,\n  type InsertRole,\n  type Notification,\n  type InsertNotification,\n  type Department,\n  type InsertDepartment,\n  type RemoteEmployee,\n  type InsertRemoteEmployee,\n  type Subscription,\n  type InsertSubscription,\n  type Advertisement,\n  type InsertAdvertisement,\n  type N8nSettings,\n  type InsertN8nSettings,\n  type TaskAutomation,\n  type InsertTaskAutomation,\n  type Office,\n  type InsertOffice,\n  type OfficeService,\n  type InsertOfficeService,\n  type ServiceRating,\n  type InsertServiceRating,\n  type ServiceComment,\n  type InsertServiceComment,\n  type ServiceRequest,\n  type InsertServiceRequest,\n  type OfficeMedia,\n  type InsertOfficeMedia,\n  type OfficePost,\n  type InsertOfficePost,\n  type OfficeMessage,\n  type InsertOfficeMessage,\n  type VideoCall,\n  type InsertVideoCall,\n  statuses,\n  statusReplies,\n  statusViews,\n  statusLikes,\n  officeFollowers,\n  internalEmails,\n  type Status,\n  type InsertStatus,\n  type StatusReply,\n  type InsertStatusReply,\n  type StatusView,\n  type InsertStatusView,\n  type StatusLike,\n  type InsertStatusLike,\n  type OfficeFollower,\n  type InsertOfficeFollower,\n  type InternalEmail,\n  type InsertInternalEmail,\n  pushSubscriptions,\n  type PushSubscription,\n  type InsertPushSubscription,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, and, or, like, sql, inArray } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // User operations (Required for Replit Auth)\n  getUser(id: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n  getAllUsers(): Promise<User[]>;\n  updateUserStatus(id: string, status: string): Promise<User | undefined>;\n  updateLastSeen(id: string): Promise<void>;\n  updateUser(id: string, data: Partial<UpsertUser>): Promise<User | undefined>;\n\n  // Task operations\n  getTasks(): Promise<Task[]>;\n  getTask(id: number): Promise<Task | undefined>;\n  createTask(task: InsertTask): Promise<Task>;\n  updateTask(id: number, task: Partial<InsertTask>): Promise<Task | undefined>;\n  deleteTask(id: number): Promise<void>;\n  getTasksByAssignee(assigneeId: string): Promise<Task[]>;\n\n  // Ticket operations\n  getTickets(): Promise<Ticket[]>;\n  getTicket(id: number): Promise<Ticket | undefined>;\n  createTicket(ticket: InsertTicket): Promise<Ticket>;\n  updateTicket(id: number, ticket: Partial<InsertTicket>): Promise<Ticket | undefined>;\n  deleteTicket(id: number): Promise<void>;\n\n  // Profile operations\n  getProfile(id: number): Promise<Profile | undefined>;\n  getProfileByOwner(ownerId: string): Promise<Profile | undefined>;\n  createProfile(profile: InsertProfile): Promise<Profile>;\n  updateProfile(id: number, profile: Partial<InsertProfile>): Promise<Profile | undefined>;\n  getOrCreateProfile(ownerId: string): Promise<Profile>;\n  \n  // Follower operations\n  followProfile(profileId: number, followerUserId: string): Promise<void>;\n  unfollowProfile(profileId: number, followerUserId: string): Promise<void>;\n  getFollowerCount(profileId: number): Promise<number>;\n  isFollowing(profileId: number, userId: string): Promise<boolean>;\n  \n  // Profile stats\n  getProfileStats(profileId: number): Promise<{ likes: number; followers: number; videos: number; photos: number }>;\n\n  // Post operations\n  getPosts(): Promise<Post[]>;\n  getPublicPosts(): Promise<Post[]>;\n  getProfilePosts(profileId: number): Promise<Post[]>;\n  getPost(id: number): Promise<Post | undefined>;\n  createPost(post: InsertPost): Promise<Post>;\n  deletePost(id: number): Promise<void>;\n  likePost(postId: number, userId: string): Promise<void>;\n  unlikePost(postId: number, userId: string): Promise<void>;\n  getPostLikes(postId: number): Promise<number>;\n  hasUserLikedPost(postId: number, userId: string): Promise<boolean>;\n  getPostComments(postId: number): Promise<PostComment[]>;\n  addPostComment(comment: InsertPostComment): Promise<PostComment>;\n  getTotalLikesForProfile(profileId: number): Promise<number>;\n\n  // Chat operations (WhatsApp-style)\n  getChatThreads(userId: string): Promise<ChatThread[]>;\n  getChatThread(id: number): Promise<ChatThread | undefined>;\n  createChatThread(thread: InsertChatThread, participantIds: string[], creatorId: string): Promise<ChatThread>;\n  createDirectChat(userId1: string, userId2: string): Promise<ChatThread>;\n  getDirectChatBetweenUsers(userId1: string, userId2: string): Promise<ChatThread | undefined>;\n  getMessages(threadId: number): Promise<Message[]>;\n  createMessage(message: InsertMessage): Promise<Message>;\n  getThreadParticipants(threadId: number): Promise<User[]>;\n  addThreadParticipant(threadId: number, userId: string, isAdmin?: boolean): Promise<void>;\n  removeThreadParticipant(threadId: number, userId: string): Promise<void>;\n  updateThread(threadId: number, data: Partial<InsertChatThread>): Promise<ChatThread | undefined>;\n  getLastMessage(threadId: number): Promise<Message | undefined>;\n  getUnreadCount(threadId: number, userId: string): Promise<number>;\n  markMessagesRead(threadId: number, userId: string): Promise<void>;\n  deleteThread(threadId: number): Promise<void>;\n\n  // Meeting operations\n  getMeetings(): Promise<Meeting[]>;\n  getMeeting(id: number): Promise<Meeting | undefined>;\n  createMeeting(meeting: InsertMeeting, attendeeIds: string[]): Promise<Meeting>;\n  updateMeeting(id: number, meeting: Partial<InsertMeeting>): Promise<Meeting | undefined>;\n  deleteMeeting(id: number): Promise<void>;\n  getMeetingAttendees(meetingId: number): Promise<User[]>;\n\n  // Job posting operations\n  getJobPostings(): Promise<JobPosting[]>;\n  getJobPosting(id: number): Promise<JobPosting | undefined>;\n  createJobPosting(job: InsertJobPosting): Promise<JobPosting>;\n  updateJobPosting(id: number, job: Partial<InsertJobPosting>): Promise<JobPosting | undefined>;\n  deleteJobPosting(id: number): Promise<void>;\n\n  // Transaction operations\n  getTransactions(): Promise<Transaction[]>;\n  getTransaction(id: number): Promise<Transaction | undefined>;\n  createTransaction(transaction: InsertTransaction): Promise<Transaction>;\n  updateTransaction(id: number, transaction: Partial<InsertTransaction>): Promise<Transaction | undefined>;\n  deleteTransaction(id: number): Promise<void>;\n  getPendingTransactions(): Promise<Transaction[]>;\n\n  // Role operations\n  getRoles(): Promise<Role[]>;\n  getRole(id: number): Promise<Role | undefined>;\n  createRole(role: InsertRole): Promise<Role>;\n  updateRole(id: number, role: Partial<InsertRole>): Promise<Role | undefined>;\n  deleteRole(id: number): Promise<void>;\n  getUserRoles(userId: string): Promise<Role[]>;\n  assignRole(userId: string, roleId: number): Promise<void>;\n  removeRole(userId: string, roleId: number): Promise<void>;\n\n  // Notification operations\n  getNotifications(userId: string): Promise<Notification[]>;\n  createNotification(notification: InsertNotification): Promise<Notification>;\n  markNotificationRead(id: number): Promise<void>;\n  markAllNotificationsRead(userId: string): Promise<void>;\n  getUnreadNotificationCount(userId: string): Promise<number>;\n\n  // Department operations (standalone)\n  getDepartments(): Promise<Department[]>;\n  getDepartmentsByManager(managerId: string): Promise<Department[]>;\n  getDepartment(id: number): Promise<Department | undefined>;\n  createDepartment(department: InsertDepartment): Promise<Department>;\n  updateDepartment(id: number, department: Partial<InsertDepartment>): Promise<Department | undefined>;\n  deleteDepartment(id: number): Promise<void>;\n  verifyDepartmentPassword(id: number, password: string): Promise<boolean>;\n\n  // Remote Employee operations\n  getRemoteEmployees(departmentId: number): Promise<RemoteEmployee[]>;\n  getRemoteEmployee(id: number): Promise<RemoteEmployee | undefined>;\n  getRemoteEmployeeByUsername(username: string): Promise<RemoteEmployee | undefined>;\n  createRemoteEmployee(employee: InsertRemoteEmployee): Promise<RemoteEmployee>;\n  updateRemoteEmployee(id: number, employee: Partial<InsertRemoteEmployee>): Promise<RemoteEmployee | undefined>;\n  deleteRemoteEmployee(id: number): Promise<void>;\n\n  // Subscription operations\n  getSubscription(id: number): Promise<Subscription | undefined>;\n  getSubscriptionByUser(userId: string): Promise<Subscription | undefined>;\n  createSubscription(subscription: InsertSubscription): Promise<Subscription>;\n  updateSubscription(id: number, subscription: Partial<InsertSubscription>): Promise<Subscription | undefined>;\n  getActiveSubscription(userId: string): Promise<Subscription | undefined>;\n\n  // Advertisement operations\n  getAdvertisements(): Promise<Advertisement[]>;\n  getActiveAdvertisements(): Promise<Advertisement[]>;\n  getAdvertisementsByUser(userId: string): Promise<Advertisement[]>;\n  getAdvertisement(id: number): Promise<Advertisement | undefined>;\n  createAdvertisement(ad: InsertAdvertisement): Promise<Advertisement>;\n  updateAdvertisement(id: number, ad: Partial<InsertAdvertisement>): Promise<Advertisement | undefined>;\n  deleteAdvertisement(id: number): Promise<void>;\n  incrementAdViews(id: number): Promise<void>;\n  incrementAdClicks(id: number): Promise<void>;\n\n  // n8n Settings operations\n  getN8nSettings(userId: string): Promise<N8nSettings | undefined>;\n  createN8nSettings(settings: InsertN8nSettings): Promise<N8nSettings>;\n  updateN8nSettings(userId: string, settings: Partial<InsertN8nSettings>): Promise<N8nSettings | undefined>;\n\n  // Task Automation operations\n  getTaskAutomations(userId: string): Promise<TaskAutomation[]>;\n  getTaskAutomation(id: number): Promise<TaskAutomation | undefined>;\n  getTaskAutomationByTask(taskId: number): Promise<TaskAutomation | undefined>;\n  createTaskAutomation(automation: InsertTaskAutomation): Promise<TaskAutomation>;\n  updateTaskAutomation(id: number, automation: Partial<InsertTaskAutomation>): Promise<TaskAutomation | undefined>;\n  deleteTaskAutomation(id: number): Promise<void>;\n  getPendingAutomations(userId: string): Promise<TaskAutomation[]>;\n\n  // Office operations (Public Storefront)\n  getPublishedOffices(): Promise<Office[]>;\n  getOffices(ownerId?: string): Promise<Office[]>;\n  getOffice(id: number): Promise<Office | undefined>;\n  getOfficeBySlug(slug: string): Promise<Office | undefined>;\n  createOffice(office: InsertOffice): Promise<Office>;\n  updateOffice(id: number, office: Partial<InsertOffice>): Promise<Office | undefined>;\n  deleteOffice(id: number): Promise<void>;\n\n  // Office Service operations\n  getOfficeServices(officeId: number): Promise<OfficeService[]>;\n  getOfficeService(id: number): Promise<OfficeService | undefined>;\n  createOfficeService(service: InsertOfficeService): Promise<OfficeService>;\n  updateOfficeService(id: number, service: Partial<InsertOfficeService>): Promise<OfficeService | undefined>;\n  deleteOfficeService(id: number): Promise<void>;\n\n  // Service Rating operations\n  getServiceRatings(serviceId: number): Promise<ServiceRating[]>;\n  getServiceAverageRating(serviceId: number): Promise<{ average: number; count: number }>;\n  createServiceRating(rating: InsertServiceRating): Promise<ServiceRating>;\n\n  // Service Comment operations\n  getServiceComments(serviceId: number): Promise<ServiceComment[]>;\n  createServiceComment(comment: InsertServiceComment): Promise<ServiceComment>;\n  updateServiceCommentStatus(id: number, status: string): Promise<ServiceComment | undefined>;\n\n  // Office Media operations\n  getOfficeMedia(officeId: number): Promise<OfficeMedia[]>;\n  getDailyVideos(): Promise<OfficeMedia[]>;\n  getAnnouncements(): Promise<OfficeMedia[]>;\n  createOfficeMedia(media: InsertOfficeMedia): Promise<OfficeMedia>;\n  deleteOfficeMedia(id: number): Promise<void>;\n  incrementMediaViews(id: number): Promise<void>;\n\n  // Office Post operations\n  getOfficePosts(officeId: number): Promise<OfficePost[]>;\n  getAllOfficePosts(): Promise<OfficePost[]>;\n  createOfficePost(post: InsertOfficePost): Promise<OfficePost>;\n  deleteOfficePost(id: number): Promise<void>;\n  likeOfficePost(id: number): Promise<void>;\n\n  // Office Message (Chat) operations\n  getOfficeMessages(officeId: number, sessionId?: string): Promise<OfficeMessage[]>;\n  createOfficeMessage(message: InsertOfficeMessage): Promise<OfficeMessage>;\n  markOfficeMessagesRead(officeId: number, sessionId: string): Promise<void>;\n  getUnreadMessageCount(officeId: number): Promise<number>;\n  \n  // Video Call operations\n  getVideoCall(id: number): Promise<VideoCall | undefined>;\n  getVideoCallByRoom(roomId: string): Promise<VideoCall | undefined>;\n  getVideoCallsByOffice(officeId: number): Promise<VideoCall[]>;\n  getPendingVideoCallsForOffice(officeId: number): Promise<VideoCall[]>;\n  createVideoCall(call: InsertVideoCall): Promise<VideoCall>;\n  updateVideoCall(id: number, data: Partial<InsertVideoCall>): Promise<VideoCall | undefined>;\n  startVideoCall(id: number, receptionistId: string): Promise<VideoCall | undefined>;\n  endVideoCall(id: number): Promise<VideoCall | undefined>;\n\n  // Daily Status (Stories) operations\n  getActiveStatuses(): Promise<Status[]>;\n  getStatus(id: number): Promise<Status | undefined>;\n  getStatusesByAuthor(authorId: string): Promise<Status[]>;\n  getStatusesByOffice(officeId: number): Promise<Status[]>;\n  createStatus(status: InsertStatus): Promise<Status>;\n  deleteStatus(id: number): Promise<void>;\n  incrementStatusViews(id: number): Promise<void>;\n\n  // Status Reply operations\n  getStatusReplies(statusId: number): Promise<StatusReply[]>;\n  createStatusReply(reply: InsertStatusReply): Promise<StatusReply>;\n  markStatusRepliesRead(statusId: number): Promise<void>;\n  getUnreadStatusRepliesCount(authorId: string): Promise<number>;\n\n  // Status View operations\n  getStatusViews(statusId: number): Promise<StatusView[]>;\n  addStatusView(view: InsertStatusView): Promise<StatusView>;\n  hasUserViewedStatus(statusId: number, userId: string): Promise<boolean>;\n\n  // Status Like operations\n  getStatusLike(statusId: number, userId: string): Promise<StatusLike | undefined>;\n  createStatusLike(like: InsertStatusLike): Promise<StatusLike>;\n  deleteStatusLike(statusId: number, userId: string): Promise<boolean>;\n  getStatusLikeCount(statusId: number): Promise<number>;\n  hasUserLikedStatus(statusId: number, userId: string): Promise<boolean>;\n\n  // Office Follow operations\n  followOffice(officeId: number, followerId: string): Promise<OfficeFollower>;\n  unfollowOffice(officeId: number, followerId: string): Promise<void>;\n  isFollowingOffice(officeId: number, userId: string): Promise<boolean>;\n  getOfficeFollowerCount(officeId: number): Promise<number>;\n\n  // Internal Email operations\n  getInboxEmails(userId: string): Promise<InternalEmail[]>;\n  getSentEmails(userId: string): Promise<InternalEmail[]>;\n  getDraftEmails(userId: string): Promise<InternalEmail[]>;\n  getStarredEmails(userId: string): Promise<InternalEmail[]>;\n  getArchivedEmails(userId: string): Promise<InternalEmail[]>;\n  getInternalEmail(id: number): Promise<InternalEmail | undefined>;\n  createInternalEmail(email: InsertInternalEmail): Promise<InternalEmail>;\n  updateInternalEmail(id: number, email: Partial<InsertInternalEmail>): Promise<InternalEmail | undefined>;\n  deleteInternalEmail(id: number): Promise<void>;\n  markEmailAsRead(id: number): Promise<void>;\n  toggleEmailStarred(id: number): Promise<void>;\n  moveEmailToArchive(id: number): Promise<void>;\n  getUnreadEmailCount(userId: string): Promise<number>;\n\n  // Push Subscription operations\n  getPushSubscriptions(userId: string): Promise<PushSubscription[]>;\n  getAllPushSubscriptions(): Promise<PushSubscription[]>;\n  createPushSubscription(subscription: InsertPushSubscription): Promise<PushSubscription>;\n  deletePushSubscription(endpoint: string, userId: string): Promise<void>;\n  deletePushSubscriptionsByUser(userId: string): Promise<void>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // =====================\n  // User Operations\n  // =====================\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    return await db.select().from(users).orderBy(users.firstName);\n  }\n\n  async updateUserStatus(id: string, status: string): Promise<User | undefined> {\n    const [user] = await db\n      .update(users)\n      .set({ status, lastSeenAt: new Date(), updatedAt: new Date() })\n      .where(eq(users.id, id))\n      .returning();\n    return user;\n  }\n\n  async updateLastSeen(id: string): Promise<void> {\n    await db\n      .update(users)\n      .set({ lastSeenAt: new Date(), updatedAt: new Date() })\n      .where(eq(users.id, id));\n  }\n\n  async updateUser(id: string, data: Partial<UpsertUser>): Promise<User | undefined> {\n    const [user] = await db\n      .update(users)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(users.id, id))\n      .returning();\n    return user;\n  }\n\n  // =====================\n  // Task Operations\n  // =====================\n  async getTasks(): Promise<Task[]> {\n    return await db.select().from(tasks).orderBy(desc(tasks.createdAt));\n  }\n\n  async getTask(id: number): Promise<Task | undefined> {\n    const [task] = await db.select().from(tasks).where(eq(tasks.id, id));\n    return task;\n  }\n\n  async createTask(task: InsertTask): Promise<Task> {\n    const [newTask] = await db.insert(tasks).values(task).returning();\n    return newTask;\n  }\n\n  async updateTask(id: number, task: Partial<InsertTask>): Promise<Task | undefined> {\n    const [updated] = await db\n      .update(tasks)\n      .set({ ...task, updatedAt: new Date() })\n      .where(eq(tasks.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteTask(id: number): Promise<void> {\n    await db.delete(tasks).where(eq(tasks.id, id));\n  }\n\n  async getTasksByAssignee(assigneeId: string): Promise<Task[]> {\n    return await db.select().from(tasks).where(eq(tasks.assigneeId, assigneeId));\n  }\n\n  // =====================\n  // Ticket Operations\n  // =====================\n  async getTickets(): Promise<Ticket[]> {\n    return await db.select().from(tickets).orderBy(desc(tickets.createdAt));\n  }\n\n  async getTicket(id: number): Promise<Ticket | undefined> {\n    const [ticket] = await db.select().from(tickets).where(eq(tickets.id, id));\n    return ticket;\n  }\n\n  async createTicket(ticket: InsertTicket): Promise<Ticket> {\n    const [newTicket] = await db.insert(tickets).values(ticket).returning();\n    return newTicket;\n  }\n\n  async updateTicket(id: number, ticket: Partial<InsertTicket>): Promise<Ticket | undefined> {\n    const [updated] = await db\n      .update(tickets)\n      .set({ ...ticket, updatedAt: new Date() })\n      .where(eq(tickets.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteTicket(id: number): Promise<void> {\n    await db.delete(tickets).where(eq(tickets.id, id));\n  }\n\n  // =====================\n  // Profile Operations\n  // =====================\n  async getProfile(id: number): Promise<Profile | undefined> {\n    const [profile] = await db.select().from(profiles).where(eq(profiles.id, id));\n    return profile;\n  }\n\n  async getProfileByOwner(ownerId: string): Promise<Profile | undefined> {\n    const [profile] = await db.select().from(profiles).where(eq(profiles.ownerId, ownerId));\n    return profile;\n  }\n\n  async createProfile(profile: InsertProfile): Promise<Profile> {\n    const [newProfile] = await db.insert(profiles).values(profile).returning();\n    return newProfile;\n  }\n\n  async updateProfile(id: number, profile: Partial<InsertProfile>): Promise<Profile | undefined> {\n    const [updated] = await db\n      .update(profiles)\n      .set({ ...profile, updatedAt: new Date() })\n      .where(eq(profiles.id, id))\n      .returning();\n    return updated;\n  }\n\n  async getOrCreateProfile(ownerId: string): Promise<Profile> {\n    let profile = await this.getProfileByOwner(ownerId);\n    if (!profile) {\n      profile = await this.createProfile({ ownerId });\n    }\n    return profile;\n  }\n\n  // =====================\n  // Follower Operations\n  // =====================\n  async followProfile(profileId: number, followerUserId: string): Promise<void> {\n    await db.insert(followers).values({ profileId, followerUserId }).onConflictDoNothing();\n  }\n\n  async unfollowProfile(profileId: number, followerUserId: string): Promise<void> {\n    await db\n      .delete(followers)\n      .where(and(eq(followers.profileId, profileId), eq(followers.followerUserId, followerUserId)));\n  }\n\n  async getFollowerCount(profileId: number): Promise<number> {\n    const result = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(followers)\n      .where(eq(followers.profileId, profileId));\n    return Number(result[0]?.count || 0);\n  }\n\n  async isFollowing(profileId: number, userId: string): Promise<boolean> {\n    const [follow] = await db\n      .select()\n      .from(followers)\n      .where(and(eq(followers.profileId, profileId), eq(followers.followerUserId, userId)));\n    return !!follow;\n  }\n\n  // =====================\n  // Profile Stats\n  // =====================\n  async getProfileStats(profileId: number): Promise<{ likes: number; followers: number; videos: number; photos: number }> {\n    const followerCount = await this.getFollowerCount(profileId);\n    const totalLikes = await this.getTotalLikesForProfile(profileId);\n    \n    const videoResult = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(posts)\n      .where(and(eq(posts.profileId, profileId), eq(posts.mediaType, 'video')));\n    const videos = Number(videoResult[0]?.count || 0);\n    \n    const photoResult = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(posts)\n      .where(and(eq(posts.profileId, profileId), eq(posts.mediaType, 'image')));\n    const photos = Number(photoResult[0]?.count || 0);\n    \n    return { likes: totalLikes, followers: followerCount, videos, photos };\n  }\n\n  async getTotalLikesForProfile(profileId: number): Promise<number> {\n    const profilePosts = await db\n      .select({ id: posts.id })\n      .from(posts)\n      .where(eq(posts.profileId, profileId));\n    \n    if (profilePosts.length === 0) return 0;\n    \n    const postIds = profilePosts.map(p => p.id);\n    const result = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(postLikes)\n      .where(sql`${postLikes.postId} IN (${sql.join(postIds.map(id => sql`${id}`), sql`, `)})`);\n    return Number(result[0]?.count || 0);\n  }\n\n  // =====================\n  // Post Operations\n  // =====================\n  async getPosts(): Promise<Post[]> {\n    return await db.select().from(posts).orderBy(desc(posts.createdAt));\n  }\n\n  async getPublicPosts(): Promise<Post[]> {\n    return await db\n      .select()\n      .from(posts)\n      .where(eq(posts.scope, 'public'))\n      .orderBy(desc(posts.createdAt));\n  }\n\n  async getProfilePosts(profileId: number): Promise<Post[]> {\n    return await db\n      .select()\n      .from(posts)\n      .where(eq(posts.profileId, profileId))\n      .orderBy(desc(posts.createdAt));\n  }\n\n  async getPost(id: number): Promise<Post | undefined> {\n    const [post] = await db.select().from(posts).where(eq(posts.id, id));\n    return post;\n  }\n\n  async createPost(post: InsertPost): Promise<Post> {\n    const [newPost] = await db.insert(posts).values(post).returning();\n    return newPost;\n  }\n\n  async deletePost(id: number): Promise<void> {\n    await db.delete(postComments).where(eq(postComments.postId, id));\n    await db.delete(postLikes).where(eq(postLikes.postId, id));\n    await db.delete(posts).where(eq(posts.id, id));\n  }\n\n  async likePost(postId: number, userId: string): Promise<void> {\n    await db.insert(postLikes).values({ postId, userId }).onConflictDoNothing();\n  }\n\n  async unlikePost(postId: number, userId: string): Promise<void> {\n    await db\n      .delete(postLikes)\n      .where(and(eq(postLikes.postId, postId), eq(postLikes.userId, userId)));\n  }\n\n  async getPostLikes(postId: number): Promise<number> {\n    const result = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(postLikes)\n      .where(eq(postLikes.postId, postId));\n    return Number(result[0]?.count || 0);\n  }\n\n  async hasUserLikedPost(postId: number, userId: string): Promise<boolean> {\n    const [like] = await db\n      .select()\n      .from(postLikes)\n      .where(and(eq(postLikes.postId, postId), eq(postLikes.userId, userId)));\n    return !!like;\n  }\n\n  async getPostComments(postId: number): Promise<PostComment[]> {\n    return await db\n      .select()\n      .from(postComments)\n      .where(eq(postComments.postId, postId))\n      .orderBy(postComments.createdAt);\n  }\n\n  async addPostComment(comment: InsertPostComment): Promise<PostComment> {\n    const [newComment] = await db.insert(postComments).values(comment).returning();\n    return newComment;\n  }\n\n  async deletePostComment(commentId: number, userId: string): Promise<void> {\n    const [comment] = await db.select().from(postComments).where(eq(postComments.id, commentId));\n    if (!comment) return;\n    if (comment.authorId !== userId) {\n      throw new Error(\"Not authorized\");\n    }\n    await db.delete(postComments).where(eq(postComments.id, commentId));\n  }\n\n  // =====================\n  // Chat Operations (WhatsApp-style)\n  // =====================\n  async getChatThreads(userId: string): Promise<ChatThread[]> {\n    const participantThreads = await db\n      .select({ threadId: chatParticipants.threadId })\n      .from(chatParticipants)\n      .where(eq(chatParticipants.userId, userId));\n\n    const threadIds = participantThreads.map((p) => p.threadId);\n    if (threadIds.length === 0) return [];\n\n    return await db\n      .select()\n      .from(chatThreads)\n      .where(inArray(chatThreads.id, threadIds))\n      .orderBy(desc(chatThreads.updatedAt));\n  }\n\n  async getChatThread(id: number): Promise<ChatThread | undefined> {\n    const [thread] = await db.select().from(chatThreads).where(eq(chatThreads.id, id));\n    return thread;\n  }\n\n  async createChatThread(thread: InsertChatThread, participantIds: string[], creatorId: string): Promise<ChatThread> {\n    const [newThread] = await db.insert(chatThreads).values({\n      ...thread,\n      creatorId,\n    }).returning();\n    \n    const participants = participantIds.map((pUserId, index) => ({\n      threadId: newThread.id,\n      userId: pUserId,\n      isAdmin: pUserId === creatorId,\n    }));\n    await db.insert(chatParticipants).values(participants);\n    \n    return newThread;\n  }\n\n  async createDirectChat(userId1: string, userId2: string): Promise<ChatThread> {\n    // Check if direct chat already exists\n    const existing = await this.getDirectChatBetweenUsers(userId1, userId2);\n    if (existing) return existing;\n\n    // Get both users for naming\n    const user1 = await this.getUser(userId1);\n    const user2 = await this.getUser(userId2);\n    const name = `${user1?.firstName || user1?.email || 'User'} & ${user2?.firstName || user2?.email || 'User'}`;\n\n    const [newThread] = await db.insert(chatThreads).values({\n      name,\n      type: \"direct\",\n      creatorId: userId1,\n    }).returning();\n\n    await db.insert(chatParticipants).values([\n      { threadId: newThread.id, userId: userId1, isAdmin: false },\n      { threadId: newThread.id, userId: userId2, isAdmin: false },\n    ]);\n\n    return newThread;\n  }\n\n  async getDirectChatBetweenUsers(userId1: string, userId2: string): Promise<ChatThread | undefined> {\n    // Find threads where both users are participants and type is \"direct\"\n    const user1Threads = await db\n      .select({ threadId: chatParticipants.threadId })\n      .from(chatParticipants)\n      .where(eq(chatParticipants.userId, userId1));\n\n    const user2Threads = await db\n      .select({ threadId: chatParticipants.threadId })\n      .from(chatParticipants)\n      .where(eq(chatParticipants.userId, userId2));\n\n    const commonThreadIds = user1Threads\n      .map(t => t.threadId)\n      .filter(id => user2Threads.some(t => t.threadId === id));\n\n    if (commonThreadIds.length === 0) return undefined;\n\n    const [directThread] = await db\n      .select()\n      .from(chatThreads)\n      .where(and(\n        inArray(chatThreads.id, commonThreadIds),\n        eq(chatThreads.type, \"direct\")\n      ));\n\n    return directThread;\n  }\n\n  async getMessages(threadId: number): Promise<Message[]> {\n    return await db\n      .select()\n      .from(messages)\n      .where(eq(messages.threadId, threadId))\n      .orderBy(messages.createdAt);\n  }\n\n  async createMessage(message: InsertMessage): Promise<Message> {\n    const [newMessage] = await db.insert(messages).values(message).returning();\n    \n    // Update thread's updatedAt and lastMessageId\n    await db\n      .update(chatThreads)\n      .set({ updatedAt: new Date(), lastMessageId: newMessage.id })\n      .where(eq(chatThreads.id, message.threadId));\n    \n    return newMessage;\n  }\n\n  async deleteMessage(messageId: number, userId: string): Promise<void> {\n    const [message] = await db.select().from(messages).where(eq(messages.id, messageId));\n    if (!message) return;\n    if (message.senderId !== userId) {\n      throw new Error(\"Not authorized\");\n    }\n    await db.delete(messages).where(eq(messages.id, messageId));\n  }\n\n  async getThreadParticipants(threadId: number): Promise<User[]> {\n    const participants = await db\n      .select({ userId: chatParticipants.userId })\n      .from(chatParticipants)\n      .where(eq(chatParticipants.threadId, threadId));\n\n    const userIds = participants.map(p => p.userId);\n    if (userIds.length === 0) return [];\n\n    return await db\n      .select()\n      .from(users)\n      .where(inArray(users.id, userIds));\n  }\n\n  async addThreadParticipant(threadId: number, userId: string, isAdmin: boolean = false): Promise<void> {\n    await db.insert(chatParticipants).values({\n      threadId,\n      userId,\n      isAdmin,\n    }).onConflictDoNothing();\n  }\n\n  async removeThreadParticipant(threadId: number, userId: string): Promise<void> {\n    await db.delete(chatParticipants).where(\n      and(\n        eq(chatParticipants.threadId, threadId),\n        eq(chatParticipants.userId, userId)\n      )\n    );\n  }\n\n  async updateThread(threadId: number, data: Partial<InsertChatThread>): Promise<ChatThread | undefined> {\n    const [updated] = await db\n      .update(chatThreads)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(chatThreads.id, threadId))\n      .returning();\n    return updated;\n  }\n\n  async getLastMessage(threadId: number): Promise<Message | undefined> {\n    const [lastMessage] = await db\n      .select()\n      .from(messages)\n      .where(eq(messages.threadId, threadId))\n      .orderBy(desc(messages.createdAt))\n      .limit(1);\n    return lastMessage;\n  }\n\n  async getUnreadCount(threadId: number, userId: string): Promise<number> {\n    const [participant] = await db\n      .select()\n      .from(chatParticipants)\n      .where(and(\n        eq(chatParticipants.threadId, threadId),\n        eq(chatParticipants.userId, userId)\n      ));\n\n    if (!participant || !participant.lastReadMessageId) {\n      const result = await db\n        .select({ count: sql<number>`count(*)` })\n        .from(messages)\n        .where(and(\n          eq(messages.threadId, threadId),\n          sql`${messages.senderId} != ${userId}`\n        ));\n      return Number(result[0]?.count || 0);\n    }\n\n    const result = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(messages)\n      .where(and(\n        eq(messages.threadId, threadId),\n        sql`${messages.id} > ${participant.lastReadMessageId}`,\n        sql`${messages.senderId} != ${userId}`\n      ));\n    return Number(result[0]?.count || 0);\n  }\n\n  async markMessagesRead(threadId: number, userId: string): Promise<void> {\n    const lastMessage = await this.getLastMessage(threadId);\n    if (lastMessage) {\n      await db\n        .update(chatParticipants)\n        .set({ lastReadMessageId: lastMessage.id })\n        .where(and(\n          eq(chatParticipants.threadId, threadId),\n          eq(chatParticipants.userId, userId)\n        ));\n    }\n  }\n\n  async deleteThread(threadId: number): Promise<void> {\n    await db.delete(messages).where(eq(messages.threadId, threadId));\n    await db.delete(chatParticipants).where(eq(chatParticipants.threadId, threadId));\n    await db.delete(chatThreads).where(eq(chatThreads.id, threadId));\n  }\n\n  // =====================\n  // Meeting Operations\n  // =====================\n  async getMeetings(): Promise<Meeting[]> {\n    return await db.select().from(meetings).orderBy(meetings.startTime);\n  }\n\n  async getMeeting(id: number): Promise<Meeting | undefined> {\n    const [meeting] = await db.select().from(meetings).where(eq(meetings.id, id));\n    return meeting;\n  }\n\n  async createMeeting(meeting: InsertMeeting, attendeeIds: string[]): Promise<Meeting> {\n    const [newMeeting] = await db.insert(meetings).values(meeting).returning();\n    \n    const attendees = attendeeIds.map((userId) => ({\n      meetingId: newMeeting.id,\n      userId,\n    }));\n    if (attendees.length > 0) {\n      await db.insert(meetingAttendees).values(attendees);\n    }\n    \n    return newMeeting;\n  }\n\n  async updateMeeting(id: number, meeting: Partial<InsertMeeting>): Promise<Meeting | undefined> {\n    const [updated] = await db\n      .update(meetings)\n      .set({ ...meeting, updatedAt: new Date() })\n      .where(eq(meetings.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteMeeting(id: number): Promise<void> {\n    await db.delete(meetingAttendees).where(eq(meetingAttendees.meetingId, id));\n    await db.delete(meetings).where(eq(meetings.id, id));\n  }\n\n  async getMeetingAttendees(meetingId: number): Promise<User[]> {\n    const attendeeRecords = await db\n      .select({ userId: meetingAttendees.userId })\n      .from(meetingAttendees)\n      .where(eq(meetingAttendees.meetingId, meetingId));\n\n    const userIds = attendeeRecords.map((a) => a.userId);\n    if (userIds.length === 0) return [];\n\n    return await db\n      .select()\n      .from(users)\n      .where(inArray(users.id, userIds));\n  }\n\n  // =====================\n  // Job Posting Operations\n  // =====================\n  async getJobPostings(): Promise<JobPosting[]> {\n    return await db.select().from(jobPostings).orderBy(desc(jobPostings.createdAt));\n  }\n\n  async getJobPosting(id: number): Promise<JobPosting | undefined> {\n    const [job] = await db.select().from(jobPostings).where(eq(jobPostings.id, id));\n    return job;\n  }\n\n  async createJobPosting(job: InsertJobPosting): Promise<JobPosting> {\n    const [newJob] = await db.insert(jobPostings).values(job).returning();\n    return newJob;\n  }\n\n  async updateJobPosting(id: number, job: Partial<InsertJobPosting>): Promise<JobPosting | undefined> {\n    const [updated] = await db\n      .update(jobPostings)\n      .set({ ...job, updatedAt: new Date() })\n      .where(eq(jobPostings.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteJobPosting(id: number): Promise<void> {\n    await db.delete(jobPostings).where(eq(jobPostings.id, id));\n  }\n\n  // =====================\n  // Transaction Operations\n  // =====================\n  async getTransactions(): Promise<Transaction[]> {\n    return await db.select().from(transactions).orderBy(desc(transactions.createdAt));\n  }\n\n  async getTransaction(id: number): Promise<Transaction | undefined> {\n    const [transaction] = await db.select().from(transactions).where(eq(transactions.id, id));\n    return transaction;\n  }\n\n  async createTransaction(transaction: InsertTransaction): Promise<Transaction> {\n    const [newTransaction] = await db.insert(transactions).values(transaction).returning();\n    return newTransaction;\n  }\n\n  async updateTransaction(id: number, transaction: Partial<InsertTransaction>): Promise<Transaction | undefined> {\n    const [updated] = await db\n      .update(transactions)\n      .set({ ...transaction, updatedAt: new Date() })\n      .where(eq(transactions.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteTransaction(id: number): Promise<void> {\n    await db.delete(transactions).where(eq(transactions.id, id));\n  }\n\n  async getPendingTransactions(): Promise<Transaction[]> {\n    return await db\n      .select()\n      .from(transactions)\n      .where(eq(transactions.status, \"pending\"))\n      .orderBy(desc(transactions.createdAt));\n  }\n\n  // =====================\n  // Role Operations\n  // =====================\n  async getRoles(): Promise<Role[]> {\n    return await db.select().from(roles).orderBy(roles.name);\n  }\n\n  async getRole(id: number): Promise<Role | undefined> {\n    const [role] = await db.select().from(roles).where(eq(roles.id, id));\n    return role;\n  }\n\n  async createRole(role: InsertRole): Promise<Role> {\n    const [newRole] = await db.insert(roles).values(role).returning();\n    return newRole;\n  }\n\n  async updateRole(id: number, role: Partial<InsertRole>): Promise<Role | undefined> {\n    const [updated] = await db\n      .update(roles)\n      .set({ ...role, updatedAt: new Date() })\n      .where(eq(roles.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteRole(id: number): Promise<void> {\n    await db.delete(userRoles).where(eq(userRoles.roleId, id));\n    await db.delete(roles).where(eq(roles.id, id));\n  }\n\n  async getUserRoles(userId: string): Promise<Role[]> {\n    const userRoleRecords = await db\n      .select({ roleId: userRoles.roleId })\n      .from(userRoles)\n      .where(eq(userRoles.userId, userId));\n\n    const roleIds = userRoleRecords.map((r) => r.roleId);\n    if (roleIds.length === 0) return [];\n\n    return await db\n      .select()\n      .from(roles)\n      .where(inArray(roles.id, roleIds));\n  }\n\n  async assignRole(userId: string, roleId: number): Promise<void> {\n    await db.insert(userRoles).values({ userId, roleId }).onConflictDoNothing();\n  }\n\n  async removeRole(userId: string, roleId: number): Promise<void> {\n    await db\n      .delete(userRoles)\n      .where(and(eq(userRoles.userId, userId), eq(userRoles.roleId, roleId)));\n  }\n\n  // =====================\n  // Notification Operations\n  // =====================\n  async getNotifications(userId: string): Promise<Notification[]> {\n    return await db\n      .select()\n      .from(notifications)\n      .where(eq(notifications.userId, userId))\n      .orderBy(desc(notifications.createdAt))\n      .limit(50);\n  }\n\n  async createNotification(notification: InsertNotification): Promise<Notification> {\n    const [newNotification] = await db.insert(notifications).values(notification).returning();\n    return newNotification;\n  }\n\n  async markNotificationRead(id: number): Promise<void> {\n    await db.update(notifications).set({ read: true }).where(eq(notifications.id, id));\n  }\n\n  async markAllNotificationsRead(userId: string): Promise<void> {\n    await db\n      .update(notifications)\n      .set({ read: true })\n      .where(eq(notifications.userId, userId));\n  }\n\n  async getUnreadNotificationCount(userId: string): Promise<number> {\n    const result = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(notifications)\n      .where(and(eq(notifications.userId, userId), eq(notifications.read, false)));\n    return Number(result[0]?.count || 0);\n  }\n\n  // =====================\n  // Department Operations (Standalone)\n  // =====================\n  async getDepartments(): Promise<Department[]> {\n    return await db.select().from(departments).orderBy(desc(departments.createdAt));\n  }\n\n  async getDepartmentsByManager(managerId: string): Promise<Department[]> {\n    return await db\n      .select()\n      .from(departments)\n      .where(eq(departments.managerId, managerId))\n      .orderBy(departments.name);\n  }\n\n  async getDepartment(id: number): Promise<Department | undefined> {\n    const [department] = await db.select().from(departments).where(eq(departments.id, id));\n    return department;\n  }\n\n  async createDepartment(department: InsertDepartment): Promise<Department> {\n    const [newDepartment] = await db.insert(departments).values(department).returning();\n    return newDepartment;\n  }\n\n  async updateDepartment(id: number, department: Partial<InsertDepartment>): Promise<Department | undefined> {\n    const [updated] = await db\n      .update(departments)\n      .set({ ...department, updatedAt: new Date() })\n      .where(eq(departments.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteDepartment(id: number): Promise<void> {\n    await db.delete(remoteEmployees).where(eq(remoteEmployees.departmentId, id));\n    await db.delete(departments).where(eq(departments.id, id));\n  }\n\n  async verifyDepartmentPassword(id: number, password: string): Promise<boolean> {\n    const dept = await this.getDepartment(id);\n    if (!dept || !dept.password) return true;\n    return dept.password === password;\n  }\n\n  // =====================\n  // Remote Employee Operations\n  // =====================\n  async getRemoteEmployees(departmentId: number): Promise<RemoteEmployee[]> {\n    return await db\n      .select()\n      .from(remoteEmployees)\n      .where(eq(remoteEmployees.departmentId, departmentId))\n      .orderBy(remoteEmployees.firstName);\n  }\n\n  async getRemoteEmployee(id: number): Promise<RemoteEmployee | undefined> {\n    const [employee] = await db.select().from(remoteEmployees).where(eq(remoteEmployees.id, id));\n    return employee;\n  }\n\n  async getRemoteEmployeeByUsername(username: string): Promise<RemoteEmployee | undefined> {\n    const [employee] = await db.select().from(remoteEmployees).where(eq(remoteEmployees.username, username));\n    return employee;\n  }\n\n  async createRemoteEmployee(employee: InsertRemoteEmployee): Promise<RemoteEmployee> {\n    const [newEmployee] = await db.insert(remoteEmployees).values(employee).returning();\n    return newEmployee;\n  }\n\n  async updateRemoteEmployee(id: number, employee: Partial<InsertRemoteEmployee>): Promise<RemoteEmployee | undefined> {\n    const [updated] = await db\n      .update(remoteEmployees)\n      .set({ ...employee, updatedAt: new Date() })\n      .where(eq(remoteEmployees.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteRemoteEmployee(id: number): Promise<void> {\n    await db.delete(remoteEmployees).where(eq(remoteEmployees.id, id));\n  }\n\n  // =====================\n  // Subscription Operations\n  // =====================\n  async getSubscription(id: number): Promise<Subscription | undefined> {\n    const [subscription] = await db.select().from(subscriptions).where(eq(subscriptions.id, id));\n    return subscription;\n  }\n\n  async getSubscriptionByUser(userId: string): Promise<Subscription | undefined> {\n    const [subscription] = await db\n      .select()\n      .from(subscriptions)\n      .where(eq(subscriptions.userId, userId))\n      .orderBy(desc(subscriptions.createdAt))\n      .limit(1);\n    return subscription;\n  }\n\n  async createSubscription(subscription: InsertSubscription): Promise<Subscription> {\n    const [newSubscription] = await db.insert(subscriptions).values(subscription).returning();\n    return newSubscription;\n  }\n\n  async updateSubscription(id: number, subscription: Partial<InsertSubscription>): Promise<Subscription | undefined> {\n    const [updated] = await db\n      .update(subscriptions)\n      .set({ ...subscription, updatedAt: new Date() })\n      .where(eq(subscriptions.id, id))\n      .returning();\n    return updated;\n  }\n\n  async getActiveSubscription(userId: string): Promise<Subscription | undefined> {\n    const [subscription] = await db\n      .select()\n      .from(subscriptions)\n      .where(and(eq(subscriptions.userId, userId), eq(subscriptions.status, 'active')))\n      .orderBy(desc(subscriptions.createdAt))\n      .limit(1);\n    return subscription;\n  }\n\n  // =====================\n  // Advertisement Operations\n  // =====================\n  async getAdvertisements(): Promise<Advertisement[]> {\n    return await db.select().from(advertisements).orderBy(desc(advertisements.createdAt));\n  }\n\n  async getActiveAdvertisements(): Promise<Advertisement[]> {\n    const now = new Date();\n    return await db\n      .select()\n      .from(advertisements)\n      .where(and(\n        eq(advertisements.status, 'active'),\n        sql`${advertisements.endDate} > ${now}`\n      ))\n      .orderBy(desc(advertisements.createdAt));\n  }\n\n  async getAdvertisementsByUser(userId: string): Promise<Advertisement[]> {\n    return await db\n      .select()\n      .from(advertisements)\n      .where(eq(advertisements.userId, userId))\n      .orderBy(desc(advertisements.createdAt));\n  }\n\n  async getAdvertisement(id: number): Promise<Advertisement | undefined> {\n    const [ad] = await db.select().from(advertisements).where(eq(advertisements.id, id));\n    return ad;\n  }\n\n  async createAdvertisement(ad: InsertAdvertisement): Promise<Advertisement> {\n    const [newAd] = await db.insert(advertisements).values(ad).returning();\n    return newAd;\n  }\n\n  async updateAdvertisement(id: number, ad: Partial<InsertAdvertisement>): Promise<Advertisement | undefined> {\n    const [updated] = await db\n      .update(advertisements)\n      .set({ ...ad, updatedAt: new Date() })\n      .where(eq(advertisements.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteAdvertisement(id: number): Promise<void> {\n    await db.delete(advertisements).where(eq(advertisements.id, id));\n  }\n\n  async incrementAdViews(id: number): Promise<void> {\n    await db\n      .update(advertisements)\n      .set({ views: sql`${advertisements.views} + 1` })\n      .where(eq(advertisements.id, id));\n  }\n\n  async incrementAdClicks(id: number): Promise<void> {\n    await db\n      .update(advertisements)\n      .set({ clicks: sql`${advertisements.clicks} + 1` })\n      .where(eq(advertisements.id, id));\n  }\n\n  // =====================\n  // n8n Settings Operations\n  // =====================\n  async getN8nSettings(userId: string): Promise<N8nSettings | undefined> {\n    const [settings] = await db\n      .select()\n      .from(n8nSettings)\n      .where(eq(n8nSettings.userId, userId));\n    return settings;\n  }\n\n  async createN8nSettings(settings: InsertN8nSettings): Promise<N8nSettings> {\n    const [newSettings] = await db.insert(n8nSettings).values(settings).returning();\n    return newSettings;\n  }\n\n  async updateN8nSettings(userId: string, settings: Partial<InsertN8nSettings>): Promise<N8nSettings | undefined> {\n    const [updated] = await db\n      .update(n8nSettings)\n      .set({ ...settings, updatedAt: new Date() })\n      .where(eq(n8nSettings.userId, userId))\n      .returning();\n    return updated;\n  }\n\n  // =====================\n  // Task Automation Operations\n  // =====================\n  async getTaskAutomations(userId: string): Promise<TaskAutomation[]> {\n    return await db\n      .select()\n      .from(taskAutomations)\n      .where(eq(taskAutomations.userId, userId))\n      .orderBy(desc(taskAutomations.createdAt));\n  }\n\n  async getTaskAutomation(id: number): Promise<TaskAutomation | undefined> {\n    const [automation] = await db\n      .select()\n      .from(taskAutomations)\n      .where(eq(taskAutomations.id, id));\n    return automation;\n  }\n\n  async getTaskAutomationByTask(taskId: number): Promise<TaskAutomation | undefined> {\n    const [automation] = await db\n      .select()\n      .from(taskAutomations)\n      .where(eq(taskAutomations.taskId, taskId))\n      .orderBy(desc(taskAutomations.createdAt))\n      .limit(1);\n    return automation;\n  }\n\n  async createTaskAutomation(automation: InsertTaskAutomation): Promise<TaskAutomation> {\n    const [newAutomation] = await db.insert(taskAutomations).values(automation).returning();\n    return newAutomation;\n  }\n\n  async updateTaskAutomation(id: number, automation: Partial<InsertTaskAutomation>): Promise<TaskAutomation | undefined> {\n    const [updated] = await db\n      .update(taskAutomations)\n      .set({ ...automation, updatedAt: new Date() })\n      .where(eq(taskAutomations.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteTaskAutomation(id: number): Promise<void> {\n    await db.delete(taskAutomations).where(eq(taskAutomations.id, id));\n  }\n\n  async getPendingAutomations(userId: string): Promise<TaskAutomation[]> {\n    return await db\n      .select()\n      .from(taskAutomations)\n      .where(and(\n        eq(taskAutomations.userId, userId),\n        eq(taskAutomations.status, 'ready')\n      ))\n      .orderBy(desc(taskAutomations.createdAt));\n  }\n\n  // =====================\n  // Office Operations (Public Storefront)\n  // =====================\n  async getPublishedOffices(): Promise<Office[]> {\n    return await db\n      .select()\n      .from(offices)\n      .where(and(\n        eq(offices.isPublished, true),\n        eq(offices.subscriptionStatus, 'active')\n      ))\n      .orderBy(desc(offices.createdAt));\n  }\n\n  async getOffices(ownerId?: string): Promise<Office[]> {\n    if (ownerId) {\n      return await db\n        .select()\n        .from(offices)\n        .where(eq(offices.ownerId, ownerId))\n        .orderBy(desc(offices.createdAt));\n    }\n    return await db.select().from(offices).orderBy(desc(offices.createdAt));\n  }\n\n  async getOffice(id: number): Promise<Office | undefined> {\n    const [office] = await db.select().from(offices).where(eq(offices.id, id));\n    return office;\n  }\n\n  async getOfficeBySlug(slug: string): Promise<Office | undefined> {\n    const [office] = await db.select().from(offices).where(eq(offices.slug, slug));\n    return office;\n  }\n\n  async createOffice(office: InsertOffice): Promise<Office> {\n    const [newOffice] = await db.insert(offices).values(office).returning();\n    return newOffice;\n  }\n\n  async updateOffice(id: number, office: Partial<InsertOffice>): Promise<Office | undefined> {\n    const [updated] = await db\n      .update(offices)\n      .set({ ...office, updatedAt: new Date() })\n      .where(eq(offices.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteOffice(id: number): Promise<void> {\n    await db.delete(officeMessages).where(eq(officeMessages.officeId, id));\n    await db.delete(officePosts).where(eq(officePosts.officeId, id));\n    await db.delete(officeMedia).where(eq(officeMedia.officeId, id));\n    const services = await db.select({ id: officeServices.id }).from(officeServices).where(eq(officeServices.officeId, id));\n    for (const service of services) {\n      await db.delete(serviceRatings).where(eq(serviceRatings.serviceId, service.id));\n      await db.delete(serviceComments).where(eq(serviceComments.serviceId, service.id));\n    }\n    await db.delete(officeServices).where(eq(officeServices.officeId, id));\n    await db.delete(offices).where(eq(offices.id, id));\n  }\n\n  // =====================\n  // Office Service Operations\n  // =====================\n  async getAllPublicServices(): Promise<(OfficeService & { officeName: string; officeSlug: string | null })[]> {\n    const result = await db\n      .select({\n        id: officeServices.id,\n        officeId: officeServices.officeId,\n        title: officeServices.title,\n        description: officeServices.description,\n        price: officeServices.price,\n        priceType: officeServices.priceType,\n        category: officeServices.category,\n        imageUrl: officeServices.imageUrl,\n        isFeatured: officeServices.isFeatured,\n        isActive: officeServices.isActive,\n        sortOrder: officeServices.sortOrder,\n        createdAt: officeServices.createdAt,\n        updatedAt: officeServices.updatedAt,\n        officeName: offices.name,\n        officeSlug: offices.slug,\n      })\n      .from(officeServices)\n      .innerJoin(offices, eq(officeServices.officeId, offices.id))\n      .where(and(eq(officeServices.isActive, true), eq(offices.isPublished, true)))\n      .orderBy(desc(officeServices.isFeatured), officeServices.sortOrder);\n    return result;\n  }\n\n  async getOfficeServices(officeId: number): Promise<OfficeService[]> {\n    return await db\n      .select()\n      .from(officeServices)\n      .where(eq(officeServices.officeId, officeId))\n      .orderBy(officeServices.sortOrder);\n  }\n\n  async getOfficeService(id: number): Promise<OfficeService | undefined> {\n    const [service] = await db.select().from(officeServices).where(eq(officeServices.id, id));\n    return service;\n  }\n\n  async createOfficeService(service: InsertOfficeService): Promise<OfficeService> {\n    const [newService] = await db.insert(officeServices).values(service).returning();\n    return newService;\n  }\n\n  async updateOfficeService(id: number, service: Partial<InsertOfficeService>): Promise<OfficeService | undefined> {\n    const [updated] = await db\n      .update(officeServices)\n      .set({ ...service, updatedAt: new Date() })\n      .where(eq(officeServices.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteOfficeService(id: number): Promise<void> {\n    await db.delete(serviceRatings).where(eq(serviceRatings.serviceId, id));\n    await db.delete(serviceComments).where(eq(serviceComments.serviceId, id));\n    await db.delete(officeServices).where(eq(officeServices.id, id));\n  }\n\n  // =====================\n  // Service Rating Operations\n  // =====================\n  async getServiceRatings(serviceId: number): Promise<ServiceRating[]> {\n    return await db\n      .select()\n      .from(serviceRatings)\n      .where(eq(serviceRatings.serviceId, serviceId))\n      .orderBy(desc(serviceRatings.createdAt));\n  }\n\n  async getServiceAverageRating(serviceId: number): Promise<{ average: number; count: number }> {\n    const result = await db\n      .select({\n        average: sql<number>`COALESCE(AVG(${serviceRatings.rating}), 0)`,\n        count: sql<number>`COUNT(*)`,\n      })\n      .from(serviceRatings)\n      .where(eq(serviceRatings.serviceId, serviceId));\n    return {\n      average: Number(result[0]?.average || 0),\n      count: Number(result[0]?.count || 0),\n    };\n  }\n\n  async createServiceRating(rating: InsertServiceRating): Promise<ServiceRating> {\n    const [newRating] = await db.insert(serviceRatings).values(rating).returning();\n    return newRating;\n  }\n\n  // =====================\n  // Service Comment Operations\n  // =====================\n  async getServiceComments(serviceId: number): Promise<ServiceComment[]> {\n    return await db\n      .select()\n      .from(serviceComments)\n      .where(and(\n        eq(serviceComments.serviceId, serviceId),\n        eq(serviceComments.status, 'published')\n      ))\n      .orderBy(desc(serviceComments.createdAt));\n  }\n\n  async createServiceComment(comment: InsertServiceComment): Promise<ServiceComment> {\n    const [newComment] = await db.insert(serviceComments).values(comment).returning();\n    return newComment;\n  }\n\n  async updateServiceCommentStatus(id: number, status: string): Promise<ServiceComment | undefined> {\n    const [updated] = await db\n      .update(serviceComments)\n      .set({ status })\n      .where(eq(serviceComments.id, id))\n      .returning();\n    return updated;\n  }\n\n  // =====================\n  // Office Media Operations\n  // =====================\n  async getOfficeMedia(officeId: number): Promise<OfficeMedia[]> {\n    return await db\n      .select()\n      .from(officeMedia)\n      .where(eq(officeMedia.officeId, officeId))\n      .orderBy(desc(officeMedia.createdAt));\n  }\n\n  async getDailyVideos(): Promise<OfficeMedia[]> {\n    const now = new Date();\n    return await db\n      .select()\n      .from(officeMedia)\n      .where(and(\n        eq(officeMedia.type, 'video'),\n        or(\n          sql`${officeMedia.expiresAt} IS NULL`,\n          sql`${officeMedia.expiresAt} > ${now}`\n        )\n      ))\n      .orderBy(desc(officeMedia.createdAt));\n  }\n\n  async getAnnouncements(): Promise<OfficeMedia[]> {\n    return await db\n      .select()\n      .from(officeMedia)\n      .where(eq(officeMedia.type, 'announcement'))\n      .orderBy(desc(officeMedia.createdAt))\n      .limit(20);\n  }\n\n  async createOfficeMedia(media: InsertOfficeMedia): Promise<OfficeMedia> {\n    const [newMedia] = await db.insert(officeMedia).values(media).returning();\n    return newMedia;\n  }\n\n  async deleteOfficeMedia(id: number): Promise<void> {\n    await db.delete(officeMedia).where(eq(officeMedia.id, id));\n  }\n\n  async incrementMediaViews(id: number): Promise<void> {\n    await db\n      .update(officeMedia)\n      .set({ views: sql`${officeMedia.views} + 1` })\n      .where(eq(officeMedia.id, id));\n  }\n\n  // =====================\n  // Office Post Operations\n  // =====================\n  async getOfficePosts(officeId: number): Promise<OfficePost[]> {\n    return await db\n      .select()\n      .from(officePosts)\n      .where(eq(officePosts.officeId, officeId))\n      .orderBy(desc(officePosts.createdAt));\n  }\n\n  async getAllOfficePosts(): Promise<OfficePost[]> {\n    return await db\n      .select()\n      .from(officePosts)\n      .orderBy(desc(officePosts.createdAt))\n      .limit(50);\n  }\n\n  async createOfficePost(post: InsertOfficePost): Promise<OfficePost> {\n    const [newPost] = await db.insert(officePosts).values(post).returning();\n    return newPost;\n  }\n\n  async deleteOfficePost(id: number): Promise<void> {\n    await db.delete(officePosts).where(eq(officePosts.id, id));\n  }\n\n  async likeOfficePost(id: number): Promise<void> {\n    await db\n      .update(officePosts)\n      .set({ likes: sql`${officePosts.likes} + 1` })\n      .where(eq(officePosts.id, id));\n  }\n\n  // =====================\n  // Office Message Operations\n  // =====================\n  async getOfficeMessages(officeId: number, sessionId?: string): Promise<OfficeMessage[]> {\n    if (sessionId) {\n      return await db\n        .select()\n        .from(officeMessages)\n        .where(and(\n          eq(officeMessages.officeId, officeId),\n          eq(officeMessages.sessionId, sessionId)\n        ))\n        .orderBy(officeMessages.createdAt);\n    }\n    return await db\n      .select()\n      .from(officeMessages)\n      .where(eq(officeMessages.officeId, officeId))\n      .orderBy(officeMessages.createdAt);\n  }\n\n  async createOfficeMessage(message: InsertOfficeMessage): Promise<OfficeMessage> {\n    const [newMessage] = await db.insert(officeMessages).values(message).returning();\n    return newMessage;\n  }\n\n  async markOfficeMessagesRead(officeId: number, sessionId: string): Promise<void> {\n    await db\n      .update(officeMessages)\n      .set({ isRead: true })\n      .where(and(\n        eq(officeMessages.officeId, officeId),\n        eq(officeMessages.sessionId, sessionId)\n      ));\n  }\n\n  async getUnreadMessageCount(officeId: number): Promise<number> {\n    const result = await db\n      .select({ count: sql<number>`COUNT(*)` })\n      .from(officeMessages)\n      .where(and(\n        eq(officeMessages.officeId, officeId),\n        eq(officeMessages.isRead, false)\n      ));\n    return Number(result[0]?.count || 0);\n  }\n\n  // =====================\n  // Video Call Operations\n  // =====================\n  async getVideoCall(id: number): Promise<VideoCall | undefined> {\n    const [call] = await db.select().from(videoCalls).where(eq(videoCalls.id, id));\n    return call;\n  }\n\n  async getVideoCallByRoom(roomId: string): Promise<VideoCall | undefined> {\n    const [call] = await db.select().from(videoCalls).where(eq(videoCalls.roomId, roomId));\n    return call;\n  }\n\n  async getVideoCallsByOffice(officeId: number): Promise<VideoCall[]> {\n    return await db\n      .select()\n      .from(videoCalls)\n      .where(eq(videoCalls.officeId, officeId))\n      .orderBy(desc(videoCalls.createdAt));\n  }\n\n  async getPendingVideoCallsForOffice(officeId: number): Promise<VideoCall[]> {\n    return await db\n      .select()\n      .from(videoCalls)\n      .where(and(\n        eq(videoCalls.officeId, officeId),\n        eq(videoCalls.status, 'pending')\n      ))\n      .orderBy(videoCalls.createdAt);\n  }\n\n  async createVideoCall(call: InsertVideoCall): Promise<VideoCall> {\n    const [newCall] = await db.insert(videoCalls).values(call).returning();\n    return newCall;\n  }\n\n  async updateVideoCall(id: number, data: Partial<InsertVideoCall>): Promise<VideoCall | undefined> {\n    const [updated] = await db\n      .update(videoCalls)\n      .set(data)\n      .where(eq(videoCalls.id, id))\n      .returning();\n    return updated;\n  }\n\n  async startVideoCall(id: number, receptionistId: string): Promise<VideoCall | undefined> {\n    const [updated] = await db\n      .update(videoCalls)\n      .set({ \n        status: 'active',\n        receptionistId,\n        startedAt: new Date()\n      })\n      .where(eq(videoCalls.id, id))\n      .returning();\n    return updated;\n  }\n\n  async endVideoCall(id: number): Promise<VideoCall | undefined> {\n    const [updated] = await db\n      .update(videoCalls)\n      .set({ \n        status: 'ended',\n        endedAt: new Date()\n      })\n      .where(eq(videoCalls.id, id))\n      .returning();\n    return updated;\n  }\n\n  // =====================\n  // Service Request Operations\n  // =====================\n  async getServiceRequests(officeId: number): Promise<ServiceRequest[]> {\n    return await db\n      .select()\n      .from(serviceRequests)\n      .where(eq(serviceRequests.officeId, officeId))\n      .orderBy(desc(serviceRequests.createdAt));\n  }\n\n  async getServiceRequest(id: number): Promise<ServiceRequest | undefined> {\n    const [request] = await db.select().from(serviceRequests).where(eq(serviceRequests.id, id));\n    return request;\n  }\n\n  async createServiceRequest(request: InsertServiceRequest): Promise<ServiceRequest> {\n    const [newRequest] = await db.insert(serviceRequests).values(request).returning();\n    return newRequest;\n  }\n\n  async updateServiceRequest(id: number, data: Partial<InsertServiceRequest>): Promise<ServiceRequest | undefined> {\n    const [updated] = await db\n      .update(serviceRequests)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(serviceRequests.id, id))\n      .returning();\n    return updated;\n  }\n\n  // =====================\n  // Daily Status (Stories) Operations\n  // =====================\n  async getActiveStatuses(): Promise<Status[]> {\n    const now = new Date();\n    return await db\n      .select()\n      .from(statuses)\n      .where(sql`${statuses.expiresAt} > ${now}`)\n      .orderBy(desc(statuses.createdAt));\n  }\n\n  async getStatus(id: number): Promise<Status | undefined> {\n    const [status] = await db.select().from(statuses).where(eq(statuses.id, id));\n    return status;\n  }\n\n  async getStatusesByAuthor(authorId: string): Promise<Status[]> {\n    return await db\n      .select()\n      .from(statuses)\n      .where(eq(statuses.authorId, authorId))\n      .orderBy(desc(statuses.createdAt));\n  }\n\n  async getStatusesByOffice(officeId: number): Promise<Status[]> {\n    return await db\n      .select()\n      .from(statuses)\n      .where(eq(statuses.officeId, officeId))\n      .orderBy(desc(statuses.createdAt));\n  }\n\n  async createStatus(status: InsertStatus): Promise<Status> {\n    const [newStatus] = await db.insert(statuses).values(status).returning();\n    return newStatus;\n  }\n\n  async deleteStatus(id: number): Promise<void> {\n    await db.delete(statuses).where(eq(statuses.id, id));\n  }\n\n  async incrementStatusViews(id: number): Promise<void> {\n    await db\n      .update(statuses)\n      .set({ viewCount: sql`${statuses.viewCount} + 1` })\n      .where(eq(statuses.id, id));\n  }\n\n  // =====================\n  // Status Reply Operations\n  // =====================\n  async getStatusReplies(statusId: number): Promise<StatusReply[]> {\n    return await db\n      .select()\n      .from(statusReplies)\n      .where(eq(statusReplies.statusId, statusId))\n      .orderBy(statusReplies.createdAt);\n  }\n\n  async createStatusReply(reply: InsertStatusReply): Promise<StatusReply> {\n    const [newReply] = await db.insert(statusReplies).values(reply).returning();\n    return newReply;\n  }\n\n  async markStatusRepliesRead(statusId: number): Promise<void> {\n    await db\n      .update(statusReplies)\n      .set({ isRead: true })\n      .where(eq(statusReplies.statusId, statusId));\n  }\n\n  async getUnreadStatusRepliesCount(authorId: string): Promise<number> {\n    const result = await db\n      .select({ count: sql<number>`COUNT(*)` })\n      .from(statusReplies)\n      .innerJoin(statuses, eq(statusReplies.statusId, statuses.id))\n      .where(and(\n        eq(statuses.authorId, authorId),\n        eq(statusReplies.isRead, false)\n      ));\n    return Number(result[0]?.count || 0);\n  }\n\n  // =====================\n  // Status View Operations\n  // =====================\n  async getStatusViews(statusId: number): Promise<StatusView[]> {\n    return await db\n      .select()\n      .from(statusViews)\n      .where(eq(statusViews.statusId, statusId))\n      .orderBy(desc(statusViews.viewedAt));\n  }\n\n  async addStatusView(view: InsertStatusView): Promise<StatusView> {\n    const [newView] = await db.insert(statusViews).values(view).returning();\n    return newView;\n  }\n\n  async hasUserViewedStatus(statusId: number, userId: string): Promise<boolean> {\n    const [view] = await db\n      .select()\n      .from(statusViews)\n      .where(and(\n        eq(statusViews.statusId, statusId),\n        eq(statusViews.viewerId, userId)\n      ));\n    return !!view;\n  }\n\n  // =====================\n  // Status Like Operations\n  // =====================\n  async getStatusLike(statusId: number, userId: string): Promise<StatusLike | undefined> {\n    const [like] = await db\n      .select()\n      .from(statusLikes)\n      .where(and(\n        eq(statusLikes.statusId, statusId),\n        eq(statusLikes.userId, userId)\n      ));\n    return like;\n  }\n\n  async createStatusLike(like: InsertStatusLike): Promise<StatusLike> {\n    const [newLike] = await db.insert(statusLikes).values(like).returning();\n    return newLike;\n  }\n\n  async deleteStatusLike(statusId: number, userId: string): Promise<boolean> {\n    const result = await db\n      .delete(statusLikes)\n      .where(and(\n        eq(statusLikes.statusId, statusId),\n        eq(statusLikes.userId, userId)\n      ));\n    return true;\n  }\n\n  async getStatusLikeCount(statusId: number): Promise<number> {\n    const result = await db\n      .select({ count: sql<number>`COUNT(*)` })\n      .from(statusLikes)\n      .where(eq(statusLikes.statusId, statusId));\n    return Number(result[0]?.count || 0);\n  }\n\n  async hasUserLikedStatus(statusId: number, userId: string): Promise<boolean> {\n    const like = await this.getStatusLike(statusId, userId);\n    return !!like;\n  }\n\n  // =====================\n  // Office Follow Operations\n  // =====================\n  async followOffice(officeId: number, followerId: string): Promise<OfficeFollower> {\n    const [follower] = await db\n      .insert(officeFollowers)\n      .values({ officeId, followerId })\n      .returning();\n    return follower;\n  }\n\n  async unfollowOffice(officeId: number, followerId: string): Promise<void> {\n    await db\n      .delete(officeFollowers)\n      .where(and(\n        eq(officeFollowers.officeId, officeId),\n        eq(officeFollowers.followerId, followerId)\n      ));\n  }\n\n  async isFollowingOffice(officeId: number, userId: string): Promise<boolean> {\n    const [follow] = await db\n      .select()\n      .from(officeFollowers)\n      .where(and(\n        eq(officeFollowers.officeId, officeId),\n        eq(officeFollowers.followerId, userId)\n      ));\n    return !!follow;\n  }\n\n  async getOfficeFollowerCount(officeId: number): Promise<number> {\n    const result = await db\n      .select({ count: sql<number>`COUNT(*)` })\n      .from(officeFollowers)\n      .where(eq(officeFollowers.officeId, officeId));\n    return Number(result[0]?.count || 0);\n  }\n\n  // =====================\n  // Internal Email Operations\n  // =====================\n  async getInboxEmails(userId: string): Promise<InternalEmail[]> {\n    return await db\n      .select()\n      .from(internalEmails)\n      .where(and(\n        eq(internalEmails.recipientId, userId),\n        eq(internalEmails.isDeleted, false),\n        eq(internalEmails.isDraft, false),\n        eq(internalEmails.isArchived, false)\n      ))\n      .orderBy(desc(internalEmails.createdAt));\n  }\n\n  async getSentEmails(userId: string): Promise<InternalEmail[]> {\n    return await db\n      .select()\n      .from(internalEmails)\n      .where(and(\n        eq(internalEmails.senderId, userId),\n        eq(internalEmails.isDeleted, false),\n        eq(internalEmails.isDraft, false)\n      ))\n      .orderBy(desc(internalEmails.createdAt));\n  }\n\n  async getDraftEmails(userId: string): Promise<InternalEmail[]> {\n    return await db\n      .select()\n      .from(internalEmails)\n      .where(and(\n        eq(internalEmails.senderId, userId),\n        eq(internalEmails.isDraft, true),\n        eq(internalEmails.isDeleted, false)\n      ))\n      .orderBy(desc(internalEmails.createdAt));\n  }\n\n  async getStarredEmails(userId: string): Promise<InternalEmail[]> {\n    return await db\n      .select()\n      .from(internalEmails)\n      .where(and(\n        or(\n          eq(internalEmails.senderId, userId),\n          eq(internalEmails.recipientId, userId)\n        ),\n        eq(internalEmails.isStarred, true),\n        eq(internalEmails.isDeleted, false)\n      ))\n      .orderBy(desc(internalEmails.createdAt));\n  }\n\n  async getArchivedEmails(userId: string): Promise<InternalEmail[]> {\n    return await db\n      .select()\n      .from(internalEmails)\n      .where(and(\n        or(\n          eq(internalEmails.senderId, userId),\n          eq(internalEmails.recipientId, userId)\n        ),\n        eq(internalEmails.isArchived, true),\n        eq(internalEmails.isDeleted, false)\n      ))\n      .orderBy(desc(internalEmails.createdAt));\n  }\n\n  async getInternalEmail(id: number): Promise<InternalEmail | undefined> {\n    const [email] = await db\n      .select()\n      .from(internalEmails)\n      .where(eq(internalEmails.id, id));\n    return email;\n  }\n\n  async createInternalEmail(email: InsertInternalEmail): Promise<InternalEmail> {\n    const [newEmail] = await db.insert(internalEmails).values(email).returning();\n    return newEmail;\n  }\n\n  async updateInternalEmail(id: number, email: Partial<InsertInternalEmail>): Promise<InternalEmail | undefined> {\n    const [updated] = await db\n      .update(internalEmails)\n      .set({ ...email, updatedAt: new Date() })\n      .where(eq(internalEmails.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteInternalEmail(id: number): Promise<void> {\n    await db\n      .update(internalEmails)\n      .set({ isDeleted: true, updatedAt: new Date() })\n      .where(eq(internalEmails.id, id));\n  }\n\n  async markEmailAsRead(id: number): Promise<void> {\n    await db\n      .update(internalEmails)\n      .set({ isRead: true, updatedAt: new Date() })\n      .where(eq(internalEmails.id, id));\n  }\n\n  async toggleEmailStarred(id: number): Promise<void> {\n    const email = await this.getInternalEmail(id);\n    if (email) {\n      await db\n        .update(internalEmails)\n        .set({ isStarred: !email.isStarred, updatedAt: new Date() })\n        .where(eq(internalEmails.id, id));\n    }\n  }\n\n  async moveEmailToArchive(id: number): Promise<void> {\n    await db\n      .update(internalEmails)\n      .set({ isArchived: true, updatedAt: new Date() })\n      .where(eq(internalEmails.id, id));\n  }\n\n  async getUnreadEmailCount(userId: string): Promise<number> {\n    const result = await db\n      .select({ count: sql<number>`COUNT(*)` })\n      .from(internalEmails)\n      .where(and(\n        eq(internalEmails.recipientId, userId),\n        eq(internalEmails.isRead, false),\n        eq(internalEmails.isDeleted, false),\n        eq(internalEmails.isDraft, false)\n      ));\n    return Number(result[0]?.count || 0);\n  }\n\n  // =====================\n  // Push Subscription Operations\n  // =====================\n  async getPushSubscriptions(userId: string): Promise<PushSubscription[]> {\n    return await db.select().from(pushSubscriptions).where(eq(pushSubscriptions.userId, userId));\n  }\n\n  async getAllPushSubscriptions(): Promise<PushSubscription[]> {\n    return await db.select().from(pushSubscriptions);\n  }\n\n  async createPushSubscription(subscription: InsertPushSubscription): Promise<PushSubscription> {\n    // Check if subscription with same endpoint already exists\n    const existing = await db.select().from(pushSubscriptions).where(eq(pushSubscriptions.endpoint, subscription.endpoint));\n    if (existing.length > 0) {\n      // Update existing subscription\n      const [updated] = await db\n        .update(pushSubscriptions)\n        .set({ ...subscription, updatedAt: new Date() })\n        .where(eq(pushSubscriptions.endpoint, subscription.endpoint))\n        .returning();\n      return updated;\n    }\n    const [newSubscription] = await db.insert(pushSubscriptions).values(subscription).returning();\n    return newSubscription;\n  }\n\n  async deletePushSubscription(endpoint: string, userId: string): Promise<void> {\n    await db.delete(pushSubscriptions).where(\n      and(\n        eq(pushSubscriptions.endpoint, endpoint),\n        eq(pushSubscriptions.userId, userId)\n      )\n    );\n  }\n\n  async deletePushSubscriptionsByUser(userId: string): Promise<void> {\n    await db.delete(pushSubscriptions).where(eq(pushSubscriptions.userId, userId));\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":74199,"size_tokens":null},"client/src/components/examples/StatusStory.tsx":{"content":"import { StatusStoriesRow } from \"../StatusStory\";\n\nconst mockStories = [\n  { id: \"1\", user: { name: \"Sarah Chen\" }, isViewed: false },\n  { id: \"2\", user: { name: \"James Wilson\" }, isViewed: false },\n  { id: \"3\", user: { name: \"Maria Garcia\" }, isViewed: true },\n  { id: \"4\", user: { name: \"David Kim\" }, isViewed: true },\n];\n\nexport default function StatusStoryExample() {\n  return (\n    <StatusStoriesRow\n      stories={mockStories}\n      currentUser={{ name: \"You\" }}\n      onStoryClick={(id) => console.log(\"View story:\", id)}\n      onAddStory={() => console.log(\"Add story\")}\n    />\n  );\n}\n","path":null,"size_bytes":595,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/examples/JobPostingCard.tsx":{"content":"import { useState } from \"react\";\nimport { JobPostingCard } from \"../JobPostingCard\";\n\nexport default function JobPostingCardExample() {\n  const [jobs, setJobs] = useState([\n    { id: \"1\", title: \"Senior Frontend Developer\", department: \"Engineering\", location: \"Remote\", type: \"Full-time\", salary: \"$120k - $150k\", postedDays: 3, isPublished: true },\n    { id: \"2\", title: \"Product Designer\", department: \"Design\", location: \"Remote\", type: \"Full-time\", salary: \"$90k - $120k\", postedDays: 7, isPublished: true },\n    { id: \"3\", title: \"Marketing Manager\", department: \"Marketing\", location: \"Hybrid\", type: \"Full-time\", salary: \"$80k - $100k\", postedDays: 1, isPublished: false },\n  ]);\n\n  const handleToggle = (id: string, published: boolean) => {\n    setJobs(prev => prev.map(job => job.id === id ? { ...job, isPublished: published } : job));\n    console.log(`Job ${id} is now ${published ? \"published\" : \"draft\"}`);\n  };\n\n  return (\n    <div className=\"space-y-3\">\n      {jobs.map(job => (\n        <JobPostingCard\n          key={job.id}\n          {...job}\n          isEditable\n          onTogglePublish={handleToggle}\n          onEdit={(id) => console.log(\"Edit job:\", id)}\n        />\n      ))}\n    </div>\n  );\n}\n","path":null,"size_bytes":1218,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/MeetingCard.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { UserAvatar } from \"./UserAvatar\";\nimport { Video, Clock, MapPin, Trash2 } from \"lucide-react\";\n\ninterface MeetingCardProps {\n  id: string;\n  title: string;\n  time: string;\n  date: string;\n  participants: Array<{ name: string; avatar?: string | null }>;\n  room: string;\n  onJoin?: () => void;\n  onDelete?: () => void;\n}\n\nexport function MeetingCard({ id, title, time, date, participants, room, onJoin, onDelete }: MeetingCardProps) {\n  return (\n    <Card data-testid={`card-meeting-${id}`}>\n      <CardContent className=\"p-4\">\n        <div className=\"flex items-start justify-between gap-4\">\n          <div className=\"flex-1 min-w-0\">\n            <p className=\"font-medium\">{title}</p>\n            <div className=\"flex items-center gap-3 mt-2 text-sm text-muted-foreground flex-wrap\">\n              <span className=\"flex items-center gap-1\">\n                <Clock className=\"h-3.5 w-3.5\" />\n                {time}\n              </span>\n              <span className=\"flex items-center gap-1\">\n                <MapPin className=\"h-3.5 w-3.5\" />\n                {room}\n              </span>\n            </div>\n            <div className=\"flex items-center gap-2 mt-3\">\n              <div className=\"flex -space-x-2\">\n                {participants.slice(0, 3).map((p, i) => (\n                  <UserAvatar\n                    key={i}\n                    name={p.name}\n                    avatar={p.avatar}\n                    size=\"sm\"\n                    className=\"ring-2 ring-background\"\n                  />\n                ))}\n              </div>\n              {participants.length > 3 && (\n                <span className=\"text-xs text-muted-foreground\">\n                  +{participants.length - 3} more\n                </span>\n              )}\n            </div>\n          </div>\n          <div className=\"flex flex-col gap-2\">\n            <Button size=\"sm\" onClick={onJoin} data-testid={`button-join-meeting-${id}`}>\n              <Video className=\"h-4 w-4 mr-1\" />\n              Join\n            </Button>\n            {onDelete && (\n              <Button \n                size=\"sm\" \n                variant=\"destructive\" \n                onClick={onDelete} \n                data-testid={`button-delete-meeting-${id}`}\n              >\n                <Trash2 className=\"h-4 w-4 mr-1\" />\n                Delete\n              </Button>\n            )}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2544,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route, useLocation } from \"wouter\";\nimport { queryClient, apiRequest } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider } from \"@/components/ui/sidebar\";\nimport { ThemeProvider } from \"@/contexts/ThemeContext\";\nimport { AppSidebar } from \"@/components/AppSidebar\";\nimport { VisitorSidebar } from \"@/components/VisitorSidebar\";\nimport { TopHeader } from \"@/components/TopHeader\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport NotFound from \"@/pages/not-found\";\nimport Landing from \"@/pages/Landing\";\nimport Dashboard from \"@/pages/Dashboard\";\nimport Welcome from \"@/pages/Welcome\";\nimport Tasks from \"@/pages/Tasks\";\nimport Tickets from \"@/pages/Tickets\";\nimport SocialFeed from \"@/pages/SocialFeed\";\nimport Messages from \"@/pages/Messages\";\nimport Meetings from \"@/pages/Meetings\";\nimport Team from \"@/pages/Team\";\nimport Jobs from \"@/pages/Jobs\";\nimport Finances from \"@/pages/Finances\";\nimport AccessControl from \"@/pages/AccessControl\";\nimport Departments from \"@/pages/Departments\";\nimport Department from \"@/pages/Department\";\nimport EmployeeProfile from \"@/pages/EmployeeProfile\";\nimport MyEmployeeProfile from \"@/pages/MyEmployeeProfile\";\nimport Profile from \"@/pages/Profile\";\nimport VisitorHub from \"@/pages/VisitorHub\";\nimport Subscription from \"@/pages/Subscription\";\nimport Advertising from \"@/pages/Advertising\";\nimport N8nSettings from \"@/pages/N8nSettings\";\nimport Storefront from \"@/pages/Storefront\";\nimport OfficeDetail from \"@/pages/OfficeDetail\";\nimport OfficeManagement from \"@/pages/OfficeManagement\";\nimport OfficeServicesShowcase from \"@/pages/OfficeServicesShowcase\";\nimport Careers from \"@/pages/Careers\";\nimport EmployeePortal from \"@/pages/EmployeePortal\";\nimport InternalMail from \"@/pages/InternalMail\";\nimport { Loader2, ShieldAlert, CreditCard } from \"lucide-react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { useEffect, useRef } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { NotificationPermission } from \"@/components/NotificationPermission\";\nimport type { Subscription as SubscriptionType } from \"@shared/schema\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\ntype UserRole = \"visitor\" | \"member\" | \"manager\" | \"admin\" | \"office_renter\";\n\ninterface RoleGuardProps {\n  allowedRoles: UserRole[];\n  userRole: string | null | undefined;\n  children: React.ReactNode;\n}\n\nfunction RoleGuard({ allowedRoles, userRole, children }: RoleGuardProps) {\n  const role = (userRole || \"member\") as UserRole;\n  \n  if (!allowedRoles.includes(role)) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[60vh] p-6\">\n        <Card className=\"max-w-md w-full\">\n          <CardHeader className=\"text-center\">\n            <div className=\"mx-auto w-12 h-12 bg-destructive/10 rounded-full flex items-center justify-center mb-4\">\n              <ShieldAlert className=\"h-6 w-6 text-destructive\" />\n            </div>\n            <CardTitle>Access Denied</CardTitle>\n            <CardDescription>\n              You don't have permission to view this page. This area is restricted to {allowedRoles.join(\" or \")} users.\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"flex justify-center\">\n            <Button onClick={() => window.location.href = \"/\"} data-testid=\"button-go-dashboard\">\n              Go to Dashboard\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n  \n  return <>{children}</>;\n}\n\ninterface SubscriptionGuardProps {\n  children: React.ReactNode;\n}\n\nfunction SubscriptionGuard({ children }: SubscriptionGuardProps) {\n  const { language } = useLanguage();\n  const t = translations[language];\n  const [, setLocation] = useLocation();\n  \n  const { data: subscription, isLoading } = useQuery<SubscriptionType | null>({\n    queryKey: ['/api/subscriptions/active'],\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[60vh]\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!subscription) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[60vh] p-6\" dir={language === 'ar' ? 'rtl' : 'ltr'}>\n        <Card className=\"max-w-md w-full\">\n          <CardHeader className=\"text-center\">\n            <div className=\"mx-auto w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-4\">\n              <CreditCard className=\"h-6 w-6 text-primary\" />\n            </div>\n            <CardTitle>\n              {language === 'ar' ? \" \" : \"Subscription Required\"}\n            </CardTitle>\n            <CardDescription>\n              {language === 'ar' \n                ? \"       .     .\"\n                : \"You must subscribe first to access office services. Subscribe now to enjoy all the features.\"}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"flex justify-center\">\n            <Button onClick={() => setLocation(\"/subscription\")} data-testid=\"button-go-subscription\">\n              {language === 'ar' ? \" \" : \"Subscribe Now\"}\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return <>{children}</>;\n}\n\nfunction AuthenticatedRouter({ userRole }: { userRole: string | null | undefined }) {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Dashboard} />\n      <Route path=\"/tasks\" component={Tasks} />\n      <Route path=\"/tickets\" component={Tickets} />\n      <Route path=\"/profile\" component={Profile} />\n      <Route path=\"/my-profile\" component={MyEmployeeProfile} />\n      <Route path=\"/feed\" component={SocialFeed} />\n      <Route path=\"/messages\" component={Messages} />\n      <Route path=\"/mail\" component={InternalMail} />\n      <Route path=\"/meetings\" component={Meetings} />\n      <Route path=\"/team\" component={Team} />\n      <Route path=\"/departments\" component={Departments} />\n      <Route path=\"/departments/:id\" component={Department} />\n      <Route path=\"/employees/:username\" component={EmployeeProfile} />\n      <Route path=\"/subscription\" component={Subscription} />\n      \n      {/* Manager & Admin only routes */}\n      <Route path=\"/jobs\">\n        <RoleGuard allowedRoles={[\"manager\", \"admin\"]} userRole={userRole}>\n          <Jobs />\n        </RoleGuard>\n      </Route>\n      <Route path=\"/n8n-settings\">\n        <RoleGuard allowedRoles={[\"manager\", \"admin\"]} userRole={userRole}>\n          <N8nSettings />\n        </RoleGuard>\n      </Route>\n      <Route path=\"/office-management\">\n        <RoleGuard allowedRoles={[\"manager\", \"admin\"]} userRole={userRole}>\n          <OfficeManagement />\n        </RoleGuard>\n      </Route>\n      <Route path=\"/services-showcase\">\n        <RoleGuard allowedRoles={[\"manager\", \"admin\"]} userRole={userRole}>\n          <OfficeServicesShowcase />\n        </RoleGuard>\n      </Route>\n      \n      {/* Admin only routes */}\n      <Route path=\"/finances\">\n        <RoleGuard allowedRoles={[\"admin\"]} userRole={userRole}>\n          <Finances />\n        </RoleGuard>\n      </Route>\n      <Route path=\"/advertising\">\n        <RoleGuard allowedRoles={[\"admin\"]} userRole={userRole}>\n          <Advertising />\n        </RoleGuard>\n      </Route>\n      <Route path=\"/access\">\n        <RoleGuard allowedRoles={[\"admin\"]} userRole={userRole}>\n          <AccessControl />\n        </RoleGuard>\n      </Route>\n      \n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction VisitorRouter() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Welcome} />\n      <Route path=\"/welcome\" component={Welcome} />\n      <Route path=\"/visitor/offices\" component={Storefront} />\n      <Route path=\"/visitor/services\" component={VisitorHub} />\n      <Route path=\"/visitor/contact\" component={VisitorHub} />\n      <Route path=\"/careers\" component={Careers} />\n      <Route path=\"/office/:slug\" component={OfficeDetail} />\n      <Route path=\"/profile\" component={Profile} />\n      <Route component={Welcome} />\n    </Switch>\n  );\n}\n\nfunction ProtectedDashboard() {\n  return (\n    <SubscriptionGuard>\n      <Dashboard />\n    </SubscriptionGuard>\n  );\n}\n\nfunction ProtectedOfficeManagement() {\n  return (\n    <SubscriptionGuard>\n      <OfficeManagement />\n    </SubscriptionGuard>\n  );\n}\n\nfunction ProtectedOfficeServicesShowcase() {\n  return (\n    <SubscriptionGuard>\n      <OfficeServicesShowcase />\n    </SubscriptionGuard>\n  );\n}\n\nfunction OfficeRenterRouter() {\n  return (\n    <Switch>\n      <Route path=\"/my-subscriptions\" component={Subscription} />\n      <Route path=\"/profile\" component={Profile} />\n      <Route path=\"/office/:slug\" component={OfficeDetail} />\n      \n      {/* Protected routes - require subscription */}\n      <Route path=\"/\" component={ProtectedDashboard} />\n      <Route path=\"/my-office\" component={ProtectedOfficeManagement} />\n      <Route path=\"/my-services\" component={ProtectedOfficeServicesShowcase} />\n      <Route component={ProtectedDashboard} />\n    </Switch>\n  );\n}\n\nfunction AuthenticatedApp() {\n  const { user } = useAuth();\n  const [location, setLocation] = useLocation();\n  const hasRedirected = useRef(false);\n  \n  const sidebarStyle = {\n    \"--sidebar-width\": \"16rem\",\n    \"--sidebar-width-icon\": \"3rem\",\n  };\n\n  const isVisitorRole = user?.role === \"visitor\";\n  const isOfficeRenterRole = user?.role === \"office_renter\";\n\n  useEffect(() => {\n    if (hasRedirected.current) return;\n    \n    const redirectPath = localStorage.getItem(\"cloudoffice_redirect\");\n    if (redirectPath) {\n      localStorage.removeItem(\"cloudoffice_redirect\");\n      hasRedirected.current = true;\n      setLocation(redirectPath);\n      return;\n    }\n\n    if (isVisitorRole && location === \"/\") {\n      hasRedirected.current = true;\n      setLocation(\"/welcome\");\n    }\n  }, [isVisitorRole, location, setLocation]);\n\n  // Heartbeat to update online status every 2 minutes\n  useEffect(() => {\n    const sendHeartbeat = async () => {\n      try {\n        await apiRequest(\"POST\", \"/api/auth/heartbeat\");\n      } catch (error) {\n        console.error(\"Heartbeat failed:\", error);\n      }\n    };\n\n    // Send initial heartbeat\n    sendHeartbeat();\n\n    // Set up interval for heartbeat every 2 minutes\n    const interval = setInterval(sendHeartbeat, 2 * 60 * 1000);\n\n    return () => clearInterval(interval);\n  }, []);\n\n  if (isVisitorRole) {\n    return (\n      <SidebarProvider style={sidebarStyle as React.CSSProperties}>\n        <div className=\"flex h-screen w-full\">\n          <VisitorSidebar user={user} />\n          <div className=\"flex flex-col flex-1 overflow-hidden\">\n            <TopHeader />\n            <main className=\"flex-1 overflow-auto bg-background\">\n              <VisitorRouter />\n            </main>\n          </div>\n        </div>\n      </SidebarProvider>\n    );\n  }\n\n  if (isOfficeRenterRole) {\n    return (\n      <SidebarProvider style={sidebarStyle as React.CSSProperties}>\n        <div className=\"flex h-screen w-full\">\n          <AppSidebar user={user} />\n          <div className=\"flex flex-col flex-1 overflow-hidden\">\n            <TopHeader />\n            <main className=\"flex-1 overflow-auto bg-background\">\n              <OfficeRenterRouter />\n            </main>\n          </div>\n        </div>\n      </SidebarProvider>\n    );\n  }\n\n  return (\n    <SidebarProvider style={sidebarStyle as React.CSSProperties}>\n      <div className=\"flex h-screen w-full\">\n        <AppSidebar user={user} />\n        <div className=\"flex flex-col flex-1 overflow-hidden\">\n          <TopHeader />\n          <main className=\"flex-1 overflow-auto bg-background\">\n            <AuthenticatedRouter userRole={user?.role} />\n          </main>\n        </div>\n      </div>\n    </SidebarProvider>\n  );\n}\n\nfunction PublicRouter() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Landing} />\n      <Route path=\"/storefront\" component={Storefront} />\n      <Route path=\"/office/:slug\" component={OfficeDetail} />\n      <Route path=\"/visitor\" component={VisitorHub} />\n      <Route path=\"/careers\" component={Careers} />\n      <Route path=\"/employee-portal\" component={EmployeePortal} />\n      <Route component={Landing} />\n    </Switch>\n  );\n}\n\nfunction AppContent() {\n  const { isAuthenticated, isLoading } = useAuth();\n  const [location] = useLocation();\n\n  const publicRoutes = [\"/\", \"/visitor\", \"/storefront\", \"/careers\", \"/employee-portal\"];\n  const isPublicRoute = publicRoutes.includes(location) || location.startsWith(\"/office/\");\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-screen bg-background\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return <PublicRouter />;\n  }\n\n  return <AuthenticatedApp />;\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider>\n        <TooltipProvider>\n          <AppContent />\n          <Toaster />\n          <NotificationPermission />\n        </TooltipProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":13489,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/components/UserAvatar.tsx":{"content":"import { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { cn } from \"@/lib/utils\";\n\ninterface UserAvatarProps {\n  name: string;\n  avatar?: string | null;\n  size?: \"sm\" | \"md\" | \"lg\";\n  status?: \"online\" | \"away\" | \"busy\" | \"offline\";\n  className?: string;\n}\n\nconst sizeClasses = {\n  sm: \"h-8 w-8\",\n  md: \"h-10 w-10\",\n  lg: \"h-12 w-12\",\n};\n\nconst statusClasses = {\n  online: \"bg-status-online\",\n  away: \"bg-status-away\",\n  busy: \"bg-status-busy\",\n  offline: \"bg-status-offline\",\n};\n\nexport function UserAvatar({ name, avatar, size = \"md\", status, className }: UserAvatarProps) {\n  const initials = name\n    .split(\" \")\n    .map((n) => n[0])\n    .join(\"\")\n    .toUpperCase()\n    .slice(0, 2);\n\n  return (\n    <div className=\"relative inline-block\">\n      <Avatar className={cn(sizeClasses[size], className)}>\n        {avatar && <AvatarImage src={avatar} alt={name} />}\n        <AvatarFallback className=\"bg-primary/10 text-primary text-sm font-medium\">\n          {initials}\n        </AvatarFallback>\n      </Avatar>\n      {status && (\n        <span\n          className={cn(\n            \"absolute bottom-0 right-0 block rounded-full ring-2 ring-background\",\n            statusClasses[status],\n            size === \"sm\" ? \"h-2 w-2\" : size === \"md\" ? \"h-2.5 w-2.5\" : \"h-3 w-3\"\n          )}\n        />\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":1352,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/pages/Department.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useParams, Link } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Progress } from \"@/components/ui/progress\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport {\n  ArrowLeft,\n  Plus,\n  Users,\n  Mail,\n  Phone,\n  Briefcase,\n  Trash2,\n  Edit,\n  User,\n  Calendar,\n  Star,\n  Calculator,\n  FileText,\n  DollarSign,\n  TrendingUp,\n  Receipt,\n  CreditCard,\n  HeartHandshake,\n  UserCheck,\n  ClipboardList,\n  GraduationCap,\n  Clock,\n  Award,\n  Scale,\n  FileSearch,\n  Shield,\n  BookOpen,\n  Gavel,\n  Megaphone,\n  BarChart3,\n  Target,\n  Share2,\n  Palette,\n  Settings,\n  Package,\n  ListChecks,\n  Gauge,\n  Truck,\n  PieChart,\n  MessageSquare,\n  FolderOpen,\n  Bell,\n  Wrench,\n} from \"lucide-react\";\nimport type { Department as DepartmentType, RemoteEmployee } from \"@shared/schema\";\n\ninterface Tool {\n  id: string;\n  name: string;\n  description: string;\n  icon: typeof Calculator;\n  color: string;\n}\n\ninterface ToolCategory {\n  specialty: string;\n  tools: Tool[];\n}\n\nconst departmentTools: Record<string, Tool[]> = {\n  calculator: [\n    { id: \"budget\", name: \"Budget Planner\", description: \"Plan and track departmental budgets\", icon: Calculator, color: \"text-blue-500\" },\n    { id: \"expenses\", name: \"Expense Tracker\", description: \"Log and categorize expenses\", icon: Receipt, color: \"text-green-500\" },\n    { id: \"invoices\", name: \"Invoice Manager\", description: \"Create and manage invoices\", icon: FileText, color: \"text-purple-500\" },\n    { id: \"reports\", name: \"Financial Reports\", description: \"Generate financial summaries\", icon: TrendingUp, color: \"text-orange-500\" },\n    { id: \"payroll\", name: \"Payroll Calculator\", description: \"Calculate employee payments\", icon: CreditCard, color: \"text-pink-500\" },\n    { id: \"forecast\", name: \"Cash Flow Forecast\", description: \"Project future cash flows\", icon: PieChart, color: \"text-cyan-500\" },\n  ],\n  hearthandshake: [\n    { id: \"leave\", name: \"Leave Tracker\", description: \"Manage employee leave requests\", icon: Clock, color: \"text-blue-500\" },\n    { id: \"performance\", name: \"Performance Reviews\", description: \"Track employee evaluations\", icon: Award, color: \"text-yellow-500\" },\n    { id: \"directory\", name: \"Employee Directory\", description: \"Searchable employee database\", icon: Users, color: \"text-green-500\" },\n    { id: \"recruitment\", name: \"Recruitment Pipeline\", description: \"Track hiring progress\", icon: UserCheck, color: \"text-purple-500\" },\n    { id: \"training\", name: \"Training Manager\", description: \"Organize training programs\", icon: GraduationCap, color: \"text-orange-500\" },\n    { id: \"onboarding\", name: \"Onboarding Checklist\", description: \"New hire onboarding tasks\", icon: ClipboardList, color: \"text-pink-500\" },\n  ],\n  scale: [\n    { id: \"contracts\", name: \"Contract Templates\", description: \"Legal document templates\", icon: FileText, color: \"text-blue-500\" },\n    { id: \"compliance\", name: \"Compliance Checklist\", description: \"Regulatory requirements tracker\", icon: Shield, color: \"text-green-500\" },\n    { id: \"cases\", name: \"Case Tracker\", description: \"Manage legal cases and matters\", icon: FileSearch, color: \"text-purple-500\" },\n    { id: \"documents\", name: \"Document Repository\", description: \"Secure legal document storage\", icon: FolderOpen, color: \"text-orange-500\" },\n    { id: \"policies\", name: \"Policy Manager\", description: \"Company policy management\", icon: BookOpen, color: \"text-cyan-500\" },\n    { id: \"disputes\", name: \"Dispute Resolution\", description: \"Track and resolve disputes\", icon: Gavel, color: \"text-red-500\" },\n  ],\n  megaphone: [\n    { id: \"campaigns\", name: \"Campaign Tracker\", description: \"Monitor marketing campaigns\", icon: Target, color: \"text-blue-500\" },\n    { id: \"content\", name: \"Content Calendar\", description: \"Plan content schedule\", icon: Calendar, color: \"text-green-500\" },\n    { id: \"analytics\", name: \"Analytics Dashboard\", description: \"Track marketing metrics\", icon: BarChart3, color: \"text-purple-500\" },\n    { id: \"social\", name: \"Social Media Manager\", description: \"Manage social accounts\", icon: Share2, color: \"text-pink-500\" },\n    { id: \"brand\", name: \"Brand Assets\", description: \"Brand guidelines and assets\", icon: Palette, color: \"text-orange-500\" },\n    { id: \"leads\", name: \"Lead Generation\", description: \"Track marketing leads\", icon: TrendingUp, color: \"text-cyan-500\" },\n  ],\n  settings: [\n    { id: \"projects\", name: \"Project Tracker\", description: \"Monitor project progress\", icon: ListChecks, color: \"text-blue-500\" },\n    { id: \"inventory\", name: \"Inventory Manager\", description: \"Track stock and supplies\", icon: Package, color: \"text-green-500\" },\n    { id: \"processes\", name: \"Process Documentation\", description: \"Document workflows\", icon: BookOpen, color: \"text-purple-500\" },\n    { id: \"quality\", name: \"Quality Metrics\", description: \"Track quality standards\", icon: Gauge, color: \"text-orange-500\" },\n    { id: \"vendors\", name: \"Vendor Management\", description: \"Manage supplier relationships\", icon: Truck, color: \"text-cyan-500\" },\n    { id: \"maintenance\", name: \"Maintenance Scheduler\", description: \"Schedule equipment maintenance\", icon: Wrench, color: \"text-red-500\" },\n  ],\n  dollarSign: [\n    { id: \"pipeline\", name: \"Sales Pipeline\", description: \"Track deals and opportunities\", icon: TrendingUp, color: \"text-blue-500\" },\n    { id: \"leads\", name: \"Lead Tracker\", description: \"Manage sales leads\", icon: Target, color: \"text-green-500\" },\n    { id: \"quotes\", name: \"Quote Generator\", description: \"Create sales proposals\", icon: FileText, color: \"text-purple-500\" },\n    { id: \"clients\", name: \"Client Database\", description: \"Customer relationship manager\", icon: Users, color: \"text-orange-500\" },\n    { id: \"commission\", name: \"Commission Calculator\", description: \"Calculate sales commissions\", icon: Calculator, color: \"text-pink-500\" },\n    { id: \"forecasts\", name: \"Sales Forecasts\", description: \"Project future sales\", icon: PieChart, color: \"text-cyan-500\" },\n  ],\n  users: [\n    { id: \"calendar\", name: \"Team Calendar\", description: \"Shared team schedule\", icon: Calendar, color: \"text-blue-500\" },\n    { id: \"resources\", name: \"Resource Allocation\", description: \"Assign team resources\", icon: Users, color: \"text-green-500\" },\n    { id: \"meetings\", name: \"Meeting Scheduler\", description: \"Plan team meetings\", icon: Clock, color: \"text-purple-500\" },\n    { id: \"board\", name: \"Collaboration Board\", description: \"Team task board\", icon: ListChecks, color: \"text-orange-500\" },\n    { id: \"analytics\", name: \"Team Analytics\", description: \"Team performance metrics\", icon: BarChart3, color: \"text-pink-500\" },\n    { id: \"chat\", name: \"Team Chat\", description: \"Internal messaging\", icon: MessageSquare, color: \"text-cyan-500\" },\n  ],\n  briefcase: [\n    { id: \"tasks\", name: \"Task Board\", description: \"Manage team tasks\", icon: ListChecks, color: \"text-blue-500\" },\n    { id: \"notes\", name: \"Team Notes\", description: \"Shared documentation\", icon: FileText, color: \"text-green-500\" },\n    { id: \"files\", name: \"File Manager\", description: \"Organize team files\", icon: FolderOpen, color: \"text-purple-500\" },\n    { id: \"calendar\", name: \"Department Calendar\", description: \"Schedule and events\", icon: Calendar, color: \"text-orange-500\" },\n    { id: \"announcements\", name: \"Announcements\", description: \"Team updates and news\", icon: Bell, color: \"text-pink-500\" },\n    { id: \"directory\", name: \"Contact Directory\", description: \"Quick contact lookup\", icon: Users, color: \"text-cyan-500\" },\n  ],\n};\n\nexport default function Department() {\n  const { id } = useParams<{ id: string }>();\n  const departmentId = parseInt(id || \"0\");\n  const { toast } = useToast();\n  const [newEmployeeOpen, setNewEmployeeOpen] = useState(false);\n  const [editEmployee, setEditEmployee] = useState<RemoteEmployee | null>(null);\n  const [selectedTool, setSelectedTool] = useState<Tool | null>(null);\n  const [activeTab, setActiveTab] = useState(\"employees\");\n\n  const [username, setUsername] = useState(\"\");\n  const [firstName, setFirstName] = useState(\"\");\n  const [lastName, setLastName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [phone, setPhone] = useState(\"\");\n  const [jobTitle, setJobTitle] = useState(\"\");\n  const [bio, setBio] = useState(\"\");\n  const [skills, setSkills] = useState(\"\");\n\n  const { data: department, isLoading: departmentLoading } = useQuery<DepartmentType>({\n    queryKey: [\"/api/departments\", departmentId],\n  });\n\n  const { data: employees = [], isLoading: employeesLoading } = useQuery<RemoteEmployee[]>({\n    queryKey: [\"/api/departments\", departmentId, \"employees\"],\n  });\n\n  const createEmployeeMutation = useMutation({\n    mutationFn: async (data: {\n      username: string;\n      firstName: string;\n      lastName: string;\n      email?: string;\n      phone?: string;\n      jobTitle?: string;\n      bio?: string;\n      skills?: string;\n    }) => {\n      const res = await apiRequest(\"POST\", `/api/departments/${departmentId}/employees`, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/departments\", departmentId, \"employees\"] });\n      resetForm();\n      setNewEmployeeOpen(false);\n      toast({ title: \"Employee Added\", description: \"Remote employee has been added to the department.\" });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error?.message || \"Failed to add employee. Username may already exist.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateEmployeeMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: Partial<RemoteEmployee> }) => {\n      const res = await apiRequest(\"PATCH\", `/api/employees/${id}`, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/departments\", departmentId, \"employees\"] });\n      setEditEmployee(null);\n      resetForm();\n      toast({ title: \"Employee Updated\", description: \"Employee information has been updated.\" });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to update employee.\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteEmployeeMutation = useMutation({\n    mutationFn: async (employeeId: number) => {\n      await apiRequest(\"DELETE\", `/api/employees/${employeeId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/departments\", departmentId, \"employees\"] });\n      toast({ title: \"Employee Removed\", description: \"Employee has been removed from the department.\" });\n    },\n  });\n\n  const resetForm = () => {\n    setUsername(\"\");\n    setFirstName(\"\");\n    setLastName(\"\");\n    setEmail(\"\");\n    setPhone(\"\");\n    setJobTitle(\"\");\n    setBio(\"\");\n    setSkills(\"\");\n  };\n\n  const openEditDialog = (employee: RemoteEmployee) => {\n    setEditEmployee(employee);\n    setUsername(employee.username);\n    setFirstName(employee.firstName);\n    setLastName(employee.lastName);\n    setEmail(employee.email || \"\");\n    setPhone(employee.phone || \"\");\n    setJobTitle(employee.jobTitle || \"\");\n    setBio(employee.bio || \"\");\n    setSkills(employee.skills || \"\");\n  };\n\n  const handleSubmit = () => {\n    const data = {\n      username,\n      firstName,\n      lastName,\n      email: email || undefined,\n      phone: phone || undefined,\n      jobTitle: jobTitle || undefined,\n      bio: bio || undefined,\n      skills: skills || undefined,\n    };\n\n    if (editEmployee) {\n      updateEmployeeMutation.mutate({ id: editEmployee.id, data });\n    } else {\n      createEmployeeMutation.mutate(data);\n    }\n  };\n\n  const normalizeIconKey = (icon: string): string => {\n    const iconMap: Record<string, string> = {\n      \"dollar-sign\": \"dollarSign\",\n      \"dollarsign\": \"dollarSign\",\n      \"heart-handshake\": \"hearthandshake\",\n    };\n    return iconMap[icon.toLowerCase()] || icon;\n  };\n\n  const getDepartmentTools = () => {\n    if (!department) return [];\n    const normalizedIcon = normalizeIconKey(department.icon || \"briefcase\");\n    return departmentTools[normalizedIcon] || departmentTools.briefcase;\n  };\n\n  const getSpecialtyLabel = (icon: string) => {\n    const normalizedIcon = normalizeIconKey(icon);\n    const labels: Record<string, string> = {\n      calculator: \"Finance\",\n      hearthandshake: \"Human Resources\",\n      scale: \"Legal\",\n      megaphone: \"Marketing\",\n      settings: \"Operations\",\n      dollarSign: \"Sales\",\n      users: \"Team\",\n      briefcase: \"General\",\n    };\n    return labels[normalizedIcon] || \"General\";\n  };\n\n  if (departmentLoading) {\n    return (\n      <div className=\"p-4 md:p-6 space-y-6 max-w-6xl mx-auto\">\n        <Skeleton className=\"h-8 w-64\" />\n        <Skeleton className=\"h-4 w-48\" />\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          {Array(4).fill(0).map((_, i) => <Skeleton key={i} className=\"h-40 w-full\" />)}\n        </div>\n      </div>\n    );\n  }\n\n  if (!department) {\n    return (\n      <div className=\"p-4 md:p-6 max-w-6xl mx-auto\">\n        <Card className=\"p-8 text-center\">\n          <p className=\"text-muted-foreground\">Department not found</p>\n          <Link href=\"/departments\">\n            <Button variant=\"outline\" className=\"mt-4\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Departments\n            </Button>\n          </Link>\n        </Card>\n      </div>\n    );\n  }\n\n  const tools = getDepartmentTools();\n\n  const EmployeeDialog = (\n    <Dialog\n      open={newEmployeeOpen || !!editEmployee}\n      onOpenChange={(open) => {\n        if (!open) {\n          setNewEmployeeOpen(false);\n          setEditEmployee(null);\n          resetForm();\n        }\n      }}\n    >\n      <DialogContent className=\"max-w-lg max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>{editEmployee ? \"Edit Employee\" : \"Add Remote Employee\"}</DialogTitle>\n          <DialogDescription>\n            {editEmployee\n              ? \"Update employee information.\"\n              : \"Add a new remote employee with a unique username.\"}\n          </DialogDescription>\n        </DialogHeader>\n        <div className=\"space-y-4 py-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"username\">Username *</Label>\n            <Input\n              id=\"username\"\n              placeholder=\"e.g., john.doe\"\n              value={username}\n              onChange={(e) => setUsername(e.target.value.toLowerCase().replace(/\\s/g, \".\"))}\n              disabled={!!editEmployee}\n              data-testid=\"input-employee-username\"\n            />\n            <p className=\"text-xs text-muted-foreground\">\n              Unique identifier for the employee. Cannot be changed after creation.\n            </p>\n          </div>\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"firstName\">First Name *</Label>\n              <Input\n                id=\"firstName\"\n                placeholder=\"John\"\n                value={firstName}\n                onChange={(e) => setFirstName(e.target.value)}\n                data-testid=\"input-employee-firstname\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"lastName\">Last Name *</Label>\n              <Input\n                id=\"lastName\"\n                placeholder=\"Doe\"\n                value={lastName}\n                onChange={(e) => setLastName(e.target.value)}\n                data-testid=\"input-employee-lastname\"\n              />\n            </div>\n          </div>\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"jobTitle\">Job Title</Label>\n            <Input\n              id=\"jobTitle\"\n              placeholder=\"e.g., Senior Accountant\"\n              value={jobTitle}\n              onChange={(e) => setJobTitle(e.target.value)}\n              data-testid=\"input-employee-jobtitle\"\n            />\n          </div>\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Email</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"john@example.com\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                data-testid=\"input-employee-email\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"phone\">Phone</Label>\n              <Input\n                id=\"phone\"\n                placeholder=\"+1 234 567 890\"\n                value={phone}\n                onChange={(e) => setPhone(e.target.value)}\n                data-testid=\"input-employee-phone\"\n              />\n            </div>\n          </div>\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"bio\">Bio</Label>\n            <Textarea\n              id=\"bio\"\n              placeholder=\"Brief description...\"\n              value={bio}\n              onChange={(e) => setBio(e.target.value)}\n              data-testid=\"input-employee-bio\"\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"skills\">Skills</Label>\n            <Input\n              id=\"skills\"\n              placeholder=\"e.g., Excel, QuickBooks, Financial Analysis\"\n              value={skills}\n              onChange={(e) => setSkills(e.target.value)}\n              data-testid=\"input-employee-skills\"\n            />\n          </div>\n        </div>\n        <DialogFooter>\n          <Button\n            onClick={handleSubmit}\n            disabled={\n              !username ||\n              !firstName ||\n              !lastName ||\n              createEmployeeMutation.isPending ||\n              updateEmployeeMutation.isPending\n            }\n            data-testid=\"button-save-employee\"\n          >\n            {createEmployeeMutation.isPending || updateEmployeeMutation.isPending\n              ? \"Saving...\"\n              : editEmployee\n              ? \"Update Employee\"\n              : \"Add Employee\"}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n\n  const ToolDialog = (\n    <Dialog open={!!selectedTool} onOpenChange={(open) => !open && setSelectedTool(null)}>\n      <DialogContent className=\"max-w-2xl\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            {selectedTool && <selectedTool.icon className={`h-5 w-5 ${selectedTool.color}`} />}\n            {selectedTool?.name}\n          </DialogTitle>\n          <DialogDescription>{selectedTool?.description}</DialogDescription>\n        </DialogHeader>\n        <div className=\"py-6\">\n          {selectedTool?.id === \"budget\" && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <Card>\n                  <CardContent className=\"pt-4\">\n                    <p className=\"text-sm text-muted-foreground\">Total Budget</p>\n                    <p className=\"text-2xl font-bold\">$150,000</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardContent className=\"pt-4\">\n                    <p className=\"text-sm text-muted-foreground\">Spent</p>\n                    <p className=\"text-2xl font-bold text-orange-500\">$87,500</p>\n                  </CardContent>\n                </Card>\n              </div>\n              <div>\n                <div className=\"flex justify-between text-sm mb-2\">\n                  <span>Budget Usage</span>\n                  <span>58%</span>\n                </div>\n                <Progress value={58} />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Add Budget Item</Label>\n                <div className=\"flex gap-2\">\n                  <Input placeholder=\"Description\" className=\"flex-1\" />\n                  <Input placeholder=\"Amount\" type=\"number\" className=\"w-32\" />\n                  <Button>Add</Button>\n                </div>\n              </div>\n            </div>\n          )}\n          {selectedTool?.id === \"expenses\" && (\n            <div className=\"space-y-4\">\n              <div className=\"flex gap-2 mb-4\">\n                <Input placeholder=\"Expense description\" className=\"flex-1\" />\n                <Input placeholder=\"Amount\" type=\"number\" className=\"w-32\" />\n                <Select defaultValue=\"office\">\n                  <SelectTrigger className=\"w-40\">\n                    <SelectValue placeholder=\"Category\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"office\">Office</SelectItem>\n                    <SelectItem value=\"travel\">Travel</SelectItem>\n                    <SelectItem value=\"supplies\">Supplies</SelectItem>\n                    <SelectItem value=\"software\">Software</SelectItem>\n                  </SelectContent>\n                </Select>\n                <Button>Log</Button>\n              </div>\n              <div className=\"border rounded-lg divide-y\">\n                {[\n                  { desc: \"Office supplies\", amount: 250, cat: \"Supplies\", date: \"Dec 1\" },\n                  { desc: \"Software license\", amount: 1200, cat: \"Software\", date: \"Nov 28\" },\n                  { desc: \"Team lunch\", amount: 180, cat: \"Office\", date: \"Nov 25\" },\n                ].map((exp, i) => (\n                  <div key={i} className=\"flex items-center justify-between p-3\">\n                    <div>\n                      <p className=\"font-medium\">{exp.desc}</p>\n                      <p className=\"text-xs text-muted-foreground\">{exp.cat} - {exp.date}</p>\n                    </div>\n                    <p className=\"font-semibold\">${exp.amount}</p>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n          {selectedTool?.id === \"leave\" && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-3 gap-4\">\n                <Card>\n                  <CardContent className=\"pt-4 text-center\">\n                    <p className=\"text-2xl font-bold text-green-500\">12</p>\n                    <p className=\"text-xs text-muted-foreground\">Available Days</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardContent className=\"pt-4 text-center\">\n                    <p className=\"text-2xl font-bold text-orange-500\">3</p>\n                    <p className=\"text-xs text-muted-foreground\">Pending Requests</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardContent className=\"pt-4 text-center\">\n                    <p className=\"text-2xl font-bold\">8</p>\n                    <p className=\"text-xs text-muted-foreground\">Days Used</p>\n                  </CardContent>\n                </Card>\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Request Leave</Label>\n                <div className=\"flex gap-2\">\n                  <Input type=\"date\" className=\"flex-1\" />\n                  <Input type=\"date\" className=\"flex-1\" />\n                  <Select defaultValue=\"vacation\">\n                    <SelectTrigger className=\"w-40\">\n                      <SelectValue placeholder=\"Type\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"vacation\">Vacation</SelectItem>\n                      <SelectItem value=\"sick\">Sick Leave</SelectItem>\n                      <SelectItem value=\"personal\">Personal</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <Button>Submit</Button>\n                </div>\n              </div>\n            </div>\n          )}\n          {selectedTool?.id === \"performance\" && (\n            <div className=\"space-y-4\">\n              <div className=\"border rounded-lg divide-y\">\n                {employees.slice(0, 3).map((emp) => (\n                  <div key={emp.id} className=\"flex items-center justify-between p-3\">\n                    <div className=\"flex items-center gap-3\">\n                      <Avatar className=\"h-8 w-8\">\n                        <AvatarFallback>{emp.firstName[0]}{emp.lastName[0]}</AvatarFallback>\n                      </Avatar>\n                      <div>\n                        <p className=\"font-medium\">{emp.firstName} {emp.lastName}</p>\n                        <p className=\"text-xs text-muted-foreground\">{emp.jobTitle || \"Team Member\"}</p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"flex\">\n                        {[1,2,3,4,5].map((star) => (\n                          <Star key={star} className={`h-4 w-4 ${star <= 4 ? 'text-yellow-500 fill-yellow-500' : 'text-muted'}`} />\n                        ))}\n                      </div>\n                      <Button size=\"sm\" variant=\"outline\">Review</Button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n          {selectedTool?.id === \"pipeline\" && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-4 gap-3\">\n                {[\"Lead\", \"Qualified\", \"Proposal\", \"Closed\"].map((stage, i) => (\n                  <div key={stage} className=\"text-center\">\n                    <div className=\"bg-muted rounded-lg p-3 mb-2\">\n                      <p className=\"text-2xl font-bold\">{[12, 8, 5, 3][i]}</p>\n                    </div>\n                    <p className=\"text-sm font-medium\">{stage}</p>\n                  </div>\n                ))}\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Add New Deal</Label>\n                <div className=\"flex gap-2\">\n                  <Input placeholder=\"Deal name\" className=\"flex-1\" />\n                  <Input placeholder=\"Value\" type=\"number\" className=\"w-32\" />\n                  <Button>Add</Button>\n                </div>\n              </div>\n            </div>\n          )}\n          {selectedTool?.id === \"campaigns\" && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-3 gap-4\">\n                <Card>\n                  <CardContent className=\"pt-4 text-center\">\n                    <p className=\"text-2xl font-bold text-blue-500\">5</p>\n                    <p className=\"text-xs text-muted-foreground\">Active Campaigns</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardContent className=\"pt-4 text-center\">\n                    <p className=\"text-2xl font-bold text-green-500\">24.5K</p>\n                    <p className=\"text-xs text-muted-foreground\">Total Reach</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardContent className=\"pt-4 text-center\">\n                    <p className=\"text-2xl font-bold text-purple-500\">3.2%</p>\n                    <p className=\"text-xs text-muted-foreground\">Conversion Rate</p>\n                  </CardContent>\n                </Card>\n              </div>\n              <div className=\"border rounded-lg divide-y\">\n                {[\"Q4 Product Launch\", \"Holiday Sale\", \"Newsletter Campaign\"].map((name, i) => (\n                  <div key={i} className=\"flex items-center justify-between p-3\">\n                    <div>\n                      <p className=\"font-medium\">{name}</p>\n                      <p className=\"text-xs text-muted-foreground\">Active</p>\n                    </div>\n                    <Button size=\"sm\" variant=\"outline\">View</Button>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n          {![\"budget\", \"expenses\", \"leave\", \"performance\", \"pipeline\", \"campaigns\"].includes(selectedTool?.id || \"\") && (\n            <div className=\"text-center py-8\">\n              <div className={`h-16 w-16 rounded-full bg-muted flex items-center justify-center mx-auto mb-4`}>\n                {selectedTool && <selectedTool.icon className={`h-8 w-8 ${selectedTool.color}`} />}\n              </div>\n              <p className=\"text-muted-foreground mb-4\">\n                This tool is ready to be configured for your team.\n              </p>\n              <Button data-testid=\"button-tool-get-started\">Get Started</Button>\n            </div>\n          )}\n        </div>\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={() => setSelectedTool(null)} data-testid=\"button-tool-close\">\n            Close\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n\n  return (\n    <div className=\"p-4 md:p-6 space-y-6 max-w-6xl mx-auto\">\n      {EmployeeDialog}\n      {ToolDialog}\n\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n        <div className=\"flex items-center gap-3\">\n          <Link href=\"/departments\">\n            <Button variant=\"ghost\" size=\"icon\">\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n          </Link>\n          <div>\n            <div className=\"flex items-center gap-2\">\n              <h1 className=\"text-2xl font-bold\" data-testid=\"text-department-name\">{department.name}</h1>\n              <Badge variant=\"secondary\">{getSpecialtyLabel(department.icon || \"briefcase\")}</Badge>\n            </div>\n            {department.description && (\n              <p className=\"text-muted-foreground text-sm\">{department.description}</p>\n            )}\n          </div>\n        </div>\n        <Button onClick={() => setNewEmployeeOpen(true)} data-testid=\"button-add-employee\">\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Add Employee\n        </Button>\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList>\n          <TabsTrigger value=\"employees\" className=\"gap-2\" data-testid=\"tab-employees\">\n            <Users className=\"h-4 w-4\" />\n            Employees ({employees.length})\n          </TabsTrigger>\n          <TabsTrigger value=\"tools\" className=\"gap-2\" data-testid=\"tab-tools\">\n            <Wrench className=\"h-4 w-4\" />\n            Tools ({tools.length})\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"employees\" className=\"mt-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {employeesLoading ? (\n              Array(6).fill(0).map((_, i) => <Skeleton key={i} className=\"h-48 w-full\" />)\n            ) : employees.length === 0 ? (\n              <Card className=\"col-span-full p-8 text-center\">\n                <Users className=\"h-12 w-12 mx-auto text-muted-foreground opacity-50 mb-2\" />\n                <p className=\"text-muted-foreground\">No employees in this department</p>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  Add remote employees to start building your team\n                </p>\n                <Button onClick={() => setNewEmployeeOpen(true)} className=\"mt-4\" data-testid=\"button-add-first-employee\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add First Employee\n                </Button>\n              </Card>\n            ) : (\n              employees.map((employee) => (\n                <Card key={employee.id} className=\"hover-elevate\" data-testid={`employee-card-${employee.id}`}>\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-start gap-3\">\n                      <Avatar className=\"h-12 w-12\">\n                        <AvatarImage src={employee.profileImageUrl || undefined} />\n                        <AvatarFallback className=\"bg-primary/10 text-primary\">\n                          {employee.firstName[0]}{employee.lastName[0]}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-start justify-between gap-2\">\n                          <div>\n                            <h3 className=\"font-semibold\">\n                              {employee.firstName} {employee.lastName}\n                            </h3>\n                            <p className=\"text-xs text-muted-foreground\">@{employee.username}</p>\n                          </div>\n                          <Badge\n                            variant=\"secondary\"\n                            className={\n                              employee.status === \"active\"\n                                ? \"bg-emerald-500/10 text-emerald-500\"\n                                : \"bg-muted text-muted-foreground\"\n                            }\n                          >\n                            {employee.status || \"active\"}\n                          </Badge>\n                        </div>\n                        {employee.jobTitle && (\n                          <p className=\"text-sm text-muted-foreground mt-1 flex items-center gap-1\">\n                            <Briefcase className=\"h-3 w-3\" />\n                            {employee.jobTitle}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n\n                    {employee.bio && (\n                      <p className=\"text-xs text-muted-foreground mt-3 line-clamp-2\">{employee.bio}</p>\n                    )}\n\n                    <div className=\"flex flex-wrap gap-2 mt-3\">\n                      {employee.email && (\n                        <Badge variant=\"outline\" className=\"text-xs gap-1\">\n                          <Mail className=\"h-3 w-3\" />\n                          {employee.email}\n                        </Badge>\n                      )}\n                      {employee.phone && (\n                        <Badge variant=\"outline\" className=\"text-xs gap-1\">\n                          <Phone className=\"h-3 w-3\" />\n                          {employee.phone}\n                        </Badge>\n                      )}\n                    </div>\n\n                    {employee.skills && (\n                      <div className=\"flex flex-wrap gap-1 mt-2\">\n                        {employee.skills.split(\",\").slice(0, 3).map((skill, idx) => (\n                          <Badge key={idx} variant=\"secondary\" className=\"text-xs\">\n                            {skill.trim()}\n                          </Badge>\n                        ))}\n                      </div>\n                    )}\n\n                    <div className=\"flex items-center justify-between mt-4 pt-3 border-t\">\n                      <Link href={`/employees/${employee.username}`}>\n                        <Button size=\"sm\" variant=\"ghost\" data-testid={`button-view-profile-${employee.id}`}>\n                          <User className=\"h-4 w-4 mr-1\" />\n                          View Profile\n                        </Button>\n                      </Link>\n                      <div className=\"flex gap-1\">\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          className=\"h-8 w-8\"\n                          onClick={() => openEditDialog(employee)}\n                          data-testid={`button-edit-employee-${employee.id}`}\n                        >\n                          <Edit className=\"h-3.5 w-3.5\" />\n                        </Button>\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          className=\"h-8 w-8 text-destructive hover:text-destructive\"\n                          onClick={() => deleteEmployeeMutation.mutate(employee.id)}\n                          data-testid={`button-delete-employee-${employee.id}`}\n                        >\n                          <Trash2 className=\"h-3.5 w-3.5\" />\n                        </Button>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))\n            )}\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"tools\" className=\"mt-6\">\n          <div className=\"mb-4\">\n            <h2 className=\"text-lg font-semibold\">{getSpecialtyLabel(department.icon || \"briefcase\")} Tools</h2>\n            <p className=\"text-sm text-muted-foreground\">\n              Specialty tools designed for your {getSpecialtyLabel(department.icon || \"briefcase\").toLowerCase()} team\n            </p>\n          </div>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {tools.map((tool) => (\n              <Card \n                key={tool.id} \n                className=\"hover-elevate cursor-pointer\" \n                onClick={() => setSelectedTool(tool)}\n                data-testid={`tool-card-${tool.id}`}\n              >\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <div className={`h-10 w-10 rounded-lg bg-muted flex items-center justify-center`}>\n                      <tool.icon className={`h-5 w-5 ${tool.color}`} />\n                    </div>\n                    <div className=\"flex-1\">\n                      <h3 className=\"font-semibold\">{tool.name}</h3>\n                      <p className=\"text-xs text-muted-foreground mt-1\">{tool.description}</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":38345,"size_tokens":null},"client/src/pages/Profile.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { UserAvatar } from \"@/components/UserAvatar\";\nimport { ObjectUploader } from \"@/components/ObjectUploader\";\nimport { \n  Send, Image, Video, X, Heart, Users, Play, Camera,\n  MapPin, Globe, Edit2\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { SocialPostCard } from \"@/components/SocialPostCard\";\nimport type { Post, User } from \"@shared/schema\";\n\ninterface Profile {\n  id: number;\n  ownerId: string;\n  displayName: string | null;\n  bio: string | null;\n  avatarUrl: string | null;\n  coverUrl: string | null;\n  website: string | null;\n  location: string | null;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\ninterface ProfileStats {\n  likes: number;\n  followers: number;\n  videos: number;\n  photos: number;\n}\n\nexport default function Profile() {\n  const { toast } = useToast();\n  const { user: currentUser } = useAuth();\n  const [newPostContent, setNewPostContent] = useState(\"\");\n  const [mediaUrl, setMediaUrl] = useState<string | null>(null);\n  const [mediaType, setMediaType] = useState<\"image\" | \"video\" | null>(null);\n  const [dualPost, setDualPost] = useState(true);\n  const [isEditing, setIsEditing] = useState(false);\n  const [editBio, setEditBio] = useState(\"\");\n\n  const { data: profile, isLoading: profileLoading } = useQuery<Profile>({\n    queryKey: [\"/api/profile\"],\n  });\n\n  const { data: stats, isLoading: statsLoading } = useQuery<ProfileStats>({\n    queryKey: [\"/api/profile\", profile?.id, \"stats\"],\n    enabled: !!profile?.id,\n  });\n\n  const { data: posts = [], isLoading: postsLoading } = useQuery<Post[]>({\n    queryKey: [\"/api/profile\", profile?.id, \"posts\"],\n    enabled: !!profile?.id,\n  });\n\n  const { data: users = [] } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const createPostMutation = useMutation({\n    mutationFn: async (data: { content: string; mediaUrl?: string; mediaType?: string; dualPostToPublic?: boolean }) => {\n      return await apiRequest(\"POST\", \"/api/posts\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/profile\", profile?.id, \"posts\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/profile\", profile?.id, \"stats\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/posts\"] });\n      setNewPostContent(\"\");\n      setMediaUrl(null);\n      setMediaType(null);\n      toast({ title: \"Posted!\", description: dualPost ? \"Your update has been shared to your profile and public feed.\" : \"Your update has been shared to your profile.\" });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to create post.\", variant: \"destructive\" });\n    },\n  });\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: Partial<Profile>) => {\n      return await apiRequest(\"PATCH\", \"/api/profile\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/profile\"] });\n      setIsEditing(false);\n      toast({ title: \"Profile Updated\", description: \"Your profile has been updated.\" });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to update profile.\", variant: \"destructive\" });\n    },\n  });\n\n  const handlePost = () => {\n    if (newPostContent.trim() || mediaUrl) {\n      createPostMutation.mutate({\n        content: newPostContent || \"\",\n        mediaUrl: mediaUrl || undefined,\n        mediaType: mediaType || undefined,\n        dualPostToPublic: dualPost,\n      });\n    }\n  };\n\n  const handleMediaUploadComplete = async (result: any, type: \"image\" | \"video\") => {\n    if (result.successful && result.successful.length > 0) {\n      const objectPath = result.successful[0].meta?.objectPath;\n      if (objectPath) {\n        setMediaUrl(objectPath);\n        setMediaType(type);\n        toast({ title: \"Uploaded!\", description: `${type === \"image\" ? \"Photo\" : \"Video\"} ready to post.` });\n      } else {\n        toast({ title: \"Upload Failed\", description: \"Could not process the uploaded file. Please try again.\", variant: \"destructive\" });\n      }\n    }\n  };\n\n  const handleCoverUploadComplete = async (result: any) => {\n    if (result.successful && result.successful.length > 0) {\n      const objectPath = result.successful[0].meta?.objectPath;\n      if (objectPath) {\n        updateProfileMutation.mutate({ coverUrl: objectPath });\n      } else {\n        toast({ title: \"Upload Failed\", description: \"Could not process the uploaded file.\", variant: \"destructive\" });\n      }\n    }\n  };\n\n  const handleAvatarUploadComplete = async (result: any) => {\n    if (result.successful && result.successful.length > 0) {\n      const objectPath = result.successful[0].meta?.objectPath;\n      if (objectPath) {\n        updateProfileMutation.mutate({ avatarUrl: objectPath });\n      } else {\n        toast({ title: \"Upload Failed\", description: \"Could not process the uploaded file.\", variant: \"destructive\" });\n      }\n    }\n  };\n\n  const getUploadParams = async () => {\n    const response = await apiRequest(\"POST\", \"/api/objects/upload\");\n    const data = await response.json();\n    const uploadData = data.uploadURL;\n    return { \n      method: \"PUT\" as const, \n      url: uploadData.uploadURL,\n      meta: { objectPath: uploadData.objectPath }\n    };\n  };\n\n  const getUserById = (userId: string | null) => {\n    if (!userId) return null;\n    return users.find(u => u.id === userId);\n  };\n\n  const currentUserName = currentUser \n    ? `${currentUser.firstName || ''} ${currentUser.lastName || ''}`.trim() || currentUser.email || 'You'\n    : 'You';\n\n  const displayName = profile?.displayName || currentUserName;\n\n  const clearMedia = () => {\n    setMediaUrl(null);\n    setMediaType(null);\n  };\n\n  const handleStartEditing = () => {\n    setEditBio(profile?.bio || \"\");\n    setIsEditing(true);\n  };\n\n  const handleSaveBio = () => {\n    updateProfileMutation.mutate({ bio: editBio });\n  };\n\n  const formatNumber = (num: number) => {\n    if (num >= 1000000) return `${(num / 1000000).toFixed(1)}M`;\n    if (num >= 1000) return `${(num / 1000).toFixed(1)}K`;\n    return num.toString();\n  };\n\n  if (profileLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <Skeleton className=\"h-48 w-full\" />\n        <Skeleton className=\"h-32 w-full\" />\n        <Skeleton className=\"h-64 w-full\" />\n      </div>\n    );\n  }\n\n  const mediaPosts = posts.filter(p => p.mediaUrl);\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"relative\">\n        <div \n          className=\"h-48 bg-gradient-to-r from-primary/20 to-primary/10 relative overflow-hidden\"\n          style={profile?.coverUrl ? { backgroundImage: `url(${profile.coverUrl})`, backgroundSize: 'cover', backgroundPosition: 'center' } : undefined}\n        >\n          <div className=\"absolute inset-0 bg-black/20\" />\n          <div className=\"absolute top-4 right-4 z-10\">\n            <ObjectUploader\n              maxNumberOfFiles={1}\n              maxFileSize={10485760}\n              allowedFileTypes={[\"image/*\"]}\n              onGetUploadParameters={getUploadParams}\n              onComplete={handleCoverUploadComplete}\n              buttonVariant=\"secondary\"\n              buttonSize=\"sm\"\n            >\n              <Camera className=\"h-4 w-4 mr-1\" />\n              Edit Cover\n            </ObjectUploader>\n          </div>\n        </div>\n\n        <div className=\"px-6 pb-6\">\n          <div className=\"relative flex flex-col md:flex-row md:items-end gap-4 -mt-16\">\n            <div className=\"relative\">\n              <div className=\"h-32 w-32 rounded-full border-4 border-background bg-background overflow-hidden\">\n                {profile?.avatarUrl ? (\n                  <img src={profile.avatarUrl} alt={displayName} className=\"h-full w-full object-cover\" />\n                ) : (\n                  <UserAvatar name={displayName} size=\"lg\" className=\"h-full w-full text-4xl\" />\n                )}\n              </div>\n              <div className=\"absolute bottom-0 right-0\">\n                <ObjectUploader\n                  maxNumberOfFiles={1}\n                  maxFileSize={5242880}\n                  allowedFileTypes={[\"image/*\"]}\n                  onGetUploadParameters={getUploadParams}\n                  onComplete={handleAvatarUploadComplete}\n                  buttonVariant=\"secondary\"\n                  buttonSize=\"icon\"\n                >\n                  <Camera className=\"h-4 w-4\" />\n                </ObjectUploader>\n              </div>\n            </div>\n\n            <div className=\"flex-1 md:pb-4\">\n              <h1 className=\"text-2xl font-semibold\" data-testid=\"text-profile-name\">{displayName}</h1>\n              {profile?.location && (\n                <div className=\"flex items-center gap-1 text-muted-foreground text-sm mt-1\">\n                  <MapPin className=\"h-4 w-4\" />\n                  <span>{profile.location}</span>\n                </div>\n              )}\n              {profile?.website && (\n                <div className=\"flex items-center gap-1 text-primary text-sm mt-1\">\n                  <Globe className=\"h-4 w-4\" />\n                  <a href={profile.website} target=\"_blank\" rel=\"noopener noreferrer\" className=\"hover:underline\">\n                    {profile.website.replace(/^https?:\\/\\//, '')}\n                  </a>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {isEditing ? (\n            <div className=\"mt-4 space-y-3\">\n              <Textarea\n                value={editBio}\n                onChange={(e) => setEditBio(e.target.value)}\n                placeholder=\"Tell people about yourself...\"\n                className=\"resize-none\"\n                data-testid=\"input-profile-bio\"\n              />\n              <div className=\"flex gap-2\">\n                <Button size=\"sm\" onClick={handleSaveBio} disabled={updateProfileMutation.isPending} data-testid=\"button-save-bio\">\n                  Save\n                </Button>\n                <Button size=\"sm\" variant=\"outline\" onClick={() => setIsEditing(false)} data-testid=\"button-cancel-edit\">\n                  Cancel\n                </Button>\n              </div>\n            </div>\n          ) : (\n            <div className=\"mt-4\">\n              {profile?.bio ? (\n                <p className=\"text-muted-foreground\">{profile.bio}</p>\n              ) : (\n                <p className=\"text-muted-foreground italic\">No bio yet</p>\n              )}\n              <Button variant=\"ghost\" size=\"sm\" className=\"mt-2\" onClick={handleStartEditing} data-testid=\"button-edit-bio\">\n                <Edit2 className=\"h-4 w-4 mr-1\" />\n                Edit Bio\n              </Button>\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"px-6\">\n        <Card>\n          <CardContent className=\"py-4\">\n            <div className=\"grid grid-cols-4 gap-4 text-center\">\n              <div className=\"space-y-1\">\n                <div className=\"flex items-center justify-center gap-1.5\">\n                  <Heart className=\"h-5 w-5 text-red-500\" />\n                  <span className=\"text-2xl font-semibold\" data-testid=\"stat-likes\">\n                    {statsLoading ? \"-\" : formatNumber(stats?.likes || 0)}\n                  </span>\n                </div>\n                <p className=\"text-sm text-muted-foreground\">Likes</p>\n              </div>\n              <div className=\"space-y-1\">\n                <div className=\"flex items-center justify-center gap-1.5\">\n                  <Users className=\"h-5 w-5 text-blue-500\" />\n                  <span className=\"text-2xl font-semibold\" data-testid=\"stat-followers\">\n                    {statsLoading ? \"-\" : formatNumber(stats?.followers || 0)}\n                  </span>\n                </div>\n                <p className=\"text-sm text-muted-foreground\">Followers</p>\n              </div>\n              <div className=\"space-y-1\">\n                <div className=\"flex items-center justify-center gap-1.5\">\n                  <Play className=\"h-5 w-5 text-purple-500\" />\n                  <span className=\"text-2xl font-semibold\" data-testid=\"stat-videos\">\n                    {statsLoading ? \"-\" : formatNumber(stats?.videos || 0)}\n                  </span>\n                </div>\n                <p className=\"text-sm text-muted-foreground\">Videos</p>\n              </div>\n              <div className=\"space-y-1\">\n                <div className=\"flex items-center justify-center gap-1.5\">\n                  <Camera className=\"h-5 w-5 text-green-500\" />\n                  <span className=\"text-2xl font-semibold\" data-testid=\"stat-photos\">\n                    {statsLoading ? \"-\" : formatNumber(stats?.photos || 0)}\n                  </span>\n                </div>\n                <p className=\"text-sm text-muted-foreground\">Photos</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"px-6 max-w-3xl mx-auto\">\n        <Card>\n          <CardContent className=\"p-4\">\n            <div className=\"flex gap-3\">\n              <UserAvatar \n                name={displayName} \n                avatar={profile?.avatarUrl || currentUser?.profileImageUrl} \n                size=\"md\" \n              />\n              <div className=\"flex-1 space-y-3\">\n                <Textarea\n                  placeholder=\"Share an update...\"\n                  value={newPostContent}\n                  onChange={(e) => setNewPostContent(e.target.value)}\n                  className=\"resize-none min-h-[80px]\"\n                  data-testid=\"input-profile-post\"\n                />\n                \n                {mediaUrl && (\n                  <div className=\"relative rounded-lg overflow-hidden bg-muted\">\n                    <Button\n                      variant=\"secondary\"\n                      size=\"icon\"\n                      className=\"absolute top-2 right-2 z-10 h-8 w-8\"\n                      onClick={clearMedia}\n                      data-testid=\"button-remove-media\"\n                    >\n                      <X className=\"h-4 w-4\" />\n                    </Button>\n                    {mediaType === \"image\" ? (\n                      <img \n                        src={mediaUrl} \n                        alt=\"Upload preview\" \n                        className=\"max-h-64 w-full object-contain\"\n                      />\n                    ) : (\n                      <video \n                        src={mediaUrl} \n                        controls \n                        className=\"max-h-64 w-full\"\n                      />\n                    )}\n                  </div>\n                )}\n\n                <div className=\"flex items-center justify-between gap-2 flex-wrap\">\n                  <div className=\"flex gap-2\">\n                    <ObjectUploader\n                      maxNumberOfFiles={1}\n                      maxFileSize={10485760}\n                      allowedFileTypes={[\"image/*\"]}\n                      onGetUploadParameters={getUploadParams}\n                      onComplete={(result) => handleMediaUploadComplete(result, \"image\")}\n                      buttonVariant=\"ghost\"\n                      buttonSize=\"sm\"\n                    >\n                      <Image className=\"h-4 w-4 mr-1\" />\n                      Photo\n                    </ObjectUploader>\n                    <ObjectUploader\n                      maxNumberOfFiles={1}\n                      maxFileSize={52428800}\n                      allowedFileTypes={[\"video/*\"]}\n                      onGetUploadParameters={getUploadParams}\n                      onComplete={(result) => handleMediaUploadComplete(result, \"video\")}\n                      buttonVariant=\"ghost\"\n                      buttonSize=\"sm\"\n                    >\n                      <Video className=\"h-4 w-4 mr-1\" />\n                      Video\n                    </ObjectUploader>\n                  </div>\n                  <div className=\"flex items-center gap-4\">\n                    <div className=\"flex items-center gap-2\">\n                      <Switch \n                        id=\"dual-post\" \n                        checked={dualPost} \n                        onCheckedChange={setDualPost}\n                        data-testid=\"switch-dual-post\"\n                      />\n                      <Label htmlFor=\"dual-post\" className=\"text-sm text-muted-foreground cursor-pointer\">\n                        Also post to public feed\n                      </Label>\n                    </div>\n                    <Button \n                      onClick={handlePost} \n                      disabled={(!newPostContent.trim() && !mediaUrl) || createPostMutation.isPending}\n                      data-testid=\"button-profile-post\"\n                    >\n                      <Send className=\"h-4 w-4 mr-2\" />\n                      {createPostMutation.isPending ? \"Posting...\" : \"Post\"}\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {mediaPosts.length > 0 && (\n        <div className=\"px-6\">\n          <h2 className=\"text-xl font-semibold mb-4\">Media</h2>\n          <div className=\"grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2\">\n            {mediaPosts.map((post) => (\n              <div \n                key={post.id} \n                className=\"aspect-square relative overflow-hidden rounded-lg bg-muted hover-elevate cursor-pointer\"\n                data-testid={`media-grid-item-${post.id}`}\n              >\n                {post.mediaType === \"image\" ? (\n                  <img \n                    src={post.mediaUrl!} \n                    alt=\"Media\" \n                    className=\"h-full w-full object-cover\"\n                  />\n                ) : (\n                  <div className=\"h-full w-full relative\">\n                    <video \n                      src={post.mediaUrl!} \n                      className=\"h-full w-full object-cover\"\n                    />\n                    <div className=\"absolute inset-0 flex items-center justify-center bg-black/30\">\n                      <Play className=\"h-8 w-8 text-white\" />\n                    </div>\n                  </div>\n                )}\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      <div className=\"px-6 max-w-3xl mx-auto space-y-4\">\n        <h2 className=\"text-xl font-semibold\">All Posts</h2>\n        {postsLoading ? (\n          Array(3).fill(0).map((_, i) => (\n            <Skeleton key={i} className=\"h-48 w-full\" />\n          ))\n        ) : posts.length > 0 ? (\n          posts.map((post) => {\n            const author = getUserById(post.authorId);\n            return (\n              <SocialPostCard\n                key={post.id}\n                post={post}\n                author={author}\n                currentUserId={currentUser?.id}\n              />\n            );\n          })\n        ) : (\n          <Card>\n            <CardContent className=\"py-12 text-center text-muted-foreground\">\n              <p className=\"text-lg mb-2\">No posts yet</p>\n              <p className=\"text-sm\">Share your first update with your followers!</p>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":19630,"size_tokens":null},"client/src/pages/EmployeeProfile.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useParams, Link } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  ArrowLeft,\n  Mail,\n  Phone,\n  Briefcase,\n  User,\n  Calendar,\n  Star,\n  Building2,\n  Clock,\n  Calculator,\n  FileText,\n  DollarSign,\n  TrendingUp,\n  Receipt,\n  CreditCard,\n  HeartHandshake,\n  UserCheck,\n  ClipboardList,\n  GraduationCap,\n  Award,\n  Scale,\n  FileSearch,\n  Shield,\n  BookOpen,\n  Gavel,\n  Megaphone,\n  BarChart3,\n  Target,\n  Share2,\n  Palette,\n  Settings,\n  Package,\n  ListChecks,\n  Gauge,\n  Truck,\n  PieChart,\n  MessageSquare,\n  FolderOpen,\n  Bell,\n  Wrench,\n  Users,\n} from \"lucide-react\";\nimport type { RemoteEmployee, Department } from \"@shared/schema\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\ninterface Tool {\n  id: string;\n  name: string;\n  description: string;\n  icon: typeof Calculator;\n  color: string;\n}\n\nconst departmentTools: Record<string, Tool[]> = {\n  calculator: [\n    { id: \"budget\", name: \"Budget Planner\", description: \"Plan and track departmental budgets\", icon: Calculator, color: \"text-blue-500\" },\n    { id: \"expenses\", name: \"Expense Tracker\", description: \"Log and categorize expenses\", icon: Receipt, color: \"text-green-500\" },\n    { id: \"invoices\", name: \"Invoice Manager\", description: \"Create and manage invoices\", icon: FileText, color: \"text-purple-500\" },\n    { id: \"reports\", name: \"Financial Reports\", description: \"Generate financial summaries\", icon: TrendingUp, color: \"text-orange-500\" },\n    { id: \"payroll\", name: \"Payroll Calculator\", description: \"Calculate employee payments\", icon: CreditCard, color: \"text-pink-500\" },\n    { id: \"forecast\", name: \"Cash Flow Forecast\", description: \"Project future cash flows\", icon: PieChart, color: \"text-cyan-500\" },\n  ],\n  hearthandshake: [\n    { id: \"leave\", name: \"Leave Tracker\", description: \"Manage employee leave requests\", icon: Clock, color: \"text-blue-500\" },\n    { id: \"performance\", name: \"Performance Reviews\", description: \"Track employee evaluations\", icon: Award, color: \"text-yellow-500\" },\n    { id: \"directory\", name: \"Employee Directory\", description: \"Searchable employee database\", icon: Users, color: \"text-green-500\" },\n    { id: \"recruitment\", name: \"Recruitment Pipeline\", description: \"Track hiring progress\", icon: UserCheck, color: \"text-purple-500\" },\n    { id: \"training\", name: \"Training Manager\", description: \"Organize training programs\", icon: GraduationCap, color: \"text-orange-500\" },\n    { id: \"onboarding\", name: \"Onboarding Checklist\", description: \"New hire onboarding tasks\", icon: ClipboardList, color: \"text-pink-500\" },\n  ],\n  scale: [\n    { id: \"contracts\", name: \"Contract Templates\", description: \"Legal document templates\", icon: FileText, color: \"text-blue-500\" },\n    { id: \"compliance\", name: \"Compliance Checklist\", description: \"Regulatory requirements tracker\", icon: Shield, color: \"text-green-500\" },\n    { id: \"cases\", name: \"Case Tracker\", description: \"Manage legal cases and matters\", icon: FileSearch, color: \"text-purple-500\" },\n    { id: \"documents\", name: \"Document Repository\", description: \"Secure legal document storage\", icon: FolderOpen, color: \"text-orange-500\" },\n    { id: \"policies\", name: \"Policy Manager\", description: \"Company policy management\", icon: BookOpen, color: \"text-cyan-500\" },\n    { id: \"disputes\", name: \"Dispute Resolution\", description: \"Track and resolve disputes\", icon: Gavel, color: \"text-red-500\" },\n  ],\n  megaphone: [\n    { id: \"campaigns\", name: \"Campaign Tracker\", description: \"Monitor marketing campaigns\", icon: Target, color: \"text-blue-500\" },\n    { id: \"content\", name: \"Content Calendar\", description: \"Plan content schedule\", icon: Calendar, color: \"text-green-500\" },\n    { id: \"analytics\", name: \"Analytics Dashboard\", description: \"Track marketing metrics\", icon: BarChart3, color: \"text-purple-500\" },\n    { id: \"social\", name: \"Social Media Manager\", description: \"Manage social accounts\", icon: Share2, color: \"text-pink-500\" },\n    { id: \"brand\", name: \"Brand Assets\", description: \"Brand guidelines and assets\", icon: Palette, color: \"text-orange-500\" },\n    { id: \"leads\", name: \"Lead Generation\", description: \"Track marketing leads\", icon: TrendingUp, color: \"text-cyan-500\" },\n  ],\n  settings: [\n    { id: \"projects\", name: \"Project Tracker\", description: \"Monitor project progress\", icon: ListChecks, color: \"text-blue-500\" },\n    { id: \"inventory\", name: \"Inventory Manager\", description: \"Track stock and supplies\", icon: Package, color: \"text-green-500\" },\n    { id: \"processes\", name: \"Process Documentation\", description: \"Document workflows\", icon: BookOpen, color: \"text-purple-500\" },\n    { id: \"quality\", name: \"Quality Metrics\", description: \"Track quality standards\", icon: Gauge, color: \"text-orange-500\" },\n    { id: \"vendors\", name: \"Vendor Management\", description: \"Manage supplier relationships\", icon: Truck, color: \"text-cyan-500\" },\n    { id: \"maintenance\", name: \"Maintenance Scheduler\", description: \"Schedule equipment maintenance\", icon: Wrench, color: \"text-red-500\" },\n  ],\n  dollarSign: [\n    { id: \"pipeline\", name: \"Sales Pipeline\", description: \"Track deals and opportunities\", icon: TrendingUp, color: \"text-blue-500\" },\n    { id: \"leads\", name: \"Lead Tracker\", description: \"Manage sales leads\", icon: Target, color: \"text-green-500\" },\n    { id: \"quotes\", name: \"Quote Generator\", description: \"Create sales proposals\", icon: FileText, color: \"text-purple-500\" },\n    { id: \"clients\", name: \"Client Database\", description: \"Customer relationship manager\", icon: Users, color: \"text-orange-500\" },\n    { id: \"commission\", name: \"Commission Calculator\", description: \"Calculate sales commissions\", icon: Calculator, color: \"text-pink-500\" },\n    { id: \"forecasts\", name: \"Sales Forecasts\", description: \"Project future sales\", icon: PieChart, color: \"text-cyan-500\" },\n  ],\n  users: [\n    { id: \"calendar\", name: \"Team Calendar\", description: \"Shared team schedule\", icon: Calendar, color: \"text-blue-500\" },\n    { id: \"resources\", name: \"Resource Allocation\", description: \"Assign team resources\", icon: Users, color: \"text-green-500\" },\n    { id: \"meetings\", name: \"Meeting Scheduler\", description: \"Plan team meetings\", icon: Clock, color: \"text-purple-500\" },\n    { id: \"board\", name: \"Collaboration Board\", description: \"Team task board\", icon: ListChecks, color: \"text-orange-500\" },\n    { id: \"analytics\", name: \"Team Analytics\", description: \"Team performance metrics\", icon: BarChart3, color: \"text-pink-500\" },\n    { id: \"chat\", name: \"Team Chat\", description: \"Internal messaging\", icon: MessageSquare, color: \"text-cyan-500\" },\n  ],\n  briefcase: [\n    { id: \"tasks\", name: \"Task Board\", description: \"Manage team tasks\", icon: ListChecks, color: \"text-blue-500\" },\n    { id: \"notes\", name: \"Team Notes\", description: \"Shared documentation\", icon: FileText, color: \"text-green-500\" },\n    { id: \"files\", name: \"File Manager\", description: \"Organize team files\", icon: FolderOpen, color: \"text-purple-500\" },\n    { id: \"calendar\", name: \"Department Calendar\", description: \"Schedule and events\", icon: Calendar, color: \"text-orange-500\" },\n    { id: \"announcements\", name: \"Announcements\", description: \"Team updates and news\", icon: Bell, color: \"text-pink-500\" },\n    { id: \"directory\", name: \"Contact Directory\", description: \"Quick contact lookup\", icon: Users, color: \"text-cyan-500\" },\n  ],\n};\n\nexport default function EmployeeProfile() {\n  const { username } = useParams<{ username: string }>();\n  const [selectedTool, setSelectedTool] = useState<Tool | null>(null);\n  const { language } = useLanguage();\n  const t = translations[language];\n\n  const { data: employee, isLoading: employeeLoading } = useQuery<RemoteEmployee>({\n    queryKey: [\"/api/employees/username\", username],\n  });\n\n  const { data: department } = useQuery<Department>({\n    queryKey: [\"/api/departments\", employee?.departmentId],\n    enabled: !!employee?.departmentId,\n  });\n\n  const normalizeIconKey = (icon: string): string => {\n    const iconMap: Record<string, string> = {\n      \"dollar-sign\": \"dollarSign\",\n      \"dollarsign\": \"dollarSign\",\n      \"heart-handshake\": \"hearthandshake\",\n    };\n    return iconMap[icon.toLowerCase()] || icon;\n  };\n\n  const getDepartmentTools = () => {\n    if (!department) return [];\n    const normalizedIcon = normalizeIconKey(department.icon || \"briefcase\");\n    return departmentTools[normalizedIcon] || departmentTools.briefcase;\n  };\n\n  const getSpecialtyLabel = (icon: string) => {\n    const normalizedIcon = normalizeIconKey(icon);\n    const labels: Record<string, string> = {\n      calculator: \"Finance\",\n      hearthandshake: \"Human Resources\",\n      scale: \"Legal\",\n      megaphone: \"Marketing\",\n      settings: \"Operations\",\n      dollarSign: \"Sales\",\n      users: \"Team\",\n      briefcase: \"General\",\n    };\n    return labels[normalizedIcon] || \"General\";\n  };\n\n  if (employeeLoading) {\n    return (\n      <div className=\"p-4 md:p-6 max-w-4xl mx-auto space-y-6\" dir={language === 'ar' ? 'rtl' : 'ltr'}>\n        <div className=\"flex items-center gap-3\">\n          <Skeleton className=\"h-10 w-10\" />\n          <Skeleton className=\"h-8 w-48\" />\n        </div>\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-start gap-6\">\n              <Skeleton className=\"h-24 w-24 rounded-full\" />\n              <div className=\"flex-1 space-y-3\">\n                <Skeleton className=\"h-8 w-48\" />\n                <Skeleton className=\"h-4 w-32\" />\n                <Skeleton className=\"h-4 w-64\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (!employee) {\n    return (\n      <div className=\"p-4 md:p-6 max-w-4xl mx-auto\" dir={language === 'ar' ? 'rtl' : 'ltr'}>\n        <Card className=\"p-8 text-center\">\n          <User className=\"h-12 w-12 mx-auto text-muted-foreground opacity-50 mb-2\" />\n          <p className=\"text-muted-foreground\">{t.employeeProfilePage?.employeeNotFound || \"Employee not found\"}</p>\n          <p className=\"text-xs text-muted-foreground mt-1\">\n            {language === 'ar' ? \"       .\" : \"The employee profile you're looking for doesn't exist.\"}\n          </p>\n          <Link href=\"/departments\">\n            <Button variant=\"outline\" className=\"mt-4\">\n              <ArrowLeft className={`h-4 w-4 ${language === 'ar' ? 'ml-2' : 'mr-2'}`} />\n              {t.employeeProfilePage?.goBack || \"Go Back\"}\n            </Button>\n          </Link>\n        </Card>\n      </div>\n    );\n  }\n\n  const skillsList = employee.skills ? employee.skills.split(\",\").map((s) => s.trim()).filter(Boolean) : [];\n  const tools = getDepartmentTools();\n\n  const ToolDialog = (\n    <Dialog open={!!selectedTool} onOpenChange={(open) => !open && setSelectedTool(null)}>\n      <DialogContent className=\"max-w-2xl\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            {selectedTool && <selectedTool.icon className={`h-5 w-5 ${selectedTool.color}`} />}\n            {selectedTool?.name}\n          </DialogTitle>\n          <DialogDescription>{selectedTool?.description}</DialogDescription>\n        </DialogHeader>\n        <div className=\"py-6\">\n          {selectedTool?.id === \"budget\" && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <Card>\n                  <CardContent className=\"pt-4\">\n                    <p className=\"text-sm text-muted-foreground\">Total Budget</p>\n                    <p className=\"text-2xl font-bold\">$150,000</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardContent className=\"pt-4\">\n                    <p className=\"text-sm text-muted-foreground\">Spent</p>\n                    <p className=\"text-2xl font-bold text-orange-500\">$87,500</p>\n                  </CardContent>\n                </Card>\n              </div>\n              <div>\n                <div className=\"flex justify-between text-sm mb-2\">\n                  <span>Budget Usage</span>\n                  <span>58%</span>\n                </div>\n                <Progress value={58} />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Add Budget Item</Label>\n                <div className=\"flex gap-2\">\n                  <Input placeholder=\"Description\" className=\"flex-1\" />\n                  <Input placeholder=\"Amount\" type=\"number\" className=\"w-32\" />\n                  <Button>Add</Button>\n                </div>\n              </div>\n            </div>\n          )}\n          {selectedTool?.id === \"expenses\" && (\n            <div className=\"space-y-4\">\n              <div className=\"flex gap-2 mb-4\">\n                <Input placeholder=\"Expense description\" className=\"flex-1\" />\n                <Input placeholder=\"Amount\" type=\"number\" className=\"w-32\" />\n                <Select defaultValue=\"office\">\n                  <SelectTrigger className=\"w-40\">\n                    <SelectValue placeholder=\"Category\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"office\">Office</SelectItem>\n                    <SelectItem value=\"travel\">Travel</SelectItem>\n                    <SelectItem value=\"supplies\">Supplies</SelectItem>\n                    <SelectItem value=\"software\">Software</SelectItem>\n                  </SelectContent>\n                </Select>\n                <Button>Log</Button>\n              </div>\n              <div className=\"border rounded-lg divide-y\">\n                {[\n                  { desc: \"Office supplies\", amount: 250, cat: \"Supplies\", date: \"Dec 1\" },\n                  { desc: \"Software license\", amount: 1200, cat: \"Software\", date: \"Nov 28\" },\n                  { desc: \"Team lunch\", amount: 180, cat: \"Office\", date: \"Nov 25\" },\n                ].map((exp, i) => (\n                  <div key={i} className=\"flex items-center justify-between p-3\">\n                    <div>\n                      <p className=\"font-medium\">{exp.desc}</p>\n                      <p className=\"text-xs text-muted-foreground\">{exp.cat} - {exp.date}</p>\n                    </div>\n                    <p className=\"font-semibold\">${exp.amount}</p>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n          {selectedTool?.id === \"leave\" && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-3 gap-4\">\n                <Card>\n                  <CardContent className=\"pt-4 text-center\">\n                    <p className=\"text-2xl font-bold text-green-500\">12</p>\n                    <p className=\"text-xs text-muted-foreground\">Available Days</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardContent className=\"pt-4 text-center\">\n                    <p className=\"text-2xl font-bold text-orange-500\">3</p>\n                    <p className=\"text-xs text-muted-foreground\">Pending Requests</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardContent className=\"pt-4 text-center\">\n                    <p className=\"text-2xl font-bold\">8</p>\n                    <p className=\"text-xs text-muted-foreground\">Days Used</p>\n                  </CardContent>\n                </Card>\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Request Leave</Label>\n                <div className=\"flex gap-2\">\n                  <Input type=\"date\" className=\"flex-1\" />\n                  <Input type=\"date\" className=\"flex-1\" />\n                  <Select defaultValue=\"vacation\">\n                    <SelectTrigger className=\"w-40\">\n                      <SelectValue placeholder=\"Type\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"vacation\">Vacation</SelectItem>\n                      <SelectItem value=\"sick\">Sick Leave</SelectItem>\n                      <SelectItem value=\"personal\">Personal</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <Button>Submit</Button>\n                </div>\n              </div>\n            </div>\n          )}\n          {selectedTool?.id === \"performance\" && (\n            <div className=\"space-y-4\">\n              <div className=\"text-center py-4\">\n                <div className=\"flex justify-center gap-1 mb-2\">\n                  {[1,2,3,4,5].map((star) => (\n                    <Star key={star} className={`h-8 w-8 ${star <= 4 ? 'text-yellow-500 fill-yellow-500' : 'text-muted'}`} />\n                  ))}\n                </div>\n                <p className=\"text-2xl font-bold\">4.0 / 5.0</p>\n                <p className=\"text-sm text-muted-foreground\">{t.employeeProfilePage?.rating || \"Rating\"}</p>\n              </div>\n              <Separator />\n              <div className=\"space-y-3\">\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-sm\">Productivity</span>\n                  <Progress value={85} className=\"w-32\" />\n                </div>\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-sm\">Communication</span>\n                  <Progress value={90} className=\"w-32\" />\n                </div>\n                <div className=\"flex justify-between items-center\">\n                  <span className=\"text-sm\">Teamwork</span>\n                  <Progress value={78} className=\"w-32\" />\n                </div>\n              </div>\n            </div>\n          )}\n          {selectedTool?.id === \"pipeline\" && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-4 gap-3\">\n                {[\"Lead\", \"Qualified\", \"Proposal\", \"Closed\"].map((stage, i) => (\n                  <div key={stage} className=\"text-center\">\n                    <div className=\"bg-muted rounded-lg p-3 mb-2\">\n                      <p className=\"text-2xl font-bold\">{[12, 8, 5, 3][i]}</p>\n                    </div>\n                    <p className=\"text-sm font-medium\">{stage}</p>\n                  </div>\n                ))}\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Add New Deal</Label>\n                <div className=\"flex gap-2\">\n                  <Input placeholder=\"Deal name\" className=\"flex-1\" />\n                  <Input placeholder=\"Value\" type=\"number\" className=\"w-32\" />\n                  <Button>Add</Button>\n                </div>\n              </div>\n            </div>\n          )}\n          {selectedTool?.id === \"campaigns\" && (\n            <div className=\"space-y-4\">\n              <div className=\"grid grid-cols-3 gap-4\">\n                <Card>\n                  <CardContent className=\"pt-4 text-center\">\n                    <p className=\"text-2xl font-bold text-blue-500\">5</p>\n                    <p className=\"text-xs text-muted-foreground\">Active Campaigns</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardContent className=\"pt-4 text-center\">\n                    <p className=\"text-2xl font-bold text-green-500\">24.5K</p>\n                    <p className=\"text-xs text-muted-foreground\">Total Reach</p>\n                  </CardContent>\n                </Card>\n                <Card>\n                  <CardContent className=\"pt-4 text-center\">\n                    <p className=\"text-2xl font-bold text-purple-500\">3.2%</p>\n                    <p className=\"text-xs text-muted-foreground\">Conversion Rate</p>\n                  </CardContent>\n                </Card>\n              </div>\n              <div className=\"border rounded-lg divide-y\">\n                {[\"Q4 Product Launch\", \"Holiday Sale\", \"Newsletter Campaign\"].map((name, i) => (\n                  <div key={i} className=\"flex items-center justify-between p-3\">\n                    <div>\n                      <p className=\"font-medium\">{name}</p>\n                      <p className=\"text-xs text-muted-foreground\">Active</p>\n                    </div>\n                    <Button size=\"sm\" variant=\"outline\">{t.common?.view || \"View\"}</Button>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n          {![\"budget\", \"expenses\", \"leave\", \"performance\", \"pipeline\", \"campaigns\"].includes(selectedTool?.id || \"\") && (\n            <div className=\"text-center py-8\">\n              <div className={`h-16 w-16 rounded-full bg-muted flex items-center justify-center mx-auto mb-4`}>\n                {selectedTool && <selectedTool.icon className={`h-8 w-8 ${selectedTool.color}`} />}\n              </div>\n              <p className=\"text-muted-foreground mb-4\">\n                {language === 'ar' ? \"    .\" : \"This tool is ready to be configured for your work.\"}\n              </p>\n              <Button data-testid=\"button-tool-get-started\">{language === 'ar' ? \" \" : \"Get Started\"}</Button>\n            </div>\n          )}\n        </div>\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={() => setSelectedTool(null)} data-testid=\"button-tool-close\">\n            {t.common?.close || \"Close\"}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n\n  return (\n    <div className=\"p-4 md:p-6 max-w-4xl mx-auto space-y-6\" dir={language === 'ar' ? 'rtl' : 'ltr'}>\n      {ToolDialog}\n\n      <div className=\"flex items-center gap-3\">\n        <Link href={department ? `/departments/${department.id}` : \"/departments\"}>\n          <Button variant=\"ghost\" size=\"icon\">\n            <ArrowLeft className=\"h-4 w-4\" />\n          </Button>\n        </Link>\n        <div>\n          <h1 className=\"text-xl font-bold\">{t.employeeProfilePage?.title || \"Employee Profile\"}</h1>\n          {department && (\n            <p className=\"text-sm text-muted-foreground flex items-center gap-1\">\n              <Building2 className=\"h-3 w-3\" />\n              {department.name}\n            </p>\n          )}\n        </div>\n      </div>\n\n      <Card>\n        <CardContent className=\"p-6\">\n          <div className=\"flex flex-col md:flex-row items-start gap-6\">\n            <Avatar className=\"h-24 w-24 border-4 border-background shadow-lg\">\n              <AvatarImage src={employee.profileImageUrl || undefined} />\n              <AvatarFallback className=\"bg-primary/10 text-primary text-2xl\">\n                {employee.firstName[0]}{employee.lastName[0]}\n              </AvatarFallback>\n            </Avatar>\n            <div className=\"flex-1\">\n              <div className=\"flex flex-wrap items-start justify-between gap-4\">\n                <div>\n                  <h2 className=\"text-2xl font-bold\" data-testid=\"text-employee-name\">\n                    {employee.firstName} {employee.lastName}\n                  </h2>\n                  <p className=\"text-muted-foreground\" data-testid=\"text-employee-username\">\n                    @{employee.username}\n                  </p>\n                </div>\n                <Badge\n                  variant=\"secondary\"\n                  className={\n                    employee.status === \"active\"\n                      ? \"bg-emerald-500/10 text-emerald-500\"\n                      : \"bg-muted text-muted-foreground\"\n                  }\n                >\n                  {employee.status || \"active\"}\n                </Badge>\n              </div>\n              {employee.jobTitle && (\n                <div className=\"flex items-center gap-2 mt-3 text-muted-foreground\">\n                  <Briefcase className=\"h-4 w-4\" />\n                  <span data-testid=\"text-employee-jobtitle\">{employee.jobTitle}</span>\n                </div>\n              )}\n              {employee.startDate && (\n                <div className=\"flex items-center gap-2 mt-2 text-muted-foreground text-sm\">\n                  <Calendar className=\"h-4 w-4\" />\n                  <span>\n                    {t.employeeProfilePage?.joinDate || \"Joined\"} {new Date(employee.startDate).toLocaleDateString(language === 'ar' ? 'ar-SA' : 'en-US', {\n                      year: \"numeric\",\n                      month: \"long\",\n                      day: \"numeric\",\n                    })}\n                  </span>\n                </div>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n              <User className={`h-4 w-4 text-primary`} />\n              {t.employeeProfilePage?.contact || \"Contact Information\"}\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {employee.email ? (\n              <div className=\"flex items-center gap-3\">\n                <div className=\"p-2 rounded-lg bg-muted\">\n                  <Mail className=\"h-4 w-4 text-muted-foreground\" />\n                </div>\n                <div>\n                  <p className=\"text-xs text-muted-foreground\">{t.employeeProfilePage?.email || \"Email\"}</p>\n                  <a\n                    href={`mailto:${employee.email}`}\n                    className=\"text-sm hover:underline\"\n                    data-testid=\"link-employee-email\"\n                  >\n                    {employee.email}\n                  </a>\n                </div>\n              </div>\n            ) : (\n              <p className=\"text-sm text-muted-foreground\">{language === 'ar' ? \"   \" : \"No email provided\"}</p>\n            )}\n            {employee.phone ? (\n              <div className=\"flex items-center gap-3\">\n                <div className=\"p-2 rounded-lg bg-muted\">\n                  <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                </div>\n                <div>\n                  <p className=\"text-xs text-muted-foreground\">{t.employeeProfilePage?.phone || \"Phone\"}</p>\n                  <a\n                    href={`tel:${employee.phone}`}\n                    className=\"text-sm hover:underline\"\n                    data-testid=\"link-employee-phone\"\n                  >\n                    {employee.phone}\n                  </a>\n                </div>\n              </div>\n            ) : (\n              <p className=\"text-sm text-muted-foreground\">{language === 'ar' ? \"  \" : \"No phone provided\"}</p>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n              <Star className={`h-4 w-4 text-primary`} />\n              {language === 'ar' ? \" \" : \"Skills & Expertise\"}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {skillsList.length > 0 ? (\n              <div className=\"flex flex-wrap gap-2\">\n                {skillsList.map((skill, idx) => (\n                  <Badge key={idx} variant=\"secondary\">\n                    {skill}\n                  </Badge>\n                ))}\n              </div>\n            ) : (\n              <p className=\"text-sm text-muted-foreground\">{language === 'ar' ? \"   \" : \"No skills listed\"}</p>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {employee.bio && (\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n              <User className={`h-4 w-4 text-primary`} />\n              {language === 'ar' ? \"\" : \"About\"}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-sm text-muted-foreground leading-relaxed\" data-testid=\"text-employee-bio\">\n              {employee.bio}\n            </p>\n          </CardContent>\n        </Card>\n      )}\n\n      <Card>\n        <CardHeader className=\"pb-2\">\n          <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n            <Clock className={`h-4 w-4 text-primary`} />\n            {language === 'ar' ? \" \" : \"Employment Details\"}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <p className=\"text-xs text-muted-foreground\">{t.employeeProfilePage?.department || \"Department\"}</p>\n              <p className=\"text-sm font-medium\">{department?.name || (t.common?.loading || \"Loading...\")}</p>\n            </div>\n            <div>\n              <p className=\"text-xs text-muted-foreground\">{language === 'ar' ? \"\" : \"Status\"}</p>\n              <p className=\"text-sm font-medium capitalize\">{employee.status || \"active\"}</p>\n            </div>\n            <div>\n              <p className=\"text-xs text-muted-foreground\">{t.employeeProfilePage?.joinDate || \"Start Date\"}</p>\n              <p className=\"text-sm font-medium\">\n                {employee.startDate\n                  ? new Date(employee.startDate).toLocaleDateString(language === 'ar' ? 'ar-SA' : 'en-US')\n                  : (language === 'ar' ? \" \" : \"Not specified\")}\n              </p>\n            </div>\n            <div>\n              <p className=\"text-xs text-muted-foreground\">{language === 'ar' ? \" \" : \"Employee ID\"}</p>\n              <p className=\"text-sm font-medium\">EMP-{String(employee.id).padStart(5, \"0\")}</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {department && tools.length > 0 && (\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n              <Wrench className={`h-4 w-4 text-primary`} />\n              {t.employeeProfilePage?.departmentTools || \"Department Tools\"} - {getSpecialtyLabel(department.icon || \"briefcase\")}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-xs text-muted-foreground mb-4\">\n              {language === 'ar' \n                ? `      ${department.name}`\n                : `Specialty tools available for your role in the ${department.name} department`}\n            </p>\n            <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\n              {tools.map((tool) => (\n                <Button\n                  key={tool.id}\n                  variant=\"outline\"\n                  className=\"h-auto p-3 flex flex-col items-start gap-1 hover-elevate\"\n                  onClick={() => setSelectedTool(tool)}\n                  data-testid={`tool-button-${tool.id}`}\n                >\n                  <div className=\"flex items-center gap-2\">\n                    <tool.icon className={`h-4 w-4 ${tool.color}`} />\n                    <span className=\"font-medium text-sm\">{tool.name}</span>\n                  </div>\n                  <span className=\"text-xs text-muted-foreground text-left line-clamp-1\">\n                    {tool.description}\n                  </span>\n                </Button>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":32238,"size_tokens":null},"client/src/pages/Departments.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Link } from \"wouter\";\nimport {\n  Building2,\n  Plus,\n  Users,\n  Briefcase,\n  DollarSign,\n  Calculator,\n  HeartHandshake,\n  Scale,\n  Megaphone,\n  Settings,\n  ArrowRight,\n  Trash2,\n  Lock,\n  Unlock,\n  UserPlus,\n  Activity,\n  Eye,\n  EyeOff,\n} from \"lucide-react\";\nimport type { Department, RemoteEmployee } from \"@shared/schema\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\nconst departmentIcons: Record<string, typeof Briefcase> = {\n  briefcase: Briefcase,\n  calculator: Calculator,\n  users: Users,\n  hearthandshake: HeartHandshake,\n  scale: Scale,\n  megaphone: Megaphone,\n  settings: Settings,\n  dollarSign: DollarSign,\n};\n\nconst departmentColors: Record<string, string> = {\n  blue: \"bg-blue-500/10 text-blue-500 border-blue-500/20\",\n  green: \"bg-emerald-500/10 text-emerald-500 border-emerald-500/20\",\n  purple: \"bg-purple-500/10 text-purple-500 border-purple-500/20\",\n  orange: \"bg-orange-500/10 text-orange-500 border-orange-500/20\",\n  red: \"bg-red-500/10 text-red-500 border-red-500/20\",\n  pink: \"bg-pink-500/10 text-pink-500 border-pink-500/20\",\n  yellow: \"bg-amber-500/10 text-amber-500 border-amber-500/20\",\n  cyan: \"bg-cyan-500/10 text-cyan-500 border-cyan-500/20\",\n};\n\nexport default function Departments() {\n  const { language } = useLanguage();\n  const t = translations[language];\n\n  const colorOptions = [\n    { value: \"blue\", label: t.departments?.colorBlue || \"Blue\" },\n    { value: \"green\", label: t.departments?.colorGreen || \"Green\" },\n    { value: \"purple\", label: t.departments?.colorPurple || \"Purple\" },\n    { value: \"orange\", label: t.departments?.colorOrange || \"Orange\" },\n    { value: \"red\", label: t.departments?.colorRed || \"Red\" },\n    { value: \"pink\", label: t.departments?.colorPink || \"Pink\" },\n    { value: \"yellow\", label: t.departments?.colorYellow || \"Yellow\" },\n    { value: \"cyan\", label: t.departments?.colorCyan || \"Cyan\" },\n  ];\n\n  const iconOptions = [\n    { value: \"briefcase\", label: t.departments?.iconGeneral || \"General\", icon: Briefcase },\n    { value: \"calculator\", label: t.departments?.iconFinance || \"Finance\", icon: Calculator },\n    { value: \"users\", label: t.departments?.iconTeam || \"Team\", icon: Users },\n    { value: \"hearthandshake\", label: t.departments?.iconHR || \"Human Resources\", icon: HeartHandshake },\n    { value: \"scale\", label: t.departments?.iconLegal || \"Legal\", icon: Scale },\n    { value: \"megaphone\", label: t.departments?.iconMarketing || \"Marketing\", icon: Megaphone },\n    { value: \"settings\", label: t.departments?.iconOperations || \"Operations\", icon: Settings },\n    { value: \"dollarSign\", label: t.departments?.iconSales || \"Sales\", icon: DollarSign },\n  ];\n  const { toast } = useToast();\n  const [selectedDepartment, setSelectedDepartment] = useState<Department | null>(null);\n  const [newDeptOpen, setNewDeptOpen] = useState(false);\n  const [passwordDialogOpen, setPasswordDialogOpen] = useState(false);\n  const [passwordInput, setPasswordInput] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [deptName, setDeptName] = useState(\"\");\n  const [deptDescription, setDeptDescription] = useState(\"\");\n  const [deptIcon, setDeptIcon] = useState(\"briefcase\");\n  const [deptColor, setDeptColor] = useState(\"blue\");\n  const [deptPassword, setDeptPassword] = useState(\"\");\n  const [unlocked, setUnlocked] = useState<Set<number>>(new Set());\n\n  const { data: departments = [], isLoading: departmentsLoading } = useQuery<Department[]>({\n    queryKey: [\"/api/departments\"],\n  });\n\n  const { data: employees = [] } = useQuery<RemoteEmployee[]>({\n    queryKey: [\"/api/departments\", selectedDepartment?.id, \"employees\"],\n    enabled: !!selectedDepartment && unlocked.has(selectedDepartment.id),\n  });\n\n  const createDepartmentMutation = useMutation({\n    mutationFn: async (data: { name: string; description: string; icon: string; color: string; password?: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/departments\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/departments\"] });\n      setNewDeptOpen(false);\n      setDeptName(\"\");\n      setDeptDescription(\"\");\n      setDeptIcon(\"briefcase\");\n      setDeptColor(\"blue\");\n      setDeptPassword(\"\");\n      toast({ title: t.departments?.departmentCreated || \"Department Created\", description: t.departments?.departmentCreatedDesc || \"New department has been added.\" });\n    },\n    onError: () => {\n      toast({ title: t.departments?.error || \"Error\", description: t.departments?.failedCreate || \"Failed to create department.\", variant: \"destructive\" });\n    },\n  });\n\n  const deleteDepartmentMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/departments/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/departments\"] });\n      setSelectedDepartment(null);\n      toast({ title: t.departments?.departmentDeleted || \"Department Deleted\", description: t.departments?.departmentDeletedDesc || \"The department has been removed.\" });\n    },\n  });\n\n  const verifyPasswordMutation = useMutation({\n    mutationFn: async ({ id, password }: { id: number; password: string }) => {\n      const res = await apiRequest(\"POST\", `/api/departments/${id}/verify-password`, { password });\n      return res.json();\n    },\n    onSuccess: (data, variables) => {\n      if (data.valid) {\n        setUnlocked(prev => new Set(Array.from(prev).concat(variables.id)));\n        setPasswordDialogOpen(false);\n        setPasswordInput(\"\");\n        toast({ title: t.departments?.accessGranted || \"Access Granted\", description: t.departments?.departmentUnlocked || \"Department unlocked successfully.\" });\n      } else {\n        toast({ title: t.departments?.accessDenied || \"Access Denied\", description: t.departments?.incorrectPassword || \"Incorrect password.\", variant: \"destructive\" });\n      }\n    },\n  });\n\n  const handleSelectDepartment = (dept: Department) => {\n    setSelectedDepartment(dept);\n    if (dept.password && !unlocked.has(dept.id)) {\n      setPasswordDialogOpen(true);\n    } else {\n      setUnlocked(prev => new Set(Array.from(prev).concat(dept.id)));\n    }\n  };\n\n  const isDepartmentUnlocked = (dept: Department) => {\n    return !dept.password || unlocked.has(dept.id);\n  };\n\n  return (\n    <div className=\"p-4 md:p-6 space-y-6 max-w-7xl mx-auto\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-page-title\">{t.departments?.myDepartments || \"My Departments\"}</h1>\n          <p className=\"text-muted-foreground text-sm\">{t.departments?.subtitle || \"Manage your team departments and employees\"}</p>\n        </div>\n        <Dialog open={newDeptOpen} onOpenChange={setNewDeptOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-add-department\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              {t.departments?.addDepartment || \"Add Department\"}\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>{t.departments?.createDepartment || \"Create Department\"}</DialogTitle>\n              <DialogDescription>\n                {t.departments?.createDepartmentDesc || \"Add a new department to organize your team.\"}\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4 py-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"dept-name\">{t.departments?.departmentName || \"Department Name\"}</Label>\n                <Input\n                  id=\"dept-name\"\n                  placeholder={t.departments?.departmentNamePlaceholder || \"e.g., Human Resources, Finance\"}\n                  value={deptName}\n                  onChange={(e) => setDeptName(e.target.value)}\n                  data-testid=\"input-department-name\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"dept-desc\">{t.departments?.description || \"Description\"}</Label>\n                <Textarea\n                  id=\"dept-desc\"\n                  placeholder={t.departments?.descriptionPlaceholder || \"Brief description of the department...\"}\n                  value={deptDescription}\n                  onChange={(e) => setDeptDescription(e.target.value)}\n                  data-testid=\"input-department-description\"\n                />\n              </div>\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label>{t.departments?.icon || \"Icon\"}</Label>\n                  <Select value={deptIcon} onValueChange={setDeptIcon}>\n                    <SelectTrigger data-testid=\"select-department-icon\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {iconOptions.map((opt) => (\n                        <SelectItem key={opt.value} value={opt.value}>\n                          <div className=\"flex items-center gap-2\">\n                            <opt.icon className=\"h-4 w-4\" />\n                            {opt.label}\n                          </div>\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label>{t.departments?.color || \"Color\"}</Label>\n                  <Select value={deptColor} onValueChange={setDeptColor}>\n                    <SelectTrigger data-testid=\"select-department-color\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {colorOptions.map((opt) => (\n                        <SelectItem key={opt.value} value={opt.value}>\n                          {opt.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"dept-password\">{t.departments?.passwordProtection || \"Password Protection (Optional)\"}</Label>\n                <div className=\"relative\">\n                  <Input\n                    id=\"dept-password\"\n                    type={showPassword ? \"text\" : \"password\"}\n                    placeholder={t.departments?.passwordPlaceholder || \"Leave empty for no password\"}\n                    value={deptPassword}\n                    onChange={(e) => setDeptPassword(e.target.value)}\n                    data-testid=\"input-department-password\"\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"absolute right-0 top-0 h-full\"\n                    onClick={() => setShowPassword(!showPassword)}\n                  >\n                    {showPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                  </Button>\n                </div>\n                <p className=\"text-xs text-muted-foreground\">\n                  {t.departments?.passwordHint || \"Set a password to protect department access\"}\n                </p>\n              </div>\n            </div>\n            <DialogFooter>\n              <Button\n                onClick={() =>\n                  createDepartmentMutation.mutate({\n                    name: deptName,\n                    description: deptDescription,\n                    icon: deptIcon,\n                    color: deptColor,\n                    password: deptPassword || undefined,\n                  })\n                }\n                disabled={!deptName || createDepartmentMutation.isPending}\n                data-testid=\"button-create-department\"\n              >\n                {createDepartmentMutation.isPending ? (t.departments?.creating || \"Creating...\") : (t.departments?.createDepartment || \"Create Department\")}\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <Dialog open={passwordDialogOpen} onOpenChange={setPasswordDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Lock className=\"h-5 w-5\" />\n              {t.departments?.departmentProtected || \"Department Protected\"}\n            </DialogTitle>\n            <DialogDescription>\n              {t.departments?.enterPasswordToAccess || \"This department is password protected. Enter the password to access.\"}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"py-4\">\n            <Input\n              type=\"password\"\n              placeholder={t.departments?.enterPassword || \"Enter password\"}\n              value={passwordInput}\n              onChange={(e) => setPasswordInput(e.target.value)}\n              data-testid=\"input-verify-password\"\n              onKeyDown={(e) => {\n                if (e.key === 'Enter' && selectedDepartment) {\n                  verifyPasswordMutation.mutate({ id: selectedDepartment.id, password: passwordInput });\n                }\n              }}\n            />\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setPasswordDialogOpen(false)}>\n              {t.common?.cancel || \"Cancel\"}\n            </Button>\n            <Button\n              onClick={() => {\n                if (selectedDepartment) {\n                  verifyPasswordMutation.mutate({ id: selectedDepartment.id, password: passwordInput });\n                }\n              }}\n              disabled={verifyPasswordMutation.isPending}\n              data-testid=\"button-verify-password\"\n            >\n              {verifyPasswordMutation.isPending ? (t.departments?.verifying || \"Verifying...\") : (t.departments?.unlock || \"Unlock\")}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <div className=\"lg:col-span-1 space-y-4\">\n          <h2 className=\"text-lg font-semibold flex items-center gap-2\">\n            <Building2 className=\"h-5 w-5 text-primary\" />\n            {t.departments?.yourDepartments || \"Your Departments\"}\n          </h2>\n          {departmentsLoading ? (\n            Array(3).fill(0).map((_, i) => <Skeleton key={i} className=\"h-24 w-full\" />)\n          ) : departments.length === 0 ? (\n            <Card className=\"p-6 text-center\">\n              <Briefcase className=\"h-12 w-12 mx-auto text-muted-foreground opacity-50 mb-2\" />\n              <p className=\"text-muted-foreground text-sm\">{t.departments?.noDepartments || \"No departments yet\"}</p>\n              <p className=\"text-xs text-muted-foreground mt-1\">{t.departments?.createFirst || \"Create your first department to get started\"}</p>\n            </Card>\n          ) : (\n            departments.map((dept) => {\n              const IconComponent = departmentIcons[dept.icon || \"briefcase\"] || Briefcase;\n              const colorClass = departmentColors[dept.color || \"blue\"] || departmentColors.blue;\n\n              return (\n                <Card\n                  key={dept.id}\n                  className={`hover-elevate cursor-pointer transition-all ${\n                    selectedDepartment?.id === dept.id ? \"ring-2 ring-primary\" : \"\"\n                  }`}\n                  onClick={() => handleSelectDepartment(dept)}\n                  data-testid={`department-card-${dept.id}`}\n                >\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-start gap-3\">\n                      <div className={`p-2 rounded-lg ${colorClass}`}>\n                        <IconComponent className=\"h-5 w-5\" />\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center gap-2\">\n                          <h3 className=\"font-semibold\">{dept.name}</h3>\n                          {dept.password && (\n                            unlocked.has(dept.id) ? (\n                              <Unlock className=\"h-3.5 w-3.5 text-emerald-500\" />\n                            ) : (\n                              <Lock className=\"h-3.5 w-3.5 text-muted-foreground\" />\n                            )\n                          )}\n                        </div>\n                        {dept.description && (\n                          <p className=\"text-xs text-muted-foreground line-clamp-1 mt-0.5\">\n                            {dept.description}\n                          </p>\n                        )}\n                      </div>\n                      <ArrowRight className=\"h-4 w-4 text-muted-foreground\" />\n                    </div>\n                  </CardContent>\n                </Card>\n              );\n            })\n          )}\n        </div>\n\n        <div className=\"lg:col-span-2\">\n          {selectedDepartment ? (\n            isDepartmentUnlocked(selectedDepartment) ? (\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <h2 className=\"text-lg font-semibold flex items-center gap-2\">\n                      {selectedDepartment.name}\n                      {selectedDepartment.password && <Unlock className=\"h-4 w-4 text-emerald-500\" />}\n                    </h2>\n                    {selectedDepartment.description && (\n                      <p className=\"text-sm text-muted-foreground\">{selectedDepartment.description}</p>\n                    )}\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <Link href={`/departments/${selectedDepartment.id}`}>\n                      <Button size=\"sm\" data-testid=\"button-manage-employees\">\n                        <UserPlus className=\"h-4 w-4 mr-1\" />\n                        {t.departments?.manageEmployees || \"Manage Employees\"}\n                      </Button>\n                    </Link>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => deleteDepartmentMutation.mutate(selectedDepartment.id)}\n                      data-testid=\"button-delete-department\"\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-4\">\n                  <Card>\n                    <CardContent className=\"p-4 text-center\">\n                      <Users className=\"h-6 w-6 mx-auto text-primary mb-2\" />\n                      <p className=\"text-2xl font-bold\">{employees.length}</p>\n                      <p className=\"text-xs text-muted-foreground\">{t.departments?.employees || \"Employees\"}</p>\n                    </CardContent>\n                  </Card>\n                  <Card>\n                    <CardContent className=\"p-4 text-center\">\n                      <Activity className=\"h-6 w-6 mx-auto text-emerald-500 mb-2\" />\n                      <p className=\"text-2xl font-bold\">{employees.filter(e => e.status === 'active').length}</p>\n                      <p className=\"text-xs text-muted-foreground\">{t.departments?.active || \"Active\"}</p>\n                    </CardContent>\n                  </Card>\n                </div>\n\n                <Card>\n                  <CardHeader className=\"pb-2\">\n                    <CardTitle className=\"text-base flex items-center gap-2\">\n                      <Users className=\"h-4 w-4\" />\n                      {t.departments?.teamMembers || \"Team Members\"}\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    {employees.length === 0 ? (\n                      <div className=\"text-center py-6\">\n                        <Users className=\"h-10 w-10 mx-auto text-muted-foreground opacity-50 mb-2\" />\n                        <p className=\"text-sm text-muted-foreground\">{t.departments?.noEmployees || \"No employees yet\"}</p>\n                        <Link href={`/departments/${selectedDepartment.id}`}>\n                          <Button size=\"sm\" className=\"mt-3\" data-testid=\"button-add-first-employee\">\n                            <UserPlus className=\"h-4 w-4 mr-1\" />\n                            {t.departments?.addFirstEmployee || \"Add First Employee\"}\n                          </Button>\n                        </Link>\n                      </div>\n                    ) : (\n                      <div className=\"space-y-3\">\n                        {employees.map((emp) => (\n                          <div\n                            key={emp.id}\n                            className=\"flex items-center gap-3 p-2 rounded-lg hover:bg-muted/50\"\n                            data-testid={`employee-row-${emp.id}`}\n                          >\n                            <Avatar className=\"h-9 w-9\">\n                              <AvatarImage src={emp.profileImageUrl || undefined} />\n                              <AvatarFallback>\n                                {emp.firstName[0]}{emp.lastName[0]}\n                              </AvatarFallback>\n                            </Avatar>\n                            <div className=\"flex-1 min-w-0\">\n                              <p className=\"font-medium text-sm\">\n                                {emp.firstName} {emp.lastName}\n                              </p>\n                              <p className=\"text-xs text-muted-foreground\">\n                                @{emp.username} {emp.jobTitle && ` ${emp.jobTitle}`}\n                              </p>\n                            </div>\n                            <Badge variant={emp.status === 'active' ? 'default' : 'secondary'}>\n                              {emp.status === 'active' ? (t.departments?.statusActive || \"Active\") : (t.departments?.statusInactive || \"Inactive\")}\n                            </Badge>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              </div>\n            ) : (\n              <Card className=\"h-full flex items-center justify-center p-8\">\n                <div className=\"text-center\">\n                  <Lock className=\"h-16 w-16 mx-auto text-muted-foreground opacity-30 mb-4\" />\n                  <h3 className=\"font-medium text-lg mb-1\">{t.departments?.departmentLocked || \"Department Locked\"}</h3>\n                  <p className=\"text-sm text-muted-foreground mb-4\">\n                    {t.departments?.enterPasswordToAccess || \"Enter the password to access this department\"}\n                  </p>\n                  <Button onClick={() => setPasswordDialogOpen(true)} data-testid=\"button-unlock-department\">\n                    <Lock className=\"h-4 w-4 mr-2\" />\n                    {t.departments?.unlockDepartment || \"Unlock Department\"}\n                  </Button>\n                </div>\n              </Card>\n            )\n          ) : (\n            <Card className=\"h-full flex items-center justify-center p-8\">\n              <div className=\"text-center\">\n                <Briefcase className=\"h-16 w-16 mx-auto text-muted-foreground opacity-30 mb-4\" />\n                <h3 className=\"font-medium text-lg mb-1\">{t.departments?.selectDepartment || \"Select a Department\"}</h3>\n                <p className=\"text-sm text-muted-foreground\">\n                  {t.departments?.chooseDepartment || \"Choose a department from the list to manage its employees\"}\n                </p>\n              </div>\n            </Card>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":24793,"size_tokens":null},"client/src/components/StatusVideoRecorder.tsx":{"content":"import { useState, useRef, useEffect, useCallback } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Video,\n  VideoOff,\n  Download,\n  Sparkles,\n  Sun,\n  Moon,\n  Heart,\n  Star,\n  Zap,\n  RefreshCw,\n  X,\n  Camera,\n  Mic,\n  MicOff,\n  Type,\n  Link2,\n  Image,\n  Trash2,\n  Flame,\n  Snowflake,\n  SwitchCamera,\n  Lock,\n  Unlock,\n  Wand2,\n  Eye,\n  Smile,\n  CircleDot,\n  MessageCircle,\n  ThumbsUp,\n  type LucideIcon,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { FaceMesh, Results as FaceMeshResults } from \"@mediapipe/face_mesh\";\nimport { WebGLBeautyFilter, createFilterSettings, defaultSettings } from \"@/lib/webgl-beauty-filter\";\n\n\ninterface TextOverlay {\n  id: string;\n  type: \"text\";\n  content: string;\n  x: number;\n  y: number;\n  fontSize: number;\n  color: string;\n}\n\ninterface LinkOverlay {\n  id: string;\n  type: \"link\";\n  url: string;\n  label: string;\n  x: number;\n  y: number;\n}\n\ninterface ImageOverlay {\n  id: string;\n  type: \"image\";\n  src: string;\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\ninterface StickerOverlay {\n  id: string;\n  type: \"sticker\";\n  stickerId: string;\n  x: number;\n  y: number;\n  scale: number;\n}\n\ntype Overlay = TextOverlay | LinkOverlay | ImageOverlay | StickerOverlay;\n\ninterface InteractiveSticker {\n  id: string;\n  name: string;\n  icon: string;\n  IconComponent: LucideIcon;\n  gradient: string;\n}\n\nconst interactiveStickers: InteractiveSticker[] = [\n  { id: \"heart\", name: \"\", icon: \"heart\", IconComponent: Heart, gradient: \"from-red-500 to-pink-500\" },\n  { id: \"fire\", name: \"\", icon: \"flame\", IconComponent: Flame, gradient: \"from-orange-500 to-red-500\" },\n  { id: \"star\", name: \"\", icon: \"star\", IconComponent: Star, gradient: \"from-yellow-400 to-amber-500\" },\n  { id: \"chat\", name: \"\", icon: \"message-circle\", IconComponent: MessageCircle, gradient: \"from-blue-500 to-cyan-500\" },\n  { id: \"thumbsup\", name: \"\", icon: \"thumbs-up\", IconComponent: ThumbsUp, gradient: \"from-blue-500 to-indigo-500\" },\n  { id: \"sparkle\", name: \"\", icon: \"sparkles\", IconComponent: Sparkles, gradient: \"from-pink-500 to-rose-500\" },\n  { id: \"zap\", name: \"\", icon: \"zap\", IconComponent: Zap, gradient: \"from-amber-500 to-yellow-500\" },\n  { id: \"eye\", name: \"\", icon: \"eye\", IconComponent: Eye, gradient: \"from-purple-500 to-indigo-500\" },\n];\n\ninterface SnapFilter {\n  id: string;\n  name: string;\n  nameAr: string;\n  emoji: string;\n  gradient: string;\n  effects: {\n    smooth?: number;\n    brighten?: number;\n    lipTint?: { intensity: number; color: string };\n    lipGloss?: { intensity: number; color: string };\n    blush?: { intensity: number; color: string };\n    eyeShadow?: { intensity: number; color: string };\n    eyeliner?: { intensity: number; color: string };\n    colorFilter?: React.CSSProperties;\n  };\n}\n\nconst snapFilters: SnapFilter[] = [\n  {\n    id: \"none\",\n    name: \"Normal\",\n    nameAr: \"\",\n    emoji: \"\",\n    gradient: \"from-gray-400 to-gray-600\",\n    effects: {}\n  }\n];\n\nconst FACE_MESH_LANDMARKS = {\n  lips: {\n    outer: [61, 146, 91, 181, 84, 17, 314, 405, 321, 375, 291, 409, 270, 269, 267, 0, 37, 39, 40, 185],\n    inner: [78, 95, 88, 178, 87, 14, 317, 402, 318, 324, 308, 415, 310, 311, 312, 13, 82, 81, 80, 191],\n  },\n  leftCheek: [116, 123, 147, 187, 207, 206, 205, 36, 142, 126],\n  rightCheek: [345, 352, 376, 411, 427, 426, 425, 266, 371, 355],\n  leftEye: {\n    outline: [33, 7, 163, 144, 145, 153, 154, 155, 133, 173, 157, 158, 159, 160, 161, 246],\n    upper: [159, 145, 144, 163, 7, 33, 246, 161, 160],\n    lower: [33, 133, 155, 154, 153, 145, 144],\n  },\n  rightEye: {\n    outline: [362, 382, 381, 380, 374, 373, 390, 249, 263, 466, 388, 387, 386, 385, 384, 398],\n    upper: [386, 374, 373, 390, 249, 263, 466, 388, 387],\n    lower: [263, 362, 382, 381, 380, 374, 373],\n  },\n  faceContour: [10, 338, 297, 332, 284, 251, 389, 356, 454, 323, 361, 288, 397, 365, 379, 378, 400, 377, 152, 148, 176, 149, 150, 136, 172, 58, 132, 93, 234, 127, 162, 21, 54, 103, 67, 109],\n  nose: [1, 2, 98, 327, 168, 6, 197, 195, 5, 4, 19, 94, 2],\n};\n\n\ninterface StatusVideoRecorderProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport function StatusVideoRecorder({ open, onOpenChange }: StatusVideoRecorderProps) {\n  const { toast } = useToast();\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const beautyCanvasRef = useRef<HTMLCanvasElement>(null);\n  const previewCanvasRef = useRef<HTMLCanvasElement>(null);\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const streamRef = useRef<MediaStream | null>(null);\n  const chunksRef = useRef<Blob[]>([]);\n  const animationRef = useRef<number>(0);\n  const previewAnimationRef = useRef<number>(0);\n  const imageCache = useRef<Map<string, HTMLImageElement>>(new Map());\n  const faceMeshRef = useRef<FaceMesh | null>(null);\n  const faceLandmarksRef = useRef<FaceMeshResults | null>(null);\n  const beautyAnimationRef = useRef<number>(0);\n  const webglFilterRef = useRef<WebGLBeautyFilter | null>(null);\n  const [webglReady, setWebglReady] = useState(false);\n\n  const [isStreaming, setIsStreaming] = useState(false);\n  const [isRecording, setIsRecording] = useState(false);\n  const [isMuted, setIsMuted] = useState(false);\n  const [isLocked, setIsLocked] = useState(false);\n  const [facingMode, setFacingMode] = useState<\"user\" | \"environment\">(\"user\");\n  const [recordedVideo, setRecordedVideo] = useState<string | null>(null);\n  const [recordingTime, setRecordingTime] = useState(0);\n  const [cameraError, setCameraError] = useState<string | null>(null);\n  const [cameraLoading, setCameraLoading] = useState(false);\n  const [overlays, setOverlays] = useState<Overlay[]>([]);\n  \n  const [uploadedMedia, setUploadedMedia] = useState<{ url: string; type: \"image\" | \"video\"; file?: File } | null>(null);\n  const [mode, setMode] = useState<\"camera\" | \"upload\">(\"upload\");\n  const [isPublishing, setIsPublishing] = useState(false);\n  const galleryInputRef = useRef<HTMLInputElement>(null);\n  const queryClient = useQueryClient();\n  \n  const [showTextInput, setShowTextInput] = useState(false);\n  const [showLinkInput, setShowLinkInput] = useState(false);\n  const [showImageInput, setShowImageInput] = useState(false);\n  const [showStickerInput, setShowStickerInput] = useState(false);\n  const [newText, setNewText] = useState(\"\");\n  const [newTextColor, setNewTextColor] = useState(\"#ffffff\");\n  const [newLinkUrl, setNewLinkUrl] = useState(\"\");\n  const [newLinkLabel, setNewLinkLabel] = useState(\"\");\n  const [newImageUrl, setNewImageUrl] = useState(\"\");\n  \n  const [selectedSnapFilter, setSelectedSnapFilter] = useState<SnapFilter>(snapFilters[0]);\n  const [faceMeshReady, setFaceMeshReady] = useState(false);\n  const [faceDetected, setFaceDetected] = useState(false);\n\n  const startCamera = useCallback(async (facing: \"user\" | \"environment\" = facingMode) => {\n    try {\n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(track => track.stop());\n      }\n      \n      setCameraError(null);\n      setCameraLoading(true);\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: { \n          width: { ideal: 1280 }, \n          height: { ideal: 720 },\n          facingMode: facing\n        },\n        audio: true\n      });\n      \n      streamRef.current = stream;\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        \n        videoRef.current.onloadedmetadata = () => {\n          const video = videoRef.current;\n          if (video && video.videoWidth > 0 && video.videoHeight > 0) {\n            if (!webglFilterRef.current) {\n              const filter = new WebGLBeautyFilter();\n              const success = filter.initialize(video.videoWidth, video.videoHeight);\n              if (success) {\n                webglFilterRef.current = filter;\n                setWebglReady(true);\n                console.log(\"WebGL Beauty Filter initialized:\", video.videoWidth, \"x\", video.videoHeight);\n              }\n            }\n          }\n        };\n        \n        await videoRef.current.play();\n      }\n      setIsStreaming(true);\n      setCameraLoading(false);\n      \n      if (isMuted) {\n        stream.getAudioTracks().forEach(track => {\n          track.enabled = false;\n        });\n      }\n    } catch (err) {\n      console.error(\"Error accessing camera:\", err);\n      setCameraLoading(false);\n      setMode(\"upload\");\n      setCameraError(null);\n      toast({\n        title: \"  \",\n        description: \"  .    .\",\n        variant: \"destructive\",\n      });\n    }\n  }, [facingMode, isMuted, toast]);\n\n  const stopCamera = useCallback(() => {\n    if (animationRef.current) {\n      cancelAnimationFrame(animationRef.current);\n    }\n    if (previewAnimationRef.current) {\n      cancelAnimationFrame(previewAnimationRef.current);\n    }\n    if (beautyAnimationRef.current) {\n      cancelAnimationFrame(beautyAnimationRef.current);\n    }\n    if (faceMeshRef.current) {\n      faceMeshRef.current.close();\n      faceMeshRef.current = null;\n      setFaceMeshReady(false);\n    }\n    if (webglFilterRef.current) {\n      webglFilterRef.current.destroy();\n      webglFilterRef.current = null;\n      setWebglReady(false);\n    }\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(track => track.stop());\n      streamRef.current = null;\n    }\n    if (videoRef.current) {\n      videoRef.current.srcObject = null;\n    }\n    setIsStreaming(false);\n    setIsRecording(false);\n    setRecordingTime(0);\n    setFaceDetected(false);\n    setCameraLoading(false);\n    faceLandmarksRef.current = null;\n  }, []);\n\n  const initFaceMesh = useCallback(() => {\n    if (faceMeshRef.current) return;\n    \n    const faceMesh = new FaceMesh({\n      locateFile: (file) => {\n        return `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`;\n      },\n    });\n\n    faceMesh.setOptions({\n      maxNumFaces: 1,\n      refineLandmarks: true,\n      minDetectionConfidence: 0.5,\n      minTrackingConfidence: 0.5,\n    });\n\n    faceMesh.onResults((results: FaceMeshResults) => {\n      faceLandmarksRef.current = results;\n      setFaceDetected(results.multiFaceLandmarks && results.multiFaceLandmarks.length > 0);\n    });\n\n    faceMeshRef.current = faceMesh;\n    setFaceMeshReady(true);\n  }, []);\n\n  const hexToRgba = (hex: string, alpha: number) => {\n    const r = parseInt(hex.slice(1, 3), 16);\n    const g = parseInt(hex.slice(3, 5), 16);\n    const b = parseInt(hex.slice(5, 7), 16);\n    return `rgba(${r}, ${g}, ${b}, ${alpha})`;\n  };\n\n  const drawLips = useCallback((\n    ctx: CanvasRenderingContext2D,\n    landmarks: { x: number; y: number; z: number }[],\n    width: number,\n    height: number,\n    color: string,\n    intensity: number\n  ) => {\n    const alpha = (intensity / 100) * 0.7;\n    ctx.save();\n    ctx.fillStyle = hexToRgba(color, alpha);\n    ctx.beginPath();\n    \n    const outerLips = FACE_MESH_LANDMARKS.lips.outer;\n    const firstPoint = landmarks[outerLips[0]];\n    ctx.moveTo(firstPoint.x * width, firstPoint.y * height);\n    \n    for (let i = 1; i < outerLips.length; i++) {\n      const point = landmarks[outerLips[i]];\n      ctx.lineTo(point.x * width, point.y * height);\n    }\n    ctx.closePath();\n    ctx.fill();\n    ctx.restore();\n  }, []);\n\n  const drawBlush = useCallback((\n    ctx: CanvasRenderingContext2D,\n    landmarks: { x: number; y: number; z: number }[],\n    width: number,\n    height: number,\n    color: string,\n    intensity: number\n  ) => {\n    const alpha = (intensity / 100) * 0.4;\n    \n    const drawCheek = (cheekPoints: number[]) => {\n      let centerX = 0, centerY = 0;\n      cheekPoints.forEach(idx => {\n        centerX += landmarks[idx].x;\n        centerY += landmarks[idx].y;\n      });\n      centerX = (centerX / cheekPoints.length) * width;\n      centerY = (centerY / cheekPoints.length) * height;\n      \n      const radius = width * 0.06;\n      const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);\n      gradient.addColorStop(0, hexToRgba(color, alpha));\n      gradient.addColorStop(1, hexToRgba(color, 0));\n      \n      ctx.save();\n      ctx.fillStyle = gradient;\n      ctx.beginPath();\n      ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);\n      ctx.fill();\n      ctx.restore();\n    };\n    \n    drawCheek(FACE_MESH_LANDMARKS.leftCheek);\n    drawCheek(FACE_MESH_LANDMARKS.rightCheek);\n  }, []);\n\n  const drawEyeShadow = useCallback((\n    ctx: CanvasRenderingContext2D,\n    landmarks: { x: number; y: number; z: number }[],\n    width: number,\n    height: number,\n    color: string,\n    intensity: number\n  ) => {\n    const alpha = (intensity / 100) * 0.5;\n    \n    const drawEyeLid = (eyePoints: number[]) => {\n      ctx.save();\n      ctx.fillStyle = hexToRgba(color, alpha);\n      ctx.beginPath();\n      \n      const firstPoint = landmarks[eyePoints[0]];\n      ctx.moveTo(firstPoint.x * width, firstPoint.y * height);\n      \n      for (let i = 1; i < eyePoints.length; i++) {\n        const point = landmarks[eyePoints[i]];\n        ctx.lineTo(point.x * width, point.y * height);\n      }\n      ctx.closePath();\n      ctx.fill();\n      ctx.restore();\n    };\n    \n    drawEyeLid(FACE_MESH_LANDMARKS.leftEye.upper);\n    drawEyeLid(FACE_MESH_LANDMARKS.rightEye.upper);\n  }, []);\n\n  const drawEyeliner = useCallback((\n    ctx: CanvasRenderingContext2D,\n    landmarks: { x: number; y: number; z: number }[],\n    width: number,\n    height: number,\n    color: string,\n    intensity: number\n  ) => {\n    const lineWidth = (intensity / 100) * 3 + 1;\n    \n    const drawLine = (eyePoints: number[]) => {\n      ctx.save();\n      ctx.strokeStyle = color;\n      ctx.lineWidth = lineWidth;\n      ctx.lineCap = \"round\";\n      ctx.lineJoin = \"round\";\n      ctx.beginPath();\n      \n      const firstPoint = landmarks[eyePoints[0]];\n      ctx.moveTo(firstPoint.x * width, firstPoint.y * height);\n      \n      for (let i = 1; i < eyePoints.length; i++) {\n        const point = landmarks[eyePoints[i]];\n        ctx.lineTo(point.x * width, point.y * height);\n      }\n      ctx.stroke();\n      ctx.restore();\n    };\n    \n    drawLine(FACE_MESH_LANDMARKS.leftEye.upper);\n    drawLine(FACE_MESH_LANDMARKS.rightEye.upper);\n  }, []);\n\n  const applySnapFilterEffects = useCallback((\n    ctx: CanvasRenderingContext2D,\n    width: number,\n    height: number\n  ) => {\n    if (!faceLandmarksRef.current?.multiFaceLandmarks?.[0]) return;\n    if (selectedSnapFilter.id === \"none\") return;\n    \n    const landmarks = faceLandmarksRef.current.multiFaceLandmarks[0];\n    const effects = selectedSnapFilter.effects;\n    \n    if (effects.lipTint) {\n      drawLips(ctx, landmarks, width, height, effects.lipTint.color, effects.lipTint.intensity);\n    }\n    \n    if (effects.lipGloss) {\n      drawLips(ctx, landmarks, width, height, effects.lipGloss.color, effects.lipGloss.intensity * 0.5);\n    }\n    \n    if (effects.blush) {\n      drawBlush(ctx, landmarks, width, height, effects.blush.color, effects.blush.intensity);\n    }\n    \n    if (effects.eyeShadow) {\n      drawEyeShadow(ctx, landmarks, width, height, effects.eyeShadow.color, effects.eyeShadow.intensity);\n    }\n    \n    if (effects.eyeliner) {\n      drawEyeliner(ctx, landmarks, width, height, effects.eyeliner.color, effects.eyeliner.intensity);\n    }\n  }, [selectedSnapFilter, drawLips, drawBlush, drawEyeShadow, drawEyeliner]);\n\n  const hasBeautyEffects = useCallback(() => {\n    // Filters disabled - always return false for better performance\n    return false;\n  }, []);\n\n  const lastFaceMeshTimeRef = useRef<number>(0);\n  const FACE_MESH_INTERVAL = 150; // Run face mesh every 150ms (~7 FPS) for better performance\n  const lowResCanvasRef = useRef<HTMLCanvasElement | null>(null);\n  \n  const runFaceMesh = useCallback(async () => {\n    if (!faceMeshRef.current || !videoRef.current || !isStreaming) return;\n    \n    // Skip FaceMesh during recording - use cached landmarks\n    if (isRecording && faceLandmarksRef.current) {\n      if (isStreaming && !isRecording) {\n        beautyAnimationRef.current = requestAnimationFrame(runFaceMesh);\n      }\n      return;\n    }\n    \n    const now = performance.now();\n    const elapsed = now - lastFaceMeshTimeRef.current;\n    \n    // Only process face mesh at reduced frame rate\n    if (elapsed >= FACE_MESH_INTERVAL) {\n      lastFaceMeshTimeRef.current = now;\n      \n      try {\n        // Use low-res canvas for FaceMesh (faster processing)\n        if (!lowResCanvasRef.current) {\n          lowResCanvasRef.current = document.createElement('canvas');\n          lowResCanvasRef.current.width = 320;\n          lowResCanvasRef.current.height = 180;\n        }\n        const lowResCtx = lowResCanvasRef.current.getContext('2d');\n        if (lowResCtx && videoRef.current.readyState >= 2) {\n          lowResCtx.drawImage(videoRef.current, 0, 0, 320, 180);\n          await faceMeshRef.current.send({ image: lowResCanvasRef.current });\n        }\n        \n        if (webglFilterRef.current && faceLandmarksRef.current) {\n          webglFilterRef.current.updateFaceMesh(faceLandmarksRef.current);\n        }\n      } catch (err) {\n        // Silent error - don't spam console\n      }\n    }\n    \n    if (isStreaming && !isRecording) {\n      beautyAnimationRef.current = requestAnimationFrame(runFaceMesh);\n    }\n  }, [isStreaming, isRecording]);\n\n  useEffect(() => {\n    if (isStreaming && hasBeautyEffects()) {\n      initFaceMesh();\n      const startFaceMesh = async () => {\n        await new Promise(resolve => setTimeout(resolve, 500));\n        runFaceMesh();\n      };\n      startFaceMesh();\n    }\n    \n    return () => {\n      if (beautyAnimationRef.current) {\n        cancelAnimationFrame(beautyAnimationRef.current);\n      }\n    };\n  }, [isStreaming, hasBeautyEffects, initFaceMesh, runFaceMesh]);\n\n  useEffect(() => {\n    if (webglFilterRef.current && selectedSnapFilter) {\n      const filterSettings = createFilterSettings(selectedSnapFilter.effects);\n      webglFilterRef.current.updateSettings({\n        ...defaultSettings,\n        ...filterSettings\n      });\n    }\n  }, [selectedSnapFilter]);\n\n  const lastPreviewTimeRef = useRef<number>(0);\n  const PREVIEW_INTERVAL = 40; // Run preview at 25 FPS for smooth performance\n  const previewCtxRef = useRef<CanvasRenderingContext2D | null>(null);\n  const processCanvasRef = useRef<HTMLCanvasElement | null>(null);\n  \n  const runPreviewLoop = useCallback(() => {\n    if (!videoRef.current || !previewCanvasRef.current || !isStreaming) {\n      return;\n    }\n    \n    const now = performance.now();\n    const elapsed = now - lastPreviewTimeRef.current;\n    \n    // Throttle to reduce CPU usage\n    if (elapsed < PREVIEW_INTERVAL) {\n      previewAnimationRef.current = requestAnimationFrame(runPreviewLoop);\n      return;\n    }\n    \n    lastPreviewTimeRef.current = now;\n    \n    const video = videoRef.current;\n    const previewCanvas = previewCanvasRef.current;\n    \n    // Cache context reference\n    if (!previewCtxRef.current) {\n      previewCtxRef.current = previewCanvas.getContext('2d', { alpha: false, willReadFrequently: false });\n    }\n    const ctx = previewCtxRef.current;\n    \n    if (!ctx || video.readyState < 2) {\n      previewAnimationRef.current = requestAnimationFrame(runPreviewLoop);\n      return;\n    }\n    \n    // Use reduced resolution for processing (0.75x)\n    const processWidth = Math.round(video.videoWidth * 0.75);\n    const processHeight = Math.round(video.videoHeight * 0.75);\n    \n    if (previewCanvas.width !== processWidth || previewCanvas.height !== processHeight) {\n      previewCanvas.width = processWidth;\n      previewCanvas.height = processHeight;\n    }\n    \n    try {\n      // Check if we have WebGL filter and beauty effects\n      if (webglFilterRef.current && hasBeautyEffects() && selectedSnapFilter.id !== \"none\") {\n        // Create low-res processing canvas if needed\n        if (!processCanvasRef.current) {\n          processCanvasRef.current = document.createElement('canvas');\n        }\n        processCanvasRef.current.width = processWidth;\n        processCanvasRef.current.height = processHeight;\n        \n        const processCtx = processCanvasRef.current.getContext('2d', { alpha: false });\n        if (processCtx) {\n          processCtx.drawImage(video, 0, 0, processWidth, processHeight);\n          const filteredCanvas = webglFilterRef.current.render(processCanvasRef.current);\n          ctx.drawImage(filteredCanvas, 0, 0, previewCanvas.width, previewCanvas.height);\n        }\n      } else {\n        // No filter - just draw video directly\n        ctx.drawImage(video, 0, 0, previewCanvas.width, previewCanvas.height);\n      }\n      \n      // Apply CSS color filter if present\n      if (selectedSnapFilter.effects.colorFilter) {\n        previewCanvas.style.filter = selectedSnapFilter.effects.colorFilter.filter as string || '';\n      } else {\n        previewCanvas.style.filter = '';\n      }\n    } catch (err) {\n      // Silent error\n    }\n    \n    if (isStreaming) {\n      previewAnimationRef.current = requestAnimationFrame(runPreviewLoop);\n    }\n  }, [isStreaming, hasBeautyEffects, selectedSnapFilter]);\n\n  useEffect(() => {\n    if (isStreaming && webglReady && hasBeautyEffects()) {\n      runPreviewLoop();\n    }\n    \n    return () => {\n      if (previewAnimationRef.current) {\n        cancelAnimationFrame(previewAnimationRef.current);\n      }\n    };\n  }, [isStreaming, webglReady, hasBeautyEffects, runPreviewLoop]);\n\n  const flipCamera = useCallback(async () => {\n    if (isRecording) return;\n    const newFacing = facingMode === \"user\" ? \"environment\" : \"user\";\n    setFacingMode(newFacing);\n    await startCamera(newFacing);\n    toast({ title: newFacing === \"user\" ? \"Front Camera\" : \"Back Camera\" });\n  }, [facingMode, isRecording, startCamera, toast]);\n\n  const toggleLock = useCallback(() => {\n    setIsLocked(!isLocked);\n    toast({ title: isLocked ? \"Screen Unlocked\" : \"Screen Locked\" });\n  }, [isLocked, toast]);\n\n  const toggleMute = useCallback(() => {\n    if (streamRef.current) {\n      const audioTracks = streamRef.current.getAudioTracks();\n      audioTracks.forEach(track => {\n        track.enabled = isMuted;\n      });\n      setIsMuted(!isMuted);\n    }\n  }, [isMuted]);\n\n  const addTextOverlay = useCallback(() => {\n    if (!newText.trim()) return;\n    const overlay: TextOverlay = {\n      id: `text-${Date.now()}`,\n      type: \"text\",\n      content: newText,\n      x: 50,\n      y: 30,\n      fontSize: 28,\n      color: newTextColor,\n    };\n    setOverlays(prev => [...prev, overlay]);\n    setNewText(\"\");\n    setShowTextInput(false);\n    toast({ title: \"Text Added\" });\n  }, [newText, newTextColor, toast]);\n\n  const addLinkOverlay = useCallback(() => {\n    if (!newLinkUrl.trim() || !newLinkLabel.trim()) return;\n    const overlay: LinkOverlay = {\n      id: `link-${Date.now()}`,\n      type: \"link\",\n      url: newLinkUrl,\n      label: newLinkLabel,\n      x: 50,\n      y: 85,\n    };\n    setOverlays(prev => [...prev, overlay]);\n    setNewLinkUrl(\"\");\n    setNewLinkLabel(\"\");\n    setShowLinkInput(false);\n    toast({ title: \"Link Added\" });\n  }, [newLinkUrl, newLinkLabel, toast]);\n\n  const addImageOverlay = useCallback(() => {\n    if (!newImageUrl.trim()) return;\n    const img = new window.Image();\n    img.crossOrigin = \"anonymous\";\n    img.onload = () => {\n      imageCache.current.set(newImageUrl, img);\n      const overlay: ImageOverlay = {\n        id: `img-${Date.now()}`,\n        type: \"image\",\n        src: newImageUrl,\n        x: 80,\n        y: 20,\n        width: Math.min(img.width, 100),\n        height: Math.min(img.height, 100),\n      };\n      setOverlays(prev => [...prev, overlay]);\n      setNewImageUrl(\"\");\n      setShowImageInput(false);\n      toast({ title: \"Sticker Added\" });\n    };\n    img.onerror = () => {\n      toast({ title: \"Error\", description: \"Failed to load image.\", variant: \"destructive\" });\n    };\n    img.src = newImageUrl;\n  }, [newImageUrl, toast]);\n\n  const addStickerOverlay = useCallback((sticker: InteractiveSticker) => {\n    const overlay: StickerOverlay = {\n      id: `sticker-${Date.now()}`,\n      type: \"sticker\",\n      stickerId: sticker.id,\n      x: 50,\n      y: 50,\n      scale: 1,\n    };\n    setOverlays(prev => [...prev, overlay]);\n    setShowStickerInput(false);\n    toast({ title: `  ${sticker.name}` });\n  }, [toast]);\n\n  const clearOverlays = useCallback(() => {\n    setOverlays([]);\n  }, []);\n\n  const handleGallerySelect = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    const isImage = file.type.startsWith('image/');\n    const isVideo = file.type.startsWith('video/');\n\n    if (!isImage && !isVideo) {\n      toast({ title: \"\", description: \"    \", variant: \"destructive\" });\n      return;\n    }\n\n    if (file.size > 100 * 1024 * 1024) {\n      toast({ title: \"\", description: \"    (  100MB)\", variant: \"destructive\" });\n      return;\n    }\n\n    // Revoke previous URL to prevent memory leak\n    if (uploadedMedia?.url) {\n      URL.revokeObjectURL(uploadedMedia.url);\n    }\n\n    const url = URL.createObjectURL(file);\n    setUploadedMedia({ url, type: isImage ? \"image\" : \"video\", file });\n    stopCamera();\n    toast({ title: \" \", description: isImage ? \"  \" : \"  \" });\n    \n    if (e.target) {\n      e.target.value = '';\n    }\n  }, [stopCamera, toast, uploadedMedia]);\n\n  const clearUploadedMedia = useCallback(() => {\n    if (uploadedMedia?.url) {\n      URL.revokeObjectURL(uploadedMedia.url);\n    }\n    setUploadedMedia(null);\n  }, [uploadedMedia]);\n\n  const publishStatus = useCallback(async () => {\n    if (!uploadedMedia?.file) {\n      toast({ title: \"\", description: \"   \", variant: \"destructive\" });\n      return;\n    }\n\n    setIsPublishing(true);\n    try {\n      const reader = new FileReader();\n      const base64Promise = new Promise<string>((resolve, reject) => {\n        reader.onload = () => resolve(reader.result as string);\n        reader.onerror = reject;\n        reader.readAsDataURL(uploadedMedia.file!);\n      });\n\n      const mediaUrl = await base64Promise;\n      \n      await apiRequest('POST', '/api/statuses', {\n        mediaUrl,\n        mediaType: uploadedMedia.type,\n        text: ''\n      });\n\n      queryClient.invalidateQueries({ queryKey: ['/api/statuses'] });\n      toast({ title: \"   \" });\n      clearUploadedMedia();\n      onOpenChange(false);\n    } catch (error) {\n      console.error('Failed to publish status:', error);\n      toast({ title: \"\", description: \"   \", variant: \"destructive\" });\n    } finally {\n      setIsPublishing(false);\n    }\n  }, [uploadedMedia, toast, queryClient, clearUploadedMedia, onOpenChange]);\n\n  const openGallery = useCallback(() => {\n    galleryInputRef.current?.click();\n  }, []);\n\n  const switchToCamera = useCallback(() => {\n    clearUploadedMedia();\n    setMode(\"camera\");\n    startCamera();\n  }, [clearUploadedMedia, startCamera]);\n\n  const switchToUpload = useCallback(() => {\n    stopCamera();\n    setMode(\"upload\");\n  }, [stopCamera]);\n\n  const drawOverlays = useCallback((ctx: CanvasRenderingContext2D, width: number, height: number) => {\n    overlays.forEach(overlay => {\n      const x = (overlay.x / 100) * width;\n      const y = (overlay.y / 100) * height;\n\n      if (overlay.type === \"text\") {\n        ctx.save();\n        ctx.font = `bold ${overlay.fontSize}px Inter, sans-serif`;\n        ctx.fillStyle = overlay.color;\n        ctx.textAlign = \"center\";\n        ctx.shadowColor = \"rgba(0,0,0,0.7)\";\n        ctx.shadowBlur = 6;\n        ctx.shadowOffsetX = 2;\n        ctx.shadowOffsetY = 2;\n        ctx.fillText(overlay.content, x, y);\n        ctx.restore();\n      } else if (overlay.type === \"link\") {\n        ctx.save();\n        ctx.font = \"bold 20px Inter, sans-serif\";\n        ctx.textAlign = \"center\";\n        const padding = 12;\n        const textWidth = ctx.measureText(overlay.label).width;\n        \n        ctx.fillStyle = \"rgba(0,0,0,0.6)\";\n        ctx.beginPath();\n        ctx.roundRect(x - textWidth/2 - padding, y - 18, textWidth + padding * 2, 32, 16);\n        ctx.fill();\n        \n        ctx.fillStyle = \"#ffffff\";\n        ctx.fillText(overlay.label, x, y + 4);\n        \n        ctx.strokeStyle = \"rgba(255,255,255,0.3)\";\n        ctx.lineWidth = 1;\n        ctx.beginPath();\n        ctx.moveTo(x - textWidth/2, y + 8);\n        ctx.lineTo(x + textWidth/2, y + 8);\n        ctx.stroke();\n        ctx.restore();\n      } else if (overlay.type === \"image\") {\n        const cachedImg = imageCache.current.get(overlay.src);\n        if (cachedImg) {\n          ctx.drawImage(cachedImg, x, y, overlay.width, overlay.height);\n        }\n      } else if (overlay.type === \"sticker\") {\n        const sticker = interactiveStickers.find(s => s.id === overlay.stickerId);\n        if (sticker) {\n          ctx.save();\n          const size = 50 * overlay.scale;\n          ctx.shadowColor = \"rgba(0,0,0,0.5)\";\n          ctx.shadowBlur = 8;\n          ctx.shadowOffsetX = 2;\n          ctx.shadowOffsetY = 2;\n          \n          ctx.fillStyle = \"#ffffff\";\n          ctx.strokeStyle = \"#ffffff\";\n          ctx.lineWidth = 3;\n          ctx.lineCap = \"round\";\n          ctx.lineJoin = \"round\";\n          \n          if (sticker.icon === \"heart\") {\n            ctx.fillStyle = \"#ef4444\";\n            ctx.beginPath();\n            const heartX = x;\n            const heartY = y;\n            const heartSize = size * 0.6;\n            ctx.moveTo(heartX, heartY + heartSize * 0.3);\n            ctx.bezierCurveTo(heartX, heartY, heartX - heartSize, heartY, heartX - heartSize, heartY + heartSize * 0.3);\n            ctx.bezierCurveTo(heartX - heartSize, heartY + heartSize * 0.6, heartX, heartY + heartSize, heartX, heartY + heartSize);\n            ctx.bezierCurveTo(heartX, heartY + heartSize, heartX + heartSize, heartY + heartSize * 0.6, heartX + heartSize, heartY + heartSize * 0.3);\n            ctx.bezierCurveTo(heartX + heartSize, heartY, heartX, heartY, heartX, heartY + heartSize * 0.3);\n            ctx.fill();\n          } else if (sticker.icon === \"star\") {\n            ctx.fillStyle = \"#eab308\";\n            ctx.beginPath();\n            const spikes = 5;\n            const outerRadius = size * 0.5;\n            const innerRadius = size * 0.25;\n            for (let i = 0; i < spikes * 2; i++) {\n              const radius = i % 2 === 0 ? outerRadius : innerRadius;\n              const angle = (i * Math.PI) / spikes - Math.PI / 2;\n              const px = x + Math.cos(angle) * radius;\n              const py = y + Math.sin(angle) * radius;\n              if (i === 0) ctx.moveTo(px, py);\n              else ctx.lineTo(px, py);\n            }\n            ctx.closePath();\n            ctx.fill();\n          } else if (sticker.icon === \"flame\") {\n            ctx.fillStyle = \"#f97316\";\n            ctx.beginPath();\n            ctx.moveTo(x, y - size * 0.5);\n            ctx.quadraticCurveTo(x + size * 0.4, y - size * 0.2, x + size * 0.3, y + size * 0.3);\n            ctx.quadraticCurveTo(x + size * 0.1, y + size * 0.1, x, y + size * 0.5);\n            ctx.quadraticCurveTo(x - size * 0.1, y + size * 0.1, x - size * 0.3, y + size * 0.3);\n            ctx.quadraticCurveTo(x - size * 0.4, y - size * 0.2, x, y - size * 0.5);\n            ctx.fill();\n          } else if (sticker.icon === \"message-circle\") {\n            ctx.fillStyle = \"#3b82f6\";\n            ctx.beginPath();\n            ctx.ellipse(x, y, size * 0.4, size * 0.35, 0, 0, Math.PI * 2);\n            ctx.fill();\n            ctx.beginPath();\n            ctx.moveTo(x - size * 0.15, y + size * 0.3);\n            ctx.lineTo(x - size * 0.3, y + size * 0.5);\n            ctx.lineTo(x, y + size * 0.35);\n            ctx.fill();\n          } else if (sticker.icon === \"thumbs-up\") {\n            ctx.fillStyle = \"#3b82f6\";\n            ctx.beginPath();\n            ctx.roundRect(x - size * 0.35, y, size * 0.2, size * 0.4, 4);\n            ctx.fill();\n            ctx.beginPath();\n            ctx.roundRect(x - size * 0.1, y - size * 0.3, size * 0.45, size * 0.7, 8);\n            ctx.fill();\n          } else if (sticker.icon === \"sparkles\") {\n            ctx.fillStyle = \"#ec4899\";\n            const drawSparkle = (sx: number, sy: number, sparkleSize: number) => {\n              ctx.beginPath();\n              ctx.moveTo(sx, sy - sparkleSize);\n              ctx.lineTo(sx + sparkleSize * 0.3, sy);\n              ctx.lineTo(sx, sy + sparkleSize);\n              ctx.lineTo(sx - sparkleSize * 0.3, sy);\n              ctx.closePath();\n              ctx.fill();\n            };\n            drawSparkle(x, y, size * 0.4);\n            drawSparkle(x + size * 0.35, y - size * 0.2, size * 0.25);\n            drawSparkle(x - size * 0.3, y + size * 0.25, size * 0.2);\n          } else if (sticker.icon === \"zap\") {\n            ctx.fillStyle = \"#eab308\";\n            ctx.beginPath();\n            ctx.moveTo(x + size * 0.1, y - size * 0.5);\n            ctx.lineTo(x - size * 0.2, y);\n            ctx.lineTo(x, y);\n            ctx.lineTo(x - size * 0.1, y + size * 0.5);\n            ctx.lineTo(x + size * 0.2, y);\n            ctx.lineTo(x, y);\n            ctx.closePath();\n            ctx.fill();\n          } else if (sticker.icon === \"eye\") {\n            ctx.fillStyle = \"#8b5cf6\";\n            ctx.beginPath();\n            ctx.ellipse(x, y, size * 0.45, size * 0.25, 0, 0, Math.PI * 2);\n            ctx.fill();\n            ctx.fillStyle = \"#ffffff\";\n            ctx.beginPath();\n            ctx.arc(x, y, size * 0.15, 0, Math.PI * 2);\n            ctx.fill();\n            ctx.fillStyle = \"#1e1b4b\";\n            ctx.beginPath();\n            ctx.arc(x, y, size * 0.08, 0, Math.PI * 2);\n            ctx.fill();\n          }\n          \n          ctx.restore();\n        }\n      }\n    });\n  }, [overlays]);\n\n  const startRecording = useCallback(() => {\n    if (!streamRef.current || isLocked) return;\n\n    chunksRef.current = [];\n    const canvas = canvasRef.current;\n    const video = videoRef.current;\n    \n    if (!canvas || !video) return;\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    canvas.width = video.videoWidth || 1920;\n    canvas.height = video.videoHeight || 1080;\n\n    setIsRecording(true);\n\n    const drawFrame = () => {\n      if (!video || !ctx) return;\n      \n      ctx.save();\n      \n      if (webglFilterRef.current && webglReady && hasBeautyEffects()) {\n        const filteredCanvas = webglFilterRef.current.render(video);\n        \n        if (facingMode === \"user\") {\n          ctx.scale(-1, 1);\n          ctx.drawImage(filteredCanvas, -canvas.width, 0, canvas.width, canvas.height);\n        } else {\n          ctx.drawImage(filteredCanvas, 0, 0, canvas.width, canvas.height);\n        }\n      } else {\n        const effects = selectedSnapFilter.effects;\n        let filterString = \"\";\n        \n        if (effects.colorFilter?.filter) {\n          filterString = effects.colorFilter.filter as string;\n        }\n        \n        if (effects.smooth) {\n          const blurAmount = (effects.smooth / 100) * 1.5;\n          filterString += ` blur(${blurAmount}px)`;\n        }\n        if (effects.brighten) {\n          const brightnessAmount = 1 + (effects.brighten / 100) * 0.3;\n          filterString += ` brightness(${brightnessAmount})`;\n        }\n        \n        if (filterString.trim()) {\n          ctx.filter = filterString.trim();\n        }\n        \n        if (facingMode === \"user\") {\n          ctx.scale(-1, 1);\n          ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);\n        } else {\n          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n        }\n      }\n      ctx.restore();\n      \n      ctx.filter = \"none\";\n      \n      if (!webglReady || !hasBeautyEffects()) {\n        applySnapFilterEffects(ctx, canvas.width, canvas.height);\n      }\n      \n      drawOverlays(ctx, canvas.width, canvas.height);\n      \n      animationRef.current = requestAnimationFrame(drawFrame);\n    };\n\n    const canvasStream = canvas.captureStream(30);\n    if (!isMuted) {\n      const audioTrack = streamRef.current.getAudioTracks()[0];\n      if (audioTrack) {\n        canvasStream.addTrack(audioTrack);\n      }\n    }\n\n    const mediaRecorder = new MediaRecorder(canvasStream, {\n      mimeType: 'video/webm;codecs=vp9'\n    });\n\n    mediaRecorder.ondataavailable = (e) => {\n      if (e.data.size > 0) {\n        chunksRef.current.push(e.data);\n      }\n    };\n\n    mediaRecorder.onstop = () => {\n      const blob = new Blob(chunksRef.current, { type: 'video/webm' });\n      const url = URL.createObjectURL(blob);\n      setRecordedVideo(url);\n    };\n\n    mediaRecorderRef.current = mediaRecorder;\n    mediaRecorder.start(100);\n    \n    drawFrame();\n  }, [selectedSnapFilter, isMuted, drawOverlays, facingMode, isLocked, applySnapFilterEffects, webglReady, hasBeautyEffects]);\n\n  const stopRecording = useCallback(() => {\n    if (animationRef.current) {\n      cancelAnimationFrame(animationRef.current);\n    }\n    if (mediaRecorderRef.current && mediaRecorderRef.current.state !== 'inactive') {\n      mediaRecorderRef.current.stop();\n    }\n    setIsRecording(false);\n    setRecordingTime(0);\n  }, []);\n\n  const downloadVideo = useCallback(() => {\n    if (!recordedVideo) return;\n    \n    const a = document.createElement('a');\n    a.href = recordedVideo;\n    a.download = `status-${new Date().toISOString().slice(0, 10)}.webm`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    \n    toast({ title: \"Video Saved\" });\n  }, [recordedVideo, toast]);\n\n  const resetRecording = useCallback(() => {\n    if (recordedVideo) {\n      URL.revokeObjectURL(recordedVideo);\n    }\n    setRecordedVideo(null);\n    setRecordingTime(0);\n  }, [recordedVideo]);\n\n  useEffect(() => {\n    if (open) {\n      if (mode === \"camera\") {\n        startCamera();\n      }\n    } else {\n      stopCamera();\n      resetRecording();\n      clearUploadedMedia();\n      setOverlays([]);\n      setShowTextInput(false);\n      setShowLinkInput(false);\n      setShowImageInput(false);\n      setShowStickerInput(false);\n      setIsLocked(false);\n      setMode(\"upload\");\n    }\n    \n    return () => {\n      stopCamera();\n    };\n  }, [open, mode, startCamera, stopCamera, resetRecording, clearUploadedMedia]);\n\n  useEffect(() => {\n    let interval: NodeJS.Timeout;\n    if (isRecording) {\n      interval = setInterval(() => {\n        setRecordingTime(prev => prev + 1);\n      }, 1000);\n    }\n    return () => clearInterval(interval);\n  }, [isRecording]);\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-[100vw] w-[100vw] h-[100vh] max-h-[100vh] p-0 m-0 rounded-none border-0 bg-black\">\n        <DialogTitle className=\"sr-only\">Daily Status Video Recorder</DialogTitle>\n        <DialogDescription className=\"sr-only\">Record a video status update with filters and overlays</DialogDescription>\n        <input\n          ref={galleryInputRef}\n          type=\"file\"\n          accept=\"image/*,video/*\"\n          onChange={handleGallerySelect}\n          className=\"hidden\"\n          data-testid=\"input-gallery-file\"\n        />\n        <div className=\"relative flex flex-col h-full\">\n          {/* Lock overlay */}\n          {isLocked && (\n            <div className=\"absolute inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-[1px]\">\n              <Button\n                variant=\"ghost\"\n                size=\"lg\"\n                onClick={toggleLock}\n                className=\"bg-white/20 backdrop-blur-md hover:bg-white/30 text-white rounded-full h-20 w-20\"\n                data-testid=\"button-unlock-screen\"\n              >\n                <Lock className=\"h-10 w-10\" />\n              </Button>\n            </div>\n          )}\n\n          {/* Top bar */}\n          <div className=\"absolute top-0 left-0 right-0 z-20 flex items-center justify-between p-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => !isLocked && onOpenChange(false)}\n              className=\"bg-black/30 backdrop-blur-sm text-white hover:bg-black/50 rounded-full h-10 w-10\"\n              disabled={isLocked}\n              data-testid=\"button-close-recorder\"\n            >\n              <X className=\"h-5 w-5\" />\n            </Button>\n            \n            {isRecording && (\n              <div className=\"flex items-center gap-2 bg-red-500 text-white px-4 py-2 rounded-full\">\n                <div className=\"w-2 h-2 bg-white rounded-full animate-pulse\" />\n                <span className=\"font-semibold text-sm\">{formatTime(recordingTime)}</span>\n              </div>\n            )}\n            \n            <div className=\"flex items-center gap-2\">\n              {overlays.length > 0 && !isLocked && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={clearOverlays}\n                  className=\"bg-black/30 backdrop-blur-sm text-white hover:bg-black/50 rounded-full\"\n                  data-testid=\"button-clear-overlays\"\n                >\n                  <Trash2 className=\"h-4 w-4 mr-1\" />\n                  Clear\n                </Button>\n              )}\n            </div>\n          </div>\n\n          {/* Main video area */}\n          <div className=\"flex-1 relative overflow-hidden\">\n            {recordedVideo ? (\n              <video \n                src={recordedVideo} \n                controls \n                autoPlay\n                loop\n                className=\"w-full h-full object-cover\"\n                data-testid=\"video-preview\"\n              />\n            ) : uploadedMedia ? (\n              <div className=\"absolute inset-0 flex flex-col items-center justify-center bg-black p-4\">\n                <div className=\"flex-1 flex items-center justify-center w-full max-h-[60vh]\">\n                  {uploadedMedia.type === \"image\" ? (\n                    <img \n                      src={uploadedMedia.url} \n                      alt=\"Uploaded\" \n                      className=\"max-w-full max-h-full object-contain rounded-lg\"\n                      data-testid=\"uploaded-image-preview\"\n                    />\n                  ) : (\n                    <video \n                      src={uploadedMedia.url} \n                      controls \n                      autoPlay\n                      loop\n                      className=\"max-w-full max-h-full object-contain rounded-lg\"\n                      data-testid=\"uploaded-video-preview\"\n                    />\n                  )}\n                </div>\n                <div className=\"flex flex-col gap-3 mt-6 w-full max-w-xs\">\n                  <Button \n                    onClick={publishStatus}\n                    disabled={isPublishing}\n                    size=\"lg\"\n                    className=\"bg-gradient-to-r from-primary to-blue-500 hover:opacity-90 text-white rounded-full px-8 w-full\"\n                    data-testid=\"button-publish-status\"\n                  >\n                    {isPublishing ? (\n                      <>\n                        <div className=\"w-5 h-5 mr-2 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\n                         ...\n                      </>\n                    ) : (\n                      <>\n                        <Sparkles className=\"h-5 w-5 mr-2\" />\n                          \n                      </>\n                    )}\n                  </Button>\n                  <Button \n                    onClick={() => {\n                      clearUploadedMedia();\n                      openGallery();\n                    }}\n                    variant=\"outline\"\n                    size=\"lg\"\n                    className=\"border-white/30 text-white hover:bg-white/10 rounded-full px-8 w-full\"\n                    data-testid=\"button-choose-another\"\n                  >\n                    <Image className=\"h-5 w-5 mr-2\" />\n                      \n                  </Button>\n                </div>\n              </div>\n            ) : mode === \"upload\" ? (\n              <div className=\"absolute inset-0 flex items-center justify-center text-white\">\n                <div className=\"text-center p-8\">\n                  <div className=\"w-32 h-32 mx-auto mb-6 rounded-full bg-gradient-to-br from-primary to-blue-500 flex items-center justify-center\">\n                    <Image className=\"h-16 w-16 text-white\" />\n                  </div>\n                  <h3 className=\"text-2xl font-bold mb-2\"> </h3>\n                  <p className=\"text-white/70 mb-6\">     </p>\n                  <div className=\"flex flex-col gap-3\">\n                    <Button \n                      onClick={openGallery}\n                      size=\"lg\"\n                      className=\"bg-white text-black hover:bg-white/90 rounded-full px-8\"\n                      data-testid=\"button-open-gallery\"\n                    >\n                      <Image className=\"h-5 w-5 mr-2\" />\n                        \n                    </Button>\n                    <Button \n                      onClick={switchToCamera}\n                      variant=\"outline\"\n                      size=\"lg\"\n                      className=\"border-white/30 text-white hover:bg-white/10 rounded-full px-8\"\n                      data-testid=\"button-switch-to-camera\"\n                    >\n                      <Camera className=\"h-5 w-5 mr-2\" />\n                       \n                    </Button>\n                  </div>\n                </div>\n              </div>\n            ) : (\n              <>\n                {cameraLoading ? (\n                  <div className=\"absolute inset-0 flex items-center justify-center text-white\">\n                    <div className=\"text-center p-4\">\n                      <div className=\"w-16 h-16 mx-auto mb-4 border-4 border-white/30 border-t-white rounded-full animate-spin\" />\n                      <p className=\"text-lg\">  ...</p>\n                    </div>\n                  </div>\n                ) : cameraError ? (\n                  <div className=\"absolute inset-0 flex items-center justify-center text-white\">\n                    <div className=\"text-center p-4\">\n                      <VideoOff className=\"h-20 w-20 mx-auto mb-4 opacity-50\" />\n                      <p className=\"text-lg mb-4\">{cameraError}</p>\n                      <Button \n                        onClick={() => startCamera()}\n                        className=\"bg-white/20 backdrop-blur-sm hover:bg-white/30\"\n                        data-testid=\"button-retry-camera\"\n                      >\n                        <RefreshCw className=\"h-4 w-4 mr-2\" />\n                        Try Again\n                      </Button>\n                    </div>\n                  </div>\n                ) : (\n                  <>\n                    <video\n                      ref={videoRef}\n                      autoPlay\n                      playsInline\n                      muted\n                      className={`w-full h-full object-cover ${webglReady && hasBeautyEffects() ? 'hidden' : ''}`}\n                      style={{ \n                        transform: facingMode === \"user\" ? 'scaleX(-1)' : 'none',\n                        ...(selectedSnapFilter.effects.colorFilter || {})\n                      }}\n                      data-testid=\"video-stream\"\n                    />\n                    <canvas \n                      ref={previewCanvasRef} \n                      className={`w-full h-full object-cover ${webglReady && hasBeautyEffects() ? '' : 'hidden'}`}\n                      style={{ \n                        transform: facingMode === \"user\" ? 'scaleX(-1)' : 'none'\n                      }}\n                      data-testid=\"canvas-preview\"\n                    />\n                    <canvas ref={canvasRef} className=\"hidden\" />\n\n                    {/* Overlays preview */}\n                    <div className=\"absolute inset-0 pointer-events-none\">\n                      {overlays.map(overlay => {\n                        const style: React.CSSProperties = {\n                          position: 'absolute',\n                          left: `${overlay.x}%`,\n                          top: `${overlay.y}%`,\n                          transform: 'translate(-50%, -50%)',\n                        };\n\n                        if (overlay.type === \"text\") {\n                          return (\n                            <div\n                              key={overlay.id}\n                              style={{\n                                ...style,\n                                fontSize: overlay.fontSize,\n                                color: overlay.color,\n                                fontWeight: 'bold',\n                                textShadow: '2px 2px 6px rgba(0,0,0,0.7)',\n                                whiteSpace: 'nowrap',\n                              }}\n                            >\n                              {overlay.content}\n                            </div>\n                          );\n                        } else if (overlay.type === \"link\") {\n                          return (\n                            <div\n                              key={overlay.id}\n                              className=\"bg-black/60 backdrop-blur-sm px-4 py-2 rounded-full\"\n                              style={style}\n                            >\n                              <span className=\"text-white font-semibold text-sm underline\">\n                                {overlay.label}\n                              </span>\n                            </div>\n                          );\n                        } else if (overlay.type === \"image\") {\n                          return (\n                            <img\n                              key={overlay.id}\n                              src={overlay.src}\n                              alt=\"\"\n                              style={{\n                                ...style,\n                                width: overlay.width,\n                                height: overlay.height,\n                                objectFit: 'contain',\n                              }}\n                            />\n                          );\n                        }\n                        return null;\n                      })}\n                    </div>\n\n                  </>\n                )}\n              </>\n            )}\n          </div>\n\n          {/* Left side controls - Flip & Lock */}\n          {!recordedVideo && isStreaming && !isLocked && (\n            <div className=\"absolute left-4 top-1/2 -translate-y-1/2 flex flex-col gap-4 z-20\">\n              {/* Flip camera button */}\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={flipCamera}\n                disabled={isRecording}\n                className={`h-12 w-12 rounded-full bg-black/40 backdrop-blur-sm hover:bg-black/60 text-white ${isRecording ? 'opacity-50' : ''}`}\n                data-testid=\"button-flip-camera\"\n              >\n                <SwitchCamera className=\"h-5 w-5\" />\n              </Button>\n\n              {/* Lock screen button */}\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={toggleLock}\n                className=\"h-12 w-12 rounded-full bg-black/40 backdrop-blur-sm hover:bg-black/60 text-white\"\n                data-testid=\"button-lock-screen\"\n              >\n                <Unlock className=\"h-5 w-5\" />\n              </Button>\n            </div>\n          )}\n\n          {/* Right side controls */}\n          {!recordedVideo && isStreaming && !isLocked && (\n            <div className=\"absolute right-4 top-1/2 -translate-y-1/2 flex flex-col gap-4 z-20\">\n              {/* Mute button */}\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={toggleMute}\n                className={`h-12 w-12 rounded-full backdrop-blur-sm ${isMuted ? 'bg-red-500/80 hover:bg-red-500' : 'bg-black/40 hover:bg-black/60'} text-white`}\n                data-testid=\"button-mute\"\n              >\n                {isMuted ? <MicOff className=\"h-5 w-5\" /> : <Mic className=\"h-5 w-5\" />}\n              </Button>\n\n              {/* Text button */}\n              <Popover open={showTextInput} onOpenChange={setShowTextInput}>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"h-12 w-12 rounded-full bg-black/40 backdrop-blur-sm hover:bg-black/60 text-white\"\n                    data-testid=\"button-add-text\"\n                  >\n                    <Type className=\"h-5 w-5\" />\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent side=\"left\" className=\"w-64 bg-black/90 backdrop-blur-md border-white/20\">\n                  <div className=\"space-y-3\">\n                    <Input\n                      value={newText}\n                      onChange={(e) => setNewText(e.target.value)}\n                      placeholder=\"Type text...\"\n                      className=\"bg-white/10 border-white/20 text-white placeholder:text-white/50\"\n                      data-testid=\"input-text-content\"\n                      onKeyDown={(e) => e.key === 'Enter' && addTextOverlay()}\n                    />\n                    <div className=\"flex gap-2\">\n                      <Input\n                        type=\"color\"\n                        value={newTextColor}\n                        onChange={(e) => setNewTextColor(e.target.value)}\n                        className=\"w-12 h-9 p-1 bg-transparent border-white/20\"\n                        data-testid=\"input-text-color\"\n                      />\n                      <Button onClick={addTextOverlay} disabled={!newText.trim()} className=\"flex-1\" data-testid=\"button-confirm-text\">\n                        Add\n                      </Button>\n                    </div>\n                  </div>\n                </PopoverContent>\n              </Popover>\n\n              {/* Link button */}\n              <Popover open={showLinkInput} onOpenChange={setShowLinkInput}>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"h-12 w-12 rounded-full bg-black/40 backdrop-blur-sm hover:bg-black/60 text-white\"\n                    data-testid=\"button-add-link\"\n                  >\n                    <Link2 className=\"h-5 w-5\" />\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent side=\"left\" className=\"w-64 bg-black/90 backdrop-blur-md border-white/20\">\n                  <div className=\"space-y-3\">\n                    <Input\n                      value={newLinkLabel}\n                      onChange={(e) => setNewLinkLabel(e.target.value)}\n                      placeholder=\"Swipe up\"\n                      className=\"bg-white/10 border-white/20 text-white placeholder:text-white/50\"\n                      data-testid=\"input-link-label\"\n                    />\n                    <Input\n                      value={newLinkUrl}\n                      onChange={(e) => setNewLinkUrl(e.target.value)}\n                      placeholder=\"https://...\"\n                      className=\"bg-white/10 border-white/20 text-white placeholder:text-white/50\"\n                      data-testid=\"input-link-url\"\n                    />\n                    <Button onClick={addLinkOverlay} disabled={!newLinkUrl.trim() || !newLinkLabel.trim()} className=\"w-full\" data-testid=\"button-confirm-link\">\n                      Add Link\n                    </Button>\n                  </div>\n                </PopoverContent>\n              </Popover>\n\n              {/* Sticker/Image button */}\n              <Popover open={showImageInput} onOpenChange={setShowImageInput}>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"h-12 w-12 rounded-full bg-black/40 backdrop-blur-sm hover:bg-black/60 text-white\"\n                    data-testid=\"button-add-sticker\"\n                  >\n                    <Image className=\"h-5 w-5\" />\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent side=\"left\" className=\"w-64 bg-black/90 backdrop-blur-md border-white/20\">\n                  <div className=\"space-y-3\">\n                    <Input\n                      value={newImageUrl}\n                      onChange={(e) => setNewImageUrl(e.target.value)}\n                      placeholder=\"Image URL...\"\n                      className=\"bg-white/10 border-white/20 text-white placeholder:text-white/50\"\n                      data-testid=\"input-sticker-url\"\n                    />\n                    <Button onClick={addImageOverlay} disabled={!newImageUrl.trim()} className=\"w-full\" data-testid=\"button-confirm-sticker\">\n                      Add Sticker\n                    </Button>\n                  </div>\n                </PopoverContent>\n              </Popover>\n\n              {/* Interactive Reactions Stickers button */}\n              <Popover open={showStickerInput} onOpenChange={setShowStickerInput}>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"h-12 w-12 rounded-full bg-gradient-to-br from-red-500 to-pink-500 backdrop-blur-sm hover:opacity-90 text-white\"\n                    data-testid=\"button-add-reactions\"\n                  >\n                    <Heart className=\"h-5 w-5\" />\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent side=\"left\" className=\"w-72 bg-black/90 backdrop-blur-md border-white/20 p-3\">\n                  <div className=\"space-y-3\">\n                    <p className=\"text-white/80 text-sm font-medium text-center\"> </p>\n                    <div className=\"grid grid-cols-4 gap-2\">\n                      {interactiveStickers.map((sticker) => {\n                        const IconComp = sticker.IconComponent;\n                        return (\n                          <button\n                            key={sticker.id}\n                            onClick={() => addStickerOverlay(sticker)}\n                            className={`flex flex-col items-center gap-1 p-2 rounded-xl bg-gradient-to-br ${sticker.gradient} hover:opacity-80 transition-opacity`}\n                            data-testid={`button-sticker-${sticker.id}`}\n                          >\n                            <IconComp className=\"h-6 w-6 text-white\" />\n                            <span className=\"text-[10px] text-white font-medium\">{sticker.name}</span>\n                          </button>\n                        );\n                      })}\n                    </div>\n                  </div>\n                </PopoverContent>\n              </Popover>\n            </div>\n          )}\n\n          {/* Bottom controls */}\n          {!isLocked && (\n            <div className=\"absolute bottom-0 left-0 right-0 z-20 pb-6\">\n              {recordedVideo ? (\n                /* Post-recording controls */\n                <div className=\"flex items-center justify-center gap-6 px-4\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"lg\"\n                    onClick={resetRecording}\n                    className=\"bg-black/40 backdrop-blur-sm hover:bg-black/60 text-white rounded-full h-14 px-6\"\n                    data-testid=\"button-retake\"\n                  >\n                    <RefreshCw className=\"h-5 w-5 mr-2\" />\n                    Retake\n                  </Button>\n                  <Button\n                    size=\"lg\"\n                    onClick={downloadVideo}\n                    className=\"bg-white hover:bg-white/90 text-black rounded-full h-14 px-8 font-semibold\"\n                    data-testid=\"button-save\"\n                  >\n                    <Download className=\"h-5 w-5 mr-2\" />\n                    Save\n                  </Button>\n                </div>\n              ) : uploadedMedia ? (\n                /* Uploaded media controls */\n                <div className=\"flex items-center justify-center gap-6 px-4\">\n                  <Button\n                    variant=\"ghost\"\n                    size=\"lg\"\n                    onClick={clearUploadedMedia}\n                    className=\"bg-black/40 backdrop-blur-sm hover:bg-black/60 text-white rounded-full h-14 px-6\"\n                    data-testid=\"button-choose-another\"\n                  >\n                    <RefreshCw className=\"h-5 w-5 mr-2\" />\n                     \n                  </Button>\n                  <Button\n                    size=\"lg\"\n                    onClick={() => {\n                      toast({ title: \"  \", description: \"   \" });\n                      onOpenChange(false);\n                    }}\n                    className=\"bg-white hover:bg-white/90 text-black rounded-full h-14 px-8 font-semibold\"\n                    data-testid=\"button-share-status\"\n                  >\n                    <Download className=\"h-5 w-5 mr-2\" />\n                     \n                  </Button>\n                </div>\n              ) : mode === \"camera\" && isStreaming ? (\n                <>\n                  {/* Record button */}\n                  <div className=\"flex items-center justify-center\">\n                    {isRecording ? (\n                      <button\n                        onClick={stopRecording}\n                        className=\"relative\"\n                        data-testid=\"button-stop-recording\"\n                      >\n                        <div className=\"w-20 h-20 rounded-full border-4 border-white flex items-center justify-center bg-transparent\">\n                          <div className=\"w-8 h-8 rounded-sm bg-red-500\" />\n                        </div>\n                      </button>\n                    ) : (\n                      <button\n                        onClick={startRecording}\n                        className=\"relative group\"\n                        data-testid=\"button-start-recording\"\n                      >\n                        <div className=\"w-20 h-20 rounded-full border-4 border-white flex items-center justify-center transition-all group-hover:scale-105 group-active:scale-95\">\n                          <div className=\"w-16 h-16 rounded-full bg-red-500 group-hover:bg-red-400 transition-colors\" />\n                        </div>\n                      </button>\n                    )}\n                  </div>\n                  {/* Switch to upload mode button */}\n                  <div className=\"flex justify-center mt-4\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={switchToUpload}\n                      className=\"text-white/70 hover:text-white hover:bg-white/10\"\n                      data-testid=\"button-switch-to-upload\"\n                    >\n                      <Image className=\"h-4 w-4 mr-2\" />\n                         \n                    </Button>\n                  </div>\n                </>\n              ) : null}\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nexport function FloatingVideoButton({ onClick }: { onClick: () => void }) {\n  return (\n    <Button\n      onClick={onClick}\n      size=\"lg\"\n      className=\"fixed bottom-6 right-6 h-14 w-14 rounded-full shadow-lg hover:shadow-xl transition-all z-50 bg-gradient-to-r from-primary to-primary/80\"\n      data-testid=\"button-floating-video\"\n    >\n      <Video className=\"h-6 w-6\" />\n    </Button>\n  );\n}\n","path":null,"size_bytes":65081,"size_tokens":null},"client/src/pages/Advertising.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Label } from \"@/components/ui/label\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\nimport {\n  Megaphone,\n  CreditCard,\n  Eye,\n  MousePointer,\n  Clock,\n  Plus,\n  Loader2,\n  ExternalLink,\n  Trash2,\n  Image as ImageIcon,\n  AlertCircle,\n} from \"lucide-react\";\nimport { SiApplepay, SiVisa } from \"react-icons/si\";\nimport type { Advertisement, Subscription } from \"@shared/schema\";\nimport { format, formatDistanceToNow } from \"date-fns\";\nimport { ar, enUS } from \"date-fns/locale\";\n\nexport default function Advertising() {\n  const { toast } = useToast();\n  const { language } = useLanguage();\n  const t = translations[language];\n  const isRTL = language === 'ar';\n  \n  const [showCreateForm, setShowCreateForm] = useState(false);\n  const [title, setTitle] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [imageUrl, setImageUrl] = useState(\"\");\n  const [linkUrl, setLinkUrl] = useState(\"\");\n  const [paymentMethod, setPaymentMethod] = useState(\"apple_pay\");\n\n  const PAYMENT_METHODS = [\n    { key: \"apple_pay\", name: t.advertising.applePay, icon: SiApplepay },\n    { key: \"visa\", name: t.advertising.visa, icon: SiVisa },\n    { key: \"credit_card\", name: t.advertising.creditCard, icon: CreditCard },\n  ];\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat(language === 'ar' ? 'ar-SA' : 'en-SA', {\n      style: 'decimal',\n      minimumFractionDigits: 0,\n    }).format(amount) + (language === 'ar' ? ' ' : ' SAR');\n  };\n\n  const { data: subscription, isLoading: checkingSubscription } = useQuery<Subscription | null>({\n    queryKey: ['/api/subscriptions/active'],\n  });\n\n  const { data: myAds = [], isLoading: loadingAds } = useQuery<Advertisement[]>({\n    queryKey: ['/api/advertisements/my'],\n  });\n\n  const createAd = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest('POST', '/api/advertisements', data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/advertisements/my'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/advertisements/active'] });\n      setShowCreateForm(false);\n      resetForm();\n      toast({\n        title: t.advertising.adCreated,\n        description: t.advertising.adCreatedDesc,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: t.advertising.failedToCreateAd,\n        description: error.message || t.advertising.pleaseRetry,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteAd = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest('DELETE', `/api/advertisements/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/advertisements/my'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/advertisements/active'] });\n      toast({\n        title: t.advertising.adDeleted,\n        description: t.advertising.adDeletedDesc,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: t.advertising.failedToDelete,\n        description: error.message || t.advertising.pleaseRetry,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetForm = () => {\n    setTitle(\"\");\n    setDescription(\"\");\n    setImageUrl(\"\");\n    setLinkUrl(\"\");\n    setPaymentMethod(\"apple_pay\");\n  };\n\n  const handleCreateAd = () => {\n    if (!title.trim()) {\n      toast({\n        title: t.advertising.titleRequired,\n        description: t.advertising.titleRequiredDesc,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    createAd.mutate({\n      title,\n      description,\n      imageUrl: imageUrl || null,\n      linkUrl: linkUrl || null,\n      paymentMethod,\n    });\n  };\n\n  const getStatusBadge = (ad: Advertisement) => {\n    const now = new Date();\n    const endDate = ad.endDate ? new Date(ad.endDate) : null;\n    \n    if (ad.status === 'expired' || (endDate && endDate < now)) {\n      return <Badge variant=\"secondary\">{t.advertising.expired}</Badge>;\n    }\n    if (ad.status === 'active') {\n      return <Badge className=\"bg-green-500/10 text-green-600 border-green-500/20\">{t.advertising.active}</Badge>;\n    }\n    if (ad.status === 'pending') {\n      return <Badge variant=\"outline\">{t.advertising.pending}</Badge>;\n    }\n    return <Badge variant=\"secondary\">{ad.status}</Badge>;\n  };\n\n  const dateLocale = language === 'ar' ? ar : enUS;\n\n  if (checkingSubscription) {\n    return (\n      <div className=\"flex items-center justify-center h-full\" data-testid=\"loading-subscription\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  if (!subscription) {\n    return (\n      <div className=\"p-6 max-w-2xl mx-auto\" dir={isRTL ? 'rtl' : 'ltr'}>\n        <Card className=\"border-destructive/20\">\n          <CardHeader>\n            <div className={`flex items-center gap-3 ${isRTL ? 'flex-row-reverse' : ''}`}>\n              <AlertCircle className=\"h-8 w-8 text-destructive\" />\n              <div>\n                <CardTitle>{t.advertising.subscriptionRequired}</CardTitle>\n                <CardDescription>\n                  {t.advertising.subscriptionRequiredDesc}\n                </CardDescription>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-muted-foreground\">\n              {t.advertising.subscriptionRequiredInfo}\n            </p>\n          </CardContent>\n          <CardFooter>\n            <Button onClick={() => window.location.href = '/subscription'} data-testid=\"button-subscribe\">\n              {t.advertising.viewSubscriptionPlans}\n            </Button>\n          </CardFooter>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\" dir={isRTL ? 'rtl' : 'ltr'}>\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-semibold\" data-testid=\"text-page-title\">{t.advertising.title}</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            {t.advertising.subtitle}\n          </p>\n        </div>\n        {!showCreateForm && (\n          <Button onClick={() => setShowCreateForm(true)} data-testid=\"button-create-ad\">\n            <Plus className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n            {t.advertising.createAd}\n          </Button>\n        )}\n      </div>\n\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        <div className=\"lg:col-span-2 space-y-6\">\n          {showCreateForm && (\n            <Card data-testid=\"card-create-ad-form\">\n              <CardHeader>\n                <CardTitle className={`flex items-center gap-2 ${isRTL ? 'flex-row-reverse' : ''}`}>\n                  <Megaphone className=\"h-5 w-5\" />\n                  {t.advertising.createNewAd}\n                </CardTitle>\n                <CardDescription>\n                  {t.advertising.adDisplayedFor3Days}\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"ad-title\">{t.advertising.adTitleRequired}</Label>\n                  <Input\n                    id=\"ad-title\"\n                    placeholder={t.advertising.enterAdTitle}\n                    value={title}\n                    onChange={(e) => setTitle(e.target.value)}\n                    data-testid=\"input-ad-title\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"ad-description\">{t.advertising.adDescription}</Label>\n                  <Textarea\n                    id=\"ad-description\"\n                    placeholder={t.advertising.describeOffer}\n                    value={description}\n                    onChange={(e) => setDescription(e.target.value)}\n                    className=\"resize-none\"\n                    rows={3}\n                    data-testid=\"input-ad-description\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"ad-image\">{t.advertising.imageUrl}</Label>\n                  <Input\n                    id=\"ad-image\"\n                    placeholder=\"https://example.com/image.jpg\"\n                    value={imageUrl}\n                    onChange={(e) => setImageUrl(e.target.value)}\n                    data-testid=\"input-ad-image\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"ad-link\">{t.advertising.linkUrl}</Label>\n                  <Input\n                    id=\"ad-link\"\n                    placeholder=\"https://your-website.com\"\n                    value={linkUrl}\n                    onChange={(e) => setLinkUrl(e.target.value)}\n                    data-testid=\"input-ad-link\"\n                  />\n                </div>\n\n                <Separator />\n\n                <div className=\"space-y-3\">\n                  <Label>{t.advertising.paymentMethod}</Label>\n                  <RadioGroup value={paymentMethod} onValueChange={setPaymentMethod}>\n                    {PAYMENT_METHODS.map((method) => (\n                      <Label\n                        key={method.key}\n                        className={`flex items-center gap-3 p-3 rounded-lg border cursor-pointer hover-elevate data-[state=checked]:border-primary ${isRTL ? 'flex-row-reverse' : ''}`}\n                        data-state={paymentMethod === method.key ? \"checked\" : \"unchecked\"}\n                      >\n                        <RadioGroupItem value={method.key} data-testid={`radio-payment-${method.key}`} />\n                        <method.icon className=\"h-6 w-6\" />\n                        <span className=\"font-medium\">{method.name}</span>\n                      </Label>\n                    ))}\n                  </RadioGroup>\n                </div>\n              </CardContent>\n              <CardFooter className=\"flex justify-between gap-3\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => {\n                    setShowCreateForm(false);\n                    resetForm();\n                  }}\n                  data-testid=\"button-cancel-ad\"\n                >\n                  {t.advertising.cancel}\n                </Button>\n                <Button\n                  onClick={handleCreateAd}\n                  disabled={createAd.isPending}\n                  data-testid=\"button-submit-ad\"\n                >\n                  {createAd.isPending ? (\n                    <>\n                      <Loader2 className={`h-4 w-4 animate-spin ${isRTL ? 'ml-2' : 'mr-2'}`} />\n                      {t.advertising.processing}\n                    </>\n                  ) : (\n                    <>\n                      {t.advertising.pay500SAR}\n                    </>\n                  )}\n                </Button>\n              </CardFooter>\n            </Card>\n          )}\n\n          <Card data-testid=\"card-my-ads\">\n            <CardHeader>\n              <CardTitle>{t.advertising.myAds}</CardTitle>\n              <CardDescription>\n                {t.advertising.manageAds}\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {loadingAds ? (\n                <div className=\"flex justify-center py-8\">\n                  <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                </div>\n              ) : myAds.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <Megaphone className=\"h-12 w-12 mx-auto mb-3 opacity-50\" />\n                  <p>{t.advertising.noAdsYet}</p>\n                  <p className=\"text-sm\">{t.advertising.createFirstAd}</p>\n                </div>\n              ) : (\n                <div className=\"space-y-4\">\n                  {myAds.map((ad) => (\n                    <div\n                      key={ad.id}\n                      className=\"p-4 rounded-lg border space-y-3\"\n                      data-testid={`card-ad-${ad.id}`}\n                    >\n                      <div className=\"flex items-start justify-between gap-3\">\n                        <div className={`flex items-start gap-3 min-w-0 ${isRTL ? 'flex-row-reverse' : ''}`}>\n                          {ad.imageUrl ? (\n                            <img\n                              src={ad.imageUrl}\n                              alt={ad.title}\n                              className=\"w-16 h-16 rounded-md object-cover bg-muted\"\n                            />\n                          ) : (\n                            <div className=\"w-16 h-16 rounded-md bg-muted flex items-center justify-center\">\n                              <ImageIcon className=\"h-6 w-6 text-muted-foreground\" />\n                            </div>\n                          )}\n                          <div className=\"min-w-0 flex-1\">\n                            <div className={`flex items-center gap-2 flex-wrap ${isRTL ? 'flex-row-reverse' : ''}`}>\n                              <h3 className=\"font-medium truncate\">{ad.title}</h3>\n                              {getStatusBadge(ad)}\n                            </div>\n                            {ad.description && (\n                              <p className=\"text-sm text-muted-foreground line-clamp-2 mt-1\">\n                                {ad.description}\n                              </p>\n                            )}\n                          </div>\n                        </div>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => deleteAd.mutate(ad.id)}\n                          disabled={deleteAd.isPending}\n                          data-testid={`button-delete-ad-${ad.id}`}\n                        >\n                          <Trash2 className=\"h-4 w-4 text-muted-foreground\" />\n                        </Button>\n                      </div>\n\n                      <div className={`flex items-center gap-4 text-sm text-muted-foreground ${isRTL ? 'flex-row-reverse' : ''}`}>\n                        <span className={`flex items-center gap-1 ${isRTL ? 'flex-row-reverse' : ''}`}>\n                          <Eye className=\"h-4 w-4\" />\n                          {ad.views || 0} {t.advertising.views}\n                        </span>\n                        <span className={`flex items-center gap-1 ${isRTL ? 'flex-row-reverse' : ''}`}>\n                          <MousePointer className=\"h-4 w-4\" />\n                          {ad.clicks || 0} {t.advertising.clicks}\n                        </span>\n                        {ad.endDate && (\n                          <span className={`flex items-center gap-1 ${isRTL ? 'flex-row-reverse' : ''}`}>\n                            <Clock className=\"h-4 w-4\" />\n                            {new Date(ad.endDate) > new Date()\n                              ? `${t.advertising.ends} ${formatDistanceToNow(new Date(ad.endDate), { addSuffix: true, locale: dateLocale })}`\n                              : `${t.advertising.ended} ${format(new Date(ad.endDate), 'MMM d, yyyy', { locale: dateLocale })}`\n                            }\n                          </span>\n                        )}\n                        {ad.linkUrl && (\n                          <a\n                            href={ad.linkUrl}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className={`flex items-center gap-1 text-primary hover:underline ${isRTL ? 'flex-row-reverse' : ''}`}\n                          >\n                            <ExternalLink className=\"h-4 w-4\" />\n                            {t.advertising.link}\n                          </a>\n                        )}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"space-y-6\">\n          <Card data-testid=\"card-pricing-info\">\n            <CardHeader>\n              <CardTitle className=\"text-lg\">{t.advertising.pricing}</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"text-center\">\n                <div className=\"text-4xl font-bold text-primary\">{formatCurrency(500)}</div>\n                <div className=\"text-muted-foreground\">{t.advertising.for3Days}</div>\n              </div>\n              <Separator />\n              <ul className=\"space-y-2 text-sm\">\n                <li className={`flex items-center gap-2 ${isRTL ? 'flex-row-reverse' : ''}`}>\n                  <div className=\"h-1.5 w-1.5 rounded-full bg-primary\" />\n                  {t.advertising.displayedOnHomepage}\n                </li>\n                <li className={`flex items-center gap-2 ${isRTL ? 'flex-row-reverse' : ''}`}>\n                  <div className=\"h-1.5 w-1.5 rounded-full bg-primary\" />\n                  {t.advertising.alongsideOtherAds}\n                </li>\n                <li className={`flex items-center gap-2 ${isRTL ? 'flex-row-reverse' : ''}`}>\n                  <div className=\"h-1.5 w-1.5 rounded-full bg-primary\" />\n                  {t.advertising.viewClickTracking}\n                </li>\n                <li className={`flex items-center gap-2 ${isRTL ? 'flex-row-reverse' : ''}`}>\n                  <div className=\"h-1.5 w-1.5 rounded-full bg-primary\" />\n                  {t.advertising.linkToWebsite}\n                </li>\n              </ul>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-ad-tips\">\n            <CardHeader>\n              <CardTitle className=\"text-lg\">{t.advertising.tipsForSuccess}</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3 text-sm text-muted-foreground\">\n              <p>\n                <strong className=\"text-foreground\">{t.advertising.useClearTitles}</strong> - \n                {t.advertising.useClearTitlesDesc}\n              </p>\n              <p>\n                <strong className=\"text-foreground\">{t.advertising.addAnImage}</strong> - \n                {t.advertising.addAnImageDesc}\n              </p>\n              <p>\n                <strong className=\"text-foreground\">{t.advertising.includeALink}</strong> - \n                {t.advertising.includeALinkDesc}\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":19107,"size_tokens":null},"client/src/pages/MyEmployeeProfile.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Mail,\n  Briefcase,\n  User,\n  Calendar,\n  Building2,\n  Clock,\n  CheckCircle2,\n  Circle,\n  AlertCircle,\n  ListChecks,\n  Target,\n  ArrowUpRight,\n  Timer,\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { Task, User as UserType } from \"@shared/schema\";\nimport { format, formatDistanceToNow, isPast, isToday } from \"date-fns\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\ninterface TaskWithCreator extends Task {\n  creator?: UserType;\n}\n\nconst priorityColors: Record<string, string> = {\n  high: \"bg-red-500/10 text-red-500 border-red-500/20\",\n  medium: \"bg-yellow-500/10 text-yellow-500 border-yellow-500/20\",\n  low: \"bg-green-500/10 text-green-500 border-green-500/20\",\n};\n\nconst statusIcons: Record<string, typeof Circle> = {\n  pending: Circle,\n  in_progress: Timer,\n  completed: CheckCircle2,\n};\n\nconst statusColors: Record<string, string> = {\n  pending: \"text-muted-foreground\",\n  in_progress: \"text-blue-500\",\n  completed: \"text-green-500\",\n};\n\nexport default function MyEmployeeProfile() {\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const { language } = useLanguage();\n  const t = translations[language];\n\n  const { data: myTasks = [], isLoading: tasksLoading } = useQuery<Task[]>({\n    queryKey: [\"/api/me/tasks\"],\n  });\n\n  const { data: allUsers = [] } = useQuery<UserType[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const updateTaskMutation = useMutation({\n    mutationFn: async ({ id, status }: { id: number; status: string }) => {\n      return await apiRequest(\"PATCH\", `/api/tasks/${id}`, { status });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/me/tasks\"] });\n      toast({ title: \"Task Updated\", description: \"Task status has been updated.\" });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to update task status.\", variant: \"destructive\" });\n    },\n  });\n\n  const getCreatorName = (creatorId: string | null) => {\n    if (!creatorId) return \"Unknown\";\n    const creator = allUsers.find(u => u.id === creatorId);\n    if (!creator) return \"Unknown\";\n    return `${creator.firstName || \"\"} ${creator.lastName || \"\"}`.trim() || creator.email || \"Unknown\";\n  };\n\n  const handleStatusChange = (taskId: number, newStatus: string) => {\n    updateTaskMutation.mutate({ id: taskId, status: newStatus });\n  };\n\n  const pendingTasks = myTasks.filter(t => t.status === \"pending\");\n  const inProgressTasks = myTasks.filter(t => t.status === \"in_progress\");\n  const completedTasks = myTasks.filter(t => t.status === \"completed\");\n  \n  const overdueTasks = myTasks.filter(t => \n    t.dueDate && isPast(new Date(t.dueDate)) && t.status !== \"completed\"\n  );\n\n  const dueTodayTasks = myTasks.filter(t =>\n    t.dueDate && isToday(new Date(t.dueDate)) && t.status !== \"completed\"\n  );\n\n  const completionRate = myTasks.length > 0 \n    ? Math.round((completedTasks.length / myTasks.length) * 100)\n    : 0;\n\n  const displayName = user \n    ? `${user.firstName || \"\"} ${user.lastName || \"\"}`.trim() || user.email || \"Employee\"\n    : \"Employee\";\n\n  if (!user) {\n    return (\n      <div className=\"p-4 md:p-6 max-w-5xl mx-auto\">\n        <Card className=\"p-8 text-center\">\n          <User className=\"h-12 w-12 mx-auto text-muted-foreground opacity-50 mb-2\" />\n          <p className=\"text-muted-foreground\">Please log in to view your profile</p>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-4 md:p-6 max-w-5xl mx-auto space-y-6\">\n      <div className=\"flex items-center gap-3\">\n        <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center\">\n          <Briefcase className=\"h-5 w-5 text-primary\" />\n        </div>\n        <div>\n          <h1 className=\"text-xl font-bold\">{t.employeeProfilePage?.title || \"Profile\"}</h1>\n          <p className=\"text-sm text-muted-foreground\">{language === \"ar\" ? \" \" : \"Your tasks and responsibilities\"}</p>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <Card className=\"lg:col-span-1\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex flex-col items-center text-center\">\n              <Avatar className=\"h-24 w-24 border-4 border-background shadow-lg mb-4\">\n                <AvatarImage src={user.profileImageUrl || undefined} />\n                <AvatarFallback className=\"bg-primary/10 text-primary text-2xl\">\n                  {(user.firstName?.[0] || \"\").toUpperCase()}{(user.lastName?.[0] || \"\").toUpperCase()}\n                </AvatarFallback>\n              </Avatar>\n              <h2 className=\"text-xl font-bold\" data-testid=\"text-my-name\">{displayName}</h2>\n              <p className=\"text-sm text-muted-foreground\" data-testid=\"text-my-email\">{user.email}</p>\n              \n              <div className=\"flex items-center gap-2 mt-3\">\n                <Badge variant=\"secondary\" className=\"capitalize\" data-testid=\"badge-role\">\n                  {user.role || \"member\"}\n                </Badge>\n                <Badge \n                  variant=\"outline\" \n                  className={user.status === \"online\" ? \"border-green-500 text-green-500\" : \"\"}\n                  data-testid=\"badge-status\"\n                >\n                  {user.status || \"offline\"}\n                </Badge>\n              </div>\n\n              {user.department && (\n                <div className=\"flex items-center gap-1 mt-4 text-muted-foreground text-sm\">\n                  <Building2 className=\"h-4 w-4\" />\n                  <span data-testid=\"text-my-department\">{user.department}</span>\n                </div>\n              )}\n            </div>\n\n            <Separator className=\"my-6\" />\n\n            <div className=\"space-y-4\">\n              <h3 className=\"font-semibold text-sm text-muted-foreground uppercase tracking-wide\">\n                Task Overview\n              </h3>\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm text-muted-foreground\">Completion Rate</span>\n                  <span className=\"font-semibold\" data-testid=\"text-completion-rate\">{completionRate}%</span>\n                </div>\n                <Progress value={completionRate} className=\"h-2\" />\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-3 text-center\">\n                <div className=\"p-3 rounded-lg bg-muted/50\">\n                  <p className=\"text-2xl font-bold text-blue-500\" data-testid=\"stat-in-progress\">{inProgressTasks.length}</p>\n                  <p className=\"text-xs text-muted-foreground\">In Progress</p>\n                </div>\n                <div className=\"p-3 rounded-lg bg-muted/50\">\n                  <p className=\"text-2xl font-bold text-amber-500\" data-testid=\"stat-pending\">{pendingTasks.length}</p>\n                  <p className=\"text-xs text-muted-foreground\">Pending</p>\n                </div>\n                <div className=\"p-3 rounded-lg bg-muted/50\">\n                  <p className=\"text-2xl font-bold text-green-500\" data-testid=\"stat-completed\">{completedTasks.length}</p>\n                  <p className=\"text-xs text-muted-foreground\">Completed</p>\n                </div>\n                <div className=\"p-3 rounded-lg bg-muted/50\">\n                  <p className=\"text-2xl font-bold text-red-500\" data-testid=\"stat-overdue\">{overdueTasks.length}</p>\n                  <p className=\"text-xs text-muted-foreground\">Overdue</p>\n                </div>\n              </div>\n            </div>\n\n            <Separator className=\"my-6\" />\n\n            <div className=\"flex flex-col gap-2\">\n              <Link href=\"/tasks\">\n                <Button variant=\"outline\" className=\"w-full\" data-testid=\"button-view-all-tasks\">\n                  <ListChecks className=\"h-4 w-4 mr-2\" />\n                  View All Tasks\n                </Button>\n              </Link>\n              <Link href=\"/profile\">\n                <Button variant=\"ghost\" className=\"w-full\" data-testid=\"button-social-profile\">\n                  <User className=\"h-4 w-4 mr-2\" />\n                  Social Profile\n                </Button>\n              </Link>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"lg:col-span-2\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"flex items-center gap-2\">\n              <Target className=\"h-5 w-5 text-primary\" />\n              My Assigned Tasks & Responsibilities\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {tasksLoading ? (\n              <div className=\"space-y-4\">\n                {[1, 2, 3].map(i => (\n                  <Skeleton key={i} className=\"h-24 w-full\" />\n                ))}\n              </div>\n            ) : myTasks.length === 0 ? (\n              <div className=\"py-12 text-center\">\n                <ListChecks className=\"h-12 w-12 mx-auto text-muted-foreground/30 mb-3\" />\n                <p className=\"text-muted-foreground\">No tasks assigned to you yet</p>\n                <p className=\"text-sm text-muted-foreground/70 mt-1\">\n                  Tasks assigned by your manager will appear here\n                </p>\n              </div>\n            ) : (\n              <Tabs defaultValue=\"all\" className=\"w-full\">\n                <TabsList className=\"grid w-full grid-cols-4 mb-4\">\n                  <TabsTrigger value=\"all\" data-testid=\"tab-all-tasks\">\n                    All ({myTasks.length})\n                  </TabsTrigger>\n                  <TabsTrigger value=\"active\" data-testid=\"tab-active-tasks\">\n                    Active ({inProgressTasks.length})\n                  </TabsTrigger>\n                  <TabsTrigger value=\"pending\" data-testid=\"tab-pending-tasks\">\n                    Pending ({pendingTasks.length})\n                  </TabsTrigger>\n                  <TabsTrigger value=\"completed\" data-testid=\"tab-completed-tasks\">\n                    Done ({completedTasks.length})\n                  </TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"all\">\n                  <TaskList \n                    tasks={myTasks} \n                    getCreatorName={getCreatorName}\n                    onStatusChange={handleStatusChange}\n                    isUpdating={updateTaskMutation.isPending}\n                  />\n                </TabsContent>\n\n                <TabsContent value=\"active\">\n                  <TaskList \n                    tasks={inProgressTasks} \n                    getCreatorName={getCreatorName}\n                    onStatusChange={handleStatusChange}\n                    isUpdating={updateTaskMutation.isPending}\n                  />\n                </TabsContent>\n\n                <TabsContent value=\"pending\">\n                  <TaskList \n                    tasks={pendingTasks} \n                    getCreatorName={getCreatorName}\n                    onStatusChange={handleStatusChange}\n                    isUpdating={updateTaskMutation.isPending}\n                  />\n                </TabsContent>\n\n                <TabsContent value=\"completed\">\n                  <TaskList \n                    tasks={completedTasks} \n                    getCreatorName={getCreatorName}\n                    onStatusChange={handleStatusChange}\n                    isUpdating={updateTaskMutation.isPending}\n                  />\n                </TabsContent>\n              </Tabs>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {(overdueTasks.length > 0 || dueTodayTasks.length > 0) && (\n        <Card className=\"border-red-500/20\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"flex items-center gap-2 text-red-500\">\n              <AlertCircle className=\"h-5 w-5\" />\n              Attention Required\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              {overdueTasks.length > 0 && (\n                <div>\n                  <h4 className=\"font-medium text-red-500 mb-2\">Overdue Tasks ({overdueTasks.length})</h4>\n                  <ul className=\"space-y-2\">\n                    {overdueTasks.slice(0, 3).map(task => (\n                      <li key={task.id} className=\"flex items-center gap-2 text-sm\">\n                        <AlertCircle className=\"h-4 w-4 text-red-500 shrink-0\" />\n                        <span className=\"truncate\" data-testid={`overdue-task-${task.id}`}>{task.title}</span>\n                        {task.dueDate && (\n                          <span className=\"text-xs text-muted-foreground shrink-0\">\n                            ({formatDistanceToNow(new Date(task.dueDate))} ago)\n                          </span>\n                        )}\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n              {dueTodayTasks.length > 0 && (\n                <div>\n                  <h4 className=\"font-medium text-amber-500 mb-2\">Due Today ({dueTodayTasks.length})</h4>\n                  <ul className=\"space-y-2\">\n                    {dueTodayTasks.slice(0, 3).map(task => (\n                      <li key={task.id} className=\"flex items-center gap-2 text-sm\">\n                        <Clock className=\"h-4 w-4 text-amber-500 shrink-0\" />\n                        <span className=\"truncate\" data-testid={`due-today-task-${task.id}`}>{task.title}</span>\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n\ninterface TaskListProps {\n  tasks: Task[];\n  getCreatorName: (creatorId: string | null) => string;\n  onStatusChange: (taskId: number, status: string) => void;\n  isUpdating: boolean;\n}\n\nfunction TaskList({ tasks, getCreatorName, onStatusChange, isUpdating }: TaskListProps) {\n  if (tasks.length === 0) {\n    return (\n      <div className=\"py-8 text-center text-muted-foreground\">\n        No tasks in this category\n      </div>\n    );\n  }\n\n  return (\n    <ScrollArea className=\"h-[400px] pr-4\">\n      <div className=\"space-y-3\">\n        {tasks.map(task => {\n          const StatusIcon = statusIcons[task.status || \"pending\"] || Circle;\n          const isOverdue = task.dueDate && isPast(new Date(task.dueDate)) && task.status !== \"completed\";\n\n          return (\n            <Card key={task.id} className={`hover-elevate ${isOverdue ? \"border-red-500/30\" : \"\"}`} data-testid={`task-card-${task.id}`}>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-start gap-3\">\n                  <div className={`mt-0.5 ${statusColors[task.status || \"pending\"]}`}>\n                    <StatusIcon className=\"h-5 w-5\" />\n                  </div>\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-start justify-between gap-2 flex-wrap\">\n                      <div className=\"min-w-0\">\n                        <h4 className=\"font-medium truncate\" data-testid={`task-title-${task.id}`}>\n                          {task.title}\n                        </h4>\n                        {task.description && (\n                          <p className=\"text-sm text-muted-foreground mt-1 line-clamp-2\">\n                            {task.description}\n                          </p>\n                        )}\n                      </div>\n                      <Badge \n                        variant=\"outline\" \n                        className={`shrink-0 ${priorityColors[task.priority || \"medium\"]}`}\n                        data-testid={`task-priority-${task.id}`}\n                      >\n                        {task.priority || \"medium\"}\n                      </Badge>\n                    </div>\n\n                    <div className=\"flex items-center gap-4 mt-3 text-xs text-muted-foreground flex-wrap\">\n                      <span className=\"flex items-center gap-1\" data-testid={`task-assigned-by-${task.id}`}>\n                        <User className=\"h-3 w-3\" />\n                        Assigned by: {getCreatorName(task.creatorId)}\n                      </span>\n                      {task.dueDate && (\n                        <span className={`flex items-center gap-1 ${isOverdue ? \"text-red-500\" : \"\"}`} data-testid={`task-due-${task.id}`}>\n                          <Calendar className=\"h-3 w-3\" />\n                          Due: {format(new Date(task.dueDate), \"MMM d, yyyy\")}\n                        </span>\n                      )}\n                    </div>\n\n                    <div className=\"flex items-center justify-between mt-3 gap-2\">\n                      <Select\n                        value={task.status || \"pending\"}\n                        onValueChange={(value) => onStatusChange(task.id, value)}\n                        disabled={isUpdating}\n                      >\n                        <SelectTrigger className=\"w-[140px] h-8\" data-testid={`task-status-select-${task.id}`}>\n                          <SelectValue placeholder=\"Status\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"pending\">Pending</SelectItem>\n                          <SelectItem value=\"in_progress\">In Progress</SelectItem>\n                          <SelectItem value=\"completed\">Completed</SelectItem>\n                        </SelectContent>\n                      </Select>\n\n                      <Link href=\"/tasks\">\n                        <Button variant=\"ghost\" size=\"sm\" className=\"h-8\" data-testid={`task-view-${task.id}`}>\n                          View Details\n                          <ArrowUpRight className=\"h-3 w-3 ml-1\" />\n                        </Button>\n                      </Link>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n    </ScrollArea>\n  );\n}\n","path":null,"size_bytes":18862,"size_tokens":null},"client/src/pages/VisitorHub.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea, ScrollBar } from \"@/components/ui/scroll-area\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Building2,\n  Search,\n  ArrowLeft,\n  Star,\n  Play,\n  Bell,\n  Video,\n  Calendar,\n  MapPin,\n  Users,\n  Clock,\n  TrendingUp,\n  Megaphone,\n  Eye,\n  Heart,\n  MessageCircle,\n  Share2,\n} from \"lucide-react\";\nimport logoUrl from \"@assets/Photoroom___1764761955587.png\";\nimport { useState } from \"react\";\nimport { Link } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { Office } from \"@shared/schema\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\nconst dailyStatusVideos = [\n  {\n    id: 1,\n    author: \"Skyline Virtual\",\n    avatar: \"https://images.unsplash.com/photo-1560179707-f14e90ef3623?w=120&h=120&fit=crop\",\n    thumbnail: \"https://images.unsplash.com/photo-1497366216548-37526070297c?w=400&h=300&fit=crop\",\n    title: \"Daily Team Standup\",\n    views: 245,\n    duration: \"2:30\",\n    postedAt: \"2 hours ago\",\n    isLive: false,\n  },\n  {\n    id: 2,\n    author: \"Metro Business Hub\",\n    avatar: \"https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=120&h=120&fit=crop\",\n    thumbnail: \"https://images.unsplash.com/photo-1497215842964-222b430dc094?w=400&h=300&fit=crop\",\n    title: \"Morning Productivity Session\",\n    views: 189,\n    duration: \"4:15\",\n    postedAt: \"4 hours ago\",\n    isLive: true,\n  },\n  {\n    id: 3,\n    author: \"Executive Suites Co\",\n    avatar: \"https://images.unsplash.com/photo-1497366811353-6870744d04b2?w=120&h=120&fit=crop\",\n    thumbnail: \"https://images.unsplash.com/photo-1542744173-8e7e53415bb0?w=400&h=300&fit=crop\",\n    title: \"Weekly Goals Review\",\n    views: 312,\n    duration: \"5:00\",\n    postedAt: \"6 hours ago\",\n    isLive: false,\n  },\n  {\n    id: 4,\n    author: \"Innovation Tower\",\n    avatar: \"https://images.unsplash.com/photo-1554469384-e58fac16e23a?w=120&h=120&fit=crop\",\n    thumbnail: \"https://images.unsplash.com/photo-1531973576160-7125cd663d86?w=400&h=300&fit=crop\",\n    title: \"Tech Innovation Update\",\n    views: 567,\n    duration: \"3:45\",\n    postedAt: \"1 day ago\",\n    isLive: false,\n  },\n];\n\nconst announcements = [\n  {\n    id: 1,\n    title: \"New Premium Office Spaces Available\",\n    content: \"We've just added 5 new premium office spaces in prime business districts. Check them out!\",\n    author: \"CloudOffice Admin\",\n    avatar: \"https://images.unsplash.com/photo-1560250097-0b93528c311a?w=100&h=100&fit=crop\",\n    date: \"Today\",\n    priority: \"high\",\n    likes: 45,\n    comments: 12,\n  },\n  {\n    id: 2,\n    title: \"Holiday Schedule Update\",\n    content: \"Please note our updated operating hours during the upcoming holiday season. Support will be available 24/7.\",\n    author: \"Operations Team\",\n    avatar: \"https://images.unsplash.com/photo-1573497019940-1c28c88b4f3e?w=100&h=100&fit=crop\",\n    date: \"Yesterday\",\n    priority: \"medium\",\n    likes: 28,\n    comments: 5,\n  },\n  {\n    id: 3,\n    title: \"New Feature: Team Collaboration Tools\",\n    content: \"Introducing enhanced collaboration features including shared calendars, real-time document editing, and video conferencing.\",\n    author: \"Product Team\",\n    avatar: \"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop\",\n    date: \"2 days ago\",\n    priority: \"medium\",\n    likes: 89,\n    comments: 23,\n  },\n  {\n    id: 4,\n    title: \"Security Update\",\n    content: \"We've implemented additional security measures to protect your data. Two-factor authentication is now available.\",\n    author: \"Security Team\",\n    avatar: \"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop\",\n    date: \"3 days ago\",\n    priority: \"high\",\n    likes: 156,\n    comments: 34,\n  },\n];\n\nconst availableOffices = [\n  {\n    id: 1,\n    name: \"Skyline Virtual\",\n    location: \"Downtown Financial District\",\n    price: \"$149/mo\",\n    status: \"available\",\n    type: \"premium\",\n    logo: \"https://images.unsplash.com/photo-1560179707-f14e90ef3623?w=120&h=120&fit=crop\",\n    rating: 4.8,\n    reviews: 124,\n    employees: 45,\n    departments: 6,\n  },\n  {\n    id: 2,\n    name: \"Metro Business Hub\",\n    location: \"Midtown Business Center\",\n    price: \"$199/mo\",\n    status: \"available\",\n    type: \"standard\",\n    logo: \"https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=120&h=120&fit=crop\",\n    rating: 4.5,\n    reviews: 89,\n    employees: 32,\n    departments: 4,\n  },\n  {\n    id: 3,\n    name: \"Innovation Tower\",\n    location: \"Innovation Tower, Suite 500\",\n    price: \"$249/mo\",\n    status: \"newly_rented\",\n    type: \"premium\",\n    logo: \"https://images.unsplash.com/photo-1554469384-e58fac16e23a?w=120&h=120&fit=crop\",\n    rating: 4.9,\n    reviews: 156,\n    employees: 78,\n    departments: 8,\n  },\n  {\n    id: 4,\n    name: \"Executive Suites Co\",\n    location: \"Corporate Business Park\",\n    price: \"$399/mo\",\n    status: \"available\",\n    type: \"premium\",\n    logo: \"https://images.unsplash.com/photo-1497366811353-6870744d04b2?w=120&h=120&fit=crop\",\n    rating: 5.0,\n    reviews: 201,\n    employees: 120,\n    departments: 12,\n  },\n  {\n    id: 5,\n    name: \"StartupSpace\",\n    location: \"Tech Innovation Hub\",\n    price: \"$99/mo\",\n    status: \"newly_rented\",\n    type: \"standard\",\n    logo: \"https://images.unsplash.com/photo-1497215842964-222b430dc094?w=120&h=120&fit=crop\",\n    rating: 4.3,\n    reviews: 67,\n    employees: 18,\n    departments: 3,\n  },\n  {\n    id: 6,\n    name: \"WorkHub Central\",\n    location: \"Metro Central Plaza\",\n    price: \"$79/mo\",\n    status: \"available\",\n    type: \"standard\",\n    logo: \"https://images.unsplash.com/photo-1504384308090-c894fdcc538d?w=120&h=120&fit=crop\",\n    rating: 4.6,\n    reviews: 112,\n    employees: 25,\n    departments: 5,\n  },\n];\n\nconst filterTabKeys = [\"All\", \"Premium\", \"Standard\", \"Available\"] as const;\n\nexport default function VisitorHub() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [activeFilter, setActiveFilter] = useState(\"All\");\n  const [activeTab, setActiveTab] = useState(\"videos\");\n  const { language } = useLanguage();\n  const t = translations[language];\n  const isRTL = language === 'ar';\n\n  // Fetch real offices from database\n  const { data: realOffices = [] } = useQuery<Office[]>({\n    queryKey: ['/api/public/offices'],\n  });\n\n  // Combine real offices with mock offices for display\n  const displayOffices = realOffices.length > 0 \n    ? realOffices.map(office => ({\n        id: office.id,\n        name: office.name,\n        slug: office.slug,\n        location: office.location || t.visitorHub.virtualOffice,\n        price: t.visitorHub.contactForPricing,\n        status: \"available\" as const,\n        type: \"premium\" as const,\n        logo: office.logoUrl || \"https://images.unsplash.com/photo-1560179707-f14e90ef3623?w=120&h=120&fit=crop\",\n        rating: 4.8,\n        reviews: 0,\n        employees: 0,\n        departments: 0,\n      }))\n    : availableOffices.map(office => ({\n        ...office,\n        slug: office.name.toLowerCase().replace(/\\s+/g, '-'),\n      }));\n\n  const filteredOffices = displayOffices.filter((office) => {\n    const matchesSearch =\n      office.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      office.location.toLowerCase().includes(searchQuery.toLowerCase());\n\n    if (activeFilter === \"All\") return matchesSearch;\n    if (activeFilter === \"Premium\") return matchesSearch && office.type === \"premium\";\n    if (activeFilter === \"Standard\") return matchesSearch && office.type === \"standard\";\n    if (activeFilter === \"Available\") return matchesSearch && office.status === \"available\";\n    return matchesSearch;\n  });\n\n  return (\n    <div className=\"min-h-screen bg-background\" dir={isRTL ? 'rtl' : 'ltr'}>\n      <header className=\"sticky top-0 z-50 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n        <div className=\"container mx-auto flex items-center justify-between h-16 px-4\">\n          <div className=\"flex items-center gap-3\">\n            <Link href=\"/\">\n              <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back-home\">\n                <ArrowLeft className={`h-4 w-4 ${isRTL ? 'rotate-180' : ''}`} />\n              </Button>\n            </Link>\n            <div className=\"flex items-center gap-2\">\n              <img src={logoUrl} alt=\"CloudOffice\" className=\"h-8 w-8 object-contain\" />\n              <span className=\"font-semibold text-lg\">{t.visitorHub.headerTitle}</span>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"container mx-auto p-4 md:p-6 max-w-7xl\">\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-3 max-w-md mx-auto\" data-testid=\"visitor-tabs\">\n            <TabsTrigger value=\"videos\" className=\"gap-2\" data-testid=\"tab-videos\">\n              <Video className={`h-4 w-4 ${isRTL ? 'ml-1' : 'mr-1'}`} />\n              <span className=\"hidden sm:inline\">{t.visitorHub.dailyStatus}</span>\n            </TabsTrigger>\n            <TabsTrigger value=\"announcements\" className=\"gap-2\" data-testid=\"tab-announcements\">\n              <Megaphone className={`h-4 w-4 ${isRTL ? 'ml-1' : 'mr-1'}`} />\n              <span className=\"hidden sm:inline\">{t.visitorHub.announcements}</span>\n            </TabsTrigger>\n            <TabsTrigger value=\"offices\" className=\"gap-2\" data-testid=\"tab-offices\">\n              <Building2 className={`h-4 w-4 ${isRTL ? 'ml-1' : 'mr-1'}`} />\n              <span className=\"hidden sm:inline\">{t.visitorHub.offices}</span>\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"videos\" className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-xl font-semibold flex items-center gap-2\">\n                <Video className={`h-5 w-5 text-primary ${isRTL ? 'ml-2' : 'mr-2'}`} />\n                {t.visitorHub.dailyStatusVideos}\n              </h2>\n              <Badge variant=\"secondary\" className=\"gap-1\">\n                <Clock className={`h-3 w-3 ${isRTL ? 'ml-1' : 'mr-1'}`} />\n                {t.visitorHub.updatedToday}\n              </Badge>\n            </div>\n\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\n              {dailyStatusVideos.map((video) => (\n                <Card\n                  key={video.id}\n                  className=\"hover-elevate cursor-pointer group overflow-hidden\"\n                  data-testid={`video-card-${video.id}`}\n                >\n                  <div className=\"relative aspect-video overflow-hidden\">\n                    <img\n                      src={video.thumbnail}\n                      alt={video.title}\n                      className=\"w-full h-full object-cover transition-transform group-hover:scale-105\"\n                    />\n                    <div className=\"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity\">\n                      <div className=\"p-3 rounded-full bg-white/90\">\n                        <Play className=\"h-6 w-6 text-primary fill-primary\" />\n                      </div>\n                    </div>\n                    {video.isLive && (\n                      <Badge className=\"absolute top-2 left-2 bg-red-500 text-white\">\n                        LIVE\n                      </Badge>\n                    )}\n                    <Badge\n                      variant=\"secondary\"\n                      className=\"absolute bottom-2 right-2 bg-black/70 text-white border-0\"\n                    >\n                      {video.duration}\n                    </Badge>\n                  </div>\n                  <CardContent className=\"p-3\">\n                    <div className=\"flex gap-3\">\n                      <Avatar className=\"h-9 w-9 flex-shrink-0\">\n                        <AvatarImage src={video.avatar} alt={video.author} />\n                        <AvatarFallback>{video.author.slice(0, 2)}</AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1 min-w-0\">\n                        <h3 className=\"font-medium text-sm line-clamp-2 leading-tight\">\n                          {video.title}\n                        </h3>\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          {video.author}\n                        </p>\n                        <p className=\"text-xs text-muted-foreground flex items-center gap-2\">\n                          <span className=\"flex items-center gap-1\">\n                            <Eye className=\"h-3 w-3\" />\n                            {video.views}\n                          </span>\n                          <span>{video.postedAt}</span>\n                        </p>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n\n          </TabsContent>\n\n          <TabsContent value=\"announcements\" className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-xl font-semibold flex items-center gap-2\">\n                <Bell className={`h-5 w-5 text-primary ${isRTL ? 'ml-2' : 'mr-2'}`} />\n                {t.visitorHub.latestAnnouncements}\n              </h2>\n            </div>\n\n            <div className=\"space-y-4\">\n              {announcements.map((announcement) => (\n                <Card\n                  key={announcement.id}\n                  className=\"hover-elevate\"\n                  data-testid={`announcement-card-${announcement.id}`}\n                >\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex gap-4\">\n                      <Avatar className=\"h-12 w-12 flex-shrink-0\">\n                        <AvatarImage src={announcement.avatar} alt={announcement.author} />\n                        <AvatarFallback>{announcement.author.slice(0, 2)}</AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-start justify-between gap-2 flex-wrap\">\n                          <div>\n                            <h3 className=\"font-semibold flex items-center gap-2\">\n                              {announcement.title}\n                              {announcement.priority === \"high\" && (\n                                <Badge variant=\"destructive\" className=\"text-xs\">\n                                  {t.visitorHub.important}\n                                </Badge>\n                              )}\n                            </h3>\n                            <p className=\"text-sm text-muted-foreground\">\n                              {announcement.author}  {announcement.date}\n                            </p>\n                          </div>\n                        </div>\n                        <p className=\"text-sm mt-2 text-muted-foreground\">\n                          {announcement.content}\n                        </p>\n                        <div className=\"flex items-center gap-4 mt-3\">\n                          <button\n                            className=\"flex items-center gap-1.5 text-sm text-muted-foreground hover:text-primary transition-colors\"\n                            data-testid={`button-like-announcement-${announcement.id}`}\n                          >\n                            <Heart className=\"h-4 w-4\" />\n                            {announcement.likes}\n                          </button>\n                          <button\n                            className=\"flex items-center gap-1.5 text-sm text-muted-foreground hover:text-primary transition-colors\"\n                            data-testid={`button-comment-announcement-${announcement.id}`}\n                          >\n                            <MessageCircle className=\"h-4 w-4\" />\n                            {announcement.comments}\n                          </button>\n                          <button\n                            className=\"flex items-center gap-1.5 text-sm text-muted-foreground hover:text-primary transition-colors\"\n                            data-testid={`button-share-announcement-${announcement.id}`}\n                          >\n                            <Share2 className=\"h-4 w-4\" />\n                            {t.visitorHub.share}\n                          </button>\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n\n          </TabsContent>\n\n          <TabsContent value=\"offices\" className=\"space-y-6\">\n            <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n              <h2 className=\"text-xl font-semibold flex items-center gap-2\">\n                <Building2 className={`h-5 w-5 text-primary ${isRTL ? 'ml-2' : 'mr-2'}`} />\n                {t.visitorHub.browsePartnerOffices}\n              </h2>\n            </div>\n\n            <div className=\"relative\">\n              <Search className={`absolute ${isRTL ? 'right-3' : 'left-3'} top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground`} />\n              <Input\n                placeholder={t.visitorHub.searchPlaceholder}\n                className={`${isRTL ? 'pr-9' : 'pl-9'} h-11 bg-card`}\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                data-testid=\"input-search-visitor-offices\"\n              />\n            </div>\n\n            <ScrollArea className=\"w-full whitespace-nowrap\">\n              <div className=\"flex gap-2 pb-2\">\n                {filterTabKeys.map((tab) => {\n                  const filterLabels: Record<typeof filterTabKeys[number], string> = {\n                    All: t.visitorHub.filterAll,\n                    Premium: t.visitorHub.filterPremium,\n                    Standard: t.visitorHub.filterStandard,\n                    Available: t.visitorHub.filterAvailable,\n                  };\n                  return (\n                    <Button\n                      key={tab}\n                      variant={activeFilter === tab ? \"default\" : \"outline\"}\n                      size=\"sm\"\n                      onClick={() => setActiveFilter(tab)}\n                      className=\"rounded-full\"\n                      data-testid={`filter-visitor-${tab.toLowerCase()}`}\n                    >\n                      {filterLabels[tab]}\n                    </Button>\n                  );\n                })}\n              </div>\n              <ScrollBar orientation=\"horizontal\" />\n            </ScrollArea>\n\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {filteredOffices.map((office) => (\n                <Card\n                  key={office.id}\n                  className=\"hover-elevate cursor-pointer\"\n                  data-testid={`visitor-office-card-${office.id}`}\n                >\n                  <CardContent className=\"p-4\">\n                    <div className=\"flex items-start gap-4\">\n                      <div className=\"w-16 h-16 rounded-xl overflow-hidden border-2 border-border shadow-sm flex-shrink-0\">\n                        <img\n                          src={office.logo}\n                          alt={office.name}\n                          className=\"w-full h-full object-cover\"\n                        />\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-start justify-between gap-2\">\n                          <h3 className=\"font-semibold\">{office.name}</h3>\n                          <Badge\n                            variant=\"secondary\"\n                            className={\n                              office.status === \"newly_rented\"\n                                ? \"bg-primary/10 text-primary border-primary/20\"\n                                : \"bg-emerald-500/10 text-emerald-500 border-emerald-500/20\"\n                            }\n                          >\n                            {office.status === \"newly_rented\" ? t.visitorHub.statusRented : t.visitorHub.statusOpen}\n                          </Badge>\n                        </div>\n                        <p className=\"text-xs text-muted-foreground mt-0.5 flex items-center gap-1\">\n                          <MapPin className=\"h-3 w-3\" />\n                          {office.location}\n                        </p>\n                        <div className=\"flex items-center gap-0.5 mt-2\">\n                          {[...Array(5)].map((_, i) => (\n                            <Star\n                              key={i}\n                              className={`h-3 w-3 ${\n                                i < Math.floor(office.rating)\n                                  ? \"fill-amber-400 text-amber-400\"\n                                  : \"text-muted-foreground/30\"\n                              }`}\n                            />\n                          ))}\n                          <span className=\"text-xs text-muted-foreground ml-1\">\n                            {office.rating} ({office.reviews})\n                          </span>\n                        </div>\n                        <div className=\"flex items-center gap-3 mt-2 text-xs text-muted-foreground\">\n                          <span className=\"flex items-center gap-1\">\n                            <Users className=\"h-3 w-3\" />\n                            {office.employees} {t.visitorHub.employees}\n                          </span>\n                          <span className=\"flex items-center gap-1\">\n                            <Building2 className=\"h-3 w-3\" />\n                            {office.departments} {t.visitorHub.depts}\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center justify-between mt-4 pt-3 border-t\">\n                      <span className=\"font-bold text-primary\">{office.price}</span>\n                      <Link href={`/office/${office.slug}`}>\n                        <Button size=\"sm\" data-testid={`button-view-office-${office.id}`}>\n                          {t.visitorHub.viewDetails}\n                        </Button>\n                      </Link>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n\n            {filteredOffices.length === 0 && (\n              <Card className=\"p-8 text-center\">\n                <Building2 className=\"h-12 w-12 mx-auto text-muted-foreground opacity-50 mb-2\" />\n                <p className=\"text-muted-foreground\">{t.visitorHub.noOfficesMatch}</p>\n              </Card>\n            )}\n          </TabsContent>\n        </Tabs>\n      </main>\n\n      <footer className=\"border-t bg-muted/50 py-8 mt-8\">\n        <div className=\"container mx-auto px-4 text-center text-muted-foreground\">\n          <p>&copy; {new Date().getFullYear()} CloudOffice. {t.visitorHub.allRightsReserved}</p>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","path":null,"size_bytes":23458,"size_tokens":null},"client/src/pages/OfficeManagement.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n  DialogFooter,\n  DialogClose,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Building2,\n  Plus,\n  Pencil,\n  Trash2,\n  Package,\n  Eye,\n  EyeOff,\n  Star,\n  ExternalLink,\n  Settings,\n  Globe,\n  MessageCircle,\n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\nimport type { Office, OfficeService, InsertOffice, InsertOfficeService } from \"@shared/schema\";\n\nfunction generateSlug(name: string): string {\n  return name\n    .toLowerCase()\n    .replace(/[^a-z0-9\\s-]/g, '')\n    .replace(/\\s+/g, '-')\n    .replace(/-+/g, '-')\n    .trim();\n}\n\nfunction formatPrice(price: number, language: string): string {\n  return new Intl.NumberFormat(language === 'ar' ? 'ar-SA' : 'en-SA', {\n    style: 'currency',\n    currency: 'SAR',\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 0,\n  }).format(price);\n}\n\nfunction OfficeForm({\n  office,\n  onSuccess,\n  onCancel,\n}: {\n  office?: Office;\n  onSuccess: () => void;\n  onCancel: () => void;\n}) {\n  const { toast } = useToast();\n  const { language } = useLanguage();\n  const t = translations[language];\n  const isRTL = language === 'ar';\n  \n  const [slugManuallyEdited, setSlugManuallyEdited] = useState(!!office?.slug);\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const [formData, setFormData] = useState({\n    name: office?.name || '',\n    slug: office?.slug || '',\n    description: office?.description || '',\n    logoUrl: office?.logoUrl || '',\n    coverUrl: office?.coverUrl || '',\n    location: office?.location || '',\n    category: office?.category || 'general',\n    contactEmail: office?.contactEmail || '',\n    contactPhone: office?.contactPhone || '',\n    workingHours: office?.workingHours || '',\n    isPublished: office?.isPublished || false,\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: Partial<InsertOffice>) => {\n      return await apiRequest('POST', '/api/offices', data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/offices'] });\n      toast({ title: t.officeManagement?.officeCreated || 'Office created successfully' });\n      onSuccess();\n    },\n    onError: (error: Error) => {\n      toast({ title: t.officeManagement?.failedCreate || 'Failed to create office', description: error.message, variant: 'destructive' });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: Partial<InsertOffice>) => {\n      return await apiRequest('PATCH', `/api/offices/${office!.id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/offices'] });\n      toast({ title: t.officeManagement?.officeUpdated || 'Office updated successfully' });\n      onSuccess();\n    },\n    onError: (error: Error) => {\n      toast({ title: t.officeManagement?.failedUpdate || 'Failed to update office', description: error.message, variant: 'destructive' });\n    },\n  });\n\n  const validateForm = (): boolean => {\n    const newErrors: Record<string, string> = {};\n    \n    if (!formData.name.trim()) {\n      newErrors.name = t.officeManagement?.officeNameRequired || 'Office name is required';\n    }\n    \n    const finalSlug = formData.slug || generateSlug(formData.name);\n    if (!finalSlug || finalSlug.length < 3) {\n      newErrors.slug = t.officeManagement?.slugMinLength || 'Slug must be at least 3 characters';\n    } else if (!/^[a-z0-9-]+$/.test(finalSlug)) {\n      newErrors.slug = t.officeManagement?.slugInvalid || 'Slug can only contain lowercase letters, numbers, and hyphens';\n    }\n    \n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!validateForm()) {\n      return;\n    }\n    \n    const data = {\n      ...formData,\n      slug: formData.slug || generateSlug(formData.name),\n    };\n    \n    if (office) {\n      updateMutation.mutate(data);\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n  \n  const isFormValid = formData.name.trim().length > 0;\n\n  const handleNameChange = (name: string) => {\n    setErrors((prev) => ({ ...prev, name: '', slug: '' }));\n    setFormData((prev) => ({\n      ...prev,\n      name,\n      slug: slugManuallyEdited ? prev.slug : generateSlug(name),\n    }));\n  };\n\n  const handleSlugChange = (slug: string) => {\n    setErrors((prev) => ({ ...prev, slug: '' }));\n    setSlugManuallyEdited(true);\n    setFormData((prev) => ({ ...prev, slug }));\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-4\" dir={isRTL ? 'rtl' : 'ltr'}>\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"name\">{t.officeManagement?.officeName || \"Office Name\"} *</Label>\n          <Input\n            id=\"name\"\n            value={formData.name}\n            onChange={(e) => handleNameChange(e.target.value)}\n            placeholder=\"My Virtual Office\"\n            className={errors.name ? 'border-destructive' : ''}\n            data-testid=\"input-office-name\"\n          />\n          {errors.name && (\n            <p className=\"text-xs text-destructive\">{errors.name}</p>\n          )}\n        </div>\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"slug\">{t.officeManagement?.urlSlug || \"URL Slug\"}</Label>\n          <Input\n            id=\"slug\"\n            value={formData.slug}\n            onChange={(e) => handleSlugChange(e.target.value)}\n            placeholder=\"my-virtual-office\"\n            className={errors.slug ? 'border-destructive' : ''}\n            data-testid=\"input-office-slug\"\n          />\n          <p className=\"text-xs text-muted-foreground\">\n            {t.officeManagement?.slugHint || \"Auto-generated from name. Only lowercase letters, numbers, and hyphens allowed.\"}\n          </p>\n          <p className=\"text-xs text-muted-foreground\">\n            {t.officeManagement?.visitorsAccessAt || \"Visitors will access at:\"} /office/{formData.slug || generateSlug(formData.name) || 'your-slug'}\n          </p>\n          {errors.slug && (\n            <p className=\"text-xs text-destructive\">{errors.slug}</p>\n          )}\n        </div>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"description\">{t.officeManagement?.description || \"Description\"}</Label>\n        <Textarea\n          id=\"description\"\n          value={formData.description}\n          onChange={(e) => setFormData((prev) => ({ ...prev, description: e.target.value }))}\n          placeholder={language === 'ar' ? \"   ...\" : \"Describe your virtual office and services...\"}\n          rows={3}\n          data-testid=\"input-office-description\"\n        />\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"category\">{t.officeManagement?.category || \"Category\"}</Label>\n          <Select\n            value={formData.category}\n            onValueChange={(value) => setFormData((prev) => ({ ...prev, category: value }))}\n          >\n            <SelectTrigger data-testid=\"select-office-category\">\n              <SelectValue placeholder={t.officeManagement?.selectCategory || \"Select category\"} />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"general\">{t.officeManagement?.categoryGeneral || \"General\"}</SelectItem>\n              <SelectItem value=\"legal\">{t.officeManagement?.categoryLegal || \"Legal Services\"}</SelectItem>\n              <SelectItem value=\"tech\">{t.officeManagement?.categoryTech || \"Technology\"}</SelectItem>\n              <SelectItem value=\"consulting\">{t.officeManagement?.categoryConsulting || \"Consulting\"}</SelectItem>\n              <SelectItem value=\"medical\">{t.officeManagement?.categoryMedical || \"Medical\"}</SelectItem>\n              <SelectItem value=\"financial\">{t.officeManagement?.categoryFinancial || \"Financial\"}</SelectItem>\n              <SelectItem value=\"marketing\">{t.officeManagement?.categoryMarketing || \"Marketing\"}</SelectItem>\n              <SelectItem value=\"hr\">{t.officeManagement?.categoryHR || \"Human Resources\"}</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"location\">{t.officeManagement?.location || \"Location\"}</Label>\n          <Input\n            id=\"location\"\n            value={formData.location}\n            onChange={(e) => setFormData((prev) => ({ ...prev, location: e.target.value }))}\n            placeholder={language === 'ar' ? \"   \" : \"Riyadh, Saudi Arabia\"}\n            data-testid=\"input-office-location\"\n          />\n        </div>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"contactEmail\">{t.officeManagement?.contactEmail || \"Contact Email\"}</Label>\n          <Input\n            id=\"contactEmail\"\n            type=\"email\"\n            value={formData.contactEmail}\n            onChange={(e) => setFormData((prev) => ({ ...prev, contactEmail: e.target.value }))}\n            placeholder=\"contact@office.com\"\n            data-testid=\"input-office-email\"\n          />\n        </div>\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"contactPhone\">{t.officeManagement?.contactPhone || \"Contact Phone\"}</Label>\n          <Input\n            id=\"contactPhone\"\n            value={formData.contactPhone}\n            onChange={(e) => setFormData((prev) => ({ ...prev, contactPhone: e.target.value }))}\n            placeholder=\"+966 xx xxx xxxx\"\n            data-testid=\"input-office-phone\"\n          />\n        </div>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"workingHours\">{t.officeManagement?.workingHours || \"Working Hours\"}</Label>\n        <Input\n          id=\"workingHours\"\n          value={formData.workingHours}\n          onChange={(e) => setFormData((prev) => ({ ...prev, workingHours: e.target.value }))}\n          placeholder={language === 'ar' ? \"- 9-5\" : \"Sun-Thu 9AM-5PM\"}\n          data-testid=\"input-office-hours\"\n        />\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"logoUrl\">{t.officeManagement?.logoUrl || \"Logo URL\"}</Label>\n          <Input\n            id=\"logoUrl\"\n            value={formData.logoUrl}\n            onChange={(e) => setFormData((prev) => ({ ...prev, logoUrl: e.target.value }))}\n            placeholder=\"https://...\"\n            data-testid=\"input-office-logo\"\n          />\n        </div>\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"coverUrl\">{t.officeManagement?.coverUrl || \"Cover Image URL\"}</Label>\n          <Input\n            id=\"coverUrl\"\n            value={formData.coverUrl}\n            onChange={(e) => setFormData((prev) => ({ ...prev, coverUrl: e.target.value }))}\n            placeholder=\"https://...\"\n            data-testid=\"input-office-cover\"\n          />\n        </div>\n      </div>\n\n      <div className={`flex items-center ${isRTL ? 'space-x-reverse space-x-2' : 'space-x-2'}`}>\n        <Switch\n          id=\"isPublished\"\n          checked={formData.isPublished}\n          onCheckedChange={(checked) => setFormData((prev) => ({ ...prev, isPublished: checked }))}\n          data-testid=\"switch-office-published\"\n        />\n        <Label htmlFor=\"isPublished\">{t.officeManagement?.publishOffice || \"Publish office (visible to visitors)\"}</Label>\n      </div>\n\n      <DialogFooter className=\"gap-2\">\n        <Button type=\"button\" variant=\"outline\" onClick={onCancel} data-testid=\"button-cancel-office\">\n          {t.officeManagement?.cancel || \"Cancel\"}\n        </Button>\n        <Button\n          type=\"submit\"\n          disabled={createMutation.isPending || updateMutation.isPending}\n          data-testid=\"button-save-office\"\n        >\n          {createMutation.isPending || updateMutation.isPending\n            ? (office ? t.officeManagement?.updating || \"Updating...\" : t.officeManagement?.creating || \"Creating...\")\n            : (office ? t.officeManagement?.updateOffice || \"Update Office\" : t.officeManagement?.createOffice || \"Create Office\")}\n        </Button>\n      </DialogFooter>\n    </form>\n  );\n}\n\nfunction ServiceForm({\n  officeId,\n  service,\n  onSuccess,\n  onCancel,\n}: {\n  officeId: number;\n  service?: OfficeService;\n  onSuccess: () => void;\n  onCancel: () => void;\n}) {\n  const { toast } = useToast();\n  const { language } = useLanguage();\n  const t = translations[language];\n  const isRTL = language === 'ar';\n  \n  const [formData, setFormData] = useState({\n    title: service?.title || '',\n    description: service?.description || '',\n    price: service?.price?.toString() || '',\n    priceType: service?.priceType || 'fixed',\n    category: service?.category || '',\n    imageUrl: service?.imageUrl || '',\n    isFeatured: service?.isFeatured || false,\n    isActive: service?.isActive ?? true,\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: Partial<InsertOfficeService>) => {\n      return await apiRequest('POST', `/api/offices/${officeId}/services`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/offices', officeId, 'services'] });\n      toast({ title: t.officeManagement?.serviceAdded || 'Service added successfully' });\n      onSuccess();\n    },\n    onError: (error: Error) => {\n      toast({ title: t.officeManagement?.failedAddService || 'Failed to add service', description: error.message, variant: 'destructive' });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: Partial<InsertOfficeService>) => {\n      return await apiRequest('PATCH', `/api/offices/${officeId}/services/${service!.id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/offices', officeId, 'services'] });\n      toast({ title: t.officeManagement?.serviceUpdated || 'Service updated successfully' });\n      onSuccess();\n    },\n    onError: (error: Error) => {\n      toast({ title: t.officeManagement?.failedUpdateService || 'Failed to update service', description: error.message, variant: 'destructive' });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    const data = {\n      ...formData,\n      officeId,\n      price: formData.price ? parseInt(formData.price) : null,\n    };\n\n    if (service) {\n      updateMutation.mutate(data);\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-4\" dir={isRTL ? 'rtl' : 'ltr'}>\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"title\">{t.officeManagement?.serviceTitle || \"Service Title\"} *</Label>\n        <Input\n          id=\"title\"\n          value={formData.title}\n          onChange={(e) => setFormData((prev) => ({ ...prev, title: e.target.value }))}\n          placeholder={language === 'ar' ? \" \" : \"Legal Consultation\"}\n          required\n          data-testid=\"input-service-title\"\n        />\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"description\">{t.officeManagement?.description || \"Description\"}</Label>\n        <Textarea\n          id=\"description\"\n          value={formData.description}\n          onChange={(e) => setFormData((prev) => ({ ...prev, description: e.target.value }))}\n          placeholder={language === 'ar' ? \" ...\" : \"Describe the service...\"}\n          rows={3}\n          data-testid=\"input-service-description\"\n        />\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"price\">{t.officeManagement?.priceSAR || \"Price (SAR)\"}</Label>\n          <Input\n            id=\"price\"\n            type=\"number\"\n            value={formData.price}\n            onChange={(e) => setFormData((prev) => ({ ...prev, price: e.target.value }))}\n            placeholder=\"100\"\n            data-testid=\"input-service-price\"\n          />\n        </div>\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"priceType\">{t.officeManagement?.priceType || \"Price Type\"}</Label>\n          <Select\n            value={formData.priceType}\n            onValueChange={(value) => setFormData((prev) => ({ ...prev, priceType: value }))}\n          >\n            <SelectTrigger data-testid=\"select-service-pricetype\">\n              <SelectValue placeholder={t.officeManagement?.selectType || \"Select type\"} />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"fixed\">{t.officeManagement?.fixedPrice || \"Fixed Price\"}</SelectItem>\n              <SelectItem value=\"hourly\">{t.officeManagement?.perHour || \"Per Hour\"}</SelectItem>\n              <SelectItem value=\"negotiable\">{t.officeManagement?.negotiable || \"Negotiable\"}</SelectItem>\n              <SelectItem value=\"free\">{t.officeManagement?.free || \"Free\"}</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"category\">{t.officeManagement?.category || \"Category\"}</Label>\n          <Input\n            id=\"category\"\n            value={formData.category}\n            onChange={(e) => setFormData((prev) => ({ ...prev, category: e.target.value }))}\n            placeholder={language === 'ar' ? \"  .\" : \"Consulting, Legal, etc.\"}\n            data-testid=\"input-service-category\"\n          />\n        </div>\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"imageUrl\">{t.officeManagement?.imageUrl || \"Image URL\"}</Label>\n          <Input\n            id=\"imageUrl\"\n            value={formData.imageUrl}\n            onChange={(e) => setFormData((prev) => ({ ...prev, imageUrl: e.target.value }))}\n            placeholder=\"https://...\"\n            data-testid=\"input-service-image\"\n          />\n        </div>\n      </div>\n\n      <div className=\"flex items-center gap-6\">\n        <div className={`flex items-center ${isRTL ? 'space-x-reverse space-x-2' : 'space-x-2'}`}>\n          <Switch\n            id=\"isActive\"\n            checked={formData.isActive}\n            onCheckedChange={(checked) => setFormData((prev) => ({ ...prev, isActive: checked }))}\n            data-testid=\"switch-service-active\"\n          />\n          <Label htmlFor=\"isActive\">{t.officeManagement?.active || \"Active\"}</Label>\n        </div>\n        <div className={`flex items-center ${isRTL ? 'space-x-reverse space-x-2' : 'space-x-2'}`}>\n          <Switch\n            id=\"isFeatured\"\n            checked={formData.isFeatured}\n            onCheckedChange={(checked) => setFormData((prev) => ({ ...prev, isFeatured: checked }))}\n            data-testid=\"switch-service-featured\"\n          />\n          <Label htmlFor=\"isFeatured\">{t.officeManagement?.featured || \"Featured\"}</Label>\n        </div>\n      </div>\n\n      <DialogFooter className=\"gap-2\">\n        <Button type=\"button\" variant=\"outline\" onClick={onCancel} data-testid=\"button-cancel-service\">\n          {t.officeManagement?.cancel || \"Cancel\"}\n        </Button>\n        <Button\n          type=\"submit\"\n          disabled={createMutation.isPending || updateMutation.isPending}\n          data-testid=\"button-save-service\"\n        >\n          {createMutation.isPending || updateMutation.isPending\n            ? (service ? t.officeManagement?.updating || \"Updating...\" : t.officeManagement?.creating || \"Creating...\")\n            : (service ? t.officeManagement?.editService || \"Update Service\" : t.officeManagement?.addService || \"Add Service\")}\n        </Button>\n      </DialogFooter>\n    </form>\n  );\n}\n\nfunction ServiceCard({\n  service,\n  officeId,\n  onEdit,\n}: {\n  service: OfficeService;\n  officeId: number;\n  onEdit: () => void;\n}) {\n  const { toast } = useToast();\n  const { language } = useLanguage();\n  const t = translations[language];\n  const isRTL = language === 'ar';\n\n  const deleteMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest('DELETE', `/api/offices/${officeId}/services/${service.id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/offices', officeId, 'services'] });\n      toast({ title: t.officeManagement?.serviceDeleted || 'Service deleted successfully' });\n    },\n    onError: (error: Error) => {\n      toast({ title: t.officeManagement?.failedDeleteService || 'Failed to delete service', description: error.message, variant: 'destructive' });\n    },\n  });\n\n  return (\n    <Card className=\"hover-elevate\" data-testid={`card-manage-service-${service.id}`}>\n      <CardContent className=\"p-4\" dir={isRTL ? 'rtl' : 'ltr'}>\n        <div className=\"flex items-start gap-4\">\n          {service.imageUrl ? (\n            <img\n              src={service.imageUrl}\n              alt={service.title}\n              className=\"w-16 h-16 rounded-lg object-cover\"\n            />\n          ) : (\n            <div className=\"w-16 h-16 rounded-lg bg-muted flex items-center justify-center\">\n              <Package className=\"h-6 w-6 text-muted-foreground\" />\n            </div>\n          )}\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-start justify-between gap-2\">\n              <div>\n                <h3 className=\"font-semibold truncate\">{service.title}</h3>\n                <div className=\"flex items-center gap-2 mt-1\">\n                  {service.category && (\n                    <Badge variant=\"secondary\" className=\"text-xs\">\n                      {service.category}\n                    </Badge>\n                  )}\n                  {service.isFeatured && (\n                    <Badge className=\"text-xs\">\n                      <Star className={`h-3 w-3 ${isRTL ? 'ml-1' : 'mr-1'}`} />\n                      {t.officeManagement?.featured || \"Featured\"}\n                    </Badge>\n                  )}\n                  {!service.isActive && (\n                    <Badge variant=\"outline\" className=\"text-xs\">\n                      <EyeOff className={`h-3 w-3 ${isRTL ? 'ml-1' : 'mr-1'}`} />\n                      {t.officeManagement?.hidden || \"Hidden\"}\n                    </Badge>\n                  )}\n                </div>\n              </div>\n              <div className=\"flex items-center gap-1\">\n                <Button variant=\"ghost\" size=\"icon\" onClick={onEdit} data-testid={`button-edit-service-${service.id}`}>\n                  <Pencil className=\"h-4 w-4\" />\n                </Button>\n                <AlertDialog>\n                  <AlertDialogTrigger asChild>\n                    <Button variant=\"ghost\" size=\"icon\" data-testid={`button-delete-service-${service.id}`}>\n                      <Trash2 className=\"h-4 w-4 text-destructive\" />\n                    </Button>\n                  </AlertDialogTrigger>\n                  <AlertDialogContent dir={isRTL ? 'rtl' : 'ltr'}>\n                    <AlertDialogHeader>\n                      <AlertDialogTitle>{t.officeManagement?.deleteService || \"Delete Service\"}</AlertDialogTitle>\n                      <AlertDialogDescription>\n                        {t.officeManagement?.deleteServiceConfirm || `Are you sure you want to delete \"${service.title}\"? This action cannot be undone.`}\n                      </AlertDialogDescription>\n                    </AlertDialogHeader>\n                    <AlertDialogFooter>\n                      <AlertDialogCancel>{t.officeManagement?.cancel || \"Cancel\"}</AlertDialogCancel>\n                      <AlertDialogAction\n                        onClick={() => deleteMutation.mutate()}\n                        className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                        data-testid=\"button-confirm-delete-service\"\n                      >\n                        {t.officeManagement?.delete || \"Delete\"}\n                      </AlertDialogAction>\n                    </AlertDialogFooter>\n                  </AlertDialogContent>\n                </AlertDialog>\n              </div>\n            </div>\n            {service.description && (\n              <p className=\"text-sm text-muted-foreground mt-1 line-clamp-2\">\n                {service.description}\n              </p>\n            )}\n            {service.price && (\n              <div className=\"mt-2\">\n                <span className=\"font-medium\">{formatPrice(service.price, language)}</span>\n                {service.priceType && service.priceType !== 'fixed' && (\n                  <span className=\"text-sm text-muted-foreground\"> / {service.priceType}</span>\n                )}\n              </div>\n            )}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction OfficeCard({\n  office,\n  onManage,\n}: {\n  office: Office;\n  onManage: () => void;\n}) {\n  const { toast } = useToast();\n  const { language } = useLanguage();\n  const t = translations[language];\n  const isRTL = language === 'ar';\n\n  const deleteMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest('DELETE', `/api/offices/${office.id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/offices'] });\n      toast({ title: t.officeManagement?.officeDeleted || 'Office deleted successfully' });\n    },\n    onError: (error: Error) => {\n      toast({ title: t.officeManagement?.failedDelete || 'Failed to delete office', description: error.message, variant: 'destructive' });\n    },\n  });\n\n  return (\n    <Card className=\"hover-elevate\" data-testid={`card-office-${office.id}`}>\n      <CardContent className=\"p-4\" dir={isRTL ? 'rtl' : 'ltr'}>\n        <div className=\"flex items-start gap-4\">\n          {office.logoUrl ? (\n            <img\n              src={office.logoUrl}\n              alt={office.name}\n              className=\"w-16 h-16 rounded-lg object-cover\"\n            />\n          ) : (\n            <div className=\"w-16 h-16 rounded-lg bg-muted flex items-center justify-center\">\n              <Building2 className=\"h-6 w-6 text-muted-foreground\" />\n            </div>\n          )}\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-start justify-between gap-2\">\n              <div>\n                <h3 className=\"font-semibold truncate\">{office.name}</h3>\n                <div className=\"flex items-center gap-2 mt-1\">\n                  {office.category && (\n                    <Badge variant=\"secondary\" className=\"text-xs capitalize\">\n                      {office.category}\n                    </Badge>\n                  )}\n                  {office.isPublished ? (\n                    <Badge variant=\"outline\" className=\"text-xs text-green-600 border-green-600\">\n                      <Eye className={`h-3 w-3 ${isRTL ? 'ml-1' : 'mr-1'}`} />\n                      {t.officeManagement?.published || \"Published\"}\n                    </Badge>\n                  ) : (\n                    <Badge variant=\"outline\" className=\"text-xs\">\n                      <EyeOff className={`h-3 w-3 ${isRTL ? 'ml-1' : 'mr-1'}`} />\n                      {t.officeManagement?.draft || \"Draft\"}\n                    </Badge>\n                  )}\n                </div>\n              </div>\n            </div>\n            {office.description && (\n              <p className=\"text-sm text-muted-foreground mt-1 line-clamp-2\">\n                {office.description}\n              </p>\n            )}\n            <div className=\"flex items-center gap-2 mt-3\">\n              <Button size=\"sm\" onClick={onManage} data-testid={`button-manage-office-${office.id}`}>\n                <Settings className={`h-4 w-4 ${isRTL ? 'ml-1' : 'mr-1'}`} />\n                {t.officeManagement?.manage || \"Manage\"}\n              </Button>\n              {office.isPublished && (\n                <a href={`/office/${office.slug}`} target=\"_blank\" rel=\"noopener noreferrer\">\n                  <Button size=\"sm\" variant=\"outline\" data-testid={`button-view-office-${office.id}`}>\n                    <ExternalLink className={`h-4 w-4 ${isRTL ? 'ml-1' : 'mr-1'}`} />\n                    {t.officeManagement?.view || \"View\"}\n                  </Button>\n                </a>\n              )}\n              <AlertDialog>\n                <AlertDialogTrigger asChild>\n                  <Button size=\"sm\" variant=\"ghost\" data-testid={`button-delete-office-${office.id}`}>\n                    <Trash2 className=\"h-4 w-4 text-destructive\" />\n                  </Button>\n                </AlertDialogTrigger>\n                <AlertDialogContent dir={isRTL ? 'rtl' : 'ltr'}>\n                  <AlertDialogHeader>\n                    <AlertDialogTitle>{t.officeManagement?.deleteOffice || \"Delete Office\"}</AlertDialogTitle>\n                    <AlertDialogDescription>\n                      {t.officeManagement?.deleteConfirm || `Are you sure you want to delete \"${office.name}\"?`} {t.officeManagement?.deleteWarning || \"This will also delete all services, media, and messages. This action cannot be undone.\"}\n                    </AlertDialogDescription>\n                  </AlertDialogHeader>\n                  <AlertDialogFooter>\n                    <AlertDialogCancel>{t.officeManagement?.cancel || \"Cancel\"}</AlertDialogCancel>\n                    <AlertDialogAction\n                      onClick={() => deleteMutation.mutate()}\n                      className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                      data-testid=\"button-confirm-delete-office\"\n                    >\n                      {t.officeManagement?.delete || \"Delete\"}\n                    </AlertDialogAction>\n                  </AlertDialogFooter>\n                </AlertDialogContent>\n              </AlertDialog>\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction OfficeManagementPanel({\n  office,\n  onBack,\n}: {\n  office: Office;\n  onBack: () => void;\n}) {\n  const { language } = useLanguage();\n  const t = translations[language];\n  const isRTL = language === 'ar';\n  \n  const [editingOffice, setEditingOffice] = useState(false);\n  const [addingService, setAddingService] = useState(false);\n  const [editingService, setEditingService] = useState<OfficeService | null>(null);\n\n  const { data: services = [], isLoading: servicesLoading } = useQuery<OfficeService[]>({\n    queryKey: ['/api/offices', office.id, 'services'],\n  });\n\n  return (\n    <div className=\"space-y-6\" dir={isRTL ? 'rtl' : 'ltr'}>\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-3\">\n          <Button variant=\"ghost\" size=\"icon\" onClick={onBack} data-testid=\"button-back-to-offices\">\n            <Building2 className=\"h-5 w-5\" />\n          </Button>\n          <div>\n            <h2 className=\"text-2xl font-bold\">{office.name}</h2>\n            <p className=\"text-sm text-muted-foreground\">{t.officeManagement?.manageYourOffice || \"Manage your office and services\"}</p>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          {office.isPublished && (\n            <a href={`/office/${office.slug}`} target=\"_blank\" rel=\"noopener noreferrer\">\n              <Button variant=\"outline\" data-testid=\"button-preview-office\">\n                <Globe className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n                {t.officeManagement?.viewPublicPage || \"View Public Page\"}\n              </Button>\n            </a>\n          )}\n          <Dialog open={editingOffice} onOpenChange={setEditingOffice}>\n            <DialogTrigger asChild>\n              <Button variant=\"outline\" data-testid=\"button-edit-office\">\n                <Pencil className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n                {t.officeManagement?.editOffice || \"Edit Office\"}\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>{t.officeManagement?.editOffice || \"Edit Office\"}</DialogTitle>\n                <DialogDescription>{t.officeManagement?.updateServiceInfo || \"Update your office information\"}</DialogDescription>\n              </DialogHeader>\n              <OfficeForm\n                office={office}\n                onSuccess={() => setEditingOffice(false)}\n                onCancel={() => setEditingOffice(false)}\n              />\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      <Tabs defaultValue=\"services\">\n        <TabsList data-testid=\"tabs-office-management\">\n          <TabsTrigger value=\"services\" data-testid=\"tab-manage-services\">\n            <Package className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n            {t.officeManagement?.servicesCount || \"Services\"} ({services.length})\n          </TabsTrigger>\n          <TabsTrigger value=\"messages\" data-testid=\"tab-manage-messages\">\n            <MessageCircle className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n            {t.officeManagement?.messages || \"Messages\"}\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"services\" className=\"mt-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <h3 className=\"text-lg font-semibold\">{t.officeManagement?.services || \"Services\"}</h3>\n            <Dialog open={addingService} onOpenChange={setAddingService}>\n              <DialogTrigger asChild>\n                <Button data-testid=\"button-add-service\">\n                  <Plus className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n                  {t.officeManagement?.addService || \"Add Service\"}\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-lg\">\n                <DialogHeader>\n                  <DialogTitle>{t.officeManagement?.addNewService || \"Add New Service\"}</DialogTitle>\n                  <DialogDescription>\n                    {t.officeManagement?.addNewServiceDesc || \"Create a new service that visitors can see and rate\"}\n                  </DialogDescription>\n                </DialogHeader>\n                <ServiceForm\n                  officeId={office.id}\n                  onSuccess={() => setAddingService(false)}\n                  onCancel={() => setAddingService(false)}\n                />\n              </DialogContent>\n            </Dialog>\n          </div>\n\n          {servicesLoading ? (\n            <div className=\"space-y-4\">\n              {Array.from({ length: 3 }).map((_, i) => (\n                <Card key={i}>\n                  <CardContent className=\"p-4\">\n                    <Skeleton className=\"h-20\" />\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : services.length === 0 ? (\n            <Card>\n              <CardContent className=\"py-12 text-center\">\n                <Package className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n                <h3 className=\"font-semibold mb-2\">{t.officeManagement?.noServicesYet || \"No Services Yet\"}</h3>\n                <p className=\"text-muted-foreground mb-4\">\n                  {t.officeManagement?.addServicesDescription || \"Add services that visitors can view and rate\"}\n                </p>\n                <Button onClick={() => setAddingService(true)} data-testid=\"button-add-first-service\">\n                  <Plus className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n                  {t.officeManagement?.addFirstService || \"Add First Service\"}\n                </Button>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"space-y-4\">\n              {services.map((service) => (\n                <ServiceCard\n                  key={service.id}\n                  service={service}\n                  officeId={office.id}\n                  onEdit={() => setEditingService(service)}\n                />\n              ))}\n            </div>\n          )}\n\n          <Dialog open={!!editingService} onOpenChange={(open) => !open && setEditingService(null)}>\n            <DialogContent className=\"max-w-lg\">\n              <DialogHeader>\n                <DialogTitle>{t.officeManagement?.editService || \"Edit Service\"}</DialogTitle>\n                <DialogDescription>{t.officeManagement?.updateServiceInfo || \"Update service information\"}</DialogDescription>\n              </DialogHeader>\n              {editingService && (\n                <ServiceForm\n                  officeId={office.id}\n                  service={editingService}\n                  onSuccess={() => setEditingService(null)}\n                  onCancel={() => setEditingService(null)}\n                />\n              )}\n            </DialogContent>\n          </Dialog>\n        </TabsContent>\n\n        <TabsContent value=\"messages\" className=\"mt-6\">\n          <Card>\n            <CardContent className=\"py-12 text-center\">\n              <MessageCircle className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n              <h3 className=\"font-semibold mb-2\">{t.officeManagement?.visitorMessages || \"Visitor Messages\"}</h3>\n              <p className=\"text-muted-foreground\">\n                {t.officeManagement?.messagesDescription || \"Messages from visitors will appear here. You can respond to them as the office receptionist.\"}\n              </p>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n\nexport default function OfficeManagement() {\n  const { user } = useAuth();\n  const { language } = useLanguage();\n  const t = translations[language];\n  const isRTL = language === 'ar';\n  \n  const [selectedOffice, setSelectedOffice] = useState<Office | null>(null);\n  const [creatingOffice, setCreatingOffice] = useState(false);\n\n  const { data: offices = [], isLoading } = useQuery<Office[]>({\n    queryKey: ['/api/offices'],\n  });\n\n  if (selectedOffice) {\n    const currentOffice = offices.find((o) => o.id === selectedOffice.id) || selectedOffice;\n    return (\n      <div className=\"p-6\" dir={isRTL ? 'rtl' : 'ltr'}>\n        <OfficeManagementPanel\n          office={currentOffice}\n          onBack={() => setSelectedOffice(null)}\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\" dir={isRTL ? 'rtl' : 'ltr'}>\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">{t.officeManagement?.title || \"Office Management\"}</h1>\n          <p className=\"text-muted-foreground\">\n            {t.officeManagement?.subtitle || \"Manage your virtual offices and services for visitors\"}\n          </p>\n        </div>\n        <Dialog open={creatingOffice} onOpenChange={setCreatingOffice}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-create-office\">\n              <Plus className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n              {t.officeManagement?.createOffice || \"Create Office\"}\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>{t.officeManagement?.createNewOffice || \"Create New Office\"}</DialogTitle>\n              <DialogDescription>\n                {t.officeManagement?.createNewOfficeDesc || \"Set up a new virtual office that visitors can browse on the marketplace\"}\n              </DialogDescription>\n            </DialogHeader>\n            <OfficeForm\n              onSuccess={() => setCreatingOffice(false)}\n              onCancel={() => setCreatingOffice(false)}\n            />\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {isLoading ? (\n        <div className=\"grid gap-4 md:grid-cols-2\">\n          {Array.from({ length: 4 }).map((_, i) => (\n            <Card key={i}>\n              <CardContent className=\"p-4\">\n                <Skeleton className=\"h-24\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : offices.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <Building2 className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n            <h3 className=\"font-semibold mb-2\">{t.officeManagement?.noOffices || \"No Offices Yet\"}</h3>\n            <p className=\"text-muted-foreground mb-4\">\n              {t.officeManagement?.createFirstOffice || \"Create your first virtual office to start offering services to visitors\"}\n            </p>\n            <Button onClick={() => setCreatingOffice(true)} data-testid=\"button-create-first-office\">\n              <Plus className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n              {t.officeManagement?.createYourFirstOffice || \"Create Your First Office\"}\n            </Button>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid gap-4 md:grid-cols-2\">\n          {offices.map((office) => (\n            <OfficeCard\n              key={office.id}\n              office={office}\n              onManage={() => setSelectedOffice(office)}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":42209,"size_tokens":null},"client/src/pages/OfficeDetail.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Building2,\n  ArrowLeft,\n  Star,\n  MapPin,\n  Clock,\n  Mail,\n  Phone,\n  Send,\n  MessageCircle,\n  Heart,\n  Package,\n  Video,\n  Eye,\n  Play,\n  Megaphone,\n  User,\n} from \"lucide-react\";\nimport logoUrl from \"@assets/Photoroom___1764761955587.png\";\nimport { useState, useEffect, useRef } from \"react\";\nimport { Link, useParams } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\nimport type {\n  Office,\n  OfficeService,\n  ServiceRating,\n  ServiceComment,\n  OfficeMedia,\n  OfficePost,\n  OfficeMessage,\n  VideoCall,\n} from \"@shared/schema\";\nimport { PhoneOff, VideoOff } from \"lucide-react\";\n\nfunction generateSessionId() {\n  const stored = localStorage.getItem('office_chat_session');\n  if (stored) return stored;\n  const newId = 'visitor_' + Math.random().toString(36).substring(2, 15);\n  localStorage.setItem('office_chat_session', newId);\n  return newId;\n}\n\nfunction StarRating({\n  rating,\n  onRate,\n  interactive = false,\n}: {\n  rating: number;\n  onRate?: (rating: number) => void;\n  interactive?: boolean;\n}) {\n  const [hover, setHover] = useState(0);\n\n  return (\n    <div className=\"flex items-center gap-1\">\n      {[1, 2, 3, 4, 5].map((star) => (\n        <button\n          key={star}\n          type=\"button\"\n          onClick={() => interactive && onRate?.(star)}\n          onMouseEnter={() => interactive && setHover(star)}\n          onMouseLeave={() => interactive && setHover(0)}\n          className={interactive ? 'cursor-pointer' : 'cursor-default'}\n          disabled={!interactive}\n          data-testid={`star-${star}`}\n        >\n          <Star\n            className={`h-5 w-5 ${\n              (hover || rating) >= star\n                ? 'fill-yellow-400 text-yellow-400'\n                : 'text-muted-foreground'\n            }`}\n          />\n        </button>\n      ))}\n    </div>\n  );\n}\n\nfunction ServiceCard({\n  service,\n  officeId,\n}: {\n  service: OfficeService;\n  officeId: number;\n}) {\n  const { language } = useLanguage();\n  const t = translations[language].officeDetail;\n  const isRTL = language === 'ar';\n  const [showRating, setShowRating] = useState(false);\n  const [showCommentForm, setShowCommentForm] = useState(false);\n  const [newRating, setNewRating] = useState(0);\n  const [visitorName, setVisitorName] = useState('');\n  const [commentContent, setCommentContent] = useState('');\n  const [commentVisitorName, setCommentVisitorName] = useState('');\n\n  const { data: ratingsData } = useQuery<{\n    ratings: ServiceRating[];\n    average: number;\n    count: number;\n  }>({\n    queryKey: ['/api/public/services', service.id, 'ratings'],\n  });\n\n  const { data: comments = [] } = useQuery<ServiceComment[]>({\n    queryKey: ['/api/public/services', service.id, 'comments'],\n  });\n\n  const submitRatingMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest('POST', `/api/public/services/${service.id}/ratings`, {\n        rating: newRating,\n        visitorName: visitorName || null,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/public/services', service.id, 'ratings'] });\n      setShowRating(false);\n      setNewRating(0);\n      setVisitorName('');\n    },\n  });\n\n  const submitCommentMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest('POST', `/api/public/services/${service.id}/comments`, {\n        content: commentContent,\n        visitorName: commentVisitorName || null,\n        rating: newRating || null,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/public/services', service.id, 'comments'] });\n      setShowCommentForm(false);\n      setCommentContent('');\n      setCommentVisitorName('');\n    },\n  });\n\n  return (\n    <Card className=\"hover-elevate\" data-testid={`card-service-${service.id}`}>\n      <CardContent className=\"p-4\">\n        <div className=\"flex items-start gap-4\">\n          {service.imageUrl ? (\n            <img\n              src={service.imageUrl}\n              alt={service.title}\n              className=\"w-20 h-20 rounded-lg object-cover\"\n            />\n          ) : (\n            <div className=\"w-20 h-20 rounded-lg bg-muted flex items-center justify-center\">\n              <Package className=\"h-8 w-8 text-muted-foreground\" />\n            </div>\n          )}\n          <div className=\"flex-1\">\n            <div className=\"flex items-start justify-between\">\n              <div>\n                <h3 className=\"font-semibold\">{service.title}</h3>\n                {service.category && (\n                  <Badge variant=\"secondary\" className=\"mt-1\">\n                    {service.category}\n                  </Badge>\n                )}\n              </div>\n              {service.price && (\n                <div className={isRTL ? \"text-left\" : \"text-right\"}>\n                  <span className=\"font-bold text-lg\">\n                    {new Intl.NumberFormat(language === 'ar' ? 'ar-SA' : 'en-SA', { style: 'currency', currency: 'SAR' }).format(Number(service.price))}\n                  </span>\n                  {service.priceType && (\n                    <span className=\"text-sm text-muted-foreground block\">\n                      /{service.priceType}\n                    </span>\n                  )}\n                </div>\n              )}\n            </div>\n            {service.description && (\n              <p className=\"text-sm text-muted-foreground mt-2 line-clamp-2\">\n                {service.description}\n              </p>\n            )}\n            <div className=\"flex items-center gap-4 mt-3\">\n              <div className=\"flex items-center gap-1\">\n                <StarRating rating={ratingsData?.average || 0} />\n                <span className=\"text-sm text-muted-foreground\">\n                  ({ratingsData?.count || 0})\n                </span>\n              </div>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setShowRating(!showRating)}\n                data-testid={`button-rate-service-${service.id}`}\n              >\n                {t.rate}\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setShowCommentForm(!showCommentForm)}\n                data-testid={`button-comment-service-${service.id}`}\n              >\n                <MessageCircle className={isRTL ? \"h-4 w-4 ml-1\" : \"h-4 w-4 mr-1\"} />\n                {comments.length}\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        {showRating && (\n          <div className=\"mt-4 p-4 bg-muted/50 rounded-lg space-y-3\" dir={isRTL ? 'rtl' : 'ltr'}>\n            <div className=\"flex items-center gap-4\">\n              <span className=\"text-sm\">{t.yourRating}</span>\n              <StarRating rating={newRating} onRate={setNewRating} interactive />\n            </div>\n            <Input\n              placeholder={t.yourNameOptional}\n              value={visitorName}\n              onChange={(e) => setVisitorName(e.target.value)}\n              data-testid=\"input-rating-name\"\n            />\n            <Button\n              onClick={() => submitRatingMutation.mutate()}\n              disabled={newRating === 0 || submitRatingMutation.isPending}\n              data-testid=\"button-submit-rating\"\n            >\n              {t.submitRating}\n            </Button>\n          </div>\n        )}\n\n        {showCommentForm && (\n          <div className=\"mt-4 p-4 bg-muted/50 rounded-lg space-y-3\" dir={isRTL ? 'rtl' : 'ltr'}>\n            <Textarea\n              placeholder={t.writeComment}\n              value={commentContent}\n              onChange={(e) => setCommentContent(e.target.value)}\n              rows={3}\n              data-testid=\"textarea-comment\"\n            />\n            <Input\n              placeholder={t.yourNameOptional}\n              value={commentVisitorName}\n              onChange={(e) => setCommentVisitorName(e.target.value)}\n              data-testid=\"input-comment-name\"\n            />\n            <Button\n              onClick={() => submitCommentMutation.mutate()}\n              disabled={!commentContent.trim() || submitCommentMutation.isPending}\n              data-testid=\"button-submit-comment\"\n            >\n              {t.postComment}\n            </Button>\n          </div>\n        )}\n\n        {comments.length > 0 && (\n          <div className=\"mt-4 space-y-3 border-t pt-4\" dir={isRTL ? 'rtl' : 'ltr'}>\n            <h4 className=\"font-medium text-sm\">{t.comments}</h4>\n            {comments.slice(0, 3).map((comment) => (\n              <div key={comment.id} className=\"flex items-start gap-3\">\n                <Avatar className=\"h-8 w-8\">\n                  <AvatarFallback>\n                    {comment.visitorName?.[0]?.toUpperCase() || (language === 'ar' ? '' : 'G')}\n                  </AvatarFallback>\n                </Avatar>\n                <div>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"font-medium text-sm\">\n                      {comment.visitorName || t.guest}\n                    </span>\n                    {comment.rating && (\n                      <StarRating rating={comment.rating} />\n                    )}\n                  </div>\n                  <p className=\"text-sm text-muted-foreground\">{comment.content}</p>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction ChatPanel({\n  officeId,\n  officeName,\n}: {\n  officeId: number;\n  officeName: string;\n}) {\n  const { language } = useLanguage();\n  const t = translations[language].officeDetail;\n  const isRTL = language === 'ar';\n  const [sessionId] = useState(generateSessionId);\n  const [message, setMessage] = useState('');\n  const [visitorName, setVisitorName] = useState(() => \n    localStorage.getItem('office_chat_name') || ''\n  );\n  const [showNameInput, setShowNameInput] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  const { data: messages = [], isLoading } = useQuery<OfficeMessage[]>({\n    queryKey: ['/api/public/offices', officeId, 'messages'],\n    queryFn: async () => {\n      const res = await fetch(`/api/public/offices/${officeId}/messages?sessionId=${sessionId}`);\n      if (!res.ok) throw new Error('Failed to fetch messages');\n      return res.json();\n    },\n    refetchInterval: 5000,\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest('POST', `/api/public/offices/${officeId}/messages`, {\n        sessionId,\n        content: message,\n        senderName: visitorName || null,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/public/offices', officeId, 'messages'] });\n      setMessage('');\n    },\n  });\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  const handleSaveName = () => {\n    localStorage.setItem('office_chat_name', visitorName);\n    setShowNameInput(false);\n  };\n\n  return (\n    <Card className=\"h-[400px] flex flex-col\" data-testid=\"panel-chat\" dir={isRTL ? 'rtl' : 'ltr'}>\n      <CardHeader className=\"py-3 px-4 border-b flex-shrink-0\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <MessageCircle className=\"h-5 w-5 text-primary\" />\n            <CardTitle className=\"text-base\">{t.chatWithReceptionist}</CardTitle>\n          </div>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setShowNameInput(!showNameInput)}\n            data-testid=\"button-set-name\"\n          >\n            <User className=\"h-4 w-4\" />\n          </Button>\n        </div>\n        {showNameInput && (\n          <div className=\"flex items-center gap-2 mt-2\">\n            <Input\n              placeholder={t.yourName}\n              value={visitorName}\n              onChange={(e) => setVisitorName(e.target.value)}\n              className=\"text-sm\"\n              data-testid=\"input-chat-name\"\n            />\n            <Button size=\"sm\" onClick={handleSaveName} data-testid=\"button-save-name\">\n              {t.save}\n            </Button>\n          </div>\n        )}\n      </CardHeader>\n      <div className=\"flex-1 overflow-auto p-4 space-y-3\">\n        {isLoading ? (\n          <div className=\"space-y-2\">\n            <Skeleton className=\"h-10 w-3/4\" />\n            <Skeleton className={`h-10 w-1/2 ${isRTL ? 'mr-auto' : 'ml-auto'}`} />\n          </div>\n        ) : messages.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center h-full text-center\">\n            <MessageCircle className=\"h-10 w-10 text-muted-foreground mb-2\" />\n            <p className=\"text-sm text-muted-foreground\">\n              {t.startConversation} {officeName}\n            </p>\n          </div>\n        ) : (\n          messages.map((msg) => (\n            <div\n              key={msg.id}\n              className={`flex ${msg.senderType === 'visitor' ? (isRTL ? 'justify-start' : 'justify-end') : (isRTL ? 'justify-end' : 'justify-start')}`}\n            >\n              <div\n                className={`max-w-[80%] rounded-lg px-3 py-2 ${\n                  msg.senderType === 'visitor'\n                    ? 'bg-primary text-primary-foreground'\n                    : 'bg-muted'\n                }`}\n                data-testid={`message-${msg.id}`}\n              >\n                {msg.senderType === 'receptionist' && (\n                  <span className=\"text-xs font-medium block mb-1\">{t.receptionist}</span>\n                )}\n                <p className=\"text-sm\">{msg.content}</p>\n              </div>\n            </div>\n          ))\n        )}\n        <div ref={messagesEndRef} />\n      </div>\n      <div className=\"p-3 border-t flex-shrink-0\">\n        <div className=\"flex items-center gap-2\">\n          <Input\n            placeholder={t.typeMessage}\n            value={message}\n            onChange={(e) => setMessage(e.target.value)}\n            onKeyDown={(e) => {\n              if (e.key === 'Enter' && !e.shiftKey) {\n                e.preventDefault();\n                if (message.trim()) sendMessageMutation.mutate();\n              }\n            }}\n            data-testid=\"input-chat-message\"\n          />\n          <Button\n            size=\"icon\"\n            onClick={() => message.trim() && sendMessageMutation.mutate()}\n            disabled={!message.trim() || sendMessageMutation.isPending}\n            data-testid=\"button-send-message\"\n          >\n            <Send className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n    </Card>\n  );\n}\n\nfunction VideoChatPanel({\n  officeId,\n  officeName,\n}: {\n  officeId: number;\n  officeName: string;\n}) {\n  const { language } = useLanguage();\n  const t = translations[language].officeDetail;\n  const isRTL = language === 'ar';\n  const [sessionId] = useState(generateSessionId);\n  const [visitorName, setVisitorName] = useState(() => \n    localStorage.getItem('office_chat_name') || ''\n  );\n  const [currentCall, setCurrentCall] = useState<VideoCall | null>(null);\n  const [showNameInput, setShowNameInput] = useState(false);\n  const [callStatus, setCallStatus] = useState<'idle' | 'requesting' | 'pending' | 'active' | 'ended' | 'declined'>('idle');\n\n  const requestCallMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest('POST', `/api/public/offices/${officeId}/video-calls`, {\n        sessionId,\n        visitorName: visitorName || null,\n      });\n      const data = await response.json();\n      return data as VideoCall;\n    },\n    onSuccess: (call: VideoCall) => {\n      setCurrentCall(call);\n      setCallStatus('pending');\n    },\n    onError: () => {\n      setCallStatus('idle');\n    },\n  });\n\n  const endCallMutation = useMutation({\n    mutationFn: async () => {\n      if (!currentCall) return;\n      await apiRequest('POST', `/api/public/video-calls/${currentCall.roomId}/end`, {\n        sessionId,\n      });\n    },\n    onSuccess: () => {\n      setCurrentCall(null);\n      setCallStatus('ended');\n      setTimeout(() => setCallStatus('idle'), 3000);\n    },\n  });\n\n  const { data: callStatusData } = useQuery<VideoCall>({\n    queryKey: ['/api/public/video-calls', currentCall?.roomId],\n    enabled: !!currentCall?.roomId && (callStatus === 'pending' || callStatus === 'active'),\n    refetchInterval: 2000,\n  });\n\n  useEffect(() => {\n    if (callStatusData) {\n      if (callStatusData.status === 'active') {\n        setCallStatus('active');\n      } else if (callStatusData.status === 'declined') {\n        setCallStatus('declined');\n        setTimeout(() => {\n          setCallStatus('idle');\n          setCurrentCall(null);\n        }, 3000);\n      } else if (callStatusData.status === 'ended') {\n        setCallStatus('ended');\n        setTimeout(() => {\n          setCallStatus('idle');\n          setCurrentCall(null);\n        }, 3000);\n      }\n    }\n  }, [callStatusData]);\n\n  const handleStartCall = () => {\n    setCallStatus('requesting');\n    requestCallMutation.mutate();\n  };\n\n  const handleEndCall = () => {\n    endCallMutation.mutate();\n  };\n\n  const handleSaveName = () => {\n    localStorage.setItem('office_chat_name', visitorName);\n    setShowNameInput(false);\n  };\n\n  return (\n    <Card className=\"h-[400px] flex flex-col\" data-testid=\"panel-video-chat\" dir={isRTL ? 'rtl' : 'ltr'}>\n      <CardHeader className=\"py-3 px-4 border-b flex-shrink-0\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <Video className=\"h-5 w-5 text-primary\" />\n            <CardTitle className=\"text-base\">{t.videoCall}</CardTitle>\n          </div>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setShowNameInput(!showNameInput)}\n            data-testid=\"button-set-video-name\"\n          >\n            <User className=\"h-4 w-4\" />\n          </Button>\n        </div>\n        {showNameInput && (\n          <div className=\"flex items-center gap-2 mt-2\">\n            <Input\n              placeholder={t.yourName}\n              value={visitorName}\n              onChange={(e) => setVisitorName(e.target.value)}\n              className=\"text-sm\"\n              data-testid=\"input-video-name\"\n            />\n            <Button size=\"sm\" onClick={handleSaveName} data-testid=\"button-save-video-name\">\n              {t.save}\n            </Button>\n          </div>\n        )}\n      </CardHeader>\n      <div className=\"flex-1 flex items-center justify-center p-6\">\n        {callStatus === 'idle' && (\n          <div className=\"text-center space-y-4\">\n            <div className=\"w-20 h-20 mx-auto rounded-full bg-primary/10 flex items-center justify-center\">\n              <Video className=\"h-10 w-10 text-primary\" />\n            </div>\n            <div>\n              <h3 className=\"font-medium\">{t.startVideoCall}</h3>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                {t.connectWith} {officeName}\n              </p>\n            </div>\n            <Button\n              onClick={handleStartCall}\n              disabled={requestCallMutation.isPending}\n              className=\"gap-2\"\n              data-testid=\"button-start-video-call\"\n            >\n              <Video className=\"h-4 w-4\" />\n              {requestCallMutation.isPending ? t.connecting : t.startVideoCall}\n            </Button>\n          </div>\n        )}\n\n        {callStatus === 'requesting' && (\n          <div className=\"text-center space-y-4\">\n            <div className=\"w-20 h-20 mx-auto rounded-full bg-primary/10 flex items-center justify-center animate-pulse\">\n              <Video className=\"h-10 w-10 text-primary\" />\n            </div>\n            <p className=\"text-sm text-muted-foreground\">{t.initiatingCall}</p>\n          </div>\n        )}\n\n        {callStatus === 'pending' && (\n          <div className=\"text-center space-y-4\">\n            <div className=\"w-20 h-20 mx-auto rounded-full bg-yellow-500/10 flex items-center justify-center\">\n              <Video className=\"h-10 w-10 text-yellow-500 animate-pulse\" />\n            </div>\n            <div>\n              <h3 className=\"font-medium\">{t.waitingForReceptionist}</h3>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                {t.pleaseWait}\n              </p>\n            </div>\n            <Button\n              variant=\"destructive\"\n              onClick={handleEndCall}\n              className=\"gap-2\"\n              data-testid=\"button-cancel-video-call\"\n            >\n              <PhoneOff className=\"h-4 w-4\" />\n              {t.cancelCall}\n            </Button>\n          </div>\n        )}\n\n        {callStatus === 'active' && (\n          <div className=\"text-center space-y-4 w-full\">\n            <div className=\"w-full aspect-video bg-muted rounded-lg flex items-center justify-center relative\">\n              <div className=\"text-center\">\n                <Video className=\"h-16 w-16 mx-auto text-green-500 animate-pulse\" />\n                <p className=\"text-sm text-muted-foreground mt-2\">{t.callInProgress}</p>\n                <p className=\"text-xs text-muted-foreground\">{t.room}: {currentCall?.roomId}</p>\n              </div>\n            </div>\n            <Button\n              variant=\"destructive\"\n              onClick={handleEndCall}\n              className=\"gap-2\"\n              data-testid=\"button-end-video-call\"\n            >\n              <PhoneOff className=\"h-4 w-4\" />\n              {t.endCall}\n            </Button>\n          </div>\n        )}\n\n        {callStatus === 'declined' && (\n          <div className=\"text-center space-y-4\">\n            <div className=\"w-20 h-20 mx-auto rounded-full bg-destructive/10 flex items-center justify-center\">\n              <VideoOff className=\"h-10 w-10 text-destructive\" />\n            </div>\n            <div>\n              <h3 className=\"font-medium\">{t.callDeclined}</h3>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                {t.receptionistUnavailable}\n              </p>\n            </div>\n          </div>\n        )}\n\n        {callStatus === 'ended' && (\n          <div className=\"text-center space-y-4\">\n            <div className=\"w-20 h-20 mx-auto rounded-full bg-muted flex items-center justify-center\">\n              <PhoneOff className=\"h-10 w-10 text-muted-foreground\" />\n            </div>\n            <div>\n              <h3 className=\"font-medium\">{t.callEnded}</h3>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                {t.thankYouConnecting}\n              </p>\n            </div>\n          </div>\n        )}\n      </div>\n    </Card>\n  );\n}\n\nexport default function OfficeDetail() {\n  const { slug } = useParams<{ slug: string }>();\n  const { language } = useLanguage();\n  const t = translations[language].officeDetail;\n  const isRTL = language === 'ar';\n\n  const { data: office, isLoading: officeLoading, error } = useQuery<Office>({\n    queryKey: ['/api/public/offices', slug],\n    enabled: !!slug,\n  });\n\n  const { data: services = [], isLoading: servicesLoading } = useQuery<OfficeService[]>({\n    queryKey: ['/api/public/offices', office?.id, 'services'],\n    enabled: !!office?.id,\n  });\n\n  const { data: media = [] } = useQuery<OfficeMedia[]>({\n    queryKey: ['/api/public/offices', office?.id, 'media'],\n    enabled: !!office?.id,\n  });\n\n  const { data: posts = [] } = useQuery<OfficePost[]>({\n    queryKey: ['/api/public/offices', office?.id, 'posts'],\n    enabled: !!office?.id,\n  });\n\n  const likePostMutation = useMutation({\n    mutationFn: async (postId: number) => {\n      await apiRequest('POST', `/api/public/posts/${postId}/like`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/public/offices', office?.id, 'posts'] });\n    },\n  });\n\n  const handleLogin = () => {\n    localStorage.setItem(\"cloudoffice_redirect\", \"/\");\n    window.location.href = \"/api/login\";\n  };\n\n  if (officeLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <header className=\"border-b bg-card sticky top-0 z-50\">\n          <div className=\"container mx-auto px-4 py-4 flex items-center gap-3\">\n            <Skeleton className=\"h-10 w-10 rounded-full\" />\n            <Skeleton className=\"h-6 w-32\" />\n          </div>\n        </header>\n        <div className=\"container mx-auto px-4 py-8\">\n          <Skeleton className=\"h-64 w-full rounded-lg mb-8\" />\n          <div className=\"grid gap-6 lg:grid-cols-3\">\n            <div className=\"lg:col-span-2 space-y-4\">\n              <Skeleton className=\"h-40\" />\n              <Skeleton className=\"h-40\" />\n            </div>\n            <Skeleton className=\"h-[400px]\" />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !office) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\" dir={isRTL ? 'rtl' : 'ltr'}>\n        <div className=\"text-center\">\n          <Building2 className=\"h-16 w-16 mx-auto text-muted-foreground mb-4\" />\n          <h1 className=\"text-2xl font-bold mb-2\">{t.officeNotFound}</h1>\n          <p className=\"text-muted-foreground mb-4\">\n            {t.officeNotFoundDesc}\n          </p>\n          <Link href=\"/storefront\">\n            <Button data-testid=\"button-back-to-storefront\">\n              <ArrowLeft className={isRTL ? \"h-4 w-4 ml-2 rotate-180\" : \"h-4 w-4 mr-2\"} />\n              {t.backToMarketplace}\n            </Button>\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  const videos = media.filter((m) => m.type === 'video');\n  const announcements = media.filter((m) => m.type === 'announcement');\n\n  return (\n    <div className=\"min-h-screen bg-background\" dir={isRTL ? 'rtl' : 'ltr'}>\n      <header className=\"border-b bg-card sticky top-0 z-50\">\n        <div className=\"container mx-auto px-4 py-4 flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <Link href=\"/storefront\">\n              <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back\">\n                <ArrowLeft className={isRTL ? \"h-5 w-5 rotate-180\" : \"h-5 w-5\"} />\n              </Button>\n            </Link>\n            <img src={logoUrl} alt=\"CloudOffice\" className=\"h-10 w-10\" />\n            <span className=\"text-xl font-semibold\">CloudOffice</span>\n          </div>\n          <Button variant=\"default\" size=\"sm\" onClick={handleLogin} data-testid=\"button-login\">\n            {t.login}\n          </Button>\n        </div>\n      </header>\n\n      <div className=\"relative h-64 bg-gradient-to-br from-primary/20 to-primary/5\">\n        {office.coverUrl ? (\n          <img\n            src={office.coverUrl}\n            alt={office.name}\n            className=\"w-full h-full object-cover\"\n          />\n        ) : (\n          <div className=\"w-full h-full flex items-center justify-center\">\n            <Building2 className=\"h-24 w-24 text-primary/20\" />\n          </div>\n        )}\n        <div className=\"absolute inset-0 bg-gradient-to-t from-background/80 to-transparent\" />\n        <div className=\"absolute bottom-0 left-0 right-0 p-6\">\n          <div className=\"container mx-auto flex items-end gap-4\">\n            <Avatar className=\"h-24 w-24 border-4 border-background\">\n              {office.logoUrl ? (\n                <AvatarImage src={office.logoUrl} alt={office.name} />\n              ) : null}\n              <AvatarFallback className=\"text-2xl\">\n                {office.name.slice(0, 2).toUpperCase()}\n              </AvatarFallback>\n            </Avatar>\n            <div className=\"mb-2\">\n              <h1 className=\"text-3xl font-bold\">{office.name}</h1>\n              <div className=\"flex items-center gap-4 mt-2 text-sm\">\n                {office.category && (\n                  <Badge variant=\"secondary\">{office.category}</Badge>\n                )}\n                {office.location && (\n                  <span className=\"flex items-center gap-1 text-muted-foreground\">\n                    <MapPin className=\"h-4 w-4\" />\n                    {office.location}\n                  </span>\n                )}\n                {office.workingHours && (\n                  <span className=\"flex items-center gap-1 text-muted-foreground\">\n                    <Clock className=\"h-4 w-4\" />\n                    {office.workingHours}\n                  </span>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"grid gap-8 lg:grid-cols-3\">\n          <div className=\"lg:col-span-2 space-y-8\">\n            {office.description && (\n              <section>\n                <h2 className=\"text-xl font-semibold mb-3\">{t.about}</h2>\n                <p className=\"text-muted-foreground\">{office.description}</p>\n              </section>\n            )}\n\n            <Card className={isRTL ? \"bg-gradient-to-l from-primary/5 to-primary/10 border-primary/20\" : \"bg-gradient-to-r from-primary/5 to-primary/10 border-primary/20\"}>\n              <CardContent className=\"p-6\">\n                <h2 className=\"text-lg font-semibold mb-4 flex items-center gap-2\">\n                  <MessageCircle className=\"h-5 w-5 text-primary\" />\n                  {t.contactInformation}\n                </h2>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  {office.contactEmail && (\n                    <a\n                      href={`mailto:${office.contactEmail}`}\n                      className=\"flex items-center gap-3 p-3 rounded-lg bg-background/50 hover:bg-background transition-colors\"\n                      data-testid=\"link-email\"\n                    >\n                      <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center\">\n                        <Mail className=\"h-5 w-5 text-primary\" />\n                      </div>\n                      <div>\n                        <p className=\"text-xs text-muted-foreground\">{t.email}</p>\n                        <p className=\"font-medium\">{office.contactEmail}</p>\n                      </div>\n                    </a>\n                  )}\n                  {office.contactPhone && (\n                    <a\n                      href={`tel:${office.contactPhone}`}\n                      className=\"flex items-center gap-3 p-3 rounded-lg bg-background/50 hover:bg-background transition-colors\"\n                      data-testid=\"link-phone\"\n                    >\n                      <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center\">\n                        <Phone className=\"h-5 w-5 text-primary\" />\n                      </div>\n                      <div>\n                        <p className=\"text-xs text-muted-foreground\">{t.phone}</p>\n                        <p className=\"font-medium\">{office.contactPhone}</p>\n                      </div>\n                    </a>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n\n            <Tabs defaultValue=\"services\">\n              <TabsList data-testid=\"tabs-office-content\">\n                <TabsTrigger value=\"services\" data-testid=\"tab-services\">\n                  <Package className={isRTL ? \"h-4 w-4 ml-2\" : \"h-4 w-4 mr-2\"} />\n                  {t.services} ({services.length})\n                </TabsTrigger>\n                <TabsTrigger value=\"media\" data-testid=\"tab-media\">\n                  <Video className={isRTL ? \"h-4 w-4 ml-2\" : \"h-4 w-4 mr-2\"} />\n                  {t.media} ({media.length})\n                </TabsTrigger>\n                <TabsTrigger value=\"posts\" data-testid=\"tab-posts\">\n                  <MessageCircle className={isRTL ? \"h-4 w-4 ml-2\" : \"h-4 w-4 mr-2\"} />\n                  {t.posts} ({posts.length})\n                </TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"services\" className=\"mt-6\">\n                {servicesLoading ? (\n                  <div className=\"space-y-4\">\n                    {Array.from({ length: 3 }).map((_, i) => (\n                      <Card key={i}>\n                        <CardContent className=\"p-4\">\n                          <Skeleton className=\"h-24\" />\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                ) : services.length === 0 ? (\n                  <div className=\"text-center py-12\">\n                    <Package className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n                    <h3 className=\"text-lg font-medium\">{t.noServices}</h3>\n                    <p className=\"text-muted-foreground\">\n                      {t.noServicesDesc}\n                    </p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-4\">\n                    {services.map((service) => (\n                      <ServiceCard\n                        key={service.id}\n                        service={service}\n                        officeId={office.id}\n                      />\n                    ))}\n                  </div>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"media\" className=\"mt-6\">\n                {media.length === 0 ? (\n                  <div className=\"text-center py-12\">\n                    <Video className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n                    <h3 className=\"text-lg font-medium\">{t.noMedia}</h3>\n                    <p className=\"text-muted-foreground\">\n                      {t.noMediaDesc}\n                    </p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-6\">\n                    {videos.length > 0 && (\n                      <div>\n                        <h3 className=\"font-medium mb-3 flex items-center gap-2\">\n                          <Video className=\"h-4 w-4\" />\n                          {t.videos}\n                        </h3>\n                        <div className=\"grid gap-4 sm:grid-cols-2\">\n                          {videos.map((video) => (\n                            <Card\n                              key={video.id}\n                              className=\"overflow-hidden\"\n                              data-testid={`card-video-${video.id}`}\n                            >\n                              <div className=\"relative\">\n                                {video.thumbnailUrl ? (\n                                  <img\n                                    src={video.thumbnailUrl}\n                                    alt={video.title || 'Video'}\n                                    className=\"w-full h-40 object-cover\"\n                                  />\n                                ) : (\n                                  <div className=\"w-full h-40 bg-muted flex items-center justify-center\">\n                                    <Video className=\"h-12 w-12 text-muted-foreground\" />\n                                  </div>\n                                )}\n                                <div className=\"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity cursor-pointer\">\n                                  <Play className=\"h-12 w-12 text-white\" />\n                                </div>\n                              </div>\n                              <CardContent className=\"p-3\">\n                                <h4 className=\"font-medium truncate\">\n                                  {video.title || 'Untitled'}\n                                </h4>\n                                <div className=\"flex items-center gap-2 text-sm text-muted-foreground mt-1\">\n                                  <Eye className=\"h-4 w-4\" />\n                                  {video.views} {t.views}\n                                </div>\n                              </CardContent>\n                            </Card>\n                          ))}\n                        </div>\n                      </div>\n                    )}\n\n                    {announcements.length > 0 && (\n                      <div>\n                        <h3 className=\"font-medium mb-3 flex items-center gap-2\">\n                          <Megaphone className=\"h-4 w-4\" />\n                          {t.announcements}\n                        </h3>\n                        <div className=\"space-y-3\">\n                          {announcements.map((ann) => (\n                            <Card key={ann.id} data-testid={`card-announcement-${ann.id}`}>\n                              <CardContent className=\"p-4\">\n                                <h4 className=\"font-medium\">{ann.title}</h4>\n                                <p className=\"text-sm text-muted-foreground mt-1\">\n                                  {ann.content}\n                                </p>\n                              </CardContent>\n                            </Card>\n                          ))}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"posts\" className=\"mt-6\">\n                {posts.length === 0 ? (\n                  <div className=\"text-center py-12\">\n                    <MessageCircle className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n                    <h3 className=\"text-lg font-medium\">{t.noPosts}</h3>\n                    <p className=\"text-muted-foreground\">\n                      {t.noPostsDesc}\n                    </p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-4\">\n                    {posts.map((post) => (\n                      <Card key={post.id} data-testid={`card-post-${post.id}`}>\n                        <CardContent className=\"p-4\">\n                          <p className=\"text-sm mb-3\">{post.content}</p>\n                          {post.mediaUrl && (\n                            <div className=\"mb-3 rounded-lg overflow-hidden\">\n                              {post.mediaType === 'video' ? (\n                                <video\n                                  src={post.mediaUrl}\n                                  className=\"w-full h-48 object-cover\"\n                                  controls\n                                />\n                              ) : (\n                                <img\n                                  src={post.mediaUrl}\n                                  alt=\"\"\n                                  className=\"w-full h-48 object-cover\"\n                                />\n                              )}\n                            </div>\n                          )}\n                          <div className=\"flex items-center justify-between text-sm\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => likePostMutation.mutate(post.id)}\n                              data-testid={`button-like-post-${post.id}`}\n                            >\n                              <Heart className={isRTL ? \"h-4 w-4 ml-1\" : \"h-4 w-4 mr-1\"} />\n                              {post.likes || 0}\n                            </Button>\n                            <span className=\"text-muted-foreground\">\n                              {new Date(post.createdAt!).toLocaleDateString(language === 'ar' ? 'ar-SA' : 'en-US')}\n                            </span>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                )}\n              </TabsContent>\n            </Tabs>\n          </div>\n\n          <div className=\"lg:sticky lg:top-24 lg:h-fit space-y-4\">\n            <ChatPanel officeId={office.id} officeName={office.name} />\n            <VideoChatPanel officeId={office.id} officeName={office.name} />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":40592,"size_tokens":null},"client/src/pages/Storefront.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { ScrollArea, ScrollBar } from \"@/components/ui/scroll-area\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Building2,\n  Search,\n  Star,\n  MapPin,\n  ArrowRight,\n  ArrowLeft,\n  Sparkles,\n  Phone,\n  Mail,\n  Send,\n  Check,\n  Briefcase,\n  FileText,\n  Headphones,\n  Package,\n  Shield,\n  Clock,\n  Users,\n  Zap,\n  ChevronRight,\n  Filter,\n} from \"lucide-react\";\nimport logoUrl from \"@assets/Photoroom___1764761955587.png\";\nimport { useState } from \"react\";\nimport { Link } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport type { OfficeService } from \"@shared/schema\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\ninterface PublicService extends OfficeService {\n  officeName: string;\n  officeSlug: string | null;\n}\n\nconst requestFormSchema = z.object({\n  visitorName: z.string().min(2, \"Name must be at least 2 characters\"),\n  visitorEmail: z.string().email(\"Please enter a valid email\"),\n  visitorPhone: z.string().optional(),\n  message: z.string().optional(),\n});\n\ntype RequestFormValues = z.infer<typeof requestFormSchema>;\n\nfunction ServiceRequestDialog({ service, children }: { service: PublicService; children: React.ReactNode }) {\n  const [open, setOpen] = useState(false);\n  const [submitted, setSubmitted] = useState(false);\n  const { toast } = useToast();\n  const { language } = useLanguage();\n  const t = translations[language].storefront;\n  const isRTL = language === 'ar';\n\n  const form = useForm<RequestFormValues>({\n    resolver: zodResolver(requestFormSchema),\n    defaultValues: {\n      visitorName: \"\",\n      visitorEmail: \"\",\n      visitorPhone: \"\",\n      message: \"\",\n    },\n  });\n\n  const submitRequest = useMutation({\n    mutationFn: async (data: RequestFormValues) => {\n      await apiRequest(\"POST\", `/api/public/services/${service.id}/request`, data);\n    },\n    onSuccess: () => {\n      setSubmitted(true);\n      toast({\n        title: t.requestSubmitted,\n        description: t.requestSubmittedDesc,\n      });\n    },\n    onError: () => {\n      toast({\n        title: t.error,\n        description: t.failedSubmitRequest,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: RequestFormValues) => {\n    submitRequest.mutate(data);\n  };\n\n  const handleClose = () => {\n    setOpen(false);\n    setTimeout(() => {\n      setSubmitted(false);\n      form.reset();\n    }, 300);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>{children}</DialogTrigger>\n      <DialogContent className=\"sm:max-w-lg\" dir={isRTL ? 'rtl' : 'ltr'}>\n        {submitted ? (\n          <div className=\"py-8 text-center\">\n            <div className=\"w-16 h-16 rounded-full bg-emerald-500/10 flex items-center justify-center mx-auto mb-4\">\n              <Check className=\"h-8 w-8 text-emerald-500\" />\n            </div>\n            <DialogHeader>\n              <DialogTitle className=\"text-center\">{t.requestSubmitted}</DialogTitle>\n              <DialogDescription className=\"text-center\">\n                {t.thankYouInterest} \"{service.title}\". {t.officeWillContact}\n              </DialogDescription>\n            </DialogHeader>\n            <Button onClick={handleClose} className=\"mt-6\">\n              {t.close}\n            </Button>\n          </div>\n        ) : (\n          <>\n            <DialogHeader>\n              <DialogTitle>{t.requestServiceTitle}</DialogTitle>\n              <DialogDescription>\n                {t.fillFormToRequest} \"{service.title}\" {t.fromOffice} {service.officeName}.\n              </DialogDescription>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"visitorName\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t.yourName}</FormLabel>\n                      <FormControl>\n                        <Input placeholder={t.namePlaceholder} {...field} data-testid=\"input-request-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"visitorEmail\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t.emailAddress}</FormLabel>\n                      <FormControl>\n                        <Input type=\"email\" placeholder={t.emailPlaceholder} {...field} data-testid=\"input-request-email\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"visitorPhone\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t.phoneOptional}</FormLabel>\n                      <FormControl>\n                        <Input type=\"tel\" placeholder={t.phonePlaceholder} {...field} data-testid=\"input-request-phone\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"message\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t.messageOptional}</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder={t.messagePlaceholder}\n                          className=\"resize-none\"\n                          rows={3}\n                          {...field}\n                          data-testid=\"input-request-message\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <div className=\"flex gap-3 pt-2\">\n                  <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)} className=\"flex-1\">\n                    {t.cancel}\n                  </Button>\n                  <Button type=\"submit\" disabled={submitRequest.isPending} className=\"flex-1 gap-2\" data-testid=\"button-submit-request\">\n                    {submitRequest.isPending ? (\n                      t.submitting\n                    ) : (\n                      <>\n                        <Send className=\"h-4 w-4\" />\n                        {t.submitRequest}\n                      </>\n                    )}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction ServiceCard({ service }: { service: PublicService }) {\n  const { language } = useLanguage();\n  const t = translations[language].storefront;\n  const isRTL = language === 'ar';\n\n  const formatPrice = (price: number | null, priceType: string | null) => {\n    if (!price) return t.contactForPricing;\n    if (priceType === \"free\") return t.free;\n    \n    const formattedPrice = new Intl.NumberFormat(language === 'ar' ? 'ar-SA' : 'en-SA', {\n      style: 'decimal',\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0,\n    }).format(price);\n    \n    if (priceType === \"hourly\") return `${formattedPrice} ${t.sar}${t.hourly}`;\n    if (priceType === \"negotiable\") return `${t.from} ${formattedPrice} ${t.sar}`;\n    return `${formattedPrice} ${t.sar}`;\n  };\n\n  const ArrowIcon = isRTL ? ArrowLeft : ArrowRight;\n\n  return (\n    <Card className=\"glass border-white/5 overflow-hidden hover-glow transition-all duration-300 h-full flex flex-col group\" data-testid={`card-service-${service.id}`}>\n      <div className=\"relative\">\n        {service.imageUrl ? (\n          <img\n            src={service.imageUrl}\n            alt={service.title}\n            className=\"w-full h-40 object-cover group-hover:scale-105 transition-transform duration-500\"\n          />\n        ) : (\n          <div className=\"w-full h-40 bg-gradient-to-br from-cyan-500/20 to-teal-500/20 flex items-center justify-center\">\n            <Package className=\"h-12 w-12 text-cyan-400/50\" />\n          </div>\n        )}\n        <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent\" />\n        {service.isFeatured && (\n          <Badge className={`absolute top-3 ${isRTL ? 'left-3' : 'right-3'} bg-amber-500/90 border-0 gap-1`}>\n            <Star className=\"h-3 w-3\" />\n            {t.featured}\n          </Badge>\n        )}\n        <div className={`absolute bottom-3 ${isRTL ? 'right-3' : 'left-3'}`}>\n          <Badge variant=\"outline\" className=\"bg-black/40 backdrop-blur-sm border-white/20 text-white text-xs\">\n            {service.category || t.service}\n          </Badge>\n        </div>\n      </div>\n      <CardContent className=\"p-5 flex flex-col flex-1\">\n        <h3 className=\"font-semibold text-base mb-1 line-clamp-1\">{service.title}</h3>\n        <p className={`text-xs text-muted-foreground mb-3 flex items-center gap-1`}>\n          <Building2 className=\"h-3 w-3\" />\n          {service.officeName}\n        </p>\n        <p className=\"text-sm text-muted-foreground line-clamp-2 mb-4 flex-1\">\n          {service.description || (language === 'ar' ? \"     .\" : \"Professional service provided by our partner office.\")}\n        </p>\n        <div className=\"flex items-center justify-between pt-3 border-t border-white/5 mt-auto\">\n          <p className=\"text-lg font-bold text-cyan-400\">{formatPrice(service.price, service.priceType)}</p>\n          <ServiceRequestDialog service={service}>\n            <Button size=\"sm\" className=\"gap-1\" data-testid={`button-request-service-${service.id}`}>\n              {t.requestService} <ArrowIcon className=\"h-3 w-3\" />\n            </Button>\n          </ServiceRequestDialog>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nexport default function Storefront() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [activeCategory, setActiveCategory] = useState(\"all\");\n  const { toast } = useToast();\n  const { language } = useLanguage();\n  const t = translations[language].storefront;\n  const isRTL = language === 'ar';\n\n  const serviceCategories = [\n    { id: \"all\", label: t.allCategories, icon: Package },\n    { id: \"legal\", label: t.legal, icon: FileText },\n    { id: \"administrative\", label: t.administrative, icon: Briefcase },\n    { id: \"support\", label: t.supportCategory, icon: Headphones },\n    { id: \"consulting\", label: t.consulting, icon: Users },\n  ];\n\n  const { data: services = [], isLoading } = useQuery<PublicService[]>({\n    queryKey: [\"/api/public/services\"],\n  });\n\n  const filteredServices = services.filter((service) => {\n    const matchesSearch =\n      service.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      service.description?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      service.officeName.toLowerCase().includes(searchQuery.toLowerCase());\n    const matchesCategory = activeCategory === \"all\" || service.category?.toLowerCase() === activeCategory;\n    return matchesSearch && matchesCategory;\n  });\n\n  const featuredServices = services.filter((s) => s.isFeatured);\n\n  const handleLogin = () => {\n    localStorage.setItem(\"cloudoffice_redirect\", \"/\");\n    window.location.href = \"/api/login\";\n  };\n\n  const formatNumber = (num: number) => {\n    return new Intl.NumberFormat(language === 'ar' ? 'ar-SA' : 'en-SA').format(num);\n  };\n\n  const stats = [\n    { icon: Package, value: formatNumber(services.length), label: t.servicesAvailable },\n    { icon: Building2, value: formatNumber(new Set(services.map((s) => s.officeId)).size), label: t.partnerOffices },\n    { icon: Shield, value: \"100%\", label: t.verifiedPartners },\n    { icon: Clock, value: \"24/7\", label: t.support247 },\n  ];\n\n  const monthlyFeatures = [t.listUnlimitedServices, t.receiveServiceRequests, t.customerMessaging, t.basicAnalytics];\n  const annualFeatures = [t.everythingInMonthly, t.featuredListings, t.prioritySupport, t.advancedAnalytics];\n\n  return (\n    <div className=\"min-h-screen bg-background\" dir={isRTL ? 'rtl' : 'ltr'}>\n      <header className=\"fixed top-0 left-0 right-0 z-50 border-b border-white/5 bg-background/80 backdrop-blur-xl\">\n        <div className=\"container mx-auto px-4 py-3 flex items-center justify-between\">\n          <div className={`flex items-center gap-3`}>\n            <img src={logoUrl} alt=\"CloudOffice\" className=\"h-9 w-9\" />\n            <span className=\"text-lg font-bold gradient-text\">CloudOffice</span>\n          </div>\n          <nav className=\"hidden md:flex items-center gap-6\">\n            <a href=\"#services\" className=\"text-sm text-muted-foreground hover:text-foreground transition-colors\">\n              {t.services}\n            </a>\n            <a href=\"#pricing\" className=\"text-sm text-muted-foreground hover:text-foreground transition-colors\">\n              {t.pricing}\n            </a>\n            <Link href=\"/visitor\" className=\"text-sm text-muted-foreground hover:text-foreground transition-colors\">\n              {t.visitorHub}\n            </Link>\n          </nav>\n          <div className=\"flex items-center gap-3\">\n            <Button size=\"sm\" onClick={handleLogin} className=\"gap-2\" data-testid=\"button-login\">\n              <Zap className=\"h-4 w-4\" />\n              {t.signIn}\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      <section className=\"relative min-h-[70vh] flex items-center justify-center overflow-hidden pt-16\">\n        <div className=\"absolute inset-0 bg-gradient-to-b from-cyan-500/5 via-transparent to-transparent\" />\n        <div className=\"absolute inset-0\">\n          <div className={`absolute top-1/4 ${isRTL ? 'right-1/4' : 'left-1/4'} w-96 h-96 bg-cyan-500/10 rounded-full blur-3xl`} />\n          <div className={`absolute bottom-1/4 ${isRTL ? 'left-1/4' : 'right-1/4'} w-96 h-96 bg-teal-500/10 rounded-full blur-3xl`} />\n        </div>\n\n        <div className=\"relative z-10 container mx-auto px-4 text-center\">\n          <Badge variant=\"outline\" className=\"mb-6 px-4 py-1.5 border-cyan-500/30 bg-cyan-500/10\">\n            <Sparkles className={`h-3 w-3 ${isRTL ? 'ml-2' : 'mr-2'} text-cyan-400`} />\n            <span className=\"text-cyan-400 text-xs\">{t.professionalServices}</span>\n          </Badge>\n\n          <h1 className=\"text-4xl md:text-6xl lg:text-7xl font-bold mb-6 leading-tight\">\n            {t.heroTitle1}\n            <span className=\"block gradient-text\">{t.heroTitle2}</span>\n          </h1>\n\n          <p className=\"text-lg md:text-xl text-muted-foreground max-w-2xl mx-auto mb-8\">\n            {t.heroSubtitle}\n          </p>\n\n          <div className=\"relative max-w-xl mx-auto mb-12\">\n            <div className=\"absolute inset-0 bg-gradient-to-r from-cyan-500/20 to-teal-500/20 rounded-2xl blur-xl\" />\n            <div className=\"relative glass rounded-2xl p-2\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"flex-1 relative\">\n                  <Search className={`absolute ${isRTL ? 'right-4' : 'left-4'} top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground`} />\n                  <Input\n                    type=\"search\"\n                    placeholder={t.searchPlaceholder}\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    className={`${isRTL ? 'pr-12' : 'pl-12'} h-12 bg-transparent border-0 focus-visible:ring-0 text-base`}\n                    data-testid=\"input-search-services\"\n                  />\n                </div>\n                <Button size=\"lg\" className=\"h-12 px-6 gap-2\" data-testid=\"button-search\">\n                  <Search className=\"h-4 w-4\" />\n                  {t.searchButton}\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6 max-w-3xl mx-auto\">\n            {stats.map((stat) => (\n              <div key={stat.label} className=\"text-center\">\n                <div className=\"inline-flex items-center justify-center w-12 h-12 rounded-xl bg-white/5 mb-3\">\n                  <stat.icon className=\"h-6 w-6 text-cyan-400\" />\n                </div>\n                <p className=\"text-2xl font-bold\">{stat.value}</p>\n                <p className=\"text-sm text-muted-foreground\">{stat.label}</p>\n              </div>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      <div className=\"container mx-auto px-4 py-12\">\n        <div className=\"max-w-7xl mx-auto space-y-16\">\n          {featuredServices.length > 0 && (\n            <section>\n              <div className=\"flex items-center justify-between mb-6\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 rounded-xl bg-gradient-to-br from-amber-500 to-orange-500\">\n                    <Star className=\"h-5 w-5 text-white\" />\n                  </div>\n                  <div>\n                    <h2 className=\"text-xl font-semibold\">{t.featuredServices}</h2>\n                    <p className=\"text-sm text-muted-foreground\">{t.featuredServicesDesc}</p>\n                  </div>\n                </div>\n              </div>\n              <ScrollArea className=\"w-full whitespace-nowrap\">\n                <div className={`flex ${isRTL ? 'space-x-reverse' : ''} space-x-4 pb-4`}>\n                  {featuredServices.map((service) => (\n                    <div key={service.id} className=\"w-[320px] shrink-0\">\n                      <ServiceCard service={service} />\n                    </div>\n                  ))}\n                </div>\n                <ScrollBar orientation=\"horizontal\" />\n              </ScrollArea>\n            </section>\n          )}\n\n          <section id=\"services\">\n            <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"p-2 rounded-xl bg-gradient-to-br from-cyan-500 to-teal-500\">\n                  <Package className=\"h-5 w-5 text-white\" />\n                </div>\n                <div>\n                  <h2 className=\"text-xl font-semibold\">{t.allServices}</h2>\n                  <p className=\"text-sm text-muted-foreground\">{t.allServicesDesc}</p>\n                </div>\n              </div>\n\n              <div className=\"flex items-center gap-2 overflow-x-auto pb-2 md:pb-0\">\n                {serviceCategories.map((cat) => (\n                  <Button\n                    key={cat.id}\n                    variant={activeCategory === cat.id ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => setActiveCategory(cat.id)}\n                    className=\"gap-1.5 whitespace-nowrap\"\n                    data-testid={`button-category-${cat.id}`}\n                  >\n                    <cat.icon className=\"h-3.5 w-3.5\" />\n                    {cat.label}\n                  </Button>\n                ))}\n              </div>\n            </div>\n\n            {isLoading ? (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                {Array.from({ length: 8 }).map((_, i) => (\n                  <Card key={i} className=\"glass border-white/5\">\n                    <Skeleton className=\"h-40 rounded-t-lg bg-white/5\" />\n                    <CardContent className=\"p-5 space-y-3\">\n                      <Skeleton className=\"h-5 w-3/4 bg-white/5\" />\n                      <Skeleton className=\"h-4 w-1/2 bg-white/5\" />\n                      <Skeleton className=\"h-4 w-full bg-white/5\" />\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : filteredServices.length > 0 ? (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\n                {filteredServices.map((service) => (\n                  <ServiceCard key={service.id} service={service} />\n                ))}\n              </div>\n            ) : (\n              <Card className=\"glass border-white/5 p-12 text-center\">\n                <Package className=\"h-16 w-16 mx-auto mb-4 text-muted-foreground opacity-30\" />\n                <h3 className=\"text-lg font-semibold mb-2\">{t.noServices}</h3>\n                <p className=\"text-muted-foreground mb-4\">\n                  {searchQuery || activeCategory !== \"all\"\n                    ? t.noServicesDesc\n                    : t.servicesWillAppear}\n                </p>\n                {(searchQuery || activeCategory !== \"all\") && (\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => {\n                      setSearchQuery(\"\");\n                      setActiveCategory(\"all\");\n                    }}\n                  >\n                    {t.clearFilters}\n                  </Button>\n                )}\n              </Card>\n            )}\n          </section>\n\n          <section id=\"pricing\" className=\"py-12\">\n            <div className=\"text-center mb-12\">\n              <Badge variant=\"outline\" className=\"mb-4 px-4 py-1.5 border-cyan-500/30 bg-cyan-500/10\">\n                <span className=\"text-cyan-400 text-xs\">{t.forOfficePartners}</span>\n              </Badge>\n              <h2 className=\"text-3xl font-bold mb-4\">{t.partnerWithUs}</h2>\n              <p className=\"text-muted-foreground max-w-lg mx-auto\">\n                {t.partnerDescription}\n              </p>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 max-w-3xl mx-auto\">\n              <Card className=\"glass border-white/5 p-8 relative overflow-hidden\">\n                <div className={`absolute top-0 ${isRTL ? 'left-0' : 'right-0'} w-32 h-32 bg-gradient-to-br from-cyan-500/10 to-transparent rounded-full -translate-y-1/2 ${isRTL ? '-translate-x-1/2' : 'translate-x-1/2'}`} />\n                <h3 className=\"text-xl font-semibold mb-2\">{t.monthly}</h3>\n                <p className=\"text-muted-foreground text-sm mb-6\">{t.perfectForStarting}</p>\n                <p className=\"text-4xl font-bold mb-1\">\n                  {language === 'ar' ? '' : '499'} <span className=\"text-lg font-normal text-muted-foreground\">{t.sar}</span>\n                </p>\n                <p className=\"text-sm text-muted-foreground mb-6\">{t.perMonth}</p>\n                <ul className=\"space-y-3 mb-8\">\n                  {monthlyFeatures.map((feature) => (\n                    <li key={feature} className=\"flex items-center gap-2 text-sm\">\n                      <div className=\"w-5 h-5 rounded-full bg-cyan-500/10 flex items-center justify-center\">\n                        <Check className=\"h-3 w-3 text-cyan-400\" />\n                      </div>\n                      {feature}\n                    </li>\n                  ))}\n                </ul>\n                <Button className=\"w-full\" variant=\"outline\" onClick={handleLogin}>\n                  {t.getStarted}\n                </Button>\n              </Card>\n\n              <Card className=\"glass border-cyan-500/30 p-8 relative overflow-hidden\">\n                <div className={`absolute top-0 ${isRTL ? 'left-0' : 'right-0'} w-32 h-32 bg-gradient-to-br from-cyan-500/20 to-teal-500/10 rounded-full -translate-y-1/2 ${isRTL ? '-translate-x-1/2' : 'translate-x-1/2'}`} />\n                <Badge className={`absolute top-4 ${isRTL ? 'left-4' : 'right-4'} bg-cyan-500`}>{t.bestValue}</Badge>\n                <h3 className=\"text-xl font-semibold mb-2\">{t.annual}</h3>\n                <p className=\"text-muted-foreground text-sm mb-6\">{t.saveWithYearly}</p>\n                <p className=\"text-4xl font-bold mb-1\">\n                  {language === 'ar' ? '' : '3,000'} <span className=\"text-lg font-normal text-muted-foreground\">{t.sar}</span>\n                </p>\n                <p className=\"text-sm text-muted-foreground mb-6\">{t.perYear}</p>\n                <ul className=\"space-y-3 mb-8\">\n                  {annualFeatures.map((feature) => (\n                    <li key={feature} className=\"flex items-center gap-2 text-sm\">\n                      <div className=\"w-5 h-5 rounded-full bg-cyan-500/10 flex items-center justify-center\">\n                        <Check className=\"h-3 w-3 text-cyan-400\" />\n                      </div>\n                      {feature}\n                    </li>\n                  ))}\n                </ul>\n                <Button className=\"w-full\" onClick={handleLogin}>\n                  {t.getStarted}\n                </Button>\n              </Card>\n            </div>\n\n            <div className=\"mt-12 text-center\">\n              <Card className=\"glass border-white/5 p-6 max-w-2xl mx-auto\">\n                <div className={`flex items-center gap-4 ${isRTL ? 'flex-row-reverse text-right' : 'text-left'}`}>\n                  <div className=\"p-3 rounded-xl bg-gradient-to-br from-purple-500/20 to-pink-500/20\">\n                    <Sparkles className=\"h-6 w-6 text-purple-400\" />\n                  </div>\n                  <div className=\"flex-1\">\n                    <h4 className=\"font-semibold mb-1\">{t.advertising}</h4>\n                    <p className=\"text-sm text-muted-foreground\">{t.advertisingDesc}</p>\n                  </div>\n                  <div className={isRTL ? 'text-left' : 'text-right'}>\n                    <p className=\"text-2xl font-bold text-purple-400\">{language === 'ar' ? '' : '500'} {t.sar}</p>\n                    <p className=\"text-xs text-muted-foreground\">{t.threeDayPlacement}</p>\n                  </div>\n                </div>\n              </Card>\n            </div>\n          </section>\n        </div>\n      </div>\n\n      <footer className=\"border-t border-white/5 bg-background/50 py-12\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"flex flex-col md:flex-row items-center justify-between gap-6\">\n            <div className=\"flex items-center gap-3\">\n              <img src={logoUrl} alt=\"CloudOffice\" className=\"h-8 w-8\" />\n              <span className=\"font-semibold\">CloudOffice</span>\n            </div>\n            <div className=\"flex items-center gap-6 text-sm text-muted-foreground\">\n              <a href=\"#services\" className=\"hover:text-foreground transition-colors\">\n                {t.services}\n              </a>\n              <a href=\"#pricing\" className=\"hover:text-foreground transition-colors\">\n                {t.pricing}\n              </a>\n              <Link href=\"/visitor\" className=\"hover:text-foreground transition-colors\">\n                {t.visitorHub}\n              </Link>\n            </div>\n            <div className=\"flex items-center gap-4\">\n              <Button variant=\"ghost\" size=\"icon\" className=\"h-9 w-9\">\n                <Mail className=\"h-4 w-4\" />\n              </Button>\n              <Button variant=\"ghost\" size=\"icon\" className=\"h-9 w-9\">\n                <Phone className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n          <div className=\"mt-8 pt-8 border-t border-white/5 text-center text-sm text-muted-foreground\">\n            <p>&copy; {new Date().getFullYear()} CloudOffice. {t.allRightsReserved}</p>\n          </div>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","path":null,"size_bytes":28227,"size_tokens":null},"client/src/pages/Subscription.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Label } from \"@/components/ui/label\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\nimport { \n  Check, \n  CreditCard, \n  Smartphone, \n  Building2,\n  ArrowRight,\n  ArrowLeft,\n  Loader2,\n  Shield,\n  Zap,\n  Users,\n  FileText,\n  BarChart3,\n  MessageSquare,\n  Calendar,\n  Briefcase,\n  Monitor,\n  Mail,\n  Video,\n  Bell,\n  Globe,\n  Headphones,\n  Lock,\n  Palette\n} from \"lucide-react\";\nimport { SiApplepay, SiVisa } from \"react-icons/si\";\nimport type { Subscription } from \"@shared/schema\";\n\nconst ADD_ON_SERVICES = [\n  { key: \"advanced_analytics\", nameKey: \"advancedAnalytics\", icon: BarChart3, descKey: \"advancedAnalyticsDesc\" },\n  { key: \"priority_support\", nameKey: \"prioritySupport\", icon: Zap, descKey: \"prioritySupportDesc\" },\n  { key: \"team_collaboration\", nameKey: \"teamCollaboration\", icon: Users, descKey: \"teamCollaborationDesc\" },\n  { key: \"document_management\", nameKey: \"documentManagement\", icon: FileText, descKey: \"documentManagementDesc\" },\n  { key: \"video_conferencing\", nameKey: \"videoConferencing\", icon: MessageSquare, descKey: \"videoConferencingDesc\" },\n  { key: \"calendar_sync\", nameKey: \"calendarIntegration\", icon: Calendar, descKey: \"calendarIntegrationDesc\" },\n  { key: \"hr_tools\", nameKey: \"hrManagement\", icon: Briefcase, descKey: \"hrManagementDesc\" },\n];\n\nconst PAYMENT_METHODS = [\n  { key: \"apple_pay\", nameKey: \"applePay\", icon: SiApplepay, descKey: \"applePayDesc\" },\n  { key: \"visa\", nameKey: \"visa\", icon: SiVisa, descKey: \"visaDesc\" },\n  { key: \"credit_card\", nameKey: \"creditCard\", icon: CreditCard, descKey: \"creditCardDesc\" },\n];\n\nexport default function Subscription() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const { language } = useLanguage();\n  const t = translations[language];\n  const isRTL = language === 'ar';\n  \n  const [billingCycle, setBillingCycle] = useState<\"monthly\" | \"yearly\">(\"monthly\");\n  const [selectedAddOns, setSelectedAddOns] = useState<string[]>([]);\n  const [paymentMethod, setPaymentMethod] = useState<string>(\"apple_pay\");\n  const [step, setStep] = useState<1 | 2>(1);\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat(language === 'ar' ? 'ar-SA' : 'en-SA', {\n      style: 'decimal',\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0,\n    }).format(amount);\n  };\n\n  const getPricing = () => ({\n    monthly: {\n      base: 499,\n      addOn: 50,\n      label: t.subscription?.monthly || \"Monthly\",\n      period: t.subscription?.perMonth || \"/month\",\n      savings: null\n    },\n    yearly: {\n      base: 3000,\n      addOn: 200,\n      label: t.subscription?.yearly || \"Yearly\",\n      period: t.subscription?.perYear || \"/year\",\n      savings: `${t.subscription?.save || \"Save\"} 2,988 SAR`\n    }\n  });\n\n  const getAddOnServiceName = (nameKey: string) => {\n    const names: Record<string, { en: string; ar: string }> = {\n      advancedAnalytics: { en: \"Advanced Analytics\", ar: \" \" },\n      prioritySupport: { en: \"Priority Support\", ar: \" \" },\n      teamCollaboration: { en: \"Team Collaboration Tools\", ar: \"  \" },\n      documentManagement: { en: \"Document Management\", ar: \" \" },\n      videoConferencing: { en: \"Video Conferencing\", ar: \" \" },\n      calendarIntegration: { en: \"Calendar Integration\", ar: \" \" },\n      hrManagement: { en: \"HR Management\", ar: \"  \" },\n    };\n    return names[nameKey]?.[language] || names[nameKey]?.en || nameKey;\n  };\n\n  const getAddOnServiceDesc = (descKey: string) => {\n    const descs: Record<string, { en: string; ar: string }> = {\n      advancedAnalyticsDesc: { en: \"Detailed reports and insights\", ar: \"  \" },\n      prioritySupportDesc: { en: \"24/7 dedicated support team\", ar: \"     \" },\n      teamCollaborationDesc: { en: \"Enhanced team features\", ar: \"  \" },\n      documentManagementDesc: { en: \"Secure file storage\", ar: \"  \" },\n      videoConferencingDesc: { en: \"HD video meetings\", ar: \"   \" },\n      calendarIntegrationDesc: { en: \"Sync with external calendars\", ar: \"   \" },\n      hrManagementDesc: { en: \"Employee management tools\", ar: \"  \" },\n    };\n    return descs[descKey]?.[language] || descs[descKey]?.en || descKey;\n  };\n\n  const getPaymentMethodName = (nameKey: string) => {\n    const names: Record<string, { en: string; ar: string }> = {\n      applePay: { en: \"Apple Pay\", ar: \"Apple Pay\" },\n      visa: { en: \"Visa\", ar: \"\" },\n      creditCard: { en: \"Credit Card\", ar: \" \" },\n    };\n    return names[nameKey]?.[language] || names[nameKey]?.en || nameKey;\n  };\n\n  const getPaymentMethodDesc = (descKey: string) => {\n    const descs: Record<string, { en: string; ar: string }> = {\n      applePayDesc: { en: \"Fast and secure\", ar: \" \" },\n      visaDesc: { en: \"Credit/Debit card\", ar: \" /\" },\n      creditCardDesc: { en: \"Mastercard, Mada, etc.\", ar: \"  .\" },\n    };\n    return descs[descKey]?.[language] || descs[descKey]?.en || descKey;\n  };\n\n  const { data: existingSubscription, isLoading: checkingSubscription } = useQuery<Subscription | null>({\n    queryKey: ['/api/subscriptions/active'],\n  });\n\n  const createSubscription = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest('POST', '/api/subscriptions', data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/subscriptions/active'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/subscriptions/current'] });\n      toast({\n        title: language === 'ar' ? \"  \" : \"Subscription Activated\",\n        description: language === 'ar' \n          ? \"   .    ...\"\n          : \"Your office subscription is now active. Setting up your workspace...\",\n      });\n      setTimeout(() => {\n        setLocation(\"/departments\");\n      }, 1500);\n    },\n    onError: (error: any) => {\n      toast({\n        title: language === 'ar' ? \" \" : \"Subscription Failed\",\n        description: error.message || (language === 'ar' \n          ? \"  .    .\"\n          : \"Failed to process subscription. Please try again.\"),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const pricing = getPricing()[billingCycle];\n  const basePrice = pricing.base;\n  const addOnPrice = selectedAddOns.length * (billingCycle === \"monthly\" ? 50 : 200);\n  const totalPrice = basePrice + addOnPrice;\n\n  const toggleAddOn = (key: string) => {\n    setSelectedAddOns(prev => \n      prev.includes(key) \n        ? prev.filter(k => k !== key)\n        : [...prev, key]\n    );\n  };\n\n  const handleSubscribe = () => {\n    createSubscription.mutate({\n      billingCycle,\n      basePrice,\n      addOnCount: selectedAddOns.length,\n      addOnPrice,\n      totalPrice,\n      currency: \"SAR\",\n      paymentMethod,\n      addOnServices: selectedAddOns,\n    });\n  };\n\n  const ArrowIcon = isRTL ? ArrowLeft : ArrowRight;\n  const iconMarginStart = isRTL ? \"mr-2\" : \"ml-2\";\n  const iconMarginEnd = isRTL ? \"ml-2\" : \"mr-2\";\n\n  if (checkingSubscription) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\" dir={isRTL ? 'rtl' : 'ltr'}>\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (existingSubscription) {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center p-4\" dir={isRTL ? 'rtl' : 'ltr'}>\n        <Card className=\"max-w-md w-full text-center\">\n          <CardHeader>\n            <div className=\"w-16 h-16 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center mx-auto mb-4\">\n              <Check className=\"h-8 w-8 text-green-600\" />\n            </div>\n            <CardTitle>{t.subscription?.activeSubscription || \"Already Subscribed\"}</CardTitle>\n            <CardDescription>\n              {t.subscription?.alreadySubscribed || \"You already have an active subscription. Continue to your workspace.\"}\n            </CardDescription>\n          </CardHeader>\n          <CardFooter className=\"justify-center\">\n            <Button onClick={() => setLocation(\"/departments\")} data-testid=\"button-go-to-departments\">\n              {language === 'ar' ? \"  \" : \"Go to Departments\"}\n              <ArrowIcon className={`h-4 w-4 ${iconMarginStart}`} />\n            </Button>\n          </CardFooter>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\" dir={isRTL ? 'rtl' : 'ltr'}>\n      <header className=\"sticky top-0 z-50 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n        <div className=\"container mx-auto flex items-center justify-between h-16 px-4\">\n          <div className=\"flex items-center gap-2\">\n            <Building2 className=\"h-8 w-8 text-primary\" />\n            <span className=\"font-semibold text-xl\">CloudOffice</span>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Badge variant=\"outline\" className=\"gap-1\">\n              <Shield className=\"h-3 w-3\" />\n              {language === 'ar' ? \" \" : \"Secure Checkout\"}\n            </Badge>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"container mx-auto p-4 md:p-6 max-w-6xl\">\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-2xl md:text-3xl font-bold mb-2\">\n            {t.subscription?.title || \"Choose Your Subscription Plan\"}\n          </h1>\n          <p className=\"text-muted-foreground\">\n            {t.subscription?.subtitle || \"Select a billing cycle and customize your office with add-on services\"}\n          </p>\n        </div>\n\n        <div className=\"flex items-center justify-center gap-2 mb-8\">\n          <div className={`flex items-center gap-2 px-4 py-2 rounded-full ${step >= 1 ? 'bg-primary text-primary-foreground' : 'bg-muted text-muted-foreground'}`}>\n            <span className=\"w-6 h-6 rounded-full bg-primary-foreground/20 flex items-center justify-center text-sm font-medium\">1</span>\n            <span className=\"text-sm font-medium\">{t.subscription?.step1 || \"Plan Selection\"}</span>\n          </div>\n          <div className=\"w-8 h-0.5 bg-muted\" />\n          <div className={`flex items-center gap-2 px-4 py-2 rounded-full ${step >= 2 ? 'bg-primary text-primary-foreground' : 'bg-muted text-muted-foreground'}`}>\n            <span className=\"w-6 h-6 rounded-full bg-primary-foreground/20 flex items-center justify-center text-sm font-medium\">2</span>\n            <span className=\"text-sm font-medium\">{t.subscription?.step2 || \"Payment\"}</span>\n          </div>\n        </div>\n\n        {step === 1 && (\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n            <div className=\"lg:col-span-2 space-y-6\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-lg\">\n                    {language === 'ar' ? \"  \" : \"Select Billing Cycle\"}\n                  </CardTitle>\n                  <CardDescription>\n                    {language === 'ar' ? \"   \" : \"Choose how often you'd like to be billed\"}\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <RadioGroup \n                    value={billingCycle} \n                    onValueChange={(v) => setBillingCycle(v as \"monthly\" | \"yearly\")}\n                    className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\"\n                  >\n                    <div className=\"relative\">\n                      <RadioGroupItem value=\"monthly\" id=\"monthly\" className=\"peer sr-only\" />\n                      <Label \n                        htmlFor=\"monthly\" \n                        className=\"flex flex-col items-center justify-between rounded-lg border-2 border-muted bg-popover p-4 hover-elevate cursor-pointer peer-data-[state=checked]:border-primary [&:has([data-state=checked])]:border-primary\"\n                        data-testid=\"radio-monthly\"\n                      >\n                        <div className=\"text-center\">\n                          <p className=\"text-2xl font-bold\">{formatCurrency(499)} <span className=\"text-sm font-normal text-muted-foreground\">SAR</span></p>\n                          <p className=\"text-muted-foreground text-sm\">{t.subscription?.perMonth || \"per month\"}</p>\n                        </div>\n                      </Label>\n                    </div>\n                    \n                    <div className=\"relative\">\n                      <RadioGroupItem value=\"yearly\" id=\"yearly\" className=\"peer sr-only\" />\n                      <Label \n                        htmlFor=\"yearly\" \n                        className=\"flex flex-col items-center justify-between rounded-lg border-2 border-muted bg-popover p-4 hover-elevate cursor-pointer peer-data-[state=checked]:border-primary [&:has([data-state=checked])]:border-primary\"\n                        data-testid=\"radio-yearly\"\n                      >\n                        <Badge className={`absolute -top-2 ${isRTL ? 'left-2' : 'right-2'}`} variant=\"default\">\n                          {language === 'ar' ? \" \" : \"Best Value\"}\n                        </Badge>\n                        <div className=\"text-center\">\n                          <p className=\"text-2xl font-bold\">{formatCurrency(3000)} <span className=\"text-sm font-normal text-muted-foreground\">SAR</span></p>\n                          <p className=\"text-muted-foreground text-sm\">{t.subscription?.perYear || \"per year\"}</p>\n                          <p className=\"text-xs text-green-600 dark:text-green-400 mt-1\">\n                            {t.subscription?.save || \"Save\"} {formatCurrency(2988)} SAR\n                          </p>\n                        </div>\n                      </Label>\n                    </div>\n                  </RadioGroup>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-lg\">{t.subscription?.addOns || \"Add-On Services\"}</CardTitle>\n                  <CardDescription>\n                    {language === 'ar' ? \"   \" : \"Enhance your office with additional features\"}\n                    <Badge variant=\"secondary\" className={isRTL ? \"mr-2\" : \"ml-2\"}>\n                      {billingCycle === \"monthly\" \n                        ? (language === 'ar' ? \"50 /  \" : \"50 SAR/month each\")\n                        : (language === 'ar' ? \"200 /  \" : \"200 SAR/year each\")}\n                    </Badge>\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n                    {ADD_ON_SERVICES.map((service) => (\n                      <div\n                        key={service.key}\n                        className={`flex items-start gap-3 p-3 rounded-lg border cursor-pointer hover-elevate transition-colors ${\n                          selectedAddOns.includes(service.key) \n                            ? 'border-primary bg-primary/5' \n                            : 'border-border'\n                        }`}\n                        onClick={() => toggleAddOn(service.key)}\n                        data-testid={`addon-${service.key}`}\n                      >\n                        <Checkbox \n                          checked={selectedAddOns.includes(service.key)}\n                          onCheckedChange={() => toggleAddOn(service.key)}\n                          className=\"mt-0.5\"\n                        />\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center gap-2\">\n                            <service.icon className=\"h-4 w-4 text-primary\" />\n                            <span className=\"font-medium text-sm\">{getAddOnServiceName(service.nameKey)}</span>\n                          </div>\n                          <p className=\"text-xs text-muted-foreground mt-0.5\">{getAddOnServiceDesc(service.descKey)}</p>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n\n            <div className=\"lg:col-span-1\">\n              <Card className=\"sticky top-24\">\n                <CardHeader>\n                  <CardTitle className=\"text-lg\">\n                    {language === 'ar' ? \" \" : \"Order Summary\"}\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-muted-foreground\">\n                      {t.subscription?.basePlan || \"Base Plan\"} ({pricing.label})\n                    </span>\n                    <span className=\"font-medium\">{formatCurrency(basePrice)} SAR</span>\n                  </div>\n                  \n                  {selectedAddOns.length > 0 && (\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-muted-foreground\">\n                        {t.subscription?.addOns || \"Add-ons\"} ({selectedAddOns.length})\n                      </span>\n                      <span className=\"font-medium\">{formatCurrency(addOnPrice)} SAR</span>\n                    </div>\n                  )}\n                  \n                  <Separator />\n                  \n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"font-semibold\">{t.subscription?.totalPrice || \"Total\"}</span>\n                    <div className={isRTL ? \"text-left\" : \"text-right\"}>\n                      <p className=\"text-2xl font-bold text-primary\">{formatCurrency(totalPrice)} SAR</p>\n                      <p className=\"text-xs text-muted-foreground\">{pricing.period}</p>\n                    </div>\n                  </div>\n\n                  {billingCycle === \"yearly\" && (\n                    <div className=\"bg-green-50 dark:bg-green-900/20 p-3 rounded-lg\">\n                      <p className=\"text-sm text-green-700 dark:text-green-400 flex items-center gap-2\">\n                        <Check className=\"h-4 w-4\" />\n                        {language === 'ar' \n                          ? `  ${formatCurrency(2988)}    `\n                          : `You're saving ${formatCurrency(2988)} SAR with yearly billing`}\n                      </p>\n                    </div>\n                  )}\n                </CardContent>\n                <CardFooter>\n                  <Button \n                    className=\"w-full\" \n                    size=\"lg\"\n                    onClick={() => setStep(2)}\n                    data-testid=\"button-continue-to-payment\"\n                  >\n                    {t.subscription?.continue || \"Continue to Payment\"}\n                    <ArrowIcon className={`h-4 w-4 ${iconMarginStart}`} />\n                  </Button>\n                </CardFooter>\n              </Card>\n            </div>\n          </div>\n        )}\n\n        {step === 2 && (\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n            <div className=\"lg:col-span-2\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-lg\">{t.subscription?.paymentMethod || \"Select Payment Method\"}</CardTitle>\n                  <CardDescription>\n                    {language === 'ar' ? \"  \" : \"Choose how you'd like to pay\"}\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <RadioGroup \n                    value={paymentMethod} \n                    onValueChange={setPaymentMethod}\n                    className=\"space-y-3\"\n                  >\n                    {PAYMENT_METHODS.map((method) => (\n                      <div key={method.key} className=\"relative\">\n                        <RadioGroupItem value={method.key} id={method.key} className=\"peer sr-only\" />\n                        <Label \n                          htmlFor={method.key} \n                          className=\"flex items-center gap-4 rounded-lg border-2 border-muted bg-popover p-4 hover-elevate cursor-pointer peer-data-[state=checked]:border-primary [&:has([data-state=checked])]:border-primary\"\n                          data-testid={`payment-${method.key}`}\n                        >\n                          <div className=\"w-12 h-12 rounded-lg bg-muted flex items-center justify-center\">\n                            <method.icon className=\"h-6 w-6\" />\n                          </div>\n                          <div className=\"flex-1\">\n                            <p className=\"font-medium\">{getPaymentMethodName(method.nameKey)}</p>\n                            <p className=\"text-sm text-muted-foreground\">{getPaymentMethodDesc(method.descKey)}</p>\n                          </div>\n                          {paymentMethod === method.key && (\n                            <Check className=\"h-5 w-5 text-primary\" />\n                          )}\n                        </Label>\n                      </div>\n                    ))}\n                  </RadioGroup>\n\n                  <div className=\"mt-6 p-4 bg-muted/50 rounded-lg\">\n                    <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                      <Shield className=\"h-4 w-4\" />\n                      <span>\n                        {language === 'ar' \n                          ? \"     \"\n                          : \"Your payment information is encrypted and secure\"}\n                      </span>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <div className=\"mt-4\">\n                <Button \n                  variant=\"ghost\" \n                  onClick={() => setStep(1)}\n                  data-testid=\"button-back-to-plan\"\n                >\n                  {t.subscription?.back || \"Back to Plan Selection\"}\n                </Button>\n              </div>\n            </div>\n\n            <div className=\"lg:col-span-1\">\n              <Card className=\"sticky top-24\">\n                <CardHeader>\n                  <CardTitle className=\"text-lg\">\n                    {language === 'ar' ? \" \" : \"Order Summary\"}\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-muted-foreground\">\n                      {t.subscription?.basePlan || \"Base Plan\"} ({pricing.label})\n                    </span>\n                    <span className=\"font-medium\">{formatCurrency(basePrice)} SAR</span>\n                  </div>\n                  \n                  {selectedAddOns.length > 0 && (\n                    <>\n                      <div className=\"flex justify-between items-center\">\n                        <span className=\"text-muted-foreground\">\n                          {t.subscription?.addOns || \"Add-ons\"} ({selectedAddOns.length})\n                        </span>\n                        <span className=\"font-medium\">{formatCurrency(addOnPrice)} SAR</span>\n                      </div>\n                      <div className={isRTL ? \"pr-4 space-y-1\" : \"pl-4 space-y-1\"}>\n                        {selectedAddOns.map(key => {\n                          const service = ADD_ON_SERVICES.find(s => s.key === key);\n                          return (\n                            <p key={key} className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                              <Check className=\"h-3 w-3 text-green-500\" />\n                              {service ? getAddOnServiceName(service.nameKey) : key}\n                            </p>\n                          );\n                        })}\n                      </div>\n                    </>\n                  )}\n                  \n                  <Separator />\n                  \n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"font-semibold\">{t.subscription?.totalPrice || \"Total\"}</span>\n                    <div className={isRTL ? \"text-left\" : \"text-right\"}>\n                      <p className=\"text-2xl font-bold text-primary\">{formatCurrency(totalPrice)} SAR</p>\n                      <p className=\"text-xs text-muted-foreground\">{pricing.period}</p>\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                    <span>{language === 'ar' ? \" :\" : \"Payment via:\"}</span>\n                    <Badge variant=\"secondary\">\n                      {PAYMENT_METHODS.find(m => m.key === paymentMethod) \n                        ? getPaymentMethodName(PAYMENT_METHODS.find(m => m.key === paymentMethod)!.nameKey)\n                        : paymentMethod}\n                    </Badge>\n                  </div>\n                </CardContent>\n                <CardFooter>\n                  <Button \n                    className=\"w-full\" \n                    size=\"lg\"\n                    onClick={handleSubscribe}\n                    disabled={createSubscription.isPending}\n                    data-testid=\"button-subscribe\"\n                  >\n                    {createSubscription.isPending ? (\n                      <>\n                        <Loader2 className={`h-4 w-4 animate-spin ${iconMarginEnd}`} />\n                        {t.subscription?.processing || \"Processing...\"}\n                      </>\n                    ) : (\n                      <>\n                        {t.subscription?.subscribe || \"Subscribe Now\"}\n                        <ArrowIcon className={`h-4 w-4 ${iconMarginStart}`} />\n                      </>\n                    )}\n                  </Button>\n                </CardFooter>\n              </Card>\n            </div>\n          </div>\n        )}\n\n        {/* Office Features Section */}\n        <section className=\"mt-16 mb-8\" data-testid=\"section-office-features\">\n          <div className=\"text-center mb-8\">\n            <h2 className=\"text-xl md:text-2xl font-bold mb-2\" data-testid=\"text-features-title\">\n              {t.subscription?.officeFeatures || \"Your Virtual Office Features\"}\n            </h2>\n            <p className=\"text-muted-foreground\" data-testid=\"text-features-subtitle\">\n              {t.subscription?.officeFeaturesSubtitle || \"Subscribe now and get all these features for your office\"}\n            </p>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n            {[\n              { icon: Building2, titleKey: \"featureVirtualOffice\", descKey: \"featureVirtualOfficeDesc\" },\n              { icon: Monitor, titleKey: \"featureDashboard\", descKey: \"featureDashboardDesc\" },\n              { icon: Users, titleKey: \"featureTeam\", descKey: \"featureTeamDesc\" },\n              { icon: FileText, titleKey: \"featureTasks\", descKey: \"featureTasksDesc\" },\n              { icon: Mail, titleKey: \"featureMail\", descKey: \"featureMailDesc\" },\n              { icon: MessageSquare, titleKey: \"featureChat\", descKey: \"featureChatDesc\" },\n              { icon: Video, titleKey: \"featureVideo\", descKey: \"featureVideoDesc\" },\n              { icon: Bell, titleKey: \"featureNotifications\", descKey: \"featureNotificationsDesc\" },\n              { icon: Globe, titleKey: \"featureStorefront\", descKey: \"featureStorefrontDesc\" },\n              { icon: Headphones, titleKey: \"featureSupport\", descKey: \"featureSupportDesc\" },\n              { icon: Lock, titleKey: \"featureAccess\", descKey: \"featureAccessDesc\" },\n              { icon: Palette, titleKey: \"featureCustomize\", descKey: \"featureCustomizeDesc\" }\n            ].map((feature, index) => (\n              <Card key={index} className=\"hover-elevate\" data-testid={`card-feature-${index}`}>\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-start gap-3\">\n                    <div className=\"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center shrink-0\">\n                      <feature.icon className=\"h-5 w-5 text-primary\" />\n                    </div>\n                    <div>\n                      <h3 className=\"font-medium text-sm\" data-testid={`text-feature-title-${index}`}>\n                        {(t.subscription as any)?.[feature.titleKey] || feature.titleKey}\n                      </h3>\n                      <p className=\"text-xs text-muted-foreground mt-0.5\" data-testid={`text-feature-desc-${index}`}>\n                        {(t.subscription as any)?.[feature.descKey] || feature.descKey}\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n\n          <div className=\"mt-8 text-center\">\n            <Card className=\"max-w-2xl mx-auto bg-primary/5 border-primary/20\" data-testid=\"card-subscribe-first\">\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-center gap-3 mb-3\">\n                  <Shield className=\"h-6 w-6 text-primary\" />\n                  <h3 className=\"font-semibold text-lg\" data-testid=\"text-subscribe-first-title\">\n                    {t.subscription?.subscribeFirst || \"Subscribe First, Then Create Your Office\"}\n                  </h3>\n                </div>\n                <p className=\"text-muted-foreground text-sm\" data-testid=\"text-subscribe-first-desc\">\n                  {t.subscription?.subscribeFirstDesc || \"After activating your subscription, you'll be able to create your virtual office, add your services, and fully manage your team.\"}\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n        </section>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":31417,"size_tokens":null},"client/src/pages/N8nSettings.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { ArrowLeft, Zap, Info, ExternalLink, Loader2, Check, AlertCircle, Webhook, Key, Settings2 } from \"lucide-react\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport type { N8nSettings } from \"@shared/schema\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\nexport default function N8nSettingsPage() {\n  const { language } = useLanguage();\n  const t = translations[language];\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  \n  const { data: settings, isLoading } = useQuery<N8nSettings>({\n    queryKey: ['/api/n8n/settings'],\n  });\n\n  const [webhookUrl, setWebhookUrl] = useState('');\n  const [apiKey, setApiKey] = useState('');\n  const [isEnabled, setIsEnabled] = useState(false);\n\n  // Sync state when settings load\n  useEffect(() => {\n    if (settings) {\n      setWebhookUrl(settings.webhookUrl || '');\n      setApiKey(settings.apiKey || '');\n      setIsEnabled(settings.isEnabled || false);\n    }\n  }, [settings]);\n\n  const updateSettings = useMutation({\n    mutationFn: async (data: { webhookUrl?: string; apiKey?: string; isEnabled?: boolean }) => {\n      return apiRequest('PUT', '/api/n8n/settings', data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/n8n/settings'] });\n      toast({\n        title: t.n8n?.settingsSaved || \"Settings saved\",\n        description: t.n8n?.settingsSavedDesc || \"Your n8n integration settings have been updated.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: t.n8n?.error || \"Error\",\n        description: error.message || (t.n8n?.failedSave || \"Failed to save settings\"),\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSave = () => {\n    updateSettings.mutate({ webhookUrl, apiKey, isEnabled });\n  };\n\n  const handleToggle = (checked: boolean) => {\n    setIsEnabled(checked);\n    updateSettings.mutate({ webhookUrl, apiKey, isEnabled: checked });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  const iconMargin = language === 'ar' ? 'ml-2' : 'mr-2';\n\n  return (\n    <div className=\"p-6 space-y-6 max-w-4xl mx-auto\" dir={language === 'ar' ? 'rtl' : 'ltr'}>\n      <div className=\"flex items-center gap-4\">\n        <Button \n          variant=\"ghost\" \n          size=\"icon\" \n          onClick={() => setLocation('/dashboard')}\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"h-5 w-5\" />\n        </Button>\n        <div>\n          <h1 className=\"text-2xl font-bold\" data-testid=\"text-page-title\">{t.n8n?.title || \"n8n Workflow Automation\"}</h1>\n          <p className=\"text-muted-foreground\">{t.n8n?.subtitle || \"Connect your n8n instance to automate tasks with AI\"}</p>\n        </div>\n      </div>\n\n      <div className=\"grid gap-6\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-4\">\n            <div className=\"space-y-1\">\n              <CardTitle className=\"flex items-center gap-2\">\n                <Zap className=\"h-5 w-5 text-primary\" />\n                {t.n8n?.integrationStatus || \"Integration Status\"}\n              </CardTitle>\n              <CardDescription>\n                {t.n8n?.statusDesc || \"Enable or disable the n8n workflow integration\"}\n              </CardDescription>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              {isEnabled ? (\n                <span className=\"flex items-center gap-1 text-sm text-green-600\">\n                  <Check className=\"h-4 w-4\" />\n                  {t.n8n?.active || \"Active\"}\n                </span>\n              ) : (\n                <span className=\"flex items-center gap-1 text-sm text-muted-foreground\">\n                  <AlertCircle className=\"h-4 w-4\" />\n                  {t.n8n?.inactive || \"Inactive\"}\n                </span>\n              )}\n              <Switch\n                checked={isEnabled}\n                onCheckedChange={handleToggle}\n                data-testid=\"switch-enable-integration\"\n              />\n            </div>\n          </CardHeader>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Webhook className=\"h-5 w-5\" />\n              {t.n8n?.webhookConfig || \"Webhook Configuration\"}\n            </CardTitle>\n            <CardDescription>\n              {t.n8n?.webhookConfigDesc || \"Configure your n8n webhook endpoint to receive task automation requests\"}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"webhook-url\">{t.n8n?.webhookUrl || \"Webhook URL\"}</Label>\n              <Input\n                id=\"webhook-url\"\n                placeholder={t.n8n?.webhookUrlPlaceholder || \"https://your-n8n-instance.com/webhook/xxx\"}\n                value={webhookUrl}\n                onChange={(e) => setWebhookUrl(e.target.value)}\n                data-testid=\"input-webhook-url\"\n              />\n              <p className=\"text-sm text-muted-foreground\">\n                {t.n8n?.webhookUrlHint || \"The URL where task data will be sent for AI processing\"}\n              </p>\n            </div>\n            \n            <div className=\"space-y-2\">\n              <Label htmlFor=\"api-key\" className=\"flex items-center gap-2\">\n                <Key className=\"h-4 w-4\" />\n                {t.n8n?.apiKey || \"API Key (Optional)\"}\n              </Label>\n              <Input\n                id=\"api-key\"\n                type=\"password\"\n                placeholder={t.n8n?.apiKeyPlaceholder || \"Enter your API key for authentication\"}\n                value={apiKey}\n                onChange={(e) => setApiKey(e.target.value)}\n                data-testid=\"input-api-key\"\n              />\n              <p className=\"text-sm text-muted-foreground\">\n                {t.n8n?.apiKeyHint || \"Optional API key sent in the X-API-Key header for webhook authentication\"}\n              </p>\n            </div>\n\n            <Button \n              onClick={handleSave} \n              disabled={updateSettings.isPending}\n              data-testid=\"button-save-settings\"\n            >\n              {updateSettings.isPending ? (\n                <>\n                  <Loader2 className={`h-4 w-4 ${iconMargin} animate-spin`} />\n                  {t.n8n?.saving || \"Saving...\"}\n                </>\n              ) : (\n                t.n8n?.saveConfig || \"Save Configuration\"\n              )}\n            </Button>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Settings2 className=\"h-5 w-5\" />\n              {t.n8n?.howItWorks || \"How It Works\"}\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <Alert>\n              <Info className=\"h-4 w-4\" />\n              <AlertTitle>{t.n8n?.workflowOverview || \"Workflow Overview\"}</AlertTitle>\n              <AlertDescription className=\"mt-2 space-y-2\">\n                <ol className=\"list-decimal list-inside space-y-1 text-sm\">\n                  <li>{t.n8n?.step1 || \"Send a task to n8n from the Tasks page\"}</li>\n                  <li>{t.n8n?.step2 || \"Your n8n workflow receives the task details via webhook\"}</li>\n                  <li>{t.n8n?.step3 || \"AI processes the task and generates a suggested completion\"}</li>\n                  <li>{t.n8n?.step4 || \"n8n sends the result back to CloudOffice\"}</li>\n                  <li>{t.n8n?.step5 || \"You review and approve or reject the AI suggestion\"}</li>\n                  <li>{t.n8n?.step6 || \"Approved tasks are marked as completed automatically\"}</li>\n                </ol>\n              </AlertDescription>\n            </Alert>\n\n            <div className=\"bg-muted/50 rounded-lg p-4 space-y-3\">\n              <h4 className=\"font-medium\">{t.n8n?.webhookPayload || \"Webhook Payload Format\"}</h4>\n              <pre className=\"text-xs bg-background p-3 rounded border overflow-x-auto\" dir=\"ltr\">\n{`{\n  \"automationId\": 123,\n  \"taskId\": 456,\n  \"title\": \"Task title\",\n  \"description\": \"Task description\",\n  \"priority\": \"high\",\n  \"dueDate\": \"2024-01-15T00:00:00Z\",\n  \"callbackUrl\": \"https://your-app.replit.app/api/automations/callback\"\n}`}\n              </pre>\n            </div>\n\n            <div className=\"bg-muted/50 rounded-lg p-4 space-y-3\">\n              <h4 className=\"font-medium\">{t.n8n?.expectedCallback || \"Expected Callback Response\"}</h4>\n              <pre className=\"text-xs bg-background p-3 rounded border overflow-x-auto\" dir=\"ltr\">\n{`POST /api/automations/callback\n{\n  \"automationId\": 123,\n  \"aiSuggestion\": \"The AI-generated task completion...\",\n  \"aiMetadata\": { \"model\": \"gpt-4\", \"tokens\": 500 },\n  \"executionId\": \"n8n-execution-id\"\n}`}\n              </pre>\n            </div>\n\n            <Button variant=\"outline\" className=\"w-full\" asChild>\n              <a \n                href=\"https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.webhook/\" \n                target=\"_blank\" \n                rel=\"noopener noreferrer\"\n                data-testid=\"link-n8n-docs\"\n              >\n                <ExternalLink className={`h-4 w-4 ${iconMargin}`} />\n                {t.n8n?.viewDocs || \"View n8n Webhook Documentation\"}\n              </a>\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":10118,"size_tokens":null},"client/src/pages/OfficeServicesShowcase.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ScrollArea, ScrollBar } from \"@/components/ui/scroll-area\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Building2,\n  Plus,\n  Pencil,\n  Trash2,\n  Package,\n  Eye,\n  EyeOff,\n  Star,\n  ExternalLink,\n  Sparkles,\n  Grid3X3,\n  List,\n  Search,\n  Filter,\n  ArrowUpDown,\n  DollarSign,\n  Tag,\n  CheckCircle2,\n  XCircle,\n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Office, OfficeService, InsertOfficeService } from \"@shared/schema\";\n\ntype ViewMode = \"grid\" | \"list\";\ntype SortBy = \"title\" | \"price\" | \"featured\" | \"createdAt\";\n\nfunction ServiceForm({\n  officeId,\n  service,\n  onSuccess,\n  onCancel,\n}: {\n  officeId: number;\n  service?: OfficeService;\n  onSuccess: () => void;\n  onCancel: () => void;\n}) {\n  const { toast } = useToast();\n  const [formData, setFormData] = useState({\n    title: service?.title || '',\n    description: service?.description || '',\n    price: service?.price?.toString() || '',\n    priceType: service?.priceType || 'fixed',\n    category: service?.category || '',\n    imageUrl: service?.imageUrl || '',\n    isFeatured: service?.isFeatured || false,\n    isActive: service?.isActive ?? true,\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: Partial<InsertOfficeService>) => {\n      return await apiRequest('POST', `/api/offices/${officeId}/services`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/offices', officeId, 'services'] });\n      toast({ title: 'Service added successfully' });\n      onSuccess();\n    },\n    onError: (error: Error) => {\n      toast({ title: 'Failed to add service', description: error.message, variant: 'destructive' });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: Partial<InsertOfficeService>) => {\n      return await apiRequest('PATCH', `/api/offices/${officeId}/services/${service!.id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/offices', officeId, 'services'] });\n      toast({ title: 'Service updated successfully' });\n      onSuccess();\n    },\n    onError: (error: Error) => {\n      toast({ title: 'Failed to update service', description: error.message, variant: 'destructive' });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!formData.title.trim()) {\n      toast({ title: 'Service title is required', variant: 'destructive' });\n      return;\n    }\n    \n    let price: number | null = null;\n    if (formData.price) {\n      const parsedPrice = Math.round(parseFloat(formData.price));\n      if (isNaN(parsedPrice) || parsedPrice < 0) {\n        toast({ title: 'Price must be a valid positive number', variant: 'destructive' });\n        return;\n      }\n      price = parsedPrice;\n    }\n    \n    const data = {\n      ...formData,\n      officeId,\n      price,\n    };\n\n    if (service) {\n      updateMutation.mutate(data);\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"title\">Service Title *</Label>\n        <Input\n          id=\"title\"\n          value={formData.title}\n          onChange={(e) => setFormData((prev) => ({ ...prev, title: e.target.value }))}\n          placeholder=\"e.g., Legal Consultation, Website Design\"\n          required\n          data-testid=\"input-service-title\"\n        />\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"description\">Description</Label>\n        <Textarea\n          id=\"description\"\n          value={formData.description}\n          onChange={(e) => setFormData((prev) => ({ ...prev, description: e.target.value }))}\n          placeholder=\"Describe what this service includes...\"\n          rows={3}\n          data-testid=\"input-service-description\"\n        />\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"price\">Price (SAR)</Label>\n          <Input\n            id=\"price\"\n            type=\"number\"\n            value={formData.price}\n            onChange={(e) => setFormData((prev) => ({ ...prev, price: e.target.value }))}\n            placeholder=\"100\"\n            data-testid=\"input-service-price\"\n          />\n        </div>\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"priceType\">Price Type</Label>\n          <Select\n            value={formData.priceType}\n            onValueChange={(value) => setFormData((prev) => ({ ...prev, priceType: value }))}\n          >\n            <SelectTrigger data-testid=\"select-service-pricetype\">\n              <SelectValue placeholder=\"Select type\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"fixed\">Fixed Price</SelectItem>\n              <SelectItem value=\"hourly\">Per Hour</SelectItem>\n              <SelectItem value=\"negotiable\">Negotiable</SelectItem>\n              <SelectItem value=\"free\">Free</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"category\">Category</Label>\n          <Input\n            id=\"category\"\n            value={formData.category}\n            onChange={(e) => setFormData((prev) => ({ ...prev, category: e.target.value }))}\n            placeholder=\"Consulting, Legal, Design, etc.\"\n            data-testid=\"input-service-category\"\n          />\n        </div>\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"imageUrl\">Image URL</Label>\n          <Input\n            id=\"imageUrl\"\n            value={formData.imageUrl}\n            onChange={(e) => setFormData((prev) => ({ ...prev, imageUrl: e.target.value }))}\n            placeholder=\"https://...\"\n            data-testid=\"input-service-image\"\n          />\n        </div>\n      </div>\n\n      <div className=\"flex items-center gap-6 pt-2\">\n        <div className=\"flex items-center space-x-2\">\n          <Switch\n            id=\"isActive\"\n            checked={formData.isActive}\n            onCheckedChange={(checked) => setFormData((prev) => ({ ...prev, isActive: checked }))}\n            data-testid=\"switch-service-active\"\n          />\n          <Label htmlFor=\"isActive\" className=\"flex items-center gap-1\">\n            <Eye className=\"h-4 w-4\" />\n            Visible to visitors\n          </Label>\n        </div>\n        <div className=\"flex items-center space-x-2\">\n          <Switch\n            id=\"isFeatured\"\n            checked={formData.isFeatured}\n            onCheckedChange={(checked) => setFormData((prev) => ({ ...prev, isFeatured: checked }))}\n            data-testid=\"switch-service-featured\"\n          />\n          <Label htmlFor=\"isFeatured\" className=\"flex items-center gap-1\">\n            <Star className=\"h-4 w-4\" />\n            Featured service\n          </Label>\n        </div>\n      </div>\n\n      <DialogFooter className=\"gap-2 pt-4\">\n        <Button type=\"button\" variant=\"outline\" onClick={onCancel} data-testid=\"button-cancel-service\">\n          Cancel\n        </Button>\n        <Button\n          type=\"submit\"\n          disabled={!formData.title.trim() || createMutation.isPending || updateMutation.isPending}\n          data-testid=\"button-save-service\"\n        >\n          {service ? 'Update Service' : 'Add Service'}\n        </Button>\n      </DialogFooter>\n    </form>\n  );\n}\n\nfunction ServiceGridCard({\n  service,\n  officeId,\n  onEdit,\n}: {\n  service: OfficeService;\n  officeId: number;\n  onEdit: () => void;\n}) {\n  const { toast } = useToast();\n\n  const deleteMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest('DELETE', `/api/offices/${officeId}/services/${service.id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/offices', officeId, 'services'] });\n      toast({ title: 'Service deleted' });\n    },\n    onError: (error: Error) => {\n      toast({ title: 'Failed to delete', description: error.message, variant: 'destructive' });\n    },\n  });\n\n  const toggleFeaturedMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest('PATCH', `/api/offices/${officeId}/services/${service.id}`, {\n        isFeatured: !service.isFeatured,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/offices', officeId, 'services'] });\n      toast({ title: service.isFeatured ? 'Removed from featured' : 'Added to featured' });\n    },\n  });\n\n  const toggleActiveMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest('PATCH', `/api/offices/${officeId}/services/${service.id}`, {\n        isActive: !service.isActive,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/offices', officeId, 'services'] });\n      toast({ title: service.isActive ? 'Service hidden' : 'Service visible' });\n    },\n  });\n\n  return (\n    <Card \n      className={`group relative overflow-hidden hover-elevate transition-all ${\n        !service.isActive ? 'opacity-60' : ''\n      } ${service.isFeatured ? 'ring-2 ring-primary' : ''}`}\n      data-testid={`card-showcase-service-${service.id}`}\n    >\n      {service.isFeatured && (\n        <div className=\"absolute top-2 left-2 z-10\">\n          <Badge className=\"gap-1\">\n            <Sparkles className=\"h-3 w-3\" />\n            Featured\n          </Badge>\n        </div>\n      )}\n      \n      <div className=\"relative h-40 bg-gradient-to-br from-primary/10 to-primary/5\">\n        {service.imageUrl ? (\n          <img\n            src={service.imageUrl}\n            alt={service.title}\n            className=\"w-full h-full object-cover\"\n          />\n        ) : (\n          <div className=\"w-full h-full flex items-center justify-center\">\n            <Package className=\"h-12 w-12 text-muted-foreground/40\" />\n          </div>\n        )}\n        \n        <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end justify-center pb-4 gap-2\">\n          <Button size=\"sm\" variant=\"secondary\" onClick={onEdit} data-testid={`button-edit-service-${service.id}`}>\n            <Pencil className=\"h-3 w-3 mr-1\" />\n            Edit\n          </Button>\n          <Button \n            size=\"sm\" \n            variant=\"secondary\"\n            onClick={() => toggleFeaturedMutation.mutate()}\n            data-testid={`button-feature-service-${service.id}`}\n          >\n            <Star className={`h-3 w-3 mr-1 ${service.isFeatured ? 'fill-yellow-400 text-yellow-400' : ''}`} />\n            {service.isFeatured ? 'Unfeature' : 'Feature'}\n          </Button>\n        </div>\n      </div>\n      \n      <CardContent className=\"p-4\">\n        <div className=\"flex items-start justify-between gap-2 mb-2\">\n          <h3 className=\"font-semibold text-lg line-clamp-1\">{service.title}</h3>\n          <div className=\"flex items-center gap-1 shrink-0\">\n            <Button \n              variant=\"ghost\" \n              size=\"icon\" \n              className=\"h-8 w-8\"\n              onClick={() => toggleActiveMutation.mutate()}\n              data-testid={`button-toggle-active-${service.id}`}\n            >\n              {service.isActive ? (\n                <Eye className=\"h-4 w-4 text-green-600\" />\n              ) : (\n                <EyeOff className=\"h-4 w-4 text-muted-foreground\" />\n              )}\n            </Button>\n            <AlertDialog>\n              <AlertDialogTrigger asChild>\n                <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\" data-testid={`button-delete-service-${service.id}`}>\n                  <Trash2 className=\"h-4 w-4 text-destructive\" />\n                </Button>\n              </AlertDialogTrigger>\n              <AlertDialogContent>\n                <AlertDialogHeader>\n                  <AlertDialogTitle>Delete Service</AlertDialogTitle>\n                  <AlertDialogDescription>\n                    Are you sure you want to delete \"{service.title}\"? This will also remove all ratings and comments.\n                  </AlertDialogDescription>\n                </AlertDialogHeader>\n                <AlertDialogFooter>\n                  <AlertDialogCancel>Cancel</AlertDialogCancel>\n                  <AlertDialogAction\n                    onClick={() => deleteMutation.mutate()}\n                    className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                    data-testid=\"button-confirm-delete\"\n                  >\n                    Delete\n                  </AlertDialogAction>\n                </AlertDialogFooter>\n              </AlertDialogContent>\n            </AlertDialog>\n          </div>\n        </div>\n        \n        {service.category && (\n          <Badge variant=\"secondary\" className=\"mb-2\">\n            <Tag className=\"h-3 w-3 mr-1\" />\n            {service.category}\n          </Badge>\n        )}\n        \n        {service.description && (\n          <p className=\"text-sm text-muted-foreground line-clamp-2 mb-3\">\n            {service.description}\n          </p>\n        )}\n        \n        <div className=\"flex items-center justify-between mt-auto pt-2 border-t\">\n          {service.price ? (\n            <div className=\"flex items-center gap-1\">\n              <DollarSign className=\"h-4 w-4 text-green-600\" />\n              <span className=\"font-bold\">{service.price} SAR</span>\n              {service.priceType && service.priceType !== 'fixed' && (\n                <span className=\"text-sm text-muted-foreground\">/{service.priceType}</span>\n              )}\n            </div>\n          ) : (\n            <Badge variant=\"outline\">\n              {service.priceType === 'free' ? 'Free' : 'Contact for price'}\n            </Badge>\n          )}\n          <div className=\"flex items-center gap-1 text-sm text-muted-foreground\">\n            {service.isActive ? (\n              <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n            ) : (\n              <XCircle className=\"h-4 w-4\" />\n            )}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction ServiceListCard({\n  service,\n  officeId,\n  onEdit,\n}: {\n  service: OfficeService;\n  officeId: number;\n  onEdit: () => void;\n}) {\n  const { toast } = useToast();\n\n  const deleteMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest('DELETE', `/api/offices/${officeId}/services/${service.id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/offices', officeId, 'services'] });\n      toast({ title: 'Service deleted' });\n    },\n  });\n\n  const toggleFeaturedMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest('PATCH', `/api/offices/${officeId}/services/${service.id}`, {\n        isFeatured: !service.isFeatured,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/offices', officeId, 'services'] });\n    },\n  });\n\n  const toggleActiveMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest('PATCH', `/api/offices/${officeId}/services/${service.id}`, {\n        isActive: !service.isActive,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/offices', officeId, 'services'] });\n    },\n  });\n\n  return (\n    <Card \n      className={`hover-elevate ${!service.isActive ? 'opacity-60' : ''}`}\n      data-testid={`card-list-service-${service.id}`}\n    >\n      <CardContent className=\"p-4\">\n        <div className=\"flex items-center gap-4\">\n          <div className=\"shrink-0\">\n            {service.imageUrl ? (\n              <img\n                src={service.imageUrl}\n                alt={service.title}\n                className=\"w-16 h-16 rounded-lg object-cover\"\n              />\n            ) : (\n              <div className=\"w-16 h-16 rounded-lg bg-muted flex items-center justify-center\">\n                <Package className=\"h-6 w-6 text-muted-foreground\" />\n              </div>\n            )}\n          </div>\n          \n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <h3 className=\"font-semibold truncate\">{service.title}</h3>\n              {service.isFeatured && (\n                <Badge className=\"shrink-0 gap-1\">\n                  <Sparkles className=\"h-3 w-3\" />\n                  Featured\n                </Badge>\n              )}\n              {!service.isActive && (\n                <Badge variant=\"outline\" className=\"shrink-0\">\n                  <EyeOff className=\"h-3 w-3 mr-1\" />\n                  Hidden\n                </Badge>\n              )}\n            </div>\n            <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n              {service.category && (\n                <span className=\"flex items-center gap-1\">\n                  <Tag className=\"h-3 w-3\" />\n                  {service.category}\n                </span>\n              )}\n              {service.price && (\n                <span className=\"flex items-center gap-1\">\n                  <DollarSign className=\"h-3 w-3\" />\n                  {service.price} SAR\n                  {service.priceType && service.priceType !== 'fixed' && ` / ${service.priceType}`}\n                </span>\n              )}\n            </div>\n            {service.description && (\n              <p className=\"text-sm text-muted-foreground mt-1 line-clamp-1\">\n                {service.description}\n              </p>\n            )}\n          </div>\n          \n          <div className=\"flex items-center gap-1 shrink-0\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => toggleFeaturedMutation.mutate()}\n              data-testid={`button-feature-list-${service.id}`}\n            >\n              <Star className={`h-4 w-4 ${service.isFeatured ? 'fill-yellow-400 text-yellow-400' : ''}`} />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => toggleActiveMutation.mutate()}\n              data-testid={`button-toggle-list-${service.id}`}\n            >\n              {service.isActive ? (\n                <Eye className=\"h-4 w-4 text-green-600\" />\n              ) : (\n                <EyeOff className=\"h-4 w-4\" />\n              )}\n            </Button>\n            <Button variant=\"ghost\" size=\"icon\" onClick={onEdit} data-testid={`button-edit-list-${service.id}`}>\n              <Pencil className=\"h-4 w-4\" />\n            </Button>\n            <AlertDialog>\n              <AlertDialogTrigger asChild>\n                <Button variant=\"ghost\" size=\"icon\" data-testid={`button-delete-list-${service.id}`}>\n                  <Trash2 className=\"h-4 w-4 text-destructive\" />\n                </Button>\n              </AlertDialogTrigger>\n              <AlertDialogContent>\n                <AlertDialogHeader>\n                  <AlertDialogTitle>Delete Service</AlertDialogTitle>\n                  <AlertDialogDescription>\n                    Are you sure you want to delete \"{service.title}\"?\n                  </AlertDialogDescription>\n                </AlertDialogHeader>\n                <AlertDialogFooter>\n                  <AlertDialogCancel>Cancel</AlertDialogCancel>\n                  <AlertDialogAction\n                    onClick={() => deleteMutation.mutate()}\n                    className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                  >\n                    Delete\n                  </AlertDialogAction>\n                </AlertDialogFooter>\n              </AlertDialogContent>\n            </AlertDialog>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction OfficeServicesPanel({ office }: { office: Office }) {\n  const [viewMode, setViewMode] = useState<ViewMode>(\"grid\");\n  const [sortBy, setSortBy] = useState<SortBy>(\"featured\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [filterActive, setFilterActive] = useState<\"all\" | \"active\" | \"hidden\">(\"all\");\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\n  const [editingService, setEditingService] = useState<OfficeService | null>(null);\n\n  const { data: services = [], isLoading } = useQuery<OfficeService[]>({\n    queryKey: ['/api/offices', office.id, 'services'],\n  });\n\n  const filteredServices = services\n    .filter((s) => {\n      if (filterActive === \"active\") return s.isActive;\n      if (filterActive === \"hidden\") return !s.isActive;\n      return true;\n    })\n    .filter((s) =>\n      s.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      s.category?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      s.description?.toLowerCase().includes(searchQuery.toLowerCase())\n    )\n    .sort((a, b) => {\n      switch (sortBy) {\n        case \"title\":\n          return a.title.localeCompare(b.title);\n        case \"price\":\n          return (b.price || 0) - (a.price || 0);\n        case \"featured\":\n          if (a.isFeatured === b.isFeatured) return 0;\n          return a.isFeatured ? -1 : 1;\n        case \"createdAt\":\n          return new Date(b.createdAt!).getTime() - new Date(a.createdAt!).getTime();\n        default:\n          return 0;\n      }\n    });\n\n  const stats = {\n    total: services.length,\n    active: services.filter((s) => s.isActive).length,\n    featured: services.filter((s) => s.isFeatured).length,\n    hidden: services.filter((s) => !s.isActive).length,\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n        <div>\n          <h2 className=\"text-2xl font-bold flex items-center gap-2\">\n            <Package className=\"h-6 w-6\" />\n            Services for {office.name}\n          </h2>\n          <p className=\"text-muted-foreground\">\n            Manage and showcase your office services\n          </p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          {office.isPublished && (\n            <a\n              href={`/office/${office.slug}`}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              className=\"inline-flex\"\n            >\n              <Button variant=\"outline\" size=\"sm\" data-testid=\"button-preview-office\">\n                <ExternalLink className=\"h-4 w-4 mr-1\" />\n                Preview\n              </Button>\n            </a>\n          )}\n          <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\n            <DialogTrigger asChild>\n              <Button data-testid=\"button-add-service\">\n                <Plus className=\"h-4 w-4 mr-1\" />\n                Add Service\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-2xl\">\n              <DialogHeader>\n                <DialogTitle>Add New Service</DialogTitle>\n                <DialogDescription>\n                  Create a new service offering for your office\n                </DialogDescription>\n              </DialogHeader>\n              <ServiceForm\n                officeId={office.id}\n                onSuccess={() => setIsAddDialogOpen(false)}\n                onCancel={() => setIsAddDialogOpen(false)}\n              />\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-4 flex items-center gap-3\">\n            <div className=\"p-2 rounded-lg bg-primary/10\">\n              <Package className=\"h-5 w-5 text-primary\" />\n            </div>\n            <div>\n              <p className=\"text-2xl font-bold\">{stats.total}</p>\n              <p className=\"text-sm text-muted-foreground\">Total Services</p>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4 flex items-center gap-3\">\n            <div className=\"p-2 rounded-lg bg-green-500/10\">\n              <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\n            </div>\n            <div>\n              <p className=\"text-2xl font-bold\">{stats.active}</p>\n              <p className=\"text-sm text-muted-foreground\">Active</p>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4 flex items-center gap-3\">\n            <div className=\"p-2 rounded-lg bg-yellow-500/10\">\n              <Star className=\"h-5 w-5 text-yellow-600\" />\n            </div>\n            <div>\n              <p className=\"text-2xl font-bold\">{stats.featured}</p>\n              <p className=\"text-sm text-muted-foreground\">Featured</p>\n            </div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4 flex items-center gap-3\">\n            <div className=\"p-2 rounded-lg bg-muted\">\n              <EyeOff className=\"h-5 w-5 text-muted-foreground\" />\n            </div>\n            <div>\n              <p className=\"text-2xl font-bold\">{stats.hidden}</p>\n              <p className=\"text-sm text-muted-foreground\">Hidden</p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-4\">\n        <div className=\"relative flex-1 w-full sm:max-w-xs\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search services...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-9\"\n            data-testid=\"input-search-services\"\n          />\n        </div>\n\n        <div className=\"flex items-center gap-2 flex-wrap\">\n          <Select value={filterActive} onValueChange={(v) => setFilterActive(v as typeof filterActive)}>\n            <SelectTrigger className=\"w-[130px]\" data-testid=\"select-filter\">\n              <Filter className=\"h-4 w-4 mr-2\" />\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">All</SelectItem>\n              <SelectItem value=\"active\">Active</SelectItem>\n              <SelectItem value=\"hidden\">Hidden</SelectItem>\n            </SelectContent>\n          </Select>\n\n          <Select value={sortBy} onValueChange={(v) => setSortBy(v as SortBy)}>\n            <SelectTrigger className=\"w-[140px]\" data-testid=\"select-sort\">\n              <ArrowUpDown className=\"h-4 w-4 mr-2\" />\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"featured\">Featured First</SelectItem>\n              <SelectItem value=\"title\">By Name</SelectItem>\n              <SelectItem value=\"price\">By Price</SelectItem>\n              <SelectItem value=\"createdAt\">Newest</SelectItem>\n            </SelectContent>\n          </Select>\n\n          <div className=\"flex items-center border rounded-md\">\n            <Button\n              variant={viewMode === \"grid\" ? \"secondary\" : \"ghost\"}\n              size=\"icon\"\n              className=\"rounded-r-none\"\n              onClick={() => setViewMode(\"grid\")}\n              data-testid=\"button-view-grid\"\n            >\n              <Grid3X3 className=\"h-4 w-4\" />\n            </Button>\n            <Button\n              variant={viewMode === \"list\" ? \"secondary\" : \"ghost\"}\n              size=\"icon\"\n              className=\"rounded-l-none\"\n              onClick={() => setViewMode(\"list\")}\n              data-testid=\"button-view-list\"\n            >\n              <List className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {isLoading ? (\n        <div className={viewMode === \"grid\" ? \"grid gap-4 md:grid-cols-2 lg:grid-cols-3\" : \"space-y-3\"}>\n          {Array.from({ length: 6 }).map((_, i) => (\n            <Card key={i}>\n              {viewMode === \"grid\" && <Skeleton className=\"h-40\" />}\n              <CardContent className=\"p-4 space-y-2\">\n                <Skeleton className=\"h-6 w-3/4\" />\n                <Skeleton className=\"h-4 w-1/2\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : filteredServices.length === 0 ? (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <Package className=\"h-12 w-12 text-muted-foreground mb-4\" />\n            <h3 className=\"text-lg font-medium mb-2\">\n              {searchQuery || filterActive !== \"all\" ? \"No services found\" : \"No services yet\"}\n            </h3>\n            <p className=\"text-muted-foreground text-center max-w-md mb-4\">\n              {searchQuery || filterActive !== \"all\"\n                ? \"Try adjusting your search or filter criteria\"\n                : \"Add your first service to showcase what your office offers to visitors\"}\n            </p>\n            {!searchQuery && filterActive === \"all\" && (\n              <Button onClick={() => setIsAddDialogOpen(true)} data-testid=\"button-add-first-service\">\n                <Plus className=\"h-4 w-4 mr-1\" />\n                Add Your First Service\n              </Button>\n            )}\n          </CardContent>\n        </Card>\n      ) : viewMode === \"grid\" ? (\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n          {filteredServices.map((service) => (\n            <ServiceGridCard\n              key={service.id}\n              service={service}\n              officeId={office.id}\n              onEdit={() => setEditingService(service)}\n            />\n          ))}\n        </div>\n      ) : (\n        <div className=\"space-y-3\">\n          {filteredServices.map((service) => (\n            <ServiceListCard\n              key={service.id}\n              service={service}\n              officeId={office.id}\n              onEdit={() => setEditingService(service)}\n            />\n          ))}\n        </div>\n      )}\n\n      <Dialog open={!!editingService} onOpenChange={(open) => !open && setEditingService(null)}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Edit Service</DialogTitle>\n            <DialogDescription>\n              Update your service details\n            </DialogDescription>\n          </DialogHeader>\n          {editingService && (\n            <ServiceForm\n              officeId={office.id}\n              service={editingService}\n              onSuccess={() => setEditingService(null)}\n              onCancel={() => setEditingService(null)}\n            />\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\nexport default function OfficeServicesShowcase() {\n  const [selectedOfficeId, setSelectedOfficeId] = useState<number | null>(null);\n\n  const { data: offices = [], isLoading } = useQuery<Office[]>({\n    queryKey: ['/api/offices'],\n  });\n\n  const selectedOffice = offices.find((o) => o.id === selectedOfficeId);\n\n  if (isLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <Skeleton className=\"h-10 w-64\" />\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n          {Array.from({ length: 3 }).map((_, i) => (\n            <Card key={i}>\n              <CardContent className=\"p-6\">\n                <Skeleton className=\"h-6 w-3/4 mb-2\" />\n                <Skeleton className=\"h-4 w-1/2\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (offices.length === 0) {\n    return (\n      <div className=\"p-6\">\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-16\">\n            <Building2 className=\"h-16 w-16 text-muted-foreground mb-4\" />\n            <h2 className=\"text-xl font-semibold mb-2\">No Offices Found</h2>\n            <p className=\"text-muted-foreground text-center max-w-md mb-6\">\n              You need to create an office first before you can add services. \n              Go to Office Management to create your virtual office.\n            </p>\n            <a href=\"/office-management\">\n              <Button data-testid=\"button-goto-office-management\">\n                <Building2 className=\"h-4 w-4 mr-2\" />\n                Go to Office Management\n              </Button>\n            </a>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (!selectedOffice) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold mb-2\">Services Showcase</h1>\n          <p className=\"text-muted-foreground\">\n            Select an office to manage and showcase its services\n          </p>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n          {offices.map((office) => (\n            <Card\n              key={office.id}\n              className=\"cursor-pointer hover-elevate\"\n              onClick={() => setSelectedOfficeId(office.id)}\n              data-testid={`card-select-office-${office.id}`}\n            >\n              <div className=\"relative h-32 bg-gradient-to-br from-primary/20 to-primary/5\">\n                {office.coverUrl ? (\n                  <img\n                    src={office.coverUrl}\n                    alt={office.name}\n                    className=\"w-full h-full object-cover\"\n                  />\n                ) : (\n                  <div className=\"w-full h-full flex items-center justify-center\">\n                    <Building2 className=\"h-10 w-10 text-primary/40\" />\n                  </div>\n                )}\n                <div className=\"absolute top-2 right-2\">\n                  {office.isPublished ? (\n                    <Badge className=\"bg-green-500\">Published</Badge>\n                  ) : (\n                    <Badge variant=\"secondary\">Draft</Badge>\n                  )}\n                </div>\n              </div>\n              <CardContent className=\"p-4\">\n                <h3 className=\"font-semibold text-lg mb-1\">{office.name}</h3>\n                <p className=\"text-sm text-muted-foreground mb-3\">\n                  {office.category || 'General'}\n                </p>\n                <Button className=\"w-full\" data-testid={`button-manage-services-${office.id}`}>\n                  <Package className=\"h-4 w-4 mr-2\" />\n                  Manage Services\n                </Button>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6\">\n      <Button\n        variant=\"ghost\"\n        className=\"mb-4\"\n        onClick={() => setSelectedOfficeId(null)}\n        data-testid=\"button-back-to-offices\"\n      >\n        <Building2 className=\"h-4 w-4 mr-2\" />\n        Back to Offices\n      </Button>\n      <OfficeServicesPanel office={selectedOffice} />\n    </div>\n  );\n}\n","path":null,"size_bytes":35844,"size_tokens":null},"client/src/pages/Careers.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ScrollArea, ScrollBar } from \"@/components/ui/scroll-area\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  ArrowLeft,\n  ArrowRight,\n  Briefcase,\n  Building2,\n  Clock,\n  MapPin,\n  Search,\n  Send,\n  Check,\n  DollarSign,\n  Users,\n  Mail,\n  Phone,\n  Upload,\n  FileText,\n  Sparkles,\n} from \"lucide-react\";\nimport logoUrl from \"@assets/Photoroom___1764761955587.png\";\nimport { Link } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\nimport type { JobPosting } from \"@shared/schema\";\n\nfunction JobApplicationDialog({ job, children, t, language }: { job: JobPosting; children: React.ReactNode; t: typeof translations.en.careers; language: string }) {\n  const [open, setOpen] = useState(false);\n  const [submitted, setSubmitted] = useState(false);\n  const { toast } = useToast();\n  const [applicant, setApplicant] = useState({\n    fullName: \"\",\n    email: \"\",\n    phone: \"\",\n    experience: \"\",\n    resume: \"\",\n    coverLetter: \"\",\n  });\n  const isRTL = language === 'ar';\n\n  const submitApplication = useMutation({\n    mutationFn: async (data: typeof applicant) => {\n      await apiRequest(\"POST\", `/api/public/jobs/${job.id}/apply`, {\n        ...data,\n        jobTitle: job.title,\n        department: job.department,\n      });\n    },\n    onSuccess: () => {\n      setSubmitted(true);\n      toast({\n        title: t.applicationSubmitted,\n        description: t.applicationSubmittedDesc,\n      });\n    },\n    onError: () => {\n      toast({\n        title: t.error,\n        description: t.failedSubmit,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = () => {\n    if (applicant.fullName && applicant.email) {\n      submitApplication.mutate(applicant);\n    } else {\n      toast({\n        title: t.missingInfo,\n        description: t.fillNameEmail,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleClose = () => {\n    setOpen(false);\n    setTimeout(() => {\n      setSubmitted(false);\n      setApplicant({\n        fullName: \"\",\n        email: \"\",\n        phone: \"\",\n        experience: \"\",\n        resume: \"\",\n        coverLetter: \"\",\n      });\n    }, 300);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>{children}</DialogTrigger>\n      <DialogContent className=\"sm:max-w-lg max-h-[90vh] overflow-y-auto\" dir={isRTL ? 'rtl' : 'ltr'}>\n        {submitted ? (\n          <div className=\"py-8 text-center\">\n            <div className=\"w-16 h-16 rounded-full bg-emerald-500/10 flex items-center justify-center mx-auto mb-4\">\n              <Check className=\"h-8 w-8 text-emerald-500\" />\n            </div>\n            <DialogHeader>\n              <DialogTitle className=\"text-center\">{t.applicationSubmitted}</DialogTitle>\n              <DialogDescription className=\"text-center\">\n                {t.thankYouApply.replace(\"{title}\", job.title)}\n              </DialogDescription>\n            </DialogHeader>\n            <Button onClick={handleClose} className=\"mt-6\">\n              {t.close}\n            </Button>\n          </div>\n        ) : (\n          <>\n            <DialogHeader>\n              <DialogTitle className={`flex items-center gap-2 ${isRTL ? 'flex-row-reverse' : ''}`}>\n                <Briefcase className=\"h-5 w-5 text-primary\" />\n                {t.applyFor} {job.title}\n              </DialogTitle>\n              <DialogDescription>\n                {job.department}  {job.location || t.remote}\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4 py-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"fullName\">{t.fullName} *</Label>\n                <Input\n                  id=\"fullName\"\n                  placeholder={t.fullNamePlaceholder}\n                  value={applicant.fullName}\n                  onChange={(e) => setApplicant({ ...applicant, fullName: e.target.value })}\n                  data-testid=\"input-career-applicant-name\"\n                />\n              </div>\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"email\">{t.emailAddress} *</Label>\n                  <div className=\"relative\">\n                    <Mail className={`absolute ${isRTL ? 'right-3' : 'left-3'} top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground`} />\n                    <Input\n                      id=\"email\"\n                      type=\"email\"\n                      placeholder={t.emailPlaceholder}\n                      className={isRTL ? 'pr-9' : 'pl-9'}\n                      value={applicant.email}\n                      onChange={(e) => setApplicant({ ...applicant, email: e.target.value })}\n                      data-testid=\"input-career-applicant-email\"\n                    />\n                  </div>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"phone\">{t.phoneNumber}</Label>\n                  <div className=\"relative\">\n                    <Phone className={`absolute ${isRTL ? 'right-3' : 'left-3'} top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground`} />\n                    <Input\n                      id=\"phone\"\n                      type=\"tel\"\n                      placeholder={t.phonePlaceholder}\n                      className={isRTL ? 'pr-9' : 'pl-9'}\n                      value={applicant.phone}\n                      onChange={(e) => setApplicant({ ...applicant, phone: e.target.value })}\n                      data-testid=\"input-career-applicant-phone\"\n                    />\n                  </div>\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"experience\">{t.yearsExperience}</Label>\n                <Select \n                  value={applicant.experience} \n                  onValueChange={(v) => setApplicant({ ...applicant, experience: v })}\n                >\n                  <SelectTrigger data-testid=\"select-career-applicant-experience\">\n                    <SelectValue placeholder={t.selectExperience} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"0-1\">{t.exp01}</SelectItem>\n                    <SelectItem value=\"1-3\">{t.exp13}</SelectItem>\n                    <SelectItem value=\"3-5\">{t.exp35}</SelectItem>\n                    <SelectItem value=\"5-10\">{t.exp510}</SelectItem>\n                    <SelectItem value=\"10+\">{t.exp10plus}</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"resume\">{t.resumeLink}</Label>\n                <div className=\"relative\">\n                  <Upload className={`absolute ${isRTL ? 'right-3' : 'left-3'} top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground`} />\n                  <Input\n                    id=\"resume\"\n                    placeholder={t.resumePlaceholder}\n                    className={isRTL ? 'pr-9' : 'pl-9'}\n                    value={applicant.resume}\n                    onChange={(e) => setApplicant({ ...applicant, resume: e.target.value })}\n                    data-testid=\"input-career-applicant-resume\"\n                  />\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"coverLetter\">{t.coverLetter}</Label>\n                <Textarea\n                  id=\"coverLetter\"\n                  placeholder={t.coverLetterPlaceholder}\n                  value={applicant.coverLetter}\n                  onChange={(e) => setApplicant({ ...applicant, coverLetter: e.target.value })}\n                  className=\"min-h-[100px]\"\n                  data-testid=\"textarea-career-applicant-cover\"\n                />\n              </div>\n            </div>\n            <DialogFooter className=\"gap-2\">\n              <Button variant=\"outline\" onClick={() => setOpen(false)}>\n                {t.cancel}\n              </Button>\n              <Button \n                onClick={handleSubmit} \n                disabled={submitApplication.isPending}\n                className=\"gap-2\"\n                data-testid=\"button-submit-career-application\"\n              >\n                {submitApplication.isPending ? (\n                  t.submitting\n                ) : (\n                  <>\n                    <Send className=\"h-4 w-4\" />\n                    {t.submitApplication}\n                  </>\n                )}\n              </Button>\n            </DialogFooter>\n          </>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction JobCard({ job, t, language }: { job: JobPosting; t: typeof translations.en.careers; language: string }) {\n  const isRTL = language === 'ar';\n  const daysAgo = job.createdAt \n    ? Math.floor((Date.now() - new Date(job.createdAt).getTime()) / (1000 * 60 * 60 * 24)) \n    : 0;\n\n  const jobTypeLabels: Record<string, string> = {\n    \"full-time\": t.fullTime,\n    \"part-time\": t.partTime,\n    \"contract\": t.contract,\n    \"internship\": t.internship,\n  };\n\n  const formatPostedDate = () => {\n    if (daysAgo === 0) return t.postedToday;\n    return t.postedDaysAgo.replace(\"{days}\", String(daysAgo));\n  };\n\n  return (\n    <Card className=\"hover-elevate transition-all duration-300\" data-testid={`card-career-job-${job.id}`}>\n      <CardContent className=\"p-5\">\n        <div className=\"flex items-start justify-between gap-4\">\n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-center gap-2 flex-wrap mb-2\">\n              <h3 className=\"font-semibold text-lg\">{job.title}</h3>\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                {jobTypeLabels[job.type || \"full-time\"] || job.type}\n              </Badge>\n            </div>\n            <div className=\"flex flex-wrap items-center gap-3 text-sm text-muted-foreground mb-3\">\n              <span className=\"flex items-center gap-1\">\n                <Building2 className=\"h-4 w-4\" />\n                {job.department}\n              </span>\n              <span className=\"flex items-center gap-1\">\n                <MapPin className=\"h-4 w-4\" />\n                {job.location || t.remote}\n              </span>\n              {job.salary && (\n                <span className=\"flex items-center gap-1\">\n                  <DollarSign className=\"h-4 w-4\" />\n                  {job.salary}\n                </span>\n              )}\n            </div>\n            {job.description && (\n              <p className=\"text-sm text-muted-foreground line-clamp-2 mb-4\">\n                {job.description}\n              </p>\n            )}\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                <Clock className=\"h-3 w-3\" />\n                {formatPostedDate()}\n              </span>\n              <JobApplicationDialog job={job} t={t} language={language}>\n                <Button size=\"sm\" className=\"gap-1\" data-testid={`button-apply-job-${job.id}`}>\n                  {t.applyNow}\n                  <Send className=\"h-3 w-3\" />\n                </Button>\n              </JobApplicationDialog>\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nexport default function Careers() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [activeFilter, setActiveFilter] = useState(\"all\");\n  const { toast } = useToast();\n  const { language } = useLanguage();\n  const t = translations[language].careers;\n  const isRTL = language === 'ar';\n\n  const { data: jobs = [], isLoading } = useQuery<JobPosting[]>({\n    queryKey: [\"/api/public/jobs\"],\n  });\n\n  const publishedJobs = jobs.filter(job => job.status === \"published\");\n\n  const filteredJobs = publishedJobs.filter((job) => {\n    const matchesSearch = \n      job.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      job.department?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      job.description?.toLowerCase().includes(searchQuery.toLowerCase());\n    \n    if (activeFilter === \"all\") return matchesSearch;\n    if (activeFilter === \"remote\") return matchesSearch && job.location?.toLowerCase().includes(\"remote\");\n    return matchesSearch && job.type === activeFilter;\n  });\n\n  const departments = Array.from(new Set(publishedJobs.map(j => j.department).filter(Boolean)));\n\n  const filterOptions = [\n    { id: \"all\", label: t.allJobs },\n    { id: \"full-time\", label: t.fullTime },\n    { id: \"part-time\", label: t.partTime },\n    { id: \"contract\", label: t.contract },\n    { id: \"remote\", label: t.remote },\n  ];\n\n  const BackArrow = isRTL ? ArrowRight : ArrowLeft;\n\n  return (\n    <div className=\"min-h-screen bg-background\" dir={isRTL ? 'rtl' : 'ltr'}>\n      <header className=\"sticky top-0 z-50 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n        <div className=\"container mx-auto flex items-center justify-between h-16 px-4\">\n          <div className=\"flex items-center gap-3\">\n            <Link href=\"/\">\n              <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back-home\">\n                <BackArrow className=\"h-4 w-4\" />\n              </Button>\n            </Link>\n            <div className=\"flex items-center gap-2\">\n              <img src={logoUrl} alt=\"CloudOffice\" className=\"h-8 w-8 object-contain\" />\n              <span className=\"font-semibold text-lg\">{t.headerTitle}</span>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <section className=\"relative py-16 overflow-hidden\">\n        <div className=\"absolute inset-0 bg-gradient-to-b from-primary/5 via-transparent to-transparent\" />\n        <div className=\"absolute inset-0\">\n          <div className={`absolute top-1/4 ${isRTL ? 'right-1/4' : 'left-1/4'} w-96 h-96 bg-orange-500/10 rounded-full blur-3xl`} />\n          <div className={`absolute bottom-1/4 ${isRTL ? 'left-1/4' : 'right-1/4'} w-96 h-96 bg-primary/10 rounded-full blur-3xl`} />\n        </div>\n        \n        <div className=\"relative container mx-auto px-4 text-center\">\n          <Badge variant=\"outline\" className=\"mb-6 px-4 py-1.5 border-orange-500/30 bg-orange-500/10\">\n            <Sparkles className={`h-3 w-3 ${isRTL ? 'ml-2' : 'mr-2'} text-orange-400`} />\n            <span className=\"text-orange-400 text-xs\">{t.joinPartners}</span>\n          </Badge>\n          \n          <h1 className=\"text-3xl md:text-5xl font-bold mb-4\">\n            {t.findNext}\n            <span className=\"block text-primary\">{t.careerOpportunity}</span>\n          </h1>\n          \n          <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto mb-8\">\n            {t.subtitle}\n          </p>\n\n          <div className=\"max-w-2xl mx-auto relative\">\n            <div className=\"absolute inset-0 bg-gradient-to-r from-orange-500/20 to-primary/20 rounded-2xl blur-xl\" />\n            <div className=\"relative bg-card rounded-2xl p-2 border\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"flex-1 relative\">\n                  <Search className={`absolute ${isRTL ? 'right-4' : 'left-4'} top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground`} />\n                  <Input\n                    type=\"search\"\n                    placeholder={t.searchPlaceholder}\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    className={`${isRTL ? 'pr-12' : 'pl-12'} h-12 bg-transparent border-0 focus-visible:ring-0 text-base`}\n                    data-testid=\"input-search-careers\"\n                  />\n                </div>\n                <Button size=\"lg\" className=\"h-12 px-6 gap-2\" data-testid=\"button-search-careers\">\n                  <Search className=\"h-4 w-4\" />\n                  {t.search}\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"flex items-center justify-center gap-8 mt-10\">\n            <div className=\"text-center\">\n              <p className=\"text-3xl font-bold text-primary\">{publishedJobs.length}</p>\n              <p className=\"text-sm text-muted-foreground\">{t.openPositions}</p>\n            </div>\n            <div className=\"h-10 w-px bg-border\" />\n            <div className=\"text-center\">\n              <p className=\"text-3xl font-bold\">{departments.length}</p>\n              <p className=\"text-sm text-muted-foreground\">{t.departments}</p>\n            </div>\n            <div className=\"h-10 w-px bg-border\" />\n            <div className=\"text-center\">\n              <p className=\"text-3xl font-bold\">100%</p>\n              <p className=\"text-sm text-muted-foreground\">{t.verified}</p>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      <main className=\"container mx-auto px-4 pb-16 max-w-5xl\">\n        <ScrollArea className=\"w-full whitespace-nowrap mb-6\">\n          <div className=\"flex gap-2 pb-2\">\n            {filterOptions.map((option) => (\n              <Button\n                key={option.id}\n                variant={activeFilter === option.id ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setActiveFilter(option.id)}\n                className=\"rounded-full\"\n                data-testid={`filter-career-${option.id}`}\n              >\n                {option.label}\n              </Button>\n            ))}\n          </div>\n          <ScrollBar orientation=\"horizontal\" />\n        </ScrollArea>\n\n        <div className=\"space-y-4\">\n          {isLoading ? (\n            Array.from({ length: 5 }).map((_, i) => (\n              <Card key={i}>\n                <CardContent className=\"p-5\">\n                  <div className=\"space-y-3\">\n                    <Skeleton className=\"h-6 w-1/3\" />\n                    <Skeleton className=\"h-4 w-1/2\" />\n                    <Skeleton className=\"h-4 w-full\" />\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          ) : filteredJobs.length > 0 ? (\n            filteredJobs.map((job) => <JobCard key={job.id} job={job} t={t} language={language} />)\n          ) : (\n            <Card className=\"p-12 text-center\">\n              <Briefcase className=\"h-16 w-16 mx-auto mb-4 text-muted-foreground opacity-30\" />\n              <h3 className=\"text-lg font-semibold mb-2\">{t.noJobsFound}</h3>\n              <p className=\"text-muted-foreground mb-4\">\n                {searchQuery || activeFilter !== \"all\"\n                  ? t.adjustSearch\n                  : t.checkBack}\n              </p>\n              {(searchQuery || activeFilter !== \"all\") && (\n                <Button\n                  variant=\"outline\"\n                  onClick={() => {\n                    setSearchQuery(\"\");\n                    setActiveFilter(\"all\");\n                  }}\n                >\n                  {t.clearFilters}\n                </Button>\n              )}\n            </Card>\n          )}\n        </div>\n\n      </main>\n\n      <footer className=\"border-t bg-muted/50 py-8\">\n        <div className=\"container mx-auto px-4 text-center text-muted-foreground\">\n          <p>&copy; {new Date().getFullYear()} CloudOffice. {t.allRightsReserved}</p>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","path":null,"size_bytes":20095,"size_tokens":null},"client/src/components/VisitorSidebar.tsx":{"content":"import { useLocation, Link } from \"wouter\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarHeader,\n  SidebarFooter,\n} from \"@/components/ui/sidebar\";\nimport { UserAvatar } from \"./UserAvatar\";\nimport {\n  Home,\n  Building2,\n  Package,\n  Briefcase,\n  MessageCircle,\n  LogOut,\n  User,\n  ChevronRight,\n  Sparkles,\n  Store,\n  Heart,\n  Star,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { cn } from \"@/lib/utils\";\nimport { LanguageSwitcher } from \"./LanguageSwitcher\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\ninterface NavItem {\n  titleKey: string;\n  url: string;\n  icon: typeof Home;\n  categoryKey: string;\n}\n\nconst navigationItems: NavItem[] = [\n  { titleKey: \"welcome\", url: \"/welcome\", icon: Home, categoryKey: \"home\" },\n  { titleKey: \"browseOffices\", url: \"/visitor/offices\", icon: Building2, categoryKey: \"explore\" },\n  { titleKey: \"viewServices\", url: \"/visitor/services\", icon: Package, categoryKey: \"explore\" },\n  { titleKey: \"findJobs\", url: \"/careers\", icon: Briefcase, categoryKey: \"opportunities\" },\n  { titleKey: \"contactUs\", url: \"/visitor/contact\", icon: MessageCircle, categoryKey: \"support\" },\n  { titleKey: \"myProfile\", url: \"/profile\", icon: User, categoryKey: \"account\" },\n];\n\ninterface VisitorSidebarProps {\n  user?: {\n    id?: string;\n    firstName?: string | null;\n    lastName?: string | null;\n    email?: string | null;\n    profileImageUrl?: string | null;\n    role?: string | null;\n  };\n}\n\nexport function VisitorSidebar({ user }: VisitorSidebarProps) {\n  const displayName = user ? `${user.firstName || ''} ${user.lastName || ''}`.trim() || user.email || 'Visitor' : 'Visitor';\n  const avatar = user?.profileImageUrl;\n  const [location] = useLocation();\n  const { language } = useLanguage();\n  const t = translations[language];\n\n  const groupedItems = navigationItems.reduce((acc, item) => {\n    if (!acc[item.categoryKey]) acc[item.categoryKey] = [];\n    acc[item.categoryKey].push(item);\n    return acc;\n  }, {} as Record<string, NavItem[]>);\n\n  const categoryIcons: Record<string, typeof Sparkles> = {\n    home: Home,\n    explore: Store,\n    opportunities: Briefcase,\n    support: MessageCircle,\n    account: User,\n  };\n\n  const getCategoryLabel = (categoryKey: string) => {\n    const labels: Record<string, string> = {\n      home: t.sidebar?.home || \"Home\",\n      explore: t.sidebar?.explore || \"Explore\",\n      opportunities: t.sidebar?.opportunities || \"Opportunities\",\n      support: t.sidebar?.support || \"Support\",\n      account: t.sidebar?.account || \"Account\",\n    };\n    return labels[categoryKey] || categoryKey;\n  };\n\n  const getItemLabel = (titleKey: string) => {\n    const labels: Record<string, string> = {\n      welcome: t.sidebar?.welcome || \"Welcome\",\n      browseOffices: t.sidebar?.browseOffices || \"Browse Offices\",\n      viewServices: t.sidebar?.viewServices || \"View Services\",\n      findJobs: t.sidebar?.findJobs || \"Find Jobs\",\n      contactUs: t.sidebar?.contactUs || \"Contact Us\",\n      myProfile: t.sidebar?.myProfile || \"My Profile\",\n    };\n    return labels[titleKey] || titleKey;\n  };\n\n  return (\n    <Sidebar className=\"border-r border-white/5\">\n      <SidebarHeader className=\"p-5 border-b border-white/5\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"relative\">\n              <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-500 to-teal-500 flex items-center justify-center\">\n                <Sparkles className=\"h-5 w-5 text-white\" />\n              </div>\n              <div className=\"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-emerald-500 rounded-full border-2 border-sidebar\" />\n            </div>\n            <div>\n              <h1 className=\"font-bold text-lg tracking-tight\">CloudOffice</h1>\n              <p className=\"text-xs text-muted-foreground\">{t.sidebar?.welcomePortal || \"Welcome Portal\"}</p>\n            </div>\n          </div>\n          <LanguageSwitcher size=\"icon\" showLabel={false} />\n        </div>\n      </SidebarHeader>\n\n      <SidebarContent className=\"px-3 py-4\">\n        {Object.entries(groupedItems).map(([categoryKey, items]) => {\n          const CategoryIcon = categoryIcons[categoryKey] || Sparkles;\n          return (\n            <SidebarGroup key={categoryKey} className=\"mb-2\">\n              <SidebarGroupLabel className=\"flex items-center gap-2 px-3 py-2 text-xs font-semibold text-muted-foreground uppercase tracking-wider\">\n                <CategoryIcon className=\"h-3.5 w-3.5\" />\n                {getCategoryLabel(categoryKey)}\n              </SidebarGroupLabel>\n              <SidebarGroupContent>\n                <SidebarMenu>\n                  {items.map((item) => {\n                    const isActive = location === item.url || \n                      (item.url !== \"/\" && item.url !== \"/welcome\" && location.startsWith(item.url));\n                    const itemLabel = getItemLabel(item.titleKey);\n                    return (\n                      <SidebarMenuItem key={item.titleKey}>\n                        <SidebarMenuButton \n                          asChild \n                          isActive={isActive}\n                          className={cn(\n                            \"group relative flex items-center gap-3 rounded-lg px-3 py-2.5 transition-all duration-200\",\n                            isActive \n                              ? \"bg-gradient-to-r from-cyan-500/10 to-teal-500/10 text-foreground\" \n                              : \"text-muted-foreground hover:text-foreground\"\n                          )}\n                        >\n                          <Link href={item.url} data-testid={`nav-${item.titleKey.toLowerCase().replace(/\\s+/g, '-')}`}>\n                            {isActive && (\n                              <span className=\"absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 bg-gradient-to-b from-cyan-500 to-teal-500 rounded-r-full\" />\n                            )}\n                            <item.icon className={cn(\n                              \"h-4 w-4 transition-colors\",\n                              isActive ? \"text-cyan-500\" : \"text-muted-foreground group-hover:text-foreground\"\n                            )} />\n                            <span className=\"flex-1 text-sm font-medium\">{itemLabel}</span>\n                            {isActive && (\n                              <ChevronRight className=\"h-4 w-4 text-cyan-500\" />\n                            )}\n                          </Link>\n                        </SidebarMenuButton>\n                      </SidebarMenuItem>\n                    );\n                  })}\n                </SidebarMenu>\n              </SidebarGroupContent>\n            </SidebarGroup>\n          );\n        })}\n      </SidebarContent>\n\n      <SidebarFooter className=\"p-4 border-t border-white/5\">\n        <div className=\"flex items-center gap-3 p-3 rounded-xl bg-gradient-to-r from-white/5 to-transparent\">\n          <UserAvatar \n            name={displayName}\n            avatar={avatar} \n            size=\"md\"\n          />\n          <div className=\"flex-1 min-w-0\">\n            <p className=\"text-sm font-medium truncate\">{displayName}</p>\n            <p className=\"text-xs text-cyan-500 capitalize\">{t.sidebar?.visitor || \"Visitor\"}</p>\n          </div>\n          <form action=\"/api/logout\" method=\"POST\">\n            <Button \n              type=\"submit\" \n              variant=\"ghost\" \n              size=\"icon\" \n              className=\"h-8 w-8 text-muted-foreground hover:text-destructive\"\n              data-testid=\"button-logout\"\n            >\n              <LogOut className=\"h-4 w-4\" />\n            </Button>\n          </form>\n        </div>\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","path":null,"size_bytes":7854,"size_tokens":null},"client/src/pages/Welcome.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea, ScrollBar } from \"@/components/ui/scroll-area\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { \n  Building2, \n  Users, \n  Clock, \n  TrendingUp,\n  Search,\n  MapPin,\n  Wifi,\n  Coffee,\n  Monitor,\n  ArrowRight,\n  Diamond,\n  FileText,\n  Award,\n  Phone,\n  Car,\n  Heart,\n  MessageCircle,\n  Share2,\n  Star,\n  UserPlus,\n  Eye,\n  Briefcase,\n  Store,\n  Package,\n  Home,\n  Calendar,\n  Bell,\n  Settings,\n  Globe,\n  Languages,\n} from \"lucide-react\";\nimport logoUrl from \"@assets/Photoroom___1764761955587.png\";\nimport { useState } from \"react\";\nimport { Link } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport type { Office, OfficeService } from \"@shared/schema\";\nimport { useLanguage, useTranslation, type Language } from \"@/lib/i18n\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\n\nexport default function Welcome() {\n  const { user } = useAuth();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const { language, setLanguage, isRTL } = useLanguage();\n  const { t } = useTranslation();\n  \n  const displayName = user ? `${user.firstName || ''} ${user.lastName || ''}`.trim() || user.email?.split('@')[0] || 'Visitor' : 'Visitor';\n\n  const { data: offices = [] } = useQuery<Office[]>({\n    queryKey: ['/api/public/offices'],\n  });\n\n  const { data: services = [] } = useQuery<OfficeService[]>({\n    queryKey: ['/api/public/services'],\n  });\n\n  const quickActions = [\n    { icon: Store, label: t.welcome.browseOffices, href: \"/visitor/offices\", color: \"from-cyan-500 to-teal-500\" },\n    { icon: Package, label: t.welcome.viewServices, href: \"/visitor/services\", color: \"from-violet-500 to-purple-500\" },\n    { icon: Briefcase, label: t.welcome.findJobs, href: \"/careers\", color: \"from-amber-500 to-orange-500\" },\n    { icon: MessageCircle, label: t.welcome.contactUs, href: \"/visitor/contact\", color: \"from-emerald-500 to-green-500\" },\n  ];\n\n  const featuredOffices = offices.slice(0, 4);\n  const featuredServices = services.slice(0, 6);\n\n  const handleLanguageChange = (lang: Language) => {\n    setLanguage(lang);\n  };\n\n  return (\n    <div className={`min-h-screen bg-background ${isRTL ? 'rtl' : 'ltr'}`} dir={isRTL ? 'rtl' : 'ltr'}>\n      <div className=\"max-w-7xl mx-auto p-6 space-y-8\">\n        \n        <div className=\"relative overflow-hidden rounded-2xl bg-gradient-to-br from-cyan-500/10 via-teal-500/10 to-emerald-500/10 border border-white/10 p-8\">\n          <div className=\"absolute inset-0 bg-gradient-to-br from-cyan-500/5 to-transparent\" />\n          <div className=\"relative\">\n            <div className=\"flex items-center justify-between gap-4 mb-6 flex-wrap\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"h-16 w-16 rounded-2xl bg-gradient-to-br from-cyan-500 to-teal-500 flex items-center justify-center shadow-lg shadow-cyan-500/20\">\n                  <img src={logoUrl} alt=\"CloudOffice\" className=\"h-10 w-10 object-contain\" />\n                </div>\n                <div>\n                  <h1 className=\"text-3xl font-bold gradient-text\" data-testid=\"text-welcome-heading\">\n                    {t.welcome.greeting}, {displayName}!\n                  </h1>\n                  <p className=\"text-muted-foreground\">{t.welcome.subtitle}</p>\n                </div>\n              </div>\n              \n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"outline\" size=\"sm\" className=\"gap-2\" data-testid=\"button-language-switcher\">\n                    <Globe className=\"h-4 w-4\" />\n                    {language === 'ar' ? '' : 'English'}\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align={isRTL ? \"start\" : \"end\"}>\n                  <DropdownMenuItem \n                    onClick={() => handleLanguageChange('en')}\n                    className={language === 'en' ? 'bg-accent' : ''}\n                    data-testid=\"menu-item-english\"\n                  >\n                    <span className=\"mr-2\">EN</span>\n                    {t.common.english}\n                  </DropdownMenuItem>\n                  <DropdownMenuItem \n                    onClick={() => handleLanguageChange('ar')}\n                    className={language === 'ar' ? 'bg-accent' : ''}\n                    data-testid=\"menu-item-arabic\"\n                  >\n                    <span className=\"mr-2\">AR</span>\n                    {t.common.arabic}\n                  </DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            </div>\n            \n            <div className=\"relative max-w-xl\">\n              <Search className={`absolute ${isRTL ? 'right-4' : 'left-4'} top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground`} />\n              <Input\n                placeholder={t.welcome.searchPlaceholder}\n                className={`${isRTL ? 'pr-12' : 'pl-12'} h-12 bg-background/50 backdrop-blur border-white/10`}\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                data-testid=\"input-welcome-search\"\n              />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n          {quickActions.map((action, index) => (\n            <Link key={index} href={action.href}>\n              <Card className=\"glass hover-glow cursor-pointer group transition-all duration-300 hover:scale-[1.02]\" data-testid={`card-quick-action-${index}`}>\n                <CardContent className=\"p-6 flex flex-col items-center text-center gap-3\">\n                  <div className={`h-14 w-14 rounded-xl bg-gradient-to-br ${action.color} flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform`}>\n                    <action.icon className=\"h-7 w-7 text-white\" />\n                  </div>\n                  <span className=\"font-medium\">{action.label}</span>\n                </CardContent>\n              </Card>\n            </Link>\n          ))}\n        </div>\n\n        <Card className=\"glass\" data-testid=\"card-featured-offices\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-4\">\n            <div>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Building2 className=\"h-5 w-5 text-cyan-500\" />\n                {t.welcome.featuredOffices}\n              </CardTitle>\n              <CardDescription>{t.welcome.discoverOffices}</CardDescription>\n            </div>\n            <Link href=\"/visitor/offices\">\n              <Button variant=\"outline\" size=\"sm\" data-testid=\"button-view-all-offices\">\n                {t.welcome.viewAll}\n                <ArrowRight className={`h-4 w-4 ${isRTL ? 'mr-2 rotate-180' : 'ml-2'}`} />\n              </Button>\n            </Link>\n          </CardHeader>\n          <CardContent>\n            {featuredOffices.length > 0 ? (\n              <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-4\">\n                {featuredOffices.map((office) => (\n                  <Link key={office.id} href={`/office/${office.slug}`}>\n                    <Card className=\"hover-elevate cursor-pointer h-full\" data-testid={`card-office-${office.id}`}>\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex items-center gap-3 mb-3\">\n                          <Avatar className=\"h-12 w-12 rounded-xl\">\n                            <AvatarImage src={office.logoUrl || ''} />\n                            <AvatarFallback className=\"rounded-xl bg-gradient-to-br from-cyan-500 to-teal-500 text-white\">\n                              {office.name.substring(0, 2).toUpperCase()}\n                            </AvatarFallback>\n                          </Avatar>\n                          <div className=\"flex-1 min-w-0\">\n                            <h3 className=\"font-semibold truncate\">{office.name}</h3>\n                            <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n                              <MapPin className=\"h-3 w-3\" />\n                              <span className=\"truncate\">{office.location || t.welcome.virtual}</span>\n                            </div>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-1 text-sm\">\n                          <Star className=\"h-4 w-4 fill-amber-400 text-amber-400\" />\n                          <span className=\"font-medium\">{t.welcome.premium}</span>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  </Link>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Building2 className=\"h-12 w-12 mx-auto mb-3 opacity-50\" />\n                <p>{t.welcome.noOffices}</p>\n                <p className=\"text-sm\">{t.welcome.checkBack}</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card className=\"glass\" data-testid=\"card-available-services\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-4\">\n            <div>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Package className=\"h-5 w-5 text-violet-500\" />\n                {t.welcome.availableServices}\n              </CardTitle>\n              <CardDescription>{t.welcome.servicesDescription}</CardDescription>\n            </div>\n            <Link href=\"/visitor/services\">\n              <Button variant=\"outline\" size=\"sm\" data-testid=\"button-view-all-services\">\n                {t.welcome.browseAll}\n                <ArrowRight className={`h-4 w-4 ${isRTL ? 'mr-2 rotate-180' : 'ml-2'}`} />\n              </Button>\n            </Link>\n          </CardHeader>\n          <CardContent>\n            {featuredServices.length > 0 ? (\n              <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {featuredServices.map((service) => (\n                  <Card key={service.id} className=\"hover-elevate\" data-testid={`card-service-${service.id}`}>\n                    <CardContent className=\"p-4\">\n                      <div className=\"flex items-start gap-3\">\n                        <div className=\"h-10 w-10 rounded-lg bg-gradient-to-br from-violet-500/20 to-purple-500/20 flex items-center justify-center flex-shrink-0\">\n                          <Package className=\"h-5 w-5 text-violet-500\" />\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <h3 className=\"font-semibold mb-1\">{service.title}</h3>\n                          <p className=\"text-sm text-muted-foreground line-clamp-2\">{service.description}</p>\n                          {service.price && (\n                            <p className=\"text-sm font-medium text-cyan-500 mt-2\">\n                              {service.price} {t.welcome.sar}\n                            </p>\n                          )}\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Package className=\"h-12 w-12 mx-auto mb-3 opacity-50\" />\n                <p>{t.welcome.noServices}</p>\n                <p className=\"text-sm\">{t.welcome.comingSoon}</p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card className=\"glass border-cyan-500/20\" data-testid=\"card-help-section\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex flex-col md:flex-row items-center gap-6\">\n              <div className=\"h-20 w-20 rounded-2xl bg-gradient-to-br from-cyan-500 to-teal-500 flex items-center justify-center flex-shrink-0\">\n                <MessageCircle className=\"h-10 w-10 text-white\" />\n              </div>\n              <div className={`flex-1 text-center ${isRTL ? 'md:text-right' : 'md:text-left'}`}>\n                <h3 className=\"text-xl font-semibold mb-2\">{t.welcome.needHelp}</h3>\n                <p className=\"text-muted-foreground mb-4\">\n                  {t.welcome.helpDescription}\n                </p>\n                <div className={`flex flex-wrap gap-3 justify-center ${isRTL ? 'md:justify-end' : 'md:justify-start'}`}>\n                  <Link href=\"/visitor/contact\">\n                    <Button data-testid=\"button-contact-support\">\n                      <MessageCircle className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n                      {t.welcome.contactSupport}\n                    </Button>\n                  </Link>\n                  <Link href=\"/careers\">\n                    <Button variant=\"outline\" data-testid=\"button-browse-careers\">\n                      <Briefcase className={`h-4 w-4 ${isRTL ? 'ml-2' : 'mr-2'}`} />\n                      {t.welcome.browseCareers}\n                    </Button>\n                  </Link>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":13577,"size_tokens":null},"client/src/pages/EmployeePortal.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Label } from \"@/components/ui/label\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { \n  ClipboardList, \n  ArrowLeft, \n  Mail, \n  CheckCircle2, \n  Clock, \n  AlertCircle,\n  Calendar,\n  User,\n  Building2,\n  Search,\n  Filter,\n  RefreshCw,\n} from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport logoUrl from \"@assets/Photoroom___1764761955587.png\";\nimport type { Task } from \"@shared/schema\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\nexport default function EmployeePortal() {\n  const { language } = useLanguage();\n  const t = translations[language];\n  const [email, setEmail] = useState(\"\");\n  const [submittedEmail, setSubmittedEmail] = useState<string | null>(null);\n  const [activeTab, setActiveTab] = useState(\"all\");\n\n  const { data: tasks = [], isLoading, refetch } = useQuery<Task[]>({\n    queryKey: ['/api/employee/tasks', submittedEmail ?? ''],\n    queryFn: async () => {\n      const response = await fetch(`/api/employee/tasks?email=${encodeURIComponent(submittedEmail!)}`);\n      if (!response.ok) throw new Error('Failed to fetch tasks');\n      return response.json();\n    },\n    enabled: !!submittedEmail,\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (email.trim()) {\n      setSubmittedEmail(email.trim().toLowerCase());\n    }\n  };\n\n  const handleLogout = () => {\n    setSubmittedEmail(null);\n    setEmail(\"\");\n  };\n\n  const getStatusBadge = (status: string) => {\n    const iconMargin = language === 'ar' ? 'ml-1' : 'mr-1';\n    switch (status) {\n      case \"completed\":\n        return <Badge className=\"bg-emerald-500/20 text-emerald-600 border-emerald-500/30\"><CheckCircle2 className={`h-3 w-3 ${iconMargin}`} /> {t.employeePortal?.completed || \"Completed\"}</Badge>;\n      case \"in_progress\":\n        return <Badge className=\"bg-blue-500/20 text-blue-600 border-blue-500/30\"><Clock className={`h-3 w-3 ${iconMargin}`} /> {t.employeePortal?.inProgress || \"In Progress\"}</Badge>;\n      case \"pending\":\n        return <Badge className=\"bg-amber-500/20 text-amber-600 border-amber-500/30\"><AlertCircle className={`h-3 w-3 ${iconMargin}`} /> {t.employeePortal?.pending || \"Pending\"}</Badge>;\n      default:\n        return <Badge variant=\"secondary\">{status}</Badge>;\n    }\n  };\n\n  const getPriorityBadge = (priority: string) => {\n    switch (priority) {\n      case \"high\":\n        return <Badge variant=\"destructive\">{t.employeePortal?.highPriority || \"High Priority\"}</Badge>;\n      case \"medium\":\n        return <Badge className=\"bg-orange-500/20 text-orange-600 border-orange-500/30\">{t.employeePortal?.medium || \"Medium\"}</Badge>;\n      case \"low\":\n        return <Badge variant=\"secondary\">{t.employeePortal?.low || \"Low\"}</Badge>;\n      default:\n        return null;\n    }\n  };\n\n  const filteredTasks = tasks.filter(task => {\n    if (activeTab === \"all\") return true;\n    return task.status === activeTab;\n  });\n\n  const taskStats = {\n    total: tasks.length,\n    pending: tasks.filter(t => t.status === \"pending\").length,\n    inProgress: tasks.filter(t => t.status === \"in_progress\").length,\n    completed: tasks.filter(t => t.status === \"completed\").length,\n  };\n\n  if (!submittedEmail) {\n    return (\n      <div className=\"min-h-screen bg-background flex flex-col\" dir={language === 'ar' ? 'rtl' : 'ltr'}>\n        <header className=\"sticky top-0 z-50 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n          <div className=\"container mx-auto flex items-center justify-between h-16 px-4\">\n            <div className=\"flex items-center gap-3\">\n              <Link href=\"/\">\n                <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back-home\">\n                  <ArrowLeft className=\"h-4 w-4\" />\n                </Button>\n              </Link>\n              <div className=\"flex items-center gap-2\">\n                <img src={logoUrl} alt=\"CloudOffice\" className=\"h-8 w-8 object-contain\" />\n                <span className=\"font-semibold text-lg\">{t.employeePortal?.title || \"Employee Portal\"}</span>\n              </div>\n            </div>\n          </div>\n        </header>\n\n        <main className=\"flex-1 flex items-center justify-center p-4\">\n          <Card className=\"w-full max-w-md\">\n            <CardHeader className=\"text-center\">\n              <div className=\"w-16 h-16 rounded-full bg-emerald-500/10 flex items-center justify-center mx-auto mb-4\">\n                <ClipboardList className=\"h-8 w-8 text-emerald-500\" />\n              </div>\n              <CardTitle className=\"text-2xl\">{t.employeePortal?.title || \"Employee Portal\"}</CardTitle>\n              <CardDescription>\n                {t.employeePortal?.subtitle || \"Enter your email to view your assigned tasks and updates from management\"}\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleSubmit} className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"email\">{t.employeePortal?.workEmail || \"Work Email\"}</Label>\n                  <div className=\"relative\">\n                    <Mail className={`absolute ${language === 'ar' ? 'right-3' : 'left-3'} top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground`} />\n                    <Input\n                      id=\"email\"\n                      type=\"email\"\n                      placeholder={t.employeePortal?.emailPlaceholder || \"your.email@company.com\"}\n                      className={language === 'ar' ? 'pr-9' : 'pl-9'}\n                      value={email}\n                      onChange={(e) => setEmail(e.target.value)}\n                      required\n                      data-testid=\"input-employee-email\"\n                    />\n                  </div>\n                </div>\n                <Button type=\"submit\" className=\"w-full bg-emerald-600 hover:bg-emerald-700\" data-testid=\"button-view-tasks\">\n                  {t.employeePortal?.viewMyTasks || \"View My Tasks\"}\n                </Button>\n              </form>\n              <p className=\"text-xs text-muted-foreground text-center mt-4\">\n                {t.employeePortal?.portalNote || \"This portal is for employees only. Your tasks are assigned by your office manager.\"}\n              </p>\n            </CardContent>\n          </Card>\n        </main>\n\n        <footer className=\"border-t bg-muted/50 py-6\">\n          <div className=\"container mx-auto px-4 text-center text-muted-foreground text-sm\">\n            <p>&copy; {new Date().getFullYear()} CloudOffice. {t.employeePortal?.allRightsReserved || \"All rights reserved.\"}</p>\n          </div>\n        </footer>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\" dir={language === 'ar' ? 'rtl' : 'ltr'}>\n      <header className=\"sticky top-0 z-50 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n        <div className=\"container mx-auto flex items-center justify-between h-16 px-4\">\n          <div className=\"flex items-center gap-3\">\n            <Link href=\"/\">\n              <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-back-home\">\n                <ArrowLeft className=\"h-4 w-4\" />\n              </Button>\n            </Link>\n            <div className=\"flex items-center gap-2\">\n              <img src={logoUrl} alt=\"CloudOffice\" className=\"h-8 w-8 object-contain\" />\n              <span className=\"font-semibold text-lg\">{t.employeePortal?.title || \"Employee Portal\"}</span>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n              <User className=\"h-4 w-4\" />\n              <span className=\"hidden sm:inline\">{submittedEmail}</span>\n            </div>\n            <Button variant=\"outline\" size=\"sm\" onClick={handleLogout} data-testid=\"button-logout\">\n              {t.employeePortal?.switchAccount || \"Switch Account\"}\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"flex-1 container mx-auto p-4 md:p-6 max-w-5xl\">\n        <div className=\"mb-6\">\n          <h1 className=\"text-2xl font-bold mb-2\">{t.employeePortal?.myTasks || \"My Tasks\"}</h1>\n          <p className=\"text-muted-foreground\">{t.employeePortal?.tasksAssigned || \"Tasks assigned to you by management\"}</p>\n        </div>\n\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 mb-6\">\n          <Card className=\"hover-elevate\">\n            <CardContent className=\"p-4 text-center\">\n              <p className=\"text-2xl font-bold\">{taskStats.total}</p>\n              <p className=\"text-xs text-muted-foreground\">{t.employeePortal?.totalTasks || \"Total Tasks\"}</p>\n            </CardContent>\n          </Card>\n          <Card className=\"hover-elevate\">\n            <CardContent className=\"p-4 text-center\">\n              <p className=\"text-2xl font-bold text-amber-500\">{taskStats.pending}</p>\n              <p className=\"text-xs text-muted-foreground\">{t.employeePortal?.pending || \"Pending\"}</p>\n            </CardContent>\n          </Card>\n          <Card className=\"hover-elevate\">\n            <CardContent className=\"p-4 text-center\">\n              <p className=\"text-2xl font-bold text-blue-500\">{taskStats.inProgress}</p>\n              <p className=\"text-xs text-muted-foreground\">{t.employeePortal?.inProgress || \"In Progress\"}</p>\n            </CardContent>\n          </Card>\n          <Card className=\"hover-elevate\">\n            <CardContent className=\"p-4 text-center\">\n              <p className=\"text-2xl font-bold text-emerald-500\">{taskStats.completed}</p>\n              <p className=\"text-xs text-muted-foreground\">{t.employeePortal?.completed || \"Completed\"}</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"flex items-center justify-between gap-4 flex-wrap mb-4\">\n          <Tabs value={activeTab} onValueChange={setActiveTab}>\n            <TabsList>\n              <TabsTrigger value=\"all\" data-testid=\"tab-all\">{t.employeePortal?.all || \"All\"}</TabsTrigger>\n              <TabsTrigger value=\"pending\" data-testid=\"tab-pending\">{t.employeePortal?.pending || \"Pending\"}</TabsTrigger>\n              <TabsTrigger value=\"in_progress\" data-testid=\"tab-in-progress\">{t.employeePortal?.inProgress || \"In Progress\"}</TabsTrigger>\n              <TabsTrigger value=\"completed\" data-testid=\"tab-completed\">{t.employeePortal?.completed || \"Completed\"}</TabsTrigger>\n            </TabsList>\n          </Tabs>\n          <Button variant=\"outline\" size=\"sm\" onClick={() => refetch()} data-testid=\"button-refresh\">\n            <RefreshCw className={`h-4 w-4 ${language === 'ar' ? 'ml-2' : 'mr-2'}`} />\n            {t.employeePortal?.refresh || \"Refresh\"}\n          </Button>\n        </div>\n\n        {isLoading ? (\n          <div className=\"space-y-4\">\n            {[1, 2, 3].map((i) => (\n              <Card key={i} className=\"animate-pulse\">\n                <CardContent className=\"p-4\">\n                  <div className=\"h-4 bg-muted rounded w-1/3 mb-2\"></div>\n                  <div className=\"h-3 bg-muted rounded w-2/3\"></div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        ) : filteredTasks.length === 0 ? (\n          <Card className=\"p-8 text-center\">\n            <ClipboardList className=\"h-12 w-12 mx-auto text-muted-foreground opacity-50 mb-2\" />\n            <p className=\"text-muted-foreground\">\n              {tasks.length === 0 \n                ? (t.employeePortal?.noTasksAssigned || \"No tasks assigned to you yet\")\n                : (t.employeePortal?.noTasksMatch || \"No tasks match this filter\")\n              }\n            </p>\n          </Card>\n        ) : (\n          <div className=\"space-y-3\">\n            {filteredTasks.map((task) => (\n              <Card key={task.id} className=\"hover-elevate\" data-testid={`task-card-${task.id}`}>\n                <CardContent className=\"p-4\">\n                  <div className=\"flex flex-col sm:flex-row sm:items-start justify-between gap-3\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center gap-2 flex-wrap mb-2\">\n                        <h3 className=\"font-semibold\">{task.title}</h3>\n                        {task.priority && getPriorityBadge(task.priority)}\n                      </div>\n                      {task.description && (\n                        <p className=\"text-sm text-muted-foreground mb-3\">{task.description}</p>\n                      )}\n                      <div className=\"flex items-center gap-4 text-xs text-muted-foreground flex-wrap\">\n                        {task.dueDate && (\n                          <span className=\"flex items-center gap-1\">\n                            <Calendar className=\"h-3 w-3\" />\n                            {t.employeePortal?.due || \"Due\"}: {new Date(task.dueDate).toLocaleDateString(language === 'ar' ? 'ar-SA' : 'en-US')}\n                          </span>\n                        )}\n                        {task.createdAt && (\n                          <span className=\"flex items-center gap-1\">\n                            <Clock className=\"h-3 w-3\" />\n                            {t.employeePortal?.created || \"Created\"}: {new Date(task.createdAt).toLocaleDateString(language === 'ar' ? 'ar-SA' : 'en-US')}\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"flex-shrink-0\">\n                      {getStatusBadge(task.status || 'pending')}\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n      </main>\n\n      <footer className=\"border-t bg-muted/50 py-6 mt-auto\">\n        <div className=\"container mx-auto px-4 text-center text-muted-foreground text-sm\">\n          <p>&copy; {new Date().getFullYear()} CloudOffice. {t.employeePortal?.allRightsReserved || \"All rights reserved.\"}</p>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","path":null,"size_bytes":14512,"size_tokens":null},"client/src/lib/webgl-beauty-filter.ts":{"content":"import { Results as FaceMeshResults } from \"@mediapipe/face_mesh\";\n\nconst VERTEX_SHADER = `\n  attribute vec2 a_position;\n  attribute vec2 a_texCoord;\n  varying vec2 v_texCoord;\n  void main() {\n    gl_Position = vec4(a_position, 0.0, 1.0);\n    v_texCoord = a_texCoord;\n  }\n`;\n\nconst FRAGMENT_SHADER = `\n  precision highp float;\n  varying vec2 v_texCoord;\n  uniform sampler2D u_image;\n  uniform sampler2D u_faceMask;\n  uniform sampler2D u_lipMask;\n  uniform sampler2D u_blushMask;\n  uniform sampler2D u_eyeMask;\n  \n  uniform float u_smoothing;\n  uniform float u_brightness;\n  uniform float u_contrast;\n  uniform float u_saturation;\n  uniform float u_warmth;\n  \n  uniform vec3 u_lipColor;\n  uniform float u_lipIntensity;\n  uniform float u_lipGloss;\n  \n  uniform vec3 u_blushColor;\n  uniform float u_blushIntensity;\n  \n  uniform vec3 u_eyeShadowColor;\n  uniform float u_eyeShadowIntensity;\n  \n  uniform vec2 u_resolution;\n  \n  vec3 rgb2hsv(vec3 c) {\n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n    float d = q.x - min(q.w, q.y);\n    float e = 1.0e-10;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n  }\n  \n  vec3 hsv2rgb(vec3 c) {\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n  }\n  \n  float softLight(float base, float blend) {\n    if (blend < 0.5) {\n      return base - (1.0 - 2.0 * blend) * base * (1.0 - base);\n    } else {\n      float d = (base <= 0.25) ? ((16.0 * base - 12.0) * base + 4.0) * base : sqrt(base);\n      return base + (2.0 * blend - 1.0) * (d - base);\n    }\n  }\n  \n  vec3 softLightBlend(vec3 base, vec3 blend) {\n    return vec3(\n      softLight(base.r, blend.r),\n      softLight(base.g, blend.g),\n      softLight(base.b, blend.b)\n    );\n  }\n  \n  vec3 overlayBlend(vec3 base, vec3 blend) {\n    vec3 result;\n    result.r = base.r < 0.5 ? (2.0 * base.r * blend.r) : (1.0 - 2.0 * (1.0 - base.r) * (1.0 - blend.r));\n    result.g = base.g < 0.5 ? (2.0 * base.g * blend.g) : (1.0 - 2.0 * (1.0 - base.g) * (1.0 - blend.g));\n    result.b = base.b < 0.5 ? (2.0 * base.b * blend.b) : (1.0 - 2.0 * (1.0 - base.b) * (1.0 - blend.b));\n    return result;\n  }\n  \n  vec3 multiplyBlend(vec3 base, vec3 blend) {\n    return base * blend;\n  }\n  \n  vec3 adjustSaturation(vec3 color, float saturation) {\n    vec3 hsv = rgb2hsv(color);\n    hsv.y *= saturation;\n    return hsv2rgb(hsv);\n  }\n  \n  vec3 adjustBrightness(vec3 color, float brightness) {\n    return color * brightness;\n  }\n  \n  vec3 adjustContrast(vec3 color, float contrast) {\n    return (color - 0.5) * contrast + 0.5;\n  }\n  \n  vec3 adjustWarmth(vec3 color, float warmth) {\n    color.r += warmth * 0.08;\n    color.b -= warmth * 0.04;\n    return clamp(color, 0.0, 1.0);\n  }\n  \n  vec3 bilateralBlur(sampler2D tex, vec2 uv, float sigma, float faceMaskValue) {\n    // Skip blur if face mask is too low or sigma is minimal\n    if (faceMaskValue < 0.1 || sigma < 0.15) return texture2D(tex, uv).rgb;\n    \n    vec3 center = texture2D(tex, uv).rgb;\n    vec3 sum = center;\n    float weightSum = 1.0;\n    \n    float sigmaTone = 0.1;\n    \n    // Optimized 5-tap cross pattern instead of 7x7 (49 taps)\n    vec2 offsets[4];\n    offsets[0] = vec2(-1.5, 0.0) / u_resolution;\n    offsets[1] = vec2(1.5, 0.0) / u_resolution;\n    offsets[2] = vec2(0.0, -1.5) / u_resolution;\n    offsets[3] = vec2(0.0, 1.5) / u_resolution;\n    \n    for (int i = 0; i < 4; i++) {\n      vec3 sampleColor = texture2D(tex, uv + offsets[i]).rgb;\n      float toneDiff = dot(sampleColor - center, sampleColor - center);\n      float weight = exp(-toneDiff / (2.0 * sigmaTone * sigmaTone)) * 0.8;\n      sum += sampleColor * weight;\n      weightSum += weight;\n    }\n    \n    vec3 blurred = sum / weightSum;\n    float blendFactor = faceMaskValue * sigma * 0.7;\n    return mix(center, blurred, clamp(blendFactor, 0.0, 0.5));\n  }\n  \n  void main() {\n    vec2 uv = v_texCoord;\n    vec4 originalColor = texture2D(u_image, uv);\n    vec3 color = originalColor.rgb;\n    \n    float faceMask = texture2D(u_faceMask, uv).r;\n    float lipMask = texture2D(u_lipMask, uv).r;\n    float blushMask = texture2D(u_blushMask, uv).r;\n    float eyeMask = texture2D(u_eyeMask, uv).r;\n    \n    float skinMask = faceMask * (1.0 - lipMask * 0.9) * (1.0 - eyeMask * 0.95);\n    \n    if (u_smoothing > 0.0) {\n      color = bilateralBlur(u_image, uv, u_smoothing, skinMask);\n    }\n    \n    color = adjustBrightness(color, u_brightness);\n    color = adjustContrast(color, u_contrast);\n    color = adjustSaturation(color, u_saturation);\n    color = adjustWarmth(color, u_warmth);\n    \n    if (u_blushIntensity > 0.0 && blushMask > 0.02) {\n      float smoothBlush = smoothstep(0.0, 0.5, blushMask);\n      vec3 tintedBlush = softLightBlend(color, u_blushColor);\n      float blushAlpha = smoothBlush * u_blushIntensity * 0.35;\n      color = mix(color, tintedBlush, blushAlpha);\n    }\n    \n    if (u_lipIntensity > 0.0 && lipMask > 0.05) {\n      float smoothLip = smoothstep(0.0, 0.4, lipMask);\n      \n      float luminance = dot(color, vec3(0.299, 0.587, 0.114));\n      vec3 lipTint = mix(color * u_lipColor * 1.2, u_lipColor, 0.5);\n      lipTint = mix(lipTint, lipTint * luminance * 1.5, 0.3);\n      \n      float lipAlpha = smoothLip * u_lipIntensity * 0.55;\n      color = mix(color, lipTint, lipAlpha);\n      \n      if (u_lipGloss > 0.0) {\n        float centerY = 0.5;\n        float highlightPos = 1.0 - abs(uv.y - centerY) * 4.0;\n        float glossHighlight = pow(max(0.0, highlightPos), 3.0) * smoothLip;\n        color += vec3(glossHighlight * u_lipGloss * 0.15);\n      }\n    }\n    \n    if (u_eyeShadowIntensity > 0.0 && eyeMask > 0.05) {\n      float smoothEye = smoothstep(0.0, 0.5, eyeMask);\n      vec3 shadowTint = overlayBlend(color, u_eyeShadowColor);\n      float shadowAlpha = smoothEye * u_eyeShadowIntensity * 0.3;\n      color = mix(color, shadowTint, shadowAlpha);\n    }\n    \n    gl_FragColor = vec4(clamp(color, 0.0, 1.0), originalColor.a);\n  }\n`;\n\nexport interface BeautyFilterSettings {\n  smoothing: number;\n  brightness: number;\n  contrast: number;\n  saturation: number;\n  warmth: number;\n  lipColor: [number, number, number];\n  lipIntensity: number;\n  lipGloss: number;\n  blushColor: [number, number, number];\n  blushIntensity: number;\n  eyeShadowColor: [number, number, number];\n  eyeShadowIntensity: number;\n}\n\nexport const defaultSettings: BeautyFilterSettings = {\n  smoothing: 0,\n  brightness: 1.0,\n  contrast: 1.0,\n  saturation: 1.0,\n  warmth: 0,\n  lipColor: [0.9, 0.4, 0.45],\n  lipIntensity: 0,\n  lipGloss: 0,\n  blushColor: [1.0, 0.75, 0.75],\n  blushIntensity: 0,\n  eyeShadowColor: [0.6, 0.5, 0.8],\n  eyeShadowIntensity: 0,\n};\n\nconst LIP_OUTER = [61, 146, 91, 181, 84, 17, 314, 405, 321, 375, 291, 409, 270, 269, 267, 0, 37, 39, 40, 185];\nconst LIP_INNER = [78, 95, 88, 178, 87, 14, 317, 402, 318, 324, 308, 415, 310, 311, 312, 13, 82, 81, 80, 191];\n\nconst LEFT_CHEEK_CENTER = [116, 117, 118, 119, 120, 121, 50, 101];\nconst RIGHT_CHEEK_CENTER = [345, 346, 347, 348, 349, 350, 280, 330];\n\nconst LEFT_EYE_UPPER = [226, 247, 30, 29, 27, 28, 56, 190];\nconst RIGHT_EYE_UPPER = [446, 467, 260, 259, 257, 258, 286, 414];\n\nconst FACE_OUTLINE = [\n  10, 338, 297, 332, 284, 251, 389, 356, 454, 323, 361, 288,\n  397, 365, 379, 378, 400, 377, 152, 148, 176, 149, 150, 136,\n  172, 58, 132, 93, 234, 127, 162, 21, 54, 103, 67, 109, 10\n];\n\ninterface SmoothedLandmark {\n  x: number;\n  y: number;\n  z: number;\n}\n\nexport class WebGLBeautyFilter {\n  private gl: WebGLRenderingContext | null = null;\n  private program: WebGLProgram | null = null;\n  private canvas: HTMLCanvasElement;\n  private videoTexture: WebGLTexture | null = null;\n  private faceMaskTexture: WebGLTexture | null = null;\n  private lipMaskTexture: WebGLTexture | null = null;\n  private blushMaskTexture: WebGLTexture | null = null;\n  private eyeMaskTexture: WebGLTexture | null = null;\n  \n  private faceMaskCanvas: HTMLCanvasElement;\n  private faceMaskCtx: CanvasRenderingContext2D;\n  private lipMaskCanvas: HTMLCanvasElement;\n  private lipMaskCtx: CanvasRenderingContext2D;\n  private blushMaskCanvas: HTMLCanvasElement;\n  private blushMaskCtx: CanvasRenderingContext2D;\n  private eyeMaskCanvas: HTMLCanvasElement;\n  private eyeMaskCtx: CanvasRenderingContext2D;\n  \n  private settings: BeautyFilterSettings = { ...defaultSettings };\n  private initialized = false;\n  \n  private prevLandmarks: SmoothedLandmark[] | null = null;\n  private smoothingFactor = 0.65;\n  \n  constructor() {\n    this.canvas = document.createElement(\"canvas\");\n    \n    this.faceMaskCanvas = document.createElement(\"canvas\");\n    this.faceMaskCtx = this.faceMaskCanvas.getContext(\"2d\", { willReadFrequently: true })!;\n    this.lipMaskCanvas = document.createElement(\"canvas\");\n    this.lipMaskCtx = this.lipMaskCanvas.getContext(\"2d\", { willReadFrequently: true })!;\n    this.blushMaskCanvas = document.createElement(\"canvas\");\n    this.blushMaskCtx = this.blushMaskCanvas.getContext(\"2d\", { willReadFrequently: true })!;\n    this.eyeMaskCanvas = document.createElement(\"canvas\");\n    this.eyeMaskCtx = this.eyeMaskCanvas.getContext(\"2d\", { willReadFrequently: true })!;\n  }\n  \n  initialize(width: number, height: number): boolean {\n    this.canvas.width = width;\n    this.canvas.height = height;\n    \n    [this.faceMaskCanvas, this.lipMaskCanvas, this.blushMaskCanvas, this.eyeMaskCanvas].forEach(c => {\n      c.width = width;\n      c.height = height;\n    });\n    \n    const gl = this.canvas.getContext(\"webgl\", {\n      premultipliedAlpha: false,\n      preserveDrawingBuffer: true,\n      antialias: true,\n    });\n    \n    if (!gl) {\n      console.warn(\"WebGL not supported, falling back to canvas\");\n      return false;\n    }\n    \n    this.gl = gl;\n    \n    const vertexShader = this.createShader(gl.VERTEX_SHADER, VERTEX_SHADER);\n    const fragmentShader = this.createShader(gl.FRAGMENT_SHADER, FRAGMENT_SHADER);\n    \n    if (!vertexShader || !fragmentShader) return false;\n    \n    this.program = gl.createProgram()!;\n    gl.attachShader(this.program, vertexShader);\n    gl.attachShader(this.program, fragmentShader);\n    gl.linkProgram(this.program);\n    \n    if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\n      console.error(\"Program link error:\", gl.getProgramInfoLog(this.program));\n      return false;\n    }\n    \n    this.setupBuffers();\n    this.setupTextures();\n    \n    this.initialized = true;\n    return true;\n  }\n  \n  private createShader(type: number, source: string): WebGLShader | null {\n    const gl = this.gl!;\n    const shader = gl.createShader(type)!;\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n    \n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      console.error(\"Shader compile error:\", gl.getShaderInfoLog(shader));\n      gl.deleteShader(shader);\n      return null;\n    }\n    \n    return shader;\n  }\n  \n  private setupBuffers() {\n    const gl = this.gl!;\n    \n    const positions = new Float32Array([\n      -1, -1,  1, -1,  -1, 1,\n      -1, 1,   1, -1,   1, 1,\n    ]);\n    \n    const texCoords = new Float32Array([\n      0, 1,  1, 1,  0, 0,\n      0, 0,  1, 1,  1, 0,\n    ]);\n    \n    const positionBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, positions, gl.STATIC_DRAW);\n    \n    const positionLoc = gl.getAttribLocation(this.program!, \"a_position\");\n    gl.enableVertexAttribArray(positionLoc);\n    gl.vertexAttribPointer(positionLoc, 2, gl.FLOAT, false, 0, 0);\n    \n    const texCoordBuffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, texCoordBuffer);\n    gl.bufferData(gl.ARRAY_BUFFER, texCoords, gl.STATIC_DRAW);\n    \n    const texCoordLoc = gl.getAttribLocation(this.program!, \"a_texCoord\");\n    gl.enableVertexAttribArray(texCoordLoc);\n    gl.vertexAttribPointer(texCoordLoc, 2, gl.FLOAT, false, 0, 0);\n  }\n  \n  private setupTextures() {\n    this.videoTexture = this.createTexture();\n    this.faceMaskTexture = this.createTexture();\n    this.lipMaskTexture = this.createTexture();\n    this.blushMaskTexture = this.createTexture();\n    this.eyeMaskTexture = this.createTexture();\n  }\n  \n  private createTexture(): WebGLTexture {\n    const gl = this.gl!;\n    const texture = gl.createTexture()!;\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    return texture;\n  }\n  \n  updateSettings(settings: Partial<BeautyFilterSettings>) {\n    this.settings = { ...this.settings, ...settings };\n  }\n  \n  private smoothLandmarks(landmarks: any[]): SmoothedLandmark[] {\n    const currentLandmarks: SmoothedLandmark[] = landmarks.map(lm => ({\n      x: lm.x,\n      y: lm.y,\n      z: lm.z || 0\n    }));\n    \n    if (!this.prevLandmarks || this.prevLandmarks.length !== currentLandmarks.length) {\n      this.prevLandmarks = currentLandmarks;\n      return currentLandmarks;\n    }\n    \n    const smoothed: SmoothedLandmark[] = [];\n    \n    for (let i = 0; i < currentLandmarks.length; i++) {\n      const prev = this.prevLandmarks[i];\n      const curr = currentLandmarks[i];\n      \n      const dx = curr.x - prev.x;\n      const dy = curr.y - prev.y;\n      const motion = Math.sqrt(dx * dx + dy * dy);\n      \n      let adaptiveAlpha: number;\n      if (motion > 0.03) {\n        adaptiveAlpha = 0.35;\n      } else if (motion > 0.01) {\n        adaptiveAlpha = 0.55;\n      } else {\n        adaptiveAlpha = 0.75;\n      }\n      \n      adaptiveAlpha = Math.max(0.35, Math.min(0.85, adaptiveAlpha));\n      \n      smoothed.push({\n        x: prev.x * adaptiveAlpha + curr.x * (1 - adaptiveAlpha),\n        y: prev.y * adaptiveAlpha + curr.y * (1 - adaptiveAlpha),\n        z: prev.z * adaptiveAlpha + curr.z * (1 - adaptiveAlpha),\n      });\n    }\n    \n    this.prevLandmarks = smoothed;\n    return smoothed;\n  }\n  \n  updateFaceMesh(results: FaceMeshResults | null) {\n    if (!results?.multiFaceLandmarks?.[0]) {\n      this.clearMasks();\n      this.prevLandmarks = null;\n      return;\n    }\n    \n    const rawLandmarks = results.multiFaceLandmarks[0];\n    const landmarks = this.smoothLandmarks(rawLandmarks);\n    const width = this.canvas.width;\n    const height = this.canvas.height;\n    \n    this.drawFaceMask(landmarks, width, height);\n    this.drawLipMask(landmarks, width, height);\n    this.drawBlushMask(landmarks, width, height);\n    this.drawEyeMask(landmarks, width, height);\n  }\n  \n  private clearMasks() {\n    [this.faceMaskCtx, this.lipMaskCtx, this.blushMaskCtx, this.eyeMaskCtx].forEach(ctx => {\n      ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n    });\n  }\n  \n  private drawFaceMask(landmarks: SmoothedLandmark[], width: number, height: number) {\n    const ctx = this.faceMaskCtx;\n    ctx.clearRect(0, 0, width, height);\n    \n    ctx.fillStyle = \"white\";\n    ctx.beginPath();\n    \n    FACE_OUTLINE.forEach((idx, i) => {\n      const point = landmarks[idx];\n      const x = point.x * width;\n      const y = point.y * height;\n      if (i === 0) ctx.moveTo(x, y);\n      else ctx.lineTo(x, y);\n    });\n    \n    ctx.closePath();\n    ctx.fill();\n    \n    ctx.filter = \"blur(20px)\";\n    ctx.drawImage(this.faceMaskCanvas, 0, 0);\n    ctx.filter = \"none\";\n  }\n  \n  private drawLipMask(landmarks: SmoothedLandmark[], width: number, height: number) {\n    const ctx = this.lipMaskCtx;\n    ctx.clearRect(0, 0, width, height);\n    \n    let centerX = 0, centerY = 0;\n    let minX = Infinity, maxX = -Infinity;\n    let minY = Infinity, maxY = -Infinity;\n    \n    LIP_OUTER.forEach(idx => {\n      const point = landmarks[idx];\n      const x = point.x * width;\n      const y = point.y * height;\n      centerX += x;\n      centerY += y;\n      minX = Math.min(minX, x);\n      maxX = Math.max(maxX, x);\n      minY = Math.min(minY, y);\n      maxY = Math.max(maxY, y);\n    });\n    \n    centerX /= LIP_OUTER.length;\n    centerY /= LIP_OUTER.length;\n    \n    const lipWidth = maxX - minX;\n    const lipHeight = maxY - minY;\n    \n    ctx.save();\n    \n    ctx.beginPath();\n    LIP_OUTER.forEach((idx, i) => {\n      const point = landmarks[idx];\n      const x = point.x * width;\n      const y = point.y * height;\n      if (i === 0) ctx.moveTo(x, y);\n      else ctx.lineTo(x, y);\n    });\n    ctx.closePath();\n    \n    LIP_INNER.forEach((idx, i) => {\n      const point = landmarks[idx];\n      const x = point.x * width;\n      const y = point.y * height;\n      if (i === 0) ctx.moveTo(x, y);\n      else ctx.lineTo(x, y);\n    });\n    ctx.closePath();\n    \n    ctx.clip(\"evenodd\");\n    \n    const gradient = ctx.createRadialGradient(\n      centerX, centerY, 0,\n      centerX, centerY, Math.max(lipWidth, lipHeight) * 0.7\n    );\n    gradient.addColorStop(0, \"rgba(255, 255, 255, 1.0)\");\n    gradient.addColorStop(0.5, \"rgba(255, 255, 255, 0.95)\");\n    gradient.addColorStop(0.8, \"rgba(255, 255, 255, 0.7)\");\n    gradient.addColorStop(1.0, \"rgba(255, 255, 255, 0.2)\");\n    \n    ctx.fillStyle = gradient;\n    ctx.fillRect(minX - 10, minY - 10, lipWidth + 20, lipHeight + 20);\n    \n    ctx.restore();\n    \n    ctx.filter = \"blur(3px)\";\n    ctx.drawImage(this.lipMaskCanvas, 0, 0);\n    ctx.filter = \"none\";\n  }\n  \n  private drawBlushMask(landmarks: SmoothedLandmark[], width: number, height: number) {\n    const ctx = this.blushMaskCtx;\n    ctx.clearRect(0, 0, width, height);\n    \n    const faceWidth = Math.abs(landmarks[234].x - landmarks[454].x) * width;\n    const baseRadius = faceWidth * 0.12;\n    \n    const drawCheek = (indices: number[], offsetX: number, offsetY: number) => {\n      let centerX = 0, centerY = 0;\n      indices.forEach(idx => {\n        centerX += landmarks[idx].x;\n        centerY += landmarks[idx].y;\n      });\n      centerX = (centerX / indices.length) * width + offsetX;\n      centerY = (centerY / indices.length) * height + offsetY;\n      \n      const radiusX = baseRadius * 1.3;\n      const radiusY = baseRadius * 0.9;\n      \n      const gradient = ctx.createRadialGradient(\n        centerX, centerY, 0,\n        centerX, centerY, Math.max(radiusX, radiusY)\n      );\n      gradient.addColorStop(0, \"rgba(255, 255, 255, 0.7)\");\n      gradient.addColorStop(0.3, \"rgba(255, 255, 255, 0.5)\");\n      gradient.addColorStop(0.6, \"rgba(255, 255, 255, 0.25)\");\n      gradient.addColorStop(1, \"rgba(255, 255, 255, 0)\");\n      \n      ctx.save();\n      ctx.translate(centerX, centerY);\n      ctx.scale(radiusX / radiusY, 1);\n      ctx.translate(-centerX, -centerY);\n      \n      ctx.fillStyle = gradient;\n      ctx.beginPath();\n      ctx.arc(centerX, centerY, radiusY, 0, Math.PI * 2);\n      ctx.fill();\n      \n      ctx.restore();\n    };\n    \n    drawCheek(LEFT_CHEEK_CENTER, -width * 0.01, height * 0.02);\n    drawCheek(RIGHT_CHEEK_CENTER, width * 0.01, height * 0.02);\n  }\n  \n  private drawEyeMask(landmarks: SmoothedLandmark[], width: number, height: number) {\n    const ctx = this.eyeMaskCtx;\n    ctx.clearRect(0, 0, width, height);\n    \n    const drawEyeShadow = (indices: number[], isLeft: boolean) => {\n      let centerX = 0, centerY = 0;\n      let minY = Infinity, maxY = -Infinity;\n      let minX = Infinity, maxX = -Infinity;\n      \n      indices.forEach(idx => {\n        const point = landmarks[idx];\n        const x = point.x * width;\n        const y = point.y * height;\n        centerX += x;\n        centerY += y;\n        minX = Math.min(minX, x);\n        maxX = Math.max(maxX, x);\n        minY = Math.min(minY, y);\n        maxY = Math.max(maxY, y);\n      });\n      \n      centerX /= indices.length;\n      centerY /= indices.length;\n      \n      const eyeWidth = maxX - minX;\n      const eyeHeight = maxY - minY;\n      \n      centerY -= eyeHeight * 0.3;\n      \n      const gradient = ctx.createRadialGradient(\n        centerX, centerY, 0,\n        centerX, centerY, eyeWidth * 0.6\n      );\n      gradient.addColorStop(0, \"rgba(255, 255, 255, 0.6)\");\n      gradient.addColorStop(0.5, \"rgba(255, 255, 255, 0.3)\");\n      gradient.addColorStop(1, \"rgba(255, 255, 255, 0)\");\n      \n      ctx.fillStyle = gradient;\n      ctx.beginPath();\n      ctx.ellipse(centerX, centerY, eyeWidth * 0.5, eyeHeight * 0.8, 0, 0, Math.PI * 2);\n      ctx.fill();\n    };\n    \n    drawEyeShadow(LEFT_EYE_UPPER, true);\n    drawEyeShadow(RIGHT_EYE_UPPER, false);\n    \n    ctx.filter = \"blur(10px)\";\n    ctx.drawImage(this.eyeMaskCanvas, 0, 0);\n    ctx.filter = \"none\";\n  }\n  \n  render(source: HTMLVideoElement | HTMLCanvasElement): HTMLCanvasElement {\n    if (!this.initialized || !this.gl || !this.program) {\n      return this.fallbackRender(source);\n    }\n    \n    const gl = this.gl;\n    \n    gl.useProgram(this.program);\n    \n    gl.activeTexture(gl.TEXTURE0);\n    gl.bindTexture(gl.TEXTURE_2D, this.videoTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, source);\n    gl.uniform1i(gl.getUniformLocation(this.program, \"u_image\"), 0);\n    \n    gl.activeTexture(gl.TEXTURE1);\n    gl.bindTexture(gl.TEXTURE_2D, this.faceMaskTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.faceMaskCanvas);\n    gl.uniform1i(gl.getUniformLocation(this.program, \"u_faceMask\"), 1);\n    \n    gl.activeTexture(gl.TEXTURE2);\n    gl.bindTexture(gl.TEXTURE_2D, this.lipMaskTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.lipMaskCanvas);\n    gl.uniform1i(gl.getUniformLocation(this.program, \"u_lipMask\"), 2);\n    \n    gl.activeTexture(gl.TEXTURE3);\n    gl.bindTexture(gl.TEXTURE_2D, this.blushMaskTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.blushMaskCanvas);\n    gl.uniform1i(gl.getUniformLocation(this.program, \"u_blushMask\"), 3);\n    \n    gl.activeTexture(gl.TEXTURE4);\n    gl.bindTexture(gl.TEXTURE_2D, this.eyeMaskTexture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this.eyeMaskCanvas);\n    gl.uniform1i(gl.getUniformLocation(this.program, \"u_eyeMask\"), 4);\n    \n    gl.uniform1f(gl.getUniformLocation(this.program, \"u_smoothing\"), this.settings.smoothing);\n    gl.uniform1f(gl.getUniformLocation(this.program, \"u_brightness\"), this.settings.brightness);\n    gl.uniform1f(gl.getUniformLocation(this.program, \"u_contrast\"), this.settings.contrast);\n    gl.uniform1f(gl.getUniformLocation(this.program, \"u_saturation\"), this.settings.saturation);\n    gl.uniform1f(gl.getUniformLocation(this.program, \"u_warmth\"), this.settings.warmth);\n    \n    gl.uniform3f(gl.getUniformLocation(this.program, \"u_lipColor\"), ...this.settings.lipColor);\n    gl.uniform1f(gl.getUniformLocation(this.program, \"u_lipIntensity\"), this.settings.lipIntensity);\n    gl.uniform1f(gl.getUniformLocation(this.program, \"u_lipGloss\"), this.settings.lipGloss);\n    \n    gl.uniform3f(gl.getUniformLocation(this.program, \"u_blushColor\"), ...this.settings.blushColor);\n    gl.uniform1f(gl.getUniformLocation(this.program, \"u_blushIntensity\"), this.settings.blushIntensity);\n    \n    gl.uniform3f(gl.getUniformLocation(this.program, \"u_eyeShadowColor\"), ...this.settings.eyeShadowColor);\n    gl.uniform1f(gl.getUniformLocation(this.program, \"u_eyeShadowIntensity\"), this.settings.eyeShadowIntensity);\n    \n    gl.uniform2f(gl.getUniformLocation(this.program, \"u_resolution\"), this.canvas.width, this.canvas.height);\n    \n    gl.viewport(0, 0, this.canvas.width, this.canvas.height);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n    \n    return this.canvas;\n  }\n  \n  private fallbackRender(source: HTMLVideoElement | HTMLCanvasElement): HTMLCanvasElement {\n    const ctx = this.canvas.getContext(\"2d\");\n    if (!ctx) return this.canvas;\n    \n    ctx.drawImage(source, 0, 0, this.canvas.width, this.canvas.height);\n    \n    if (this.settings.smoothing > 0) {\n      ctx.filter = `blur(${this.settings.smoothing * 1.5}px)`;\n      ctx.globalAlpha = this.settings.smoothing * 0.4;\n      ctx.drawImage(this.canvas, 0, 0);\n      ctx.globalAlpha = 1;\n      ctx.filter = \"none\";\n    }\n    \n    const filters: string[] = [];\n    if (this.settings.brightness !== 1) filters.push(`brightness(${this.settings.brightness})`);\n    if (this.settings.contrast !== 1) filters.push(`contrast(${this.settings.contrast})`);\n    if (this.settings.saturation !== 1) filters.push(`saturate(${this.settings.saturation})`);\n    if (this.settings.warmth > 0) filters.push(`sepia(${this.settings.warmth * 0.15})`);\n    \n    if (filters.length > 0) {\n      ctx.filter = filters.join(\" \");\n      ctx.drawImage(this.canvas, 0, 0);\n      ctx.filter = \"none\";\n    }\n    \n    return this.canvas;\n  }\n  \n  getCanvas(): HTMLCanvasElement {\n    return this.canvas;\n  }\n  \n  destroy() {\n    if (this.gl) {\n      this.gl.deleteProgram(this.program);\n      this.gl.deleteTexture(this.videoTexture);\n      this.gl.deleteTexture(this.faceMaskTexture);\n      this.gl.deleteTexture(this.lipMaskTexture);\n      this.gl.deleteTexture(this.blushMaskTexture);\n      this.gl.deleteTexture(this.eyeMaskTexture);\n    }\n    this.initialized = false;\n    this.prevLandmarks = null;\n  }\n}\n\nexport function hexToRgb(hex: string): [number, number, number] {\n  const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n  if (result) {\n    return [\n      parseInt(result[1], 16) / 255,\n      parseInt(result[2], 16) / 255,\n      parseInt(result[3], 16) / 255,\n    ];\n  }\n  return [1, 1, 1];\n}\n\nexport function createFilterSettings(filter: {\n  smooth?: number;\n  brighten?: number;\n  lipTint?: { intensity: number; color: string };\n  lipGloss?: { intensity: number; color: string };\n  blush?: { intensity: number; color: string };\n  eyeShadow?: { intensity: number; color: string };\n  colorFilter?: { filter?: string };\n}): Partial<BeautyFilterSettings> {\n  const settings: Partial<BeautyFilterSettings> = {};\n  \n  if (filter.smooth !== undefined) {\n    settings.smoothing = filter.smooth / 100;\n  }\n  \n  if (filter.brighten !== undefined) {\n    settings.brightness = 1 + (filter.brighten / 100) * 0.25;\n  }\n  \n  if (filter.lipTint) {\n    settings.lipColor = hexToRgb(filter.lipTint.color);\n    settings.lipIntensity = filter.lipTint.intensity / 100;\n  }\n  \n  if (filter.lipGloss) {\n    settings.lipGloss = filter.lipGloss.intensity / 100;\n  }\n  \n  if (filter.blush) {\n    settings.blushColor = hexToRgb(filter.blush.color);\n    settings.blushIntensity = filter.blush.intensity / 100;\n  }\n  \n  if (filter.eyeShadow) {\n    settings.eyeShadowColor = hexToRgb(filter.eyeShadow.color);\n    settings.eyeShadowIntensity = filter.eyeShadow.intensity / 100;\n  }\n  \n  if (filter.colorFilter?.filter) {\n    const filterStr = filter.colorFilter.filter;\n    \n    const satMatch = filterStr.match(/saturate\\(([\\d.]+)\\)/);\n    if (satMatch) settings.saturation = parseFloat(satMatch[1]);\n    \n    const brightMatch = filterStr.match(/brightness\\(([\\d.]+)\\)/);\n    if (brightMatch) settings.brightness = parseFloat(brightMatch[1]);\n    \n    const sepiaMatch = filterStr.match(/sepia\\(([\\d.]+)\\)/);\n    if (sepiaMatch) settings.warmth = parseFloat(sepiaMatch[1]) * 2;\n  }\n  \n  return settings;\n}\n","path":null,"size_bytes":27182,"size_tokens":null},"client/src/components/StatusViewer.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { UserAvatar } from \"./UserAvatar\";\nimport { Dialog, DialogContent, DialogTitle } from \"@/components/ui/dialog\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { \n  X, \n  MessageCircle, \n  UserPlus, \n  UserCheck, \n  Eye, \n  Send,\n  ChevronLeft,\n  ChevronRight,\n  Pause,\n  Play,\n  Heart\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { ar } from \"date-fns/locale\";\n\ninterface StatusAuthor {\n  id: string;\n  name: string;\n  avatar: string | null;\n}\n\ninterface StatusOffice {\n  id: number;\n  name: string;\n  logo: string | null;\n}\n\ninterface StatusData {\n  id: number;\n  authorId: string;\n  officeId: number | null;\n  mediaUrl: string;\n  mediaType: string | null;\n  caption: string | null;\n  expiresAt: string;\n  viewCount: number | null;\n  createdAt: string | null;\n  author: StatusAuthor | null;\n  office: StatusOffice | null;\n  replyCount?: number;\n  likeCount?: number;\n  isLiked?: boolean;\n  isFollowingOffice?: boolean;\n}\n\ninterface StatusReply {\n  id: number;\n  statusId: number;\n  senderId: string;\n  message: string;\n  isRead: boolean | null;\n  createdAt: string | null;\n  sender: StatusAuthor | null;\n}\n\ninterface StatusViewerProps {\n  statuses: StatusData[];\n  initialIndex?: number;\n  open: boolean;\n  onClose: () => void;\n  currentUserId?: string;\n}\n\nexport function StatusViewer({ \n  statuses, \n  initialIndex = 0, \n  open, \n  onClose,\n  currentUserId \n}: StatusViewerProps) {\n  const [currentIndex, setCurrentIndex] = useState(initialIndex);\n  const [isPaused, setIsPaused] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [showReplies, setShowReplies] = useState(false);\n  const [replyMessage, setReplyMessage] = useState(\"\");\n  const progressInterval = useRef<NodeJS.Timeout | null>(null);\n  const STORY_DURATION = 10000;\n  \n  const currentStatus = statuses[currentIndex];\n\n  useEffect(() => {\n    setCurrentIndex(initialIndex);\n  }, [initialIndex]);\n\n  const { data: statusDetail, refetch: refetchStatusDetail } = useQuery<StatusData>({\n    queryKey: ['/api/statuses', currentStatus?.id],\n    enabled: open && !!currentStatus?.id\n  });\n\n  useEffect(() => {\n    if (open && currentStatus?.id) {\n      refetchStatusDetail();\n    }\n  }, [open, currentStatus?.id]);\n\n  const activeStatus = statusDetail ?? currentStatus;\n\n  useEffect(() => {\n    if (!open || isPaused || showReplies) {\n      if (progressInterval.current) {\n        clearInterval(progressInterval.current);\n      }\n      return;\n    }\n\n    setProgress(0);\n    const startTime = Date.now();\n    \n    progressInterval.current = setInterval(() => {\n      const elapsed = Date.now() - startTime;\n      const newProgress = (elapsed / STORY_DURATION) * 100;\n      \n      if (newProgress >= 100) {\n        handleNext();\n      } else {\n        setProgress(newProgress);\n      }\n    }, 50);\n\n    return () => {\n      if (progressInterval.current) {\n        clearInterval(progressInterval.current);\n      }\n    };\n  }, [currentIndex, open, isPaused, showReplies]);\n\n  const { data: replies = [], refetch: refetchReplies } = useQuery<StatusReply[]>({\n    queryKey: ['/api/statuses', activeStatus?.id, 'replies'],\n    enabled: open && !!activeStatus && showReplies\n  });\n\n  const { data: followStatus, refetch: refetchFollowStatus } = useQuery({\n    queryKey: ['/api/offices', activeStatus?.office?.id, 'follow'],\n    enabled: open && !!activeStatus?.office?.id\n  });\n\n  const followMutation = useMutation({\n    mutationFn: async (officeId: number) => {\n      return apiRequest('POST', `/api/offices/${officeId}/follow`);\n    },\n    onSuccess: () => {\n      if (activeStatus?.office?.id) {\n        queryClient.invalidateQueries({ \n          queryKey: ['/api/offices', activeStatus.office.id, 'follow'] \n        });\n        queryClient.invalidateQueries({ queryKey: ['/api/statuses'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/statuses', activeStatus.id] });\n      }\n    }\n  });\n\n  const unfollowMutation = useMutation({\n    mutationFn: async (officeId: number) => {\n      return apiRequest('DELETE', `/api/offices/${officeId}/follow`);\n    },\n    onSuccess: () => {\n      if (activeStatus?.office?.id) {\n        queryClient.invalidateQueries({ \n          queryKey: ['/api/offices', activeStatus.office.id, 'follow'] \n        });\n        queryClient.invalidateQueries({ queryKey: ['/api/statuses'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/statuses', activeStatus.id] });\n      }\n    }\n  });\n\n  const replyMutation = useMutation({\n    mutationFn: async ({ statusId, message }: { statusId: number; message: string }) => {\n      return apiRequest('POST', `/api/statuses/${statusId}/replies`, { message });\n    },\n    onSuccess: () => {\n      setReplyMessage(\"\");\n      refetchReplies();\n      queryClient.invalidateQueries({ queryKey: ['/api/statuses'] });\n      if (activeStatus?.id) {\n        queryClient.invalidateQueries({ queryKey: ['/api/statuses', activeStatus.id] });\n      }\n    }\n  });\n\n  const likeMutation = useMutation({\n    mutationFn: async (statusId: number) => {\n      return apiRequest('POST', `/api/statuses/${statusId}/like`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/statuses'] });\n      if (activeStatus?.id) {\n        queryClient.invalidateQueries({ queryKey: ['/api/statuses', activeStatus.id] });\n      }\n    }\n  });\n\n  const unlikeMutation = useMutation({\n    mutationFn: async (statusId: number) => {\n      return apiRequest('DELETE', `/api/statuses/${statusId}/like`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/statuses'] });\n      if (activeStatus?.id) {\n        queryClient.invalidateQueries({ queryKey: ['/api/statuses', activeStatus.id] });\n      }\n    }\n  });\n\n  const handleLikeToggle = () => {\n    if (!activeStatus) return;\n    if (activeStatus.isLiked) {\n      unlikeMutation.mutate(activeStatus.id);\n    } else {\n      likeMutation.mutate(activeStatus.id);\n    }\n  };\n\n  const handlePrevious = () => {\n    if (currentIndex > 0) {\n      setCurrentIndex(currentIndex - 1);\n      setProgress(0);\n    }\n  };\n\n  const handleNext = () => {\n    if (currentIndex < statuses.length - 1) {\n      setCurrentIndex(currentIndex + 1);\n      setProgress(0);\n    } else {\n      onClose();\n    }\n  };\n\n  const handleFollowToggle = () => {\n    if (!activeStatus?.office?.id) return;\n    \n    const isFollowingOffice = (followStatus as any)?.isFollowing ?? activeStatus.isFollowingOffice;\n    \n    if (isFollowingOffice) {\n      unfollowMutation.mutate(activeStatus.office.id);\n    } else {\n      followMutation.mutate(activeStatus.office.id);\n    }\n  };\n\n  const handleSendReply = () => {\n    if (!replyMessage.trim() || !activeStatus) return;\n    replyMutation.mutate({ \n      statusId: activeStatus.id, \n      message: replyMessage.trim() \n    });\n  };\n\n  const isFollowing = (followStatus as any)?.isFollowing ?? activeStatus?.isFollowingOffice;\n  const isOwnStatus = activeStatus?.authorId === currentUserId;\n\n  if (!activeStatus) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={(open) => !open && onClose()}>\n      <DialogContent className=\"max-w-lg w-full h-[90vh] max-h-[800px] p-0 bg-black border-none overflow-hidden\">\n        <DialogTitle className=\"sr-only\">View Status</DialogTitle>\n        \n        <div className=\"relative w-full h-full flex flex-col\">\n          <div className=\"absolute top-2 left-2 right-2 z-20 flex gap-1\">\n            {statuses.map((_, idx) => (\n              <div \n                key={idx}\n                className=\"flex-1 h-0.5 bg-white/30 rounded-full overflow-hidden\"\n              >\n                <div \n                  className={cn(\n                    \"h-full bg-white transition-all duration-100\",\n                    idx < currentIndex ? \"w-full\" : idx === currentIndex ? \"\" : \"w-0\"\n                  )}\n                  style={{ \n                    width: idx === currentIndex ? `${progress}%` : undefined \n                  }}\n                />\n              </div>\n            ))}\n          </div>\n\n          <div className=\"absolute top-6 left-2 right-2 z-20 flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              <UserAvatar \n                name={activeStatus.author?.name || \"Unknown\"} \n                avatar={activeStatus.author?.avatar}\n                size=\"md\"\n              />\n              <div className=\"flex flex-col\">\n                <span className=\"text-white font-medium text-sm\">\n                  {activeStatus.author?.name || \"Unknown\"}\n                </span>\n                <span className=\"text-white/60 text-xs\">\n                  {activeStatus.createdAt && formatDistanceToNow(new Date(activeStatus.createdAt), { \n                    addSuffix: true,\n                    locale: ar \n                  })}\n                </span>\n              </div>\n            </div>\n            \n            <div className=\"flex items-center gap-2\">\n              {activeStatus.office && !isOwnStatus && (\n                <Button\n                  size=\"sm\"\n                  variant={isFollowing ? \"secondary\" : \"default\"}\n                  className={cn(\n                    \"h-7 text-xs gap-1\",\n                    isFollowing \n                      ? \"bg-white/20 hover:bg-white/30 text-white\" \n                      : \"bg-primary hover:bg-primary/90\"\n                  )}\n                  onClick={handleFollowToggle}\n                  disabled={followMutation.isPending || unfollowMutation.isPending}\n                  data-testid=\"button-follow-office\"\n                >\n                  {isFollowing ? (\n                    <>\n                      <UserCheck className=\"w-3.5 h-3.5\" />\n                      \n                    </>\n                  ) : (\n                    <>\n                      <UserPlus className=\"w-3.5 h-3.5\" />\n                      \n                    </>\n                  )}\n                </Button>\n              )}\n              \n              <Button\n                size=\"icon\"\n                variant=\"ghost\"\n                className=\"h-8 w-8 text-white hover:bg-white/20\"\n                onClick={() => setIsPaused(!isPaused)}\n                data-testid=\"button-pause-play\"\n              >\n                {isPaused ? <Play className=\"w-4 h-4\" /> : <Pause className=\"w-4 h-4\" />}\n              </Button>\n              \n              <Button\n                size=\"icon\"\n                variant=\"ghost\"\n                className=\"h-8 w-8 text-white hover:bg-white/20\"\n                onClick={onClose}\n                data-testid=\"button-close-status\"\n              >\n                <X className=\"w-5 h-5\" />\n              </Button>\n            </div>\n          </div>\n\n          <div \n            className=\"flex-1 w-full bg-black relative\"\n            onClick={(e) => {\n              const rect = e.currentTarget.getBoundingClientRect();\n              const x = e.clientX - rect.left;\n              if (x < rect.width / 3) {\n                handlePrevious();\n              } else if (x > (rect.width * 2) / 3) {\n                handleNext();\n              }\n            }}\n          >\n            {activeStatus.mediaType === \"video\" ? (\n              <video\n                src={activeStatus.mediaUrl}\n                className=\"w-full h-full object-contain\"\n                autoPlay\n                loop\n                playsInline\n              />\n            ) : (\n              <img\n                src={activeStatus.mediaUrl}\n                alt=\"\"\n                className=\"w-full h-full object-contain\"\n              />\n            )}\n            \n            {activeStatus.caption && (\n              <div className=\"absolute bottom-24 left-4 right-4 text-center\">\n                <p className=\"text-white text-lg font-medium drop-shadow-lg bg-black/30 rounded-lg px-4 py-2\">\n                  {activeStatus.caption}\n                </p>\n              </div>\n            )}\n\n            {currentIndex > 0 && (\n              <button\n                className=\"absolute left-2 top-1/2 -translate-y-1/2 w-10 h-10 flex items-center justify-center text-white/50 hover:text-white\"\n                onClick={handlePrevious}\n                data-testid=\"button-previous-status\"\n              >\n                <ChevronLeft className=\"w-8 h-8\" />\n              </button>\n            )}\n            \n            {currentIndex < statuses.length - 1 && (\n              <button\n                className=\"absolute right-2 top-1/2 -translate-y-1/2 w-10 h-10 flex items-center justify-center text-white/50 hover:text-white\"\n                onClick={handleNext}\n                data-testid=\"button-next-status\"\n              >\n                <ChevronRight className=\"w-8 h-8\" />\n              </button>\n            )}\n          </div>\n\n          <div className=\"absolute bottom-0 left-0 right-0 z-20 p-3 bg-gradient-to-t from-black/80 to-transparent\">\n            {isOwnStatus ? (\n              <div className=\"flex items-center justify-center gap-4 text-white/80 text-sm\">\n                <div className=\"flex items-center gap-1\">\n                  <Eye className=\"w-4 h-4\" />\n                  <span>{activeStatus.viewCount || 0} </span>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                  <Heart className=\"w-4 h-4\" />\n                  <span>{activeStatus.likeCount || 0} </span>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                  <MessageCircle className=\"w-4 h-4\" />\n                  <span>{activeStatus.replyCount || 0} </span>\n                </div>\n              </div>\n            ) : (\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  size=\"icon\"\n                  variant=\"ghost\"\n                  className={cn(\n                    \"h-10 w-10 shrink-0 transition-colors\",\n                    activeStatus.isLiked \n                      ? \"text-red-500 hover:bg-red-500/20\" \n                      : \"text-white hover:bg-white/20\"\n                  )}\n                  onClick={handleLikeToggle}\n                  disabled={likeMutation.isPending || unlikeMutation.isPending}\n                  data-testid=\"button-like-status\"\n                >\n                  <Heart className={cn(\"w-5 h-5\", activeStatus.isLiked && \"fill-current\")} />\n                </Button>\n                \n                <Button\n                  size=\"icon\"\n                  variant=\"ghost\"\n                  className={cn(\n                    \"h-10 w-10 text-white hover:bg-white/20 shrink-0\",\n                    showReplies && \"bg-white/20\"\n                  )}\n                  onClick={() => setShowReplies(!showReplies)}\n                  data-testid=\"button-toggle-replies\"\n                >\n                  <MessageCircle className=\"w-5 h-5\" />\n                </Button>\n                \n                <div className=\"flex-1 flex items-center gap-2 bg-white/10 rounded-full px-3 py-1\">\n                  <Input\n                    type=\"text\"\n                    placeholder=\"  ...\"\n                    value={replyMessage}\n                    onChange={(e) => setReplyMessage(e.target.value)}\n                    onKeyDown={(e) => {\n                      if (e.key === \"Enter\" && !e.shiftKey) {\n                        e.preventDefault();\n                        handleSendReply();\n                      }\n                    }}\n                    className=\"flex-1 bg-transparent border-none text-white placeholder:text-white/50 focus-visible:ring-0 h-8\"\n                    data-testid=\"input-reply-message\"\n                  />\n                  <Button\n                    size=\"icon\"\n                    variant=\"ghost\"\n                    className=\"h-8 w-8 text-white hover:bg-white/20\"\n                    onClick={handleSendReply}\n                    disabled={!replyMessage.trim() || replyMutation.isPending}\n                    data-testid=\"button-send-reply\"\n                  >\n                    <Send className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n              </div>\n            )}\n          </div>\n\n          {showReplies && (\n            <div className=\"absolute bottom-16 left-0 right-0 z-30 bg-black/95 rounded-t-2xl max-h-[50%] animate-in slide-in-from-bottom\">\n              <div className=\"p-4 border-b border-white/10\">\n                <div className=\"flex items-center justify-between\">\n                  <h3 className=\"text-white font-medium\"> ({replies.length})</h3>\n                  <Button\n                    size=\"icon\"\n                    variant=\"ghost\"\n                    className=\"h-8 w-8 text-white/60 hover:text-white\"\n                    onClick={() => setShowReplies(false)}\n                  >\n                    <X className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n              </div>\n              \n              <ScrollArea className=\"h-[200px] p-4\">\n                {replies.length === 0 ? (\n                  <p className=\"text-white/50 text-center text-sm py-4\">\n                       \n                  </p>\n                ) : (\n                  <div className=\"space-y-3\">\n                    {replies.map((reply) => (\n                      <div key={reply.id} className=\"flex items-start gap-2\">\n                        <UserAvatar \n                          name={reply.sender?.name || \"Unknown\"} \n                          avatar={reply.sender?.avatar}\n                          size=\"sm\"\n                        />\n                        <div className=\"flex-1 bg-white/10 rounded-lg px-3 py-2\">\n                          <div className=\"flex items-center gap-2\">\n                            <span className=\"text-white text-sm font-medium\">\n                              {reply.sender?.name || \"Unknown\"}\n                            </span>\n                            <span className=\"text-white/40 text-xs\">\n                              {reply.createdAt && formatDistanceToNow(new Date(reply.createdAt), { \n                                addSuffix: true,\n                                locale: ar \n                              })}\n                            </span>\n                          </div>\n                          <p className=\"text-white/80 text-sm mt-1\">{reply.message}</p>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </ScrollArea>\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nexport function StatusStoriesRow({ \n  currentUser,\n  onAddStory\n}: { \n  currentUser?: { id: string; name: string; avatar?: string | null };\n  onAddStory?: () => void;\n}) {\n  const [selectedIndex, setSelectedIndex] = useState<number | null>(null);\n  \n  const { data: statuses = [], isLoading } = useQuery<StatusData[]>({\n    queryKey: ['/api/statuses']\n  });\n\n  const groupedStatuses = statuses.reduce<{ [authorId: string]: StatusData[] }>((acc, status) => {\n    const key = status.authorId;\n    if (!acc[key]) {\n      acc[key] = [];\n    }\n    acc[key].push(status);\n    return acc;\n  }, {});\n\n  const authors = Object.keys(groupedStatuses).map(authorId => {\n    const authorStatuses = groupedStatuses[authorId];\n    const latestStatus = authorStatuses[0];\n    return {\n      id: authorId,\n      name: latestStatus.author?.name || \"Unknown\",\n      avatar: latestStatus.author?.avatar,\n      statuses: authorStatuses,\n      hasUnviewed: true \n    };\n  });\n\n  const handleAuthorClick = (authorId: string) => {\n    const authorStatuses = groupedStatuses[authorId];\n    if (authorStatuses && authorStatuses.length > 0) {\n      const flattenedStatuses = authors.flatMap(a => a.statuses);\n      const startIndex = flattenedStatuses.findIndex(s => s.authorId === authorId);\n      setSelectedIndex(startIndex);\n    }\n  };\n\n  const allStatuses = authors.flatMap(a => a.statuses);\n\n  if (isLoading) {\n    return (\n      <div className=\"flex gap-2 overflow-x-auto pb-2 scrollbar-hide\">\n        {[1, 2, 3, 4].map((i) => (\n          <div key={i} className=\"flex flex-col items-center gap-1 p-2 animate-pulse\">\n            <div className=\"w-14 h-14 rounded-full bg-muted\" />\n            <div className=\"w-12 h-3 rounded bg-muted\" />\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  const currentUserStatuses = currentUser ? groupedStatuses[currentUser.id] : [];\n  const hasOwnStatuses = currentUserStatuses && currentUserStatuses.length > 0;\n\n  const handleOwnStatusClick = () => {\n    if (hasOwnStatuses) {\n      const flattenedStatuses = authors.flatMap(a => a.statuses);\n      const startIndex = flattenedStatuses.findIndex(s => s.authorId === currentUser?.id);\n      setSelectedIndex(startIndex >= 0 ? startIndex : 0);\n    }\n  };\n\n  return (\n    <>\n      <div className=\"flex gap-2 overflow-x-auto pb-2 scrollbar-hide\">\n        {currentUser && (\n          <>\n            <button\n              onClick={hasOwnStatuses ? handleOwnStatusClick : onAddStory}\n              className=\"flex flex-col items-center gap-1 p-2 hover-elevate rounded-md\"\n              data-testid=\"button-my-story\"\n            >\n              <div className=\"relative\">\n                <div className={cn(\n                  \"p-0.5 rounded-full\",\n                  hasOwnStatuses \n                    ? \"bg-gradient-to-tr from-primary to-blue-400\" \n                    : \"bg-muted\"\n                )}>\n                  <div className=\"p-0.5 rounded-full bg-background\">\n                    <UserAvatar name={currentUser.name} avatar={currentUser.avatar} size=\"lg\" />\n                  </div>\n                </div>\n                <div className=\"absolute -bottom-1 -right-1 w-5 h-5 rounded-full bg-primary flex items-center justify-center border-2 border-background\">\n                  <span className=\"text-xs font-bold text-primary-foreground\">+</span>\n                </div>\n              </div>\n              <span className=\"text-xs text-center truncate w-16\">\n                \n              </span>\n            </button>\n          </>\n        )}\n        \n        {authors.filter(a => a.id !== currentUser?.id).map((author) => (\n          <button\n            key={author.id}\n            onClick={() => handleAuthorClick(author.id)}\n            className=\"flex flex-col items-center gap-1 p-2 hover-elevate rounded-md\"\n            data-testid={`button-story-${author.id}`}\n          >\n            <div className={cn(\n              \"p-0.5 rounded-full\",\n              author.hasUnviewed \n                ? \"bg-gradient-to-tr from-primary to-blue-400\" \n                : \"bg-muted\"\n            )}>\n              <div className=\"p-0.5 rounded-full bg-background\">\n                <UserAvatar name={author.name} avatar={author.avatar} size=\"lg\" />\n              </div>\n            </div>\n            <span className=\"text-xs text-center truncate w-16\">\n              {author.name.split(\" \")[0]}\n            </span>\n          </button>\n        ))}\n      </div>\n\n      <StatusViewer\n        statuses={allStatuses}\n        initialIndex={selectedIndex ?? 0}\n        open={selectedIndex !== null}\n        onClose={() => setSelectedIndex(null)}\n        currentUserId={currentUser?.id}\n      />\n    </>\n  );\n}\n","path":null,"size_bytes":23671,"size_tokens":null},"client/src/pages/InternalMail.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { UserAvatar } from \"@/components/UserAvatar\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { \n  Search, \n  Send, \n  Mail, \n  Inbox, \n  SendHorizontal,\n  Star,\n  Archive,\n  Trash2,\n  FileEdit,\n  Plus,\n  ArrowLeft,\n  MoreVertical,\n  Loader2,\n  Clock,\n  CheckCircle,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport type { InternalEmail, User } from \"@shared/schema\";\nimport { format, formatDistanceToNow } from \"date-fns\";\nimport { ar, enUS } from \"date-fns/locale\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\ntype EmailWithUsers = InternalEmail & {\n  sender?: User | null;\n  recipient?: User | null;\n};\n\ntype MailboxView = \"inbox\" | \"sent\" | \"drafts\" | \"starred\" | \"archived\";\n\nexport default function InternalMail() {\n  const { language } = useLanguage();\n  const t = translations[language];\n  const dateLocale = language === 'ar' ? ar : enUS;\n  const { user: currentUser } = useAuth();\n  const [activeView, setActiveView] = useState<MailboxView>(\"inbox\");\n  const [search, setSearch] = useState(\"\");\n  const [selectedEmail, setSelectedEmail] = useState<EmailWithUsers | null>(null);\n  const [showCompose, setShowCompose] = useState(false);\n  \n  const [composeData, setComposeData] = useState({\n    recipientId: \"\",\n    subject: \"\",\n    body: \"\",\n    isDraft: false,\n  });\n\n  const { data: inboxEmails = [], isLoading: inboxLoading } = useQuery<EmailWithUsers[]>({\n    queryKey: [\"/api/emails/inbox\"],\n  });\n\n  const { data: sentEmails = [], isLoading: sentLoading } = useQuery<EmailWithUsers[]>({\n    queryKey: [\"/api/emails/sent\"],\n  });\n\n  const { data: draftEmails = [], isLoading: draftsLoading } = useQuery<EmailWithUsers[]>({\n    queryKey: [\"/api/emails/drafts\"],\n  });\n\n  const { data: starredEmails = [], isLoading: starredLoading } = useQuery<EmailWithUsers[]>({\n    queryKey: [\"/api/emails/starred\"],\n  });\n\n  const { data: archivedEmails = [], isLoading: archivedLoading } = useQuery<EmailWithUsers[]>({\n    queryKey: [\"/api/emails/archived\"],\n  });\n\n  const { data: unreadCount = { count: 0 } } = useQuery<{ count: number }>({\n    queryKey: [\"/api/emails/unread-count\"],\n  });\n\n  const { data: users = [] } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const invalidateAllEmailQueries = () => {\n    queryClient.invalidateQueries({ queryKey: [\"/api/emails/inbox\"] });\n    queryClient.invalidateQueries({ queryKey: [\"/api/emails/sent\"] });\n    queryClient.invalidateQueries({ queryKey: [\"/api/emails/drafts\"] });\n    queryClient.invalidateQueries({ queryKey: [\"/api/emails/starred\"] });\n    queryClient.invalidateQueries({ queryKey: [\"/api/emails/archived\"] });\n    queryClient.invalidateQueries({ queryKey: [\"/api/emails/unread-count\"] });\n  };\n\n  const sendEmailMutation = useMutation({\n    mutationFn: async (data: typeof composeData) => {\n      return await apiRequest(\"POST\", \"/api/emails\", data);\n    },\n    onSuccess: () => {\n      invalidateAllEmailQueries();\n      setShowCompose(false);\n      setComposeData({ recipientId: \"\", subject: \"\", body: \"\", isDraft: false });\n    },\n  });\n\n  const toggleStarMutation = useMutation({\n    mutationFn: async (emailId: number) => {\n      return await apiRequest(\"POST\", `/api/emails/${emailId}/star`, {});\n    },\n    onSuccess: () => {\n      invalidateAllEmailQueries();\n    },\n  });\n\n  const archiveMutation = useMutation({\n    mutationFn: async (emailId: number) => {\n      return await apiRequest(\"POST\", `/api/emails/${emailId}/archive`, {});\n    },\n    onSuccess: () => {\n      invalidateAllEmailQueries();\n      setSelectedEmail(null);\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (emailId: number) => {\n      return await apiRequest(\"DELETE\", `/api/emails/${emailId}`, {});\n    },\n    onSuccess: () => {\n      invalidateAllEmailQueries();\n      setSelectedEmail(null);\n    },\n  });\n\n  const getCurrentEmails = (): EmailWithUsers[] => {\n    switch (activeView) {\n      case \"inbox\": return inboxEmails;\n      case \"sent\": return sentEmails;\n      case \"drafts\": return draftEmails;\n      case \"starred\": return starredEmails;\n      case \"archived\": return archivedEmails;\n      default: return inboxEmails;\n    }\n  };\n\n  const isLoading = () => {\n    switch (activeView) {\n      case \"inbox\": return inboxLoading;\n      case \"sent\": return sentLoading;\n      case \"drafts\": return draftsLoading;\n      case \"starred\": return starredLoading;\n      case \"archived\": return archivedLoading;\n      default: return false;\n    }\n  };\n\n  const getDisplayUser = (email: EmailWithUsers) => {\n    if (activeView === \"sent\" || activeView === \"drafts\") {\n      return email.recipient;\n    }\n    return email.sender;\n  };\n\n  const filteredEmails = getCurrentEmails().filter((email) => {\n    const user = getDisplayUser(email);\n    const userName = user ? `${user.firstName || \"\"} ${user.lastName || \"\"}`.toLowerCase() : \"\";\n    return (\n      email.subject.toLowerCase().includes(search.toLowerCase()) ||\n      email.body.toLowerCase().includes(search.toLowerCase()) ||\n      userName.includes(search.toLowerCase())\n    );\n  });\n\n  const handleSend = () => {\n    if (composeData.recipientId && composeData.subject) {\n      sendEmailMutation.mutate(composeData);\n    }\n  };\n\n  const handleSaveDraft = () => {\n    if (composeData.recipientId && composeData.subject) {\n      sendEmailMutation.mutate({ ...composeData, isDraft: true });\n    }\n  };\n\n  const mailboxItems = [\n    { id: \"inbox\" as MailboxView, label: t.internalMail?.inbox || \"Inbox\", icon: Inbox, count: unreadCount.count },\n    { id: \"sent\" as MailboxView, label: t.internalMail?.sent || \"Sent\", icon: SendHorizontal, count: 0 },\n    { id: \"drafts\" as MailboxView, label: t.internalMail?.drafts || \"Drafts\", icon: FileEdit, count: draftEmails.length },\n    { id: \"starred\" as MailboxView, label: t.internalMail?.starred || \"Starred\", icon: Star, count: 0 },\n    { id: \"archived\" as MailboxView, label: t.internalMail?.archived || \"Archived\", icon: Archive, count: 0 },\n  ];\n\n  const iconMargin = language === 'ar' ? 'ml-2' : 'mr-2';\n\n  return (\n    <div className=\"flex h-[calc(100vh-4rem)]\" dir={language === 'ar' ? 'rtl' : 'ltr'}>\n      <div className=\"w-64 border-r border-white/5 flex flex-col bg-sidebar\">\n        <div className=\"p-4 border-b border-white/5\">\n          <Button \n            onClick={() => setShowCompose(true)}\n            className=\"w-full bg-gradient-to-r from-cyan-500 to-teal-500 hover:from-cyan-600 hover:to-teal-600\"\n            data-testid=\"button-compose-email\"\n          >\n            <Plus className={`h-4 w-4 ${iconMargin}`} />\n            {t.internalMail?.newMessage || \"New Message\"}\n          </Button>\n        </div>\n        \n        <ScrollArea className=\"flex-1\">\n          <div className=\"p-2 space-y-1\">\n            {mailboxItems.map((item) => (\n              <button\n                key={item.id}\n                onClick={() => {\n                  setActiveView(item.id);\n                  setSelectedEmail(null);\n                }}\n                className={cn(\n                  \"w-full p-3 rounded-xl text-left transition-all duration-200 flex items-center justify-between\",\n                  activeView === item.id\n                    ? \"bg-white/10 border border-cyan-500/30\"\n                    : \"hover:bg-white/5 border border-transparent\"\n                )}\n                data-testid={`button-mailbox-${item.id}`}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <item.icon className={cn(\n                    \"h-4 w-4\",\n                    activeView === item.id ? \"text-cyan-400\" : \"text-muted-foreground\"\n                  )} />\n                  <span className={cn(\n                    \"text-sm\",\n                    activeView === item.id && \"text-cyan-400 font-medium\"\n                  )}>{item.label}</span>\n                </div>\n                {item.count > 0 && (\n                  <Badge variant=\"secondary\" className=\"text-xs px-2\">\n                    {item.count}\n                  </Badge>\n                )}\n              </button>\n            ))}\n          </div>\n        </ScrollArea>\n      </div>\n\n      <div className=\"w-80 border-r border-white/5 flex flex-col bg-background\">\n        <div className=\"p-4 border-b border-white/5\">\n          <div className=\"flex items-center gap-2 mb-4\">\n            <div className=\"p-2 rounded-lg bg-gradient-to-br from-cyan-500 to-teal-500\">\n              <Mail className=\"h-4 w-4 text-white\" />\n            </div>\n            <h2 className=\"font-semibold\">\n              {mailboxItems.find(i => i.id === activeView)?.label || (t.internalMail?.mail || \"Mail\")}\n            </h2>\n          </div>\n          <div className=\"relative\">\n            <Search className={`absolute ${language === 'ar' ? 'right-3' : 'left-3'} top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground`} />\n            <Input\n              placeholder={t.internalMail?.searchMessages || \"Search messages...\"}\n              value={search}\n              onChange={(e) => setSearch(e.target.value)}\n              className={`${language === 'ar' ? 'pr-9' : 'pl-9'} bg-white/5 border-white/10 focus:border-cyan-500/50`}\n              data-testid=\"input-search-emails\"\n            />\n          </div>\n        </div>\n        <ScrollArea className=\"flex-1\">\n          <div className=\"p-2 space-y-1\">\n            {isLoading() ? (\n              Array(5).fill(0).map((_, i) => (\n                <Skeleton key={i} className=\"h-20 w-full bg-white/5\" />\n              ))\n            ) : filteredEmails.length > 0 ? (\n              filteredEmails.map((email) => {\n                const displayUser = getDisplayUser(email);\n                return (\n                  <button\n                    key={email.id}\n                    onClick={() => setSelectedEmail(email)}\n                    className={cn(\n                      \"w-full p-3 rounded-xl text-left transition-all duration-200\",\n                      selectedEmail?.id === email.id\n                        ? \"bg-white/10 border border-cyan-500/30\"\n                        : \"hover:bg-white/5 border border-transparent\",\n                      !email.isRead && activeView === \"inbox\" && \"bg-white/5\"\n                    )}\n                    data-testid={`button-email-${email.id}`}\n                  >\n                    <div className=\"flex items-start gap-3\">\n                      <UserAvatar \n                        name={displayUser ? `${displayUser.firstName || \"\"} ${displayUser.lastName || \"\"}` : \"User\"} \n                        avatar={displayUser?.profileImageUrl}\n                        size=\"sm\" \n                      />\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-center justify-between gap-2\">\n                          <span className={cn(\n                            \"font-medium text-sm truncate\",\n                            !email.isRead && activeView === \"inbox\" && \"text-cyan-400\"\n                          )}>\n                            {displayUser ? `${displayUser.firstName || \"\"} ${displayUser.lastName || \"\"}` : \"Unknown\"}\n                          </span>\n                          <span className=\"text-xs text-muted-foreground whitespace-nowrap\">\n                            {email.createdAt && formatDistanceToNow(new Date(email.createdAt), { addSuffix: true, locale: dateLocale })}\n                          </span>\n                        </div>\n                        <p className={cn(\n                          \"text-sm truncate\",\n                          !email.isRead && activeView === \"inbox\" ? \"font-medium\" : \"text-muted-foreground\"\n                        )}>\n                          {email.subject}\n                        </p>\n                        <p className=\"text-xs text-muted-foreground truncate mt-0.5\">\n                          {email.body.substring(0, 50)}...\n                        </p>\n                      </div>\n                      {email.isStarred && (\n                        <Star className=\"h-4 w-4 text-yellow-500 fill-yellow-500 flex-shrink-0\" />\n                      )}\n                    </div>\n                  </button>\n                );\n              })\n            ) : (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Mail className=\"h-10 w-10 mx-auto mb-2 opacity-30\" />\n                <p className=\"text-sm\">{search ? (t.internalMail?.noMatchingMessages || \"No matching messages\") : (t.internalMail?.noMessages || \"No messages\")}</p>\n              </div>\n            )}\n          </div>\n        </ScrollArea>\n      </div>\n\n      <div className=\"flex-1 flex flex-col bg-background\">\n        {selectedEmail ? (\n          <>\n            <div className=\"h-16 border-b border-white/5 px-6 flex items-center justify-between bg-card/50 backdrop-blur-sm\">\n              <div className=\"flex items-center gap-3\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => setSelectedEmail(null)}\n                  data-testid=\"button-back-to-list\"\n                >\n                  <ArrowLeft className=\"h-4 w-4\" />\n                </Button>\n                <div>\n                  <p className=\"font-semibold\">{selectedEmail.subject}</p>\n                  <p className=\"text-xs text-muted-foreground\">\n                    {activeView === \"sent\" || activeView === \"drafts\" ? (t.internalMail?.to || \"To\") + \": \" : (t.internalMail?.from || \"From\") + \": \"}\n                    {getDisplayUser(selectedEmail) ? \n                      `${getDisplayUser(selectedEmail)?.firstName || \"\"} ${getDisplayUser(selectedEmail)?.lastName || \"\"}` : \n                      \"Unknown\"\n                    }\n                  </p>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => toggleStarMutation.mutate(selectedEmail.id)}\n                  data-testid=\"button-toggle-star\"\n                >\n                  <Star className={cn(\n                    \"h-4 w-4\",\n                    selectedEmail.isStarred && \"text-yellow-500 fill-yellow-500\"\n                  )} />\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => archiveMutation.mutate(selectedEmail.id)}\n                  data-testid=\"button-archive-email\"\n                >\n                  <Archive className=\"h-4 w-4\" />\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => deleteMutation.mutate(selectedEmail.id)}\n                  data-testid=\"button-delete-email\"\n                >\n                  <Trash2 className=\"h-4 w-4 text-destructive\" />\n                </Button>\n              </div>\n            </div>\n\n            <ScrollArea className=\"flex-1\">\n              <div className=\"p-6 max-w-3xl mx-auto\">\n                <div className=\"glass rounded-xl p-6\">\n                  <div className=\"flex items-start gap-4 mb-6\">\n                    <UserAvatar \n                      name={selectedEmail.sender ? `${selectedEmail.sender.firstName || \"\"} ${selectedEmail.sender.lastName || \"\"}` : \"User\"} \n                      avatar={selectedEmail.sender?.profileImageUrl}\n                      size=\"md\" \n                    />\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <p className=\"font-semibold\">\n                            {selectedEmail.sender ? `${selectedEmail.sender.firstName || \"\"} ${selectedEmail.sender.lastName || \"\"}` : \"Unknown\"}\n                          </p>\n                          <p className=\"text-xs text-muted-foreground\">\n                            {selectedEmail.sender?.email || \"\"}\n                          </p>\n                        </div>\n                        <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                          <Clock className=\"h-3 w-3\" />\n                          {selectedEmail.createdAt && format(new Date(selectedEmail.createdAt), \"d MMM yyyy, HH:mm\")}\n                        </div>\n                      </div>\n                      <div className=\"mt-2\">\n                        <span className=\"text-xs text-muted-foreground\">{t.internalMail?.to || \"To\"}: </span>\n                        <span className=\"text-xs\">\n                          {selectedEmail.recipient ? `${selectedEmail.recipient.firstName || \"\"} ${selectedEmail.recipient.lastName || \"\"}` : \"Unknown\"}\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"border-t border-white/10 pt-6\">\n                    <h3 className=\"font-semibold text-lg mb-4\">{selectedEmail.subject}</h3>\n                    <div className=\"prose prose-invert prose-sm max-w-none whitespace-pre-wrap\">\n                      {selectedEmail.body}\n                    </div>\n                  </div>\n                </div>\n\n                {activeView === \"inbox\" && (\n                  <div className=\"mt-6\">\n                    <Button\n                      onClick={() => {\n                        const replyPrefix = language === 'ar' ? ': ' : 'Re: ';\n                        setComposeData({\n                          recipientId: selectedEmail.senderId,\n                          subject: `${replyPrefix}${selectedEmail.subject}`,\n                          body: \"\",\n                          isDraft: false,\n                        });\n                        setShowCompose(true);\n                      }}\n                      className=\"bg-gradient-to-r from-cyan-500 to-teal-500\"\n                      data-testid=\"button-reply\"\n                    >\n                      <Send className={`h-4 w-4 ${iconMargin}`} />\n                      {t.internalMail?.replyToMessage || \"Reply\"}\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </ScrollArea>\n          </>\n        ) : (\n          <div className=\"flex-1 flex items-center justify-center text-muted-foreground\">\n            <div className=\"text-center\">\n              <Mail className=\"h-16 w-16 mx-auto mb-4 opacity-20\" />\n              <h3 className=\"text-lg font-semibold mb-1\">{t.internalMail?.selectMessage || \"Select a message\"}</h3>\n              <p className=\"text-sm\">{t.internalMail?.selectMessageDesc || \"Select a message from the list to view its contents\"}</p>\n            </div>\n          </div>\n        )}\n      </div>\n\n      <Dialog open={showCompose} onOpenChange={setShowCompose}>\n        <DialogContent className=\"sm:max-w-2xl\" dir={language === 'ar' ? 'rtl' : 'ltr'}>\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Mail className=\"h-5 w-5 text-cyan-500\" />\n              {t.internalMail?.newMessage || \"New Message\"}\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 mt-4\">\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">{t.internalMail?.to || \"To\"}</label>\n              <Select\n                value={composeData.recipientId}\n                onValueChange={(value) => setComposeData({ ...composeData, recipientId: value })}\n              >\n                <SelectTrigger data-testid=\"select-recipient\">\n                  <SelectValue placeholder={t.internalMail?.selectRecipient || \"Select recipient...\"} />\n                </SelectTrigger>\n                <SelectContent>\n                  {users\n                    .filter(u => u.id !== currentUser?.id)\n                    .map((user) => (\n                      <SelectItem key={user.id} value={user.id}>\n                        <div className=\"flex items-center gap-2\">\n                          <UserAvatar \n                            name={`${user.firstName || \"\"} ${user.lastName || \"\"}`} \n                            avatar={user.profileImageUrl}\n                            size=\"sm\" \n                          />\n                          <span>{user.firstName} {user.lastName}</span>\n                          <span className=\"text-xs text-muted-foreground\">({user.email})</span>\n                        </div>\n                      </SelectItem>\n                    ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">{t.internalMail?.subject || \"Subject\"}</label>\n              <Input\n                value={composeData.subject}\n                onChange={(e) => setComposeData({ ...composeData, subject: e.target.value })}\n                placeholder={t.internalMail?.subjectPlaceholder || \"Message subject...\"}\n                data-testid=\"input-subject\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">{t.internalMail?.content || \"Content\"}</label>\n              <Textarea\n                value={composeData.body}\n                onChange={(e) => setComposeData({ ...composeData, body: e.target.value })}\n                placeholder={t.internalMail?.contentPlaceholder || \"Write your message here...\"}\n                rows={8}\n                className=\"resize-none\"\n                data-testid=\"input-body\"\n              />\n            </div>\n\n            <div className=\"flex justify-between gap-4 flex-wrap pt-4\">\n              <Button\n                variant=\"outline\"\n                onClick={handleSaveDraft}\n                disabled={sendEmailMutation.isPending}\n                data-testid=\"button-save-draft\"\n              >\n                <FileEdit className={`h-4 w-4 ${iconMargin}`} />\n                {t.internalMail?.saveDraft || \"Save as Draft\"}\n              </Button>\n              <Button\n                onClick={handleSend}\n                disabled={!composeData.recipientId || !composeData.subject || sendEmailMutation.isPending}\n                className=\"bg-gradient-to-r from-cyan-500 to-teal-500\"\n                data-testid=\"button-send-email\"\n              >\n                {sendEmailMutation.isPending ? (\n                  <Loader2 className={`h-4 w-4 ${iconMargin} animate-spin`} />\n                ) : (\n                  <Send className={`h-4 w-4 ${iconMargin}`} />\n                )}\n                {t.internalMail?.send || \"Send\"}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":23387,"size_tokens":null},"client/src/components/VoiceRecorder.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Mic, Square, Send, X, Loader2 } from \"lucide-react\";\n\ninterface VoiceRecorderProps {\n  onRecordingComplete: (audioBlob: Blob) => void;\n  onCancel: () => void;\n  isUploading?: boolean;\n}\n\nexport function VoiceRecorder({ onRecordingComplete, onCancel, isUploading }: VoiceRecorderProps) {\n  const [isRecording, setIsRecording] = useState(false);\n  const [recordingTime, setRecordingTime] = useState(0);\n  const [audioBlob, setAudioBlob] = useState<Blob | null>(null);\n  const [audioUrl, setAudioUrl] = useState<string | null>(null);\n  \n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const chunksRef = useRef<Blob[]>([]);\n  const timerRef = useRef<NodeJS.Timeout | null>(null);\n  const streamRef = useRef<MediaStream | null>(null);\n\n  useEffect(() => {\n    return () => {\n      if (timerRef.current) {\n        clearInterval(timerRef.current);\n      }\n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(track => track.stop());\n      }\n      if (audioUrl) {\n        URL.revokeObjectURL(audioUrl);\n      }\n    };\n  }, [audioUrl]);\n\n  const startRecording = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      streamRef.current = stream;\n      \n      const mediaRecorder = new MediaRecorder(stream, {\n        mimeType: MediaRecorder.isTypeSupported('audio/webm') ? 'audio/webm' : 'audio/ogg'\n      });\n      \n      mediaRecorderRef.current = mediaRecorder;\n      chunksRef.current = [];\n\n      mediaRecorder.ondataavailable = (e) => {\n        if (e.data.size > 0) {\n          chunksRef.current.push(e.data);\n        }\n      };\n\n      mediaRecorder.onstop = () => {\n        const blob = new Blob(chunksRef.current, { \n          type: MediaRecorder.isTypeSupported('audio/webm') ? 'audio/webm' : 'audio/ogg' \n        });\n        setAudioBlob(blob);\n        setAudioUrl(URL.createObjectURL(blob));\n        \n        if (streamRef.current) {\n          streamRef.current.getTracks().forEach(track => track.stop());\n        }\n      };\n\n      mediaRecorder.start();\n      setIsRecording(true);\n      setRecordingTime(0);\n\n      timerRef.current = setInterval(() => {\n        setRecordingTime(prev => prev + 1);\n      }, 1000);\n    } catch (error) {\n      console.error(\"Error accessing microphone:\", error);\n    }\n  };\n\n  const stopRecording = () => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n      \n      if (timerRef.current) {\n        clearInterval(timerRef.current);\n      }\n    }\n  };\n\n  const handleSend = () => {\n    if (audioBlob) {\n      onRecordingComplete(audioBlob);\n    }\n  };\n\n  const handleCancel = () => {\n    if (isRecording) {\n      stopRecording();\n    }\n    setAudioBlob(null);\n    if (audioUrl) {\n      URL.revokeObjectURL(audioUrl);\n      setAudioUrl(null);\n    }\n    onCancel();\n  };\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  return (\n    <div className=\"flex items-center gap-2 p-2 bg-muted/50 rounded-lg\" data-testid=\"voice-recorder\">\n      {!audioBlob ? (\n        <>\n          {isRecording ? (\n            <>\n              <div className=\"flex items-center gap-2 flex-1\">\n                <div className=\"w-3 h-3 bg-red-500 rounded-full animate-pulse\" />\n                <span className=\"text-sm font-mono\">{formatTime(recordingTime)}</span>\n              </div>\n              <Button \n                size=\"icon\" \n                variant=\"destructive\" \n                onClick={stopRecording}\n                data-testid=\"button-stop-recording\"\n              >\n                <Square className=\"h-4 w-4\" />\n              </Button>\n            </>\n          ) : (\n            <>\n              <span className=\"text-sm text-muted-foreground flex-1\"> </span>\n              <Button \n                size=\"icon\" \n                variant=\"default\" \n                onClick={startRecording}\n                data-testid=\"button-start-recording\"\n              >\n                <Mic className=\"h-4 w-4\" />\n              </Button>\n            </>\n          )}\n          <Button \n            size=\"icon\" \n            variant=\"ghost\" \n            onClick={handleCancel}\n            data-testid=\"button-cancel-recording\"\n          >\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </>\n      ) : (\n        <>\n          <audio \n            src={audioUrl || undefined} \n            controls \n            className=\"h-8 flex-1\"\n            data-testid=\"audio-preview\"\n          />\n          <Button \n            size=\"icon\" \n            variant=\"default\" \n            onClick={handleSend}\n            disabled={isUploading}\n            data-testid=\"button-send-voice\"\n          >\n            {isUploading ? (\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\n            ) : (\n              <Send className=\"h-4 w-4\" />\n            )}\n          </Button>\n          <Button \n            size=\"icon\" \n            variant=\"ghost\" \n            onClick={handleCancel}\n            disabled={isUploading}\n            data-testid=\"button-cancel-voice\"\n          >\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":5432,"size_tokens":null},"client/src/components/LanguageSwitcher.tsx":{"content":"import { Globe } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\n\ninterface LanguageSwitcherProps {\n  variant?: \"default\" | \"ghost\" | \"outline\";\n  size?: \"default\" | \"sm\" | \"icon\";\n  showLabel?: boolean;\n  className?: string;\n}\n\nexport function LanguageSwitcher({ \n  variant = \"ghost\", \n  size = \"sm\",\n  showLabel = true,\n  className = \"\"\n}: LanguageSwitcherProps) {\n  const { language, setLanguage } = useLanguage();\n  const t = translations[language];\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button \n          variant={variant} \n          size={size}\n          className={className}\n          data-testid=\"button-language-switcher\"\n        >\n          <Globe className=\"h-4 w-4\" />\n          {showLabel && <span className=\"ml-2\">{language === 'ar' ? '' : 'English'}</span>}\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\">\n        <DropdownMenuItem \n          onClick={() => setLanguage('en')}\n          className={language === 'en' ? 'bg-accent' : ''}\n          data-testid=\"menu-item-english\"\n        >\n          <span className=\"mr-2\">EN</span>\n          English\n        </DropdownMenuItem>\n        <DropdownMenuItem \n          onClick={() => setLanguage('ar')}\n          className={language === 'ar' ? 'bg-accent' : ''}\n          data-testid=\"menu-item-arabic\"\n        >\n          <span className=\"mr-2\"></span>\n          \n        </DropdownMenuItem>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n","path":null,"size_bytes":1726,"size_tokens":null},"client/src/components/ui/loading-spinner.tsx":{"content":"import { Loader2 } from \"lucide-react\";\nimport { useLanguage, translations } from \"@/lib/i18n\";\nimport { cn } from \"@/lib/utils\";\n\ninterface LoadingSpinnerProps {\n  size?: \"sm\" | \"md\" | \"lg\";\n  text?: string;\n  fullScreen?: boolean;\n  className?: string;\n}\n\nexport function LoadingSpinner({ \n  size = \"md\", \n  text,\n  fullScreen = false,\n  className \n}: LoadingSpinnerProps) {\n  const { language } = useLanguage();\n  const t = translations[language];\n  const isRTL = language === 'ar';\n  \n  const sizeClasses = {\n    sm: \"h-4 w-4\",\n    md: \"h-8 w-8\",\n    lg: \"h-12 w-12\"\n  };\n\n  const textSizeClasses = {\n    sm: \"text-xs\",\n    md: \"text-sm\",\n    lg: \"text-base\"\n  };\n\n  const displayText = text || (t.common?.loading || \"Loading...\");\n\n  const spinner = (\n    <div \n      className={cn(\n        \"flex flex-col items-center justify-center gap-3\",\n        className\n      )}\n      dir={isRTL ? 'rtl' : 'ltr'}\n      data-testid=\"loading-spinner\"\n    >\n      <Loader2 \n        className={cn(\n          sizeClasses[size],\n          \"animate-spin text-primary\"\n        )} \n      />\n      <p className={cn(\n        textSizeClasses[size],\n        \"text-muted-foreground animate-pulse\"\n      )}>\n        {displayText}\n      </p>\n    </div>\n  );\n\n  if (fullScreen) {\n    return (\n      <div className=\"fixed inset-0 flex items-center justify-center bg-background/80 backdrop-blur-sm z-50\">\n        {spinner}\n      </div>\n    );\n  }\n\n  return spinner;\n}\n\ninterface PageLoadingProps {\n  message?: string;\n}\n\nexport function PageLoading({ message }: PageLoadingProps) {\n  const { language } = useLanguage();\n  const t = translations[language];\n  const isRTL = language === 'ar';\n  \n  return (\n    <div \n      className=\"flex-1 flex items-center justify-center min-h-[400px] p-8\"\n      dir={isRTL ? 'rtl' : 'ltr'}\n      data-testid=\"page-loading\"\n    >\n      <div className=\"text-center space-y-4\">\n        <div className=\"relative\">\n          <div className=\"h-16 w-16 mx-auto rounded-full border-4 border-primary/20 border-t-primary animate-spin\" />\n        </div>\n        <p className=\"text-muted-foreground\">\n          {message || (t.common?.loading || \"Loading...\")}\n        </p>\n      </div>\n    </div>\n  );\n}\n\ninterface CardSkeletonProps {\n  count?: number;\n}\n\nexport function CardSkeleton({ count = 3 }: CardSkeletonProps) {\n  return (\n    <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n      {Array.from({ length: count }).map((_, i) => (\n        <div \n          key={i} \n          className=\"rounded-lg border bg-card p-4 space-y-3\"\n          data-testid={`card-skeleton-${i}`}\n        >\n          <div className=\"h-4 bg-muted rounded animate-pulse w-3/4\" />\n          <div className=\"h-3 bg-muted rounded animate-pulse w-1/2\" />\n          <div className=\"h-20 bg-muted rounded animate-pulse\" />\n          <div className=\"flex gap-2\">\n            <div className=\"h-6 bg-muted rounded animate-pulse w-16\" />\n            <div className=\"h-6 bg-muted rounded animate-pulse w-16\" />\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n","path":null,"size_bytes":3048,"size_tokens":null},"client/src/lib/i18n.ts":{"content":"import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\nexport type Language = 'en' | 'ar';\n\ninterface LanguageState {\n  language: Language;\n  setLanguage: (lang: Language) => void;\n  isRTL: boolean;\n}\n\nexport const useLanguage = create<LanguageState>()(\n  persist(\n    (set: (state: Partial<LanguageState>) => void) => ({\n      language: 'en' as Language,\n      isRTL: false,\n      setLanguage: (lang: Language) => {\n        set({ language: lang, isRTL: lang === 'ar' });\n        document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';\n        document.documentElement.lang = lang;\n      },\n    }),\n    {\n      name: 'cloudoffice-language',\n      onRehydrateStorage: () => (state: LanguageState | undefined) => {\n        if (state) {\n          document.documentElement.dir = state.language === 'ar' ? 'rtl' : 'ltr';\n          document.documentElement.lang = state.language;\n        }\n      },\n    }\n  )\n);\n\nexport const translations = {\n  en: {\n    dashboard: {\n      title: \"Dashboard\",\n      welcomeBack: \"Welcome back to your workspace\",\n      systemOnline: \"System Online\",\n      dailyStories: \"Daily Stories\",\n      taskCompletion: \"Task Completion\",\n      activeTasks: \"Active Tasks\",\n      openTickets: \"Open Tickets\",\n      teamMembers: \"Team Members\",\n      meetings: \"Meetings\",\n      departments: \"Departments\",\n      completed: \"completed\",\n      pending: \"pending\",\n      resolved: \"resolved\",\n      activeNow: \"Active now\",\n      upcoming: \"Upcoming\",\n      active: \"Active\",\n      weeklyActivity: \"Weekly Activity\",\n      taskDistribution: \"Task Distribution\",\n      noTaskData: \"No task data yet\",\n      financialOverview: \"Financial Overview\",\n      revenue: \"Revenue\",\n      expenses: \"Expenses\",\n      netBalance: \"Net Balance\",\n      profitable: \"Profitable\",\n      loss: \"Loss\",\n      details: \"Details\",\n      viewAll: \"View All\",\n      createTask: \"Create a task\",\n      noActiveTasks: \"No active tasks\",\n      departmentsInOrg: \"department(s) in your organization\",\n      noDepartments: \"No departments yet\",\n      createDepartment: \"Create a department to organize your team\",\n      addDepartment: \"Add Department\",\n      inProgress: \"In Progress\",\n      Pending: \"Pending\",\n      Completed: \"Completed\",\n    },\n    tasks: {\n      title: \"Tasks\",\n      subtitle: \"Manage and track your team's work\",\n      newTask: \"New Task\",\n      createNewTask: \"Create New Task\",\n      taskTitle: \"Title\",\n      titlePlaceholder: \"What needs to be done?\",\n      description: \"Description\",\n      descriptionPlaceholder: \"Add more details...\",\n      assignee: \"Assignee\",\n      selectAssignee: \"Select...\",\n      priority: \"Priority\",\n      dueDate: \"Due Date\",\n      createTask: \"Create Task\",\n      creating: \"Creating...\",\n      allTasks: \"All Tasks\",\n      aiAutomation: \"AI Automation\",\n      pendingReview: \"pending review\",\n      searchTasks: \"Search tasks...\",\n      filter: \"Filter\",\n      total: \"Total\",\n      pending: \"Pending\",\n      inProgress: \"In Progress\",\n      completed: \"Completed\",\n      high: \"High\",\n      medium: \"Medium\",\n      low: \"Low\",\n      priorityHigh: \"High\",\n      priorityMedium: \"Medium\",\n      priorityLow: \"Low\",\n      priorityUrgent: \"Urgent\",\n      selectPriority: \"Select priority\",\n      noTasksMatch: \"No tasks match your search\",\n      noTasksYet: \"No tasks yet\",\n      createFirstTask: \"Create your first task to get started\",\n      n8nNotConfigured: \"n8n Integration Not Configured\",\n      n8nDescription: \"Connect your n8n instance to automate tasks with AI-powered workflows\",\n      configureN8n: \"Configure n8n\",\n      pendingReviewTitle: \"Pending Review\",\n      aiSuggestionReady: \"AI suggestion ready for review\",\n      review: \"Review\",\n      automationHistory: \"Automation History\",\n      noAutomations: \"No automations yet\",\n      noAutomationsYet: \"No automations yet\",\n      sendFirstTask: \"Send a task to n8n to see automation history\",\n      sendTaskToN8n: \"Send a task to n8n to get started\",\n      unknownTask: \"Unknown Task\",\n      taskCreated: \"Task created\",\n      taskCreatedDesc: \"Your new task has been added.\",\n      taskSentToN8n: \"Task sent to n8n\",\n      taskSentDesc: \"The AI is now processing your task. You'll be notified when it's ready for review.\",\n      approved: \"Approved\",\n      approvedDesc: \"The AI suggestion has been approved and the task is complete.\",\n      rejected: \"Rejected\",\n      rejectedDesc: \"The AI suggestion has been rejected.\",\n      error: \"Error\",\n      failedCreate: \"Failed to create task.\",\n      failedApprove: \"Failed to approve automation.\",\n      failedReject: \"Failed to reject automation.\",\n      unassigned: \"Unassigned\",\n      noDate: \"No date\",\n    },\n    tickets: {\n      title: \"Support Tickets\",\n      subtitle: \"Track and manage support requests\",\n      newTicket: \"New Ticket\",\n      createTicket: \"Create Support Ticket\",\n      ticketTitle: \"Title\",\n      titlePlaceholder: \"Brief description of the issue\",\n      description: \"Description\",\n      descriptionPlaceholder: \"Provide more details about your issue...\",\n      priority: \"Priority\",\n      highPriority: \"High Priority\",\n      mediumPriority: \"Medium Priority\",\n      lowPriority: \"Low Priority\",\n      submitTicket: \"Submit Ticket\",\n      submitting: \"Submitting...\",\n      searchTickets: \"Search tickets...\",\n      filter: \"Filter\",\n      allTickets: \"All Tickets\",\n      open: \"Open\",\n      inProgress: \"In Progress\",\n      resolved: \"Resolved\",\n      closed: \"Closed\",\n      total: \"Total\",\n      reportedBy: \"Reported by\",\n      assignedTo: \"Assigned to\",\n      noTicketsMatch: \"No tickets match your search\",\n      noTicketsYet: \"No tickets yet\",\n      createFirstTicket: \"Create your first support ticket to get started\",\n      ticketCreated: \"Ticket created\",\n      ticketCreatedDesc: \"Your support ticket has been submitted.\",\n      error: \"Error\",\n      failedCreate: \"Failed to create ticket.\",\n    },\n    messages: {\n      title: \"Messages\",\n      subtitle: \"Stay connected with your team\",\n      newChat: \"New Chat\",\n      searchConversations: \"Search conversations...\",\n      noConversations: \"No conversations yet\",\n      noConversationsFound: \"No conversations found\",\n      startConversation: \"Click the + button to start a new chat\",\n      typeMessage: \"Type a message...\",\n      send: \"Send\",\n      online: \"Online\",\n      offline: \"Offline\",\n      members: \"members\",\n      today: \"Today\",\n      yesterday: \"Yesterday\",\n      selectUser: \"Select a user to start a conversation\",\n      createGroup: \"Create Group\",\n      groupName: \"Group Name\",\n      enterGroupName: \"Enter group name...\",\n      selectMembers: \"Select Members\",\n      createGroupBtn: \"Create Group\",\n      noMessagesYet: \"No messages yet\",\n    },\n    meetings: {\n      title: \"Meetings\",\n      subtitle: \"Schedule and join virtual meetings\",\n      newMeeting: \"New Meeting\",\n      scheduleMeeting: \"Schedule Meeting\",\n      scheduleNewMeeting: \"Schedule New Meeting\",\n      meetingTitle: \"Meeting Title\",\n      titlePlaceholder: \"Weekly team sync\",\n      description: \"Description\",\n      descriptionOptional: \"Description (optional)\",\n      descriptionPlaceholder: \"Meeting agenda...\",\n      date: \"Date\",\n      startTime: \"Start Time\",\n      endTime: \"End Time\",\n      room: \"Room\",\n      virtualRoom: \"Virtual Room\",\n      attendees: \"attendees\",\n      selectAttendees: \"Select attendees\",\n      createMeeting: \"Create Meeting\",\n      creating: \"Creating...\",\n      upcomingMeetings: \"Upcoming Meetings\",\n      pastMeetings: \"Past Meetings\",\n      todaysMeetings: \"Today's Meetings\",\n      allMeetings: \"All Meetings\",\n      totalMeetings: \"Total Meetings\",\n      today: \"Today\",\n      upcoming: \"Upcoming\",\n      noMeetings: \"No meetings scheduled\",\n      noTodayMeetings: \"No meetings scheduled for today\",\n      noUpcomingMeetings: \"No upcoming meetings\",\n      scheduleFirst: \"Schedule your first meeting\",\n      planAhead: \"Plan your schedule ahead\",\n      join: \"Join\",\n      edit: \"Edit\",\n      delete: \"Delete\",\n      attendee: \"attendee\",\n      meetingCreated: \"Meeting scheduled\",\n      meetingCreatedDesc: \"Your meeting has been created.\",\n      meetingDeleted: \"Meeting deleted\",\n      meetingRemovedDesc: \"The meeting has been removed.\",\n      error: \"Error\",\n      failedCreate: \"Failed to create meeting.\",\n      failedDelete: \"Failed to delete meeting.\",\n      titleRequired: \"Meeting title is required.\",\n      dateTimeRequired: \"Date and start time are required.\",\n      joiningMeeting: \"Joining Meeting\",\n      openingConference: \"Opening video conference in a new tab...\",\n      confirmDelete: \"Are you sure you want to delete this meeting?\",\n    },\n    team: {\n      title: \"Team\",\n      subtitle: \"View team members and performance metrics\",\n      addMember: \"Add Member\",\n      searchMembers: \"Search members...\",\n      searchPlaceholder: \"Search by name or department...\",\n      allMembers: \"All Members\",\n      totalMembers: \"Total Members\",\n      departments: \"Departments\",\n      onlineNow: \"Online Now\",\n      active: \"Active\",\n      inactive: \"Inactive\",\n      online: \"online\",\n      away: \"away\",\n      offline: \"offline\",\n      noMembers: \"No team members yet\",\n      noSearchResults: \"No team members match your search\",\n      inviteFirst: \"Invite your team to get started\",\n      role: \"Role\",\n      department: \"Department\",\n      email: \"Email\",\n      phone: \"Phone\",\n      message: \"Message\",\n      joinedOn: \"Joined on\",\n      member: \"member\",\n      admin: \"Admin\",\n      manager: \"Manager\",\n      completed: \"Completed\",\n      totalTasks: \"Total Tasks\",\n    },\n    departments: {\n      title: \"Departments\",\n      subtitle: \"Manage your team departments and employees\",\n      myDepartments: \"My Departments\",\n      yourDepartments: \"Your Departments\",\n      addDepartment: \"Add Department\",\n      createDepartment: \"Create Department\",\n      createDepartmentDesc: \"Add a new department to organize your team.\",\n      departmentName: \"Department Name\",\n      departmentNamePlaceholder: \"e.g., Human Resources, Finance\",\n      description: \"Description\",\n      descriptionPlaceholder: \"Brief description of the department...\",\n      icon: \"Icon\",\n      color: \"Color\",\n      passwordProtection: \"Password Protection (Optional)\",\n      passwordPlaceholder: \"Leave empty for no password\",\n      passwordHint: \"Set a password to protect department access\",\n      creating: \"Creating...\",\n      searchDepartments: \"Search departments...\",\n      noDepartments: \"No departments yet\",\n      createFirst: \"Create your first department to get started\",\n      employees: \"Employees\",\n      active: \"Active\",\n      teamMembers: \"Team Members\",\n      noEmployees: \"No employees yet\",\n      addFirstEmployee: \"Add First Employee\",\n      manageEmployees: \"Manage Employees\",\n      manager: \"Manager\",\n      noManager: \"No manager assigned\",\n      departmentProtected: \"Department Protected\",\n      departmentLocked: \"Department Locked\",\n      enterPasswordToAccess: \"This department is password protected. Enter the password to access.\",\n      enterPassword: \"Enter password\",\n      verifying: \"Verifying...\",\n      unlock: \"Unlock\",\n      unlockDepartment: \"Unlock Department\",\n      selectDepartment: \"Select a Department\",\n      chooseDepartment: \"Choose a department from the list to manage its employees\",\n      accessGranted: \"Access Granted\",\n      departmentUnlocked: \"Department unlocked successfully.\",\n      accessDenied: \"Access Denied\",\n      incorrectPassword: \"Incorrect password.\",\n      departmentCreated: \"Department Created\",\n      departmentCreatedDesc: \"New department has been added.\",\n      departmentDeleted: \"Department Deleted\",\n      departmentDeletedDesc: \"The department has been removed.\",\n      error: \"Error\",\n      failedCreate: \"Failed to create department.\",\n      colorBlue: \"Blue\",\n      colorGreen: \"Green\",\n      colorPurple: \"Purple\",\n      colorOrange: \"Orange\",\n      colorRed: \"Red\",\n      colorPink: \"Pink\",\n      colorYellow: \"Yellow\",\n      colorCyan: \"Cyan\",\n      iconGeneral: \"General\",\n      iconFinance: \"Finance\",\n      iconTeam: \"Team\",\n      iconHR: \"Human Resources\",\n      iconLegal: \"Legal\",\n      iconMarketing: \"Marketing\",\n      iconOperations: \"Operations\",\n      iconSales: \"Sales\",\n      statusActive: \"Active\",\n      statusInactive: \"Inactive\",\n    },\n    finances: {\n      title: \"Financial Review\",\n      subtitle: \"Manage expenses and approvals\",\n      addTransaction: \"Add Transaction\",\n      totalRevenue: \"Total Revenue\",\n      totalExpenses: \"Total Expenses\",\n      netBalance: \"Net Balance\",\n      income: \"Income\",\n      expense: \"Expense\",\n      recentTransactions: \"Recent Transactions\",\n      noTransactions: \"No transactions yet\",\n      addFirst: \"Add your first transaction\",\n      amount: \"Amount ($)\",\n      type: \"Type\",\n      category: \"Category\",\n      date: \"Date\",\n      description: \"Description\",\n      pending: \"Pending\",\n      approved: \"Approved\",\n      rejected: \"Rejected\",\n      submitExpense: \"Submit Expense\",\n      descriptionPlaceholder: \"What is this expense for?\",\n      cancel: \"Cancel\",\n      submit: \"Submit\",\n      submitting: \"Submitting...\",\n      pendingApproval: \"Pending Approval\",\n      allTransactions: \"All Transactions\",\n      awaitingApproval: \"Awaiting Your Approval\",\n      transactionHistory: \"Transaction History\",\n      noPendingApprovals: \"No pending approvals\",\n      approvedThisMonth: \"Approved This Month\",\n      expenseSubmitted: \"Expense submitted\",\n      expenseSubmittedDesc: \"Your expense has been submitted for approval.\",\n      error: \"Error\",\n      failedSubmitExpense: \"Failed to submit expense.\",\n      descriptionRequired: \"Description is required.\",\n      invalidAmount: \"Please enter a valid amount.\",\n      transactionUpdated: \"Transaction updated\",\n      transactionUpdatedDesc: \"The transaction has been updated.\",\n      categorySoftware: \"Software\",\n      categoryMeals: \"Meals\",\n      categorySupplies: \"Supplies\",\n      categoryTravel: \"Travel\",\n      categoryOther: \"Other\",\n    },\n    socialFeed: {\n      title: \"Social Feed\",\n      subtitle: \"Share updates, photos, and videos with your team\",\n      whatsOnMind: \"What's on your mind?\",\n      post: \"Post\",\n      posting: \"Posting...\",\n      like: \"Like\",\n      comment: \"Comment\",\n      share: \"Share\",\n      comments: \"comments\",\n      likes: \"likes\",\n      writeComment: \"Write a comment...\",\n      noPostsYet: \"No posts yet\",\n      beFirst: \"Be the first to share an update with your team!\",\n      photo: \"Photo\",\n      video: \"Video\",\n      posted: \"Posted!\",\n      postedDesc: \"Your update has been shared.\",\n      error: \"Error\",\n      failedPost: \"Failed to create post.\",\n      uploaded: \"Uploaded!\",\n      readyToPost: \"ready to post.\",\n      uploadFailed: \"Upload Failed\",\n      uploadFailedDesc: \"Could not process the uploaded file. Please try again.\",\n      uploadPreview: \"Upload preview\",\n    },\n    profile: {\n      title: \"Profile\",\n      editProfile: \"Edit Profile\",\n      firstName: \"First Name\",\n      lastName: \"Last Name\",\n      email: \"Email\",\n      phone: \"Phone\",\n      department: \"Department\",\n      role: \"Role\",\n      bio: \"Bio\",\n      saveChanges: \"Save Changes\",\n      saving: \"Saving...\",\n      profileUpdated: \"Profile updated\",\n      profileUpdatedDesc: \"Your profile has been updated successfully.\",\n    },\n    common: {\n      loading: \"Loading...\",\n      save: \"Save\",\n      cancel: \"Cancel\",\n      delete: \"Delete\",\n      edit: \"Edit\",\n      view: \"View\",\n      create: \"Create\",\n      submit: \"Submit\",\n      search: \"Search\",\n      filter: \"Filter\",\n      all: \"All\",\n      none: \"None\",\n      yes: \"Yes\",\n      no: \"No\",\n      confirm: \"Confirm\",\n      back: \"Back\",\n      next: \"Next\",\n      previous: \"Previous\",\n      close: \"Close\",\n      open: \"Open\",\n      success: \"Success\",\n      error: \"Error\",\n      warning: \"Warning\",\n      info: \"Info\",\n      language: \"Language\",\n      arabic: \"Arabic\",\n      english: \"English\",\n      you: \"You\",\n      // Error messages\n      somethingWentWrong: \"Something went wrong\",\n      tryAgain: \"Try Again\",\n      pleaseWait: \"Please wait...\",\n      noDataFound: \"No data found\",\n      unauthorized: \"Unauthorized access\",\n      forbidden: \"You don't have permission to access this\",\n      notFound: \"Page not found\",\n      serverError: \"Server error occurred\",\n      networkError: \"Network connection error\",\n      sessionExpired: \"Your session has expired. Please login again.\",\n      refreshPage: \"Refresh Page\",\n      goHome: \"Go Home\",\n      goBack: \"Go Back\",\n    },\n    welcome: {\n      greeting: \"Welcome back\",\n      subtitle: \"Your gateway to professional virtual office services\",\n      searchPlaceholder: \"Search offices, services, or opportunities...\",\n      browseOffices: \"Browse Offices\",\n      viewServices: \"View Services\",\n      findJobs: \"Find Jobs\",\n      contactUs: \"Contact Us\",\n      featuredOffices: \"Featured Offices\",\n      discoverOffices: \"Discover premium virtual office spaces\",\n      viewAll: \"View All\",\n      noOffices: \"No offices available at the moment\",\n      checkBack: \"Check back soon for new listings\",\n      availableServices: \"Available Services\",\n      servicesDescription: \"Professional business services at your fingertips\",\n      browseAll: \"Browse All\",\n      noServices: \"No services available at the moment\",\n      comingSoon: \"New services coming soon\",\n      needHelp: \"Need Help Finding the Right Service?\",\n      helpDescription: \"Our team is here to help you find the perfect virtual office solution for your business needs.\",\n      contactSupport: \"Contact Support\",\n      browseCareers: \"Browse Careers\",\n      virtual: \"Virtual\",\n      premium: \"Premium\",\n      sar: \"SAR\",\n    },\n    landing: {\n      welcomeTitle: \"Welcome to CloudOffice\",\n      welcomeSubtitle: \"Your gateway to professional business services. Choose how you'd like to get started.\",\n      registerOffice: \"Register Office\",\n      registerOfficeDesc: \"List your office services and connect with customers\",\n      getStarted: \"Get Started\",\n      visitor: \"Visitor\",\n      visitorDesc: \"Browse offices, watch daily updates, and explore services\",\n      explore: \"Explore\",\n      jobOpportunities: \"Job Opportunities\",\n      jobOpportunitiesDesc: \"Explore career opportunities and apply for open positions\",\n      viewJobs: \"View Jobs\",\n      employeePortal: \"Employee Portal\",\n      employeePortalDesc: \"Access your tasks and assignments from management\",\n      enter: \"Enter\",\n      searchPlaceholder: \"Search offices and services...\",\n      signIn: \"Sign In\",\n      signInNow: \"Sign In Now\",\n      exploreNow: \"Explore Now\",\n      socialUpdates: \"Social Media Updates\",\n      achievementsTitle: \"Achievements & Successes\",\n      featuredPromotions: \"Featured Promotions\",\n      availableOffices: \"Available & Newly Rented Offices\",\n      viewDetails: \"View Details\",\n      viewOffice: \"View Office\",\n      ad: \"Ad\",\n      globalReach: \"Global Reach: Your\",\n      businessPartner: \"Business Partner\",\n      globalReachDesc: \"Establish a professional presence in prime business districts worldwide.\",\n      readyToStart: \"Ready to Get Started?\",\n      readyToStartDesc: \"Join thousands of businesses using CloudOffice to establish their professional virtual presence.\",\n      allRightsReserved: \"All rights reserved.\",\n      noOfficesMatch: \"No offices match your search\",\n      reviews: \"reviews\",\n      rented: \"Rented\",\n      open: \"Open\",\n      stats: {\n        activeOffices: \"Active Offices\",\n        onlineMembers: \"Online Members\",\n        hoursLogged: \"Hours Logged\",\n        productivity: \"Productivity\",\n        today: \"today\",\n      },\n      filters: {\n        all: \"All\",\n        premium: \"Premium\",\n        standard: \"Standard\",\n        available: \"Available\",\n        newlyRented: \"Newly Rented\",\n      },\n      achievements: {\n        premiumPartner: \"Premium Partner Status\",\n        premiumPartnerDesc: \"Exclusive benefits unlocked\",\n        completeDoc: \"Complete Documentation\",\n        completeDocDesc: \"All contracts verified\",\n        topRated: \"Top Rated Provider\",\n        topRatedDesc: \"Excellence in service\",\n      },\n      socialPosts: {\n        post1Author: \"CloudOffice Team\",\n        post1Content: \"Welcome to our new business partners joining this month! We're excited to grow together.\",\n        post1Time: \"2h ago\",\n        post2Author: \"Business Network\",\n        post2Content: \"Check out our latest premium office spaces in the Downtown Financial District!\",\n        post2Time: \"4h ago\",\n      },\n    },\n    employeePortal: {\n      title: \"Employee Portal\",\n      subtitle: \"Enter your email to view your assigned tasks and updates from management\",\n      workEmail: \"Work Email\",\n      emailPlaceholder: \"your.email@company.com\",\n      viewMyTasks: \"View My Tasks\",\n      portalNote: \"This portal is for employees only. Your tasks are assigned by your office manager.\",\n      myTasks: \"My Tasks\",\n      tasksAssigned: \"Tasks assigned to you by management\",\n      switchAccount: \"Switch Account\",\n      totalTasks: \"Total Tasks\",\n      pending: \"Pending\",\n      inProgress: \"In Progress\",\n      completed: \"Completed\",\n      all: \"All\",\n      refresh: \"Refresh\",\n      noTasksAssigned: \"No tasks assigned to you yet\",\n      noTasksMatch: \"No tasks match this filter\",\n      highPriority: \"High Priority\",\n      medium: \"Medium\",\n      low: \"Low\",\n      due: \"Due\",\n      created: \"Created\",\n      allRightsReserved: \"All rights reserved.\",\n    },\n    internalMail: {\n      title: \"Internal Mail\",\n      inbox: \"Inbox\",\n      sent: \"Sent\",\n      drafts: \"Drafts\",\n      starred: \"Starred\",\n      archived: \"Archived\",\n      mail: \"Mail\",\n      newMessage: \"New Message\",\n      searchMessages: \"Search messages...\",\n      noMessages: \"No messages\",\n      noMatchingMessages: \"No matching messages\",\n      to: \"To\",\n      from: \"From\",\n      selectRecipient: \"Select recipient...\",\n      subject: \"Subject\",\n      subjectPlaceholder: \"Message subject...\",\n      content: \"Content\",\n      contentPlaceholder: \"Write your message here...\",\n      saveDraft: \"Save as Draft\",\n      send: \"Send\",\n      selectMessage: \"Select a message\",\n      selectMessageDesc: \"Select a message from the list to view its content\",\n      replyPrefix: \"Re:\",\n      replyToMessage: \"Reply to message\",\n    },\n    n8n: {\n      title: \"n8n Workflow Automation\",\n      subtitle: \"Connect your n8n instance to automate tasks with AI\",\n      integrationStatus: \"Integration Status\",\n      statusDesc: \"Enable or disable the n8n workflow integration\",\n      active: \"Active\",\n      inactive: \"Inactive\",\n      webhookConfig: \"Webhook Configuration\",\n      webhookConfigDesc: \"Configure your n8n webhook endpoint to receive task automation requests\",\n      webhookUrl: \"Webhook URL\",\n      webhookUrlPlaceholder: \"https://your-n8n-instance.com/webhook/xxx\",\n      webhookUrlHint: \"The URL where task data will be sent for AI processing\",\n      apiKey: \"API Key (Optional)\",\n      apiKeyPlaceholder: \"Enter your API key for authentication\",\n      apiKeyHint: \"Optional API key sent in the X-API-Key header for webhook authentication\",\n      saveConfig: \"Save Configuration\",\n      saving: \"Saving...\",\n      settingsSaved: \"Settings saved\",\n      settingsSavedDesc: \"Your n8n integration settings have been updated.\",\n      error: \"Error\",\n      failedSave: \"Failed to save settings\",\n      howItWorks: \"How It Works\",\n      workflowOverview: \"Workflow Overview\",\n      step1: \"Send a task to n8n from the Tasks page\",\n      step2: \"Your n8n workflow receives the task details via webhook\",\n      step3: \"AI processes the task and generates a suggested completion\",\n      step4: \"n8n sends the result back to CloudOffice\",\n      step5: \"You review and approve or reject the AI suggestion\",\n      step6: \"Approved tasks are marked as completed automatically\",\n      webhookPayload: \"Webhook Payload Format\",\n      expectedCallback: \"Expected Callback Response\",\n      viewDocs: \"View n8n Webhook Documentation\",\n    },\n    employeeProfilePage: {\n      title: \"Profile\",\n      overview: \"Overview\",\n      tools: \"Tools\",\n      loading: \"Loading profile...\",\n      back: \"Back\",\n      contact: \"Contact Information\",\n      email: \"Email\",\n      phone: \"Phone\",\n      position: \"Position\",\n      department: \"Department\",\n      joinDate: \"Join Date\",\n      performance: \"Performance\",\n      rating: \"Rating\",\n      tasks: \"Tasks\",\n      completedTasks: \"Completed Tasks\",\n      noDepartment: \"No Department\",\n      departmentTools: \"Department Tools\",\n      availableTools: \"Available Tools\",\n      unavailable: \"Unavailable\",\n      employeeNotFound: \"Employee not found\",\n      goBack: \"Go Back\",\n    },\n    officeManagement: {\n      title: \"Office Management\",\n      subtitle: \"Manage your virtual offices and services for visitors\",\n      offices: \"Offices\",\n      services: \"Services\",\n      settings: \"Settings\",\n      addOffice: \"Add Office\",\n      editOffice: \"Edit Office\",\n      deleteOffice: \"Delete Office\",\n      officeName: \"Office Name\",\n      description: \"Description\",\n      location: \"Location\",\n      category: \"Category\",\n      contactEmail: \"Contact Email\",\n      contactPhone: \"Contact Phone\",\n      workingHours: \"Working Hours\",\n      published: \"Published\",\n      unpublished: \"Unpublished\",\n      draft: \"Draft\",\n      save: \"Save\",\n      cancel: \"Cancel\",\n      creating: \"Creating...\",\n      updating: \"Updating...\",\n      deleteConfirm: \"Are you sure you want to delete this office?\",\n      deleteWarning: \"This will also delete all services, media, and messages. This action cannot be undone.\",\n      addService: \"Add Service\",\n      editService: \"Edit Service\",\n      deleteService: \"Delete Service\",\n      serviceName: \"Service Name\",\n      serviceDescription: \"Service Description\",\n      price: \"Price\",\n      noOffices: \"No offices yet\",\n      createFirstOffice: \"Create your first virtual office to start offering services to visitors\",\n      noServices: \"No services yet\",\n      addServicesToOffice: \"Add services that visitors can view and rate\",\n      createOffice: \"Create Office\",\n      updateOffice: \"Update Office\",\n      createNewOffice: \"Create New Office\",\n      createNewOfficeDesc: \"Set up a new virtual office that visitors can browse on the marketplace\",\n      urlSlug: \"URL Slug\",\n      slugHint: \"Auto-generated from name. Only lowercase letters, numbers, and hyphens allowed.\",\n      visitorsAccessAt: \"Visitors will access at:\",\n      selectCategory: \"Select category\",\n      categoryGeneral: \"General\",\n      categoryLegal: \"Legal Services\",\n      categoryTech: \"Technology\",\n      categoryConsulting: \"Consulting\",\n      categoryMedical: \"Medical\",\n      categoryFinancial: \"Financial\",\n      categoryMarketing: \"Marketing\",\n      categoryHR: \"Human Resources\",\n      logoUrl: \"Logo URL\",\n      coverUrl: \"Cover Image URL\",\n      publishOffice: \"Publish office (visible to visitors)\",\n      officeCreated: \"Office created successfully\",\n      officeUpdated: \"Office updated successfully\",\n      officeDeleted: \"Office deleted successfully\",\n      failedCreate: \"Failed to create office\",\n      failedUpdate: \"Failed to update office\",\n      failedDelete: \"Failed to delete office\",\n      officeNameRequired: \"Office name is required\",\n      slugMinLength: \"Slug must be at least 3 characters\",\n      slugInvalid: \"Slug can only contain lowercase letters, numbers, and hyphens\",\n      serviceTitle: \"Service Title\",\n      priceType: \"Price Type\",\n      priceSAR: \"Price (SAR)\",\n      imageUrl: \"Image URL\",\n      active: \"Active\",\n      featured: \"Featured\",\n      hidden: \"Hidden\",\n      fixedPrice: \"Fixed Price\",\n      perHour: \"Per Hour\",\n      negotiable: \"Negotiable\",\n      free: \"Free\",\n      selectType: \"Select type\",\n      serviceAdded: \"Service added successfully\",\n      serviceUpdated: \"Service updated successfully\",\n      serviceDeleted: \"Service deleted successfully\",\n      failedAddService: \"Failed to add service\",\n      failedUpdateService: \"Failed to update service\",\n      failedDeleteService: \"Failed to delete service\",\n      manageYourOffice: \"Manage your office and services\",\n      viewPublicPage: \"View Public Page\",\n      servicesCount: \"Services\",\n      messages: \"Messages\",\n      visitorMessages: \"Visitor Messages\",\n      messagesDescription: \"Messages from visitors will appear here. You can respond to them as the office receptionist.\",\n      noServicesYet: \"No Services Yet\",\n      addServicesDescription: \"Add services that visitors can view and rate\",\n      addFirstService: \"Add First Service\",\n      addNewService: \"Add New Service\",\n      addNewServiceDesc: \"Create a new service that visitors can see and rate\",\n      updateServiceInfo: \"Update service information\",\n      manage: \"Manage\",\n      view: \"View\",\n      delete: \"Delete\",\n      createYourFirstOffice: \"Create Your First Office\",\n      deleteServiceConfirm: \"Are you sure you want to delete this service?\",\n    },\n    subscription: {\n      title: \"Subscription Plans\",\n      subtitle: \"Choose the plan that fits your needs\",\n      monthly: \"Monthly\",\n      yearly: \"Yearly\",\n      perMonth: \"/month\",\n      perYear: \"/year\",\n      save: \"Save\",\n      basePlan: \"Base Plan\",\n      addOns: \"Add-On Services\",\n      totalPrice: \"Total Price\",\n      checkout: \"Checkout\",\n      paymentMethod: \"Payment Method\",\n      processing: \"Processing...\",\n      subscribe: \"Subscribe\",\n      activeSubscription: \"Active Subscription\",\n      expiresOn: \"Expires on\",\n      renewSubscription: \"Renew Subscription\",\n      cancelSubscription: \"Cancel Subscription\",\n      features: \"Features\",\n      included: \"Included\",\n      selectPlan: \"Select Plan\",\n      step1: \"Step 1: Choose Plan\",\n      step2: \"Step 2: Payment\",\n      back: \"Back\",\n      continue: \"Continue\",\n      alreadySubscribed: \"You already have an active subscription\",\n      manageSubscription: \"Manage your subscription settings\",\n      officeFeatures: \"Your Virtual Office Features\",\n      officeFeaturesSubtitle: \"Subscribe now and get all these features for your office\",\n      subscribeFirst: \"Subscribe First, Then Create Your Office\",\n      subscribeFirstDesc: \"After activating your subscription, you'll be able to create your virtual office, add your services, and fully manage your team.\",\n      featureVirtualOffice: \"Complete Virtual Office\",\n      featureVirtualOfficeDesc: \"Your own professional office page\",\n      featureDashboard: \"Full Dashboard\",\n      featureDashboardDesc: \"Complete management of your operations\",\n      featureTeam: \"Team Management\",\n      featureTeamDesc: \"Add employees and manage your team easily\",\n      featureTasks: \"Task Management\",\n      featureTasksDesc: \"Track tasks and projects efficiently\",\n      featureMail: \"Internal Mail\",\n      featureMailDesc: \"Internal mail system for secure communication\",\n      featureChat: \"Instant Messaging\",\n      featureChatDesc: \"Instant chat with team and groups\",\n      featureVideo: \"Video Meetings\",\n      featureVideoDesc: \"Virtual meetings with your team\",\n      featureNotifications: \"Instant Notifications\",\n      featureNotificationsDesc: \"Stay updated with everything\",\n      featureStorefront: \"Public Storefront\",\n      featureStorefrontDesc: \"Showcase your services to potential clients\",\n      featureSupport: \"Support Tickets\",\n      featureSupportDesc: \"Ticket system to manage support requests\",\n      featureAccess: \"Access Control\",\n      featureAccessDesc: \"Full control over user permissions\",\n      featureCustomize: \"Office Customization\",\n      featureCustomizeDesc: \"Customize your office with logo and colors\",\n    },\n    sidebar: {\n      virtualWorkspace: \"Virtual Workspace\",\n      businessServices: \"Business Services\",\n      welcomePortal: \"Welcome Portal\",\n      overview: \"Overview\",\n      productivity: \"Productivity\",\n      communication: \"Communication\",\n      organization: \"Organization\",\n      management: \"Management\",\n      admin: \"Admin\",\n      dashboard: \"Dashboard\",\n      employeeProfile: \"Profile\",\n      tasks: \"Tasks\",\n      tickets: \"Tickets\",\n      n8nAutomation: \"n8n Automation\",\n      socialProfile: \"Social Profile\",\n      socialFeed: \"Social Feed\",\n      messages: \"Messages\",\n      internalMail: \"Internal Mail\",\n      meetings: \"Meetings\",\n      team: \"Team\",\n      departments: \"Departments\",\n      officeManagement: \"Office Management\",\n      servicesShowcase: \"Services Showcase\",\n      jobPostings: \"Job Postings\",\n      finances: \"Finances\",\n      advertising: \"Advertising\",\n      accessControl: \"Access Control\",\n      myOffice: \"My Office\",\n      myServices: \"My Services\",\n      mySubscriptions: \"My Subscriptions\",\n      welcome: \"Welcome\",\n      browseOffices: \"Browse Offices\",\n      viewServices: \"View Services\",\n      findJobs: \"Find Jobs\",\n      contactUs: \"Contact Us\",\n      myProfile: \"My Profile\",\n      home: \"Home\",\n      explore: \"Explore\",\n      opportunities: \"Opportunities\",\n      support: \"Support\",\n      account: \"Account\",\n      logout: \"Logout\",\n      visitor: \"Visitor\",\n    },\n    careers: {\n      title: \"Career Opportunities\",\n      subtitle: \"Browse job openings from our verified partner offices. Apply directly and take the next step in your career.\",\n      headerTitle: \"CloudOffice Careers\",\n      joinPartners: \"Join Our Partner Companies\",\n      findNext: \"Find Your Next\",\n      careerOpportunity: \"Career Opportunity\",\n      searchPlaceholder: \"Search job titles, departments...\",\n      search: \"Search\",\n      openPositions: \"Open Positions\",\n      departments: \"Departments\",\n      verified: \"Verified\",\n      allJobs: \"All Jobs\",\n      fullTime: \"Full-time\",\n      partTime: \"Part-time\",\n      contract: \"Contract\",\n      internship: \"Internship\",\n      remote: \"Remote\",\n      noJobsFound: \"No Jobs Found\",\n      adjustSearch: \"Try adjusting your search or filters\",\n      checkBack: \"Check back soon for new opportunities\",\n      clearFilters: \"Clear Filters\",\n      applyNow: \"Apply Now\",\n      postedToday: \"Posted today\",\n      postedDaysAgo: \"Posted {days} day(s) ago\",\n      applyFor: \"Apply for\",\n      applicationSubmitted: \"Application Submitted\",\n      applicationSubmittedDesc: \"Thank you for applying. We'll review your application and get back to you.\",\n      thankYouApply: \"Thank you for applying to \\\"{title}\\\". We'll review your application and contact you at the email provided.\",\n      close: \"Close\",\n      fullName: \"Full Name\",\n      fullNamePlaceholder: \"Enter your full name\",\n      emailAddress: \"Email Address\",\n      emailPlaceholder: \"your@email.com\",\n      phoneNumber: \"Phone Number\",\n      phonePlaceholder: \"+966 5XX XXX XXXX\",\n      yearsExperience: \"Years of Experience\",\n      selectExperience: \"Select experience level\",\n      exp01: \"0-1 years\",\n      exp13: \"1-3 years\",\n      exp35: \"3-5 years\",\n      exp510: \"5-10 years\",\n      exp10plus: \"10+ years\",\n      resumeLink: \"Resume/CV Link\",\n      resumePlaceholder: \"Link to your resume (Google Drive, Dropbox, etc.)\",\n      coverLetter: \"Cover Letter / Why this role?\",\n      coverLetterPlaceholder: \"Tell us why you're interested in this position...\",\n      cancel: \"Cancel\",\n      submitApplication: \"Submit Application\",\n      submitting: \"Submitting...\",\n      error: \"Error\",\n      failedSubmit: \"Failed to submit application. Please try again.\",\n      missingInfo: \"Missing Information\",\n      fillNameEmail: \"Please fill in your name and email.\",\n      allRightsReserved: \"All rights reserved.\",\n    },\n    jobs: {\n      title: \"Job Postings\",\n      subtitle: \"Manage job listings and recruitment\",\n      addJob: \"Add Job\",\n      newJobPosting: \"New Job Posting\",\n      editJob: \"Edit Job\",\n      deleteJob: \"Delete Job\",\n      createJobPosting: \"Create Job Posting\",\n      jobTitle: \"Job Title\",\n      jobTitlePlaceholder: \"e.g. Senior Developer\",\n      description: \"Job Description\",\n      descriptionPlaceholder: \"Describe the role and responsibilities...\",\n      requirements: \"Requirements\",\n      location: \"Location\",\n      salary: \"Salary Range\",\n      salaryPlaceholder: \"e.g. $80k - $120k\",\n      type: \"Employment Type\",\n      status: \"Status\",\n      department: \"Department\",\n      selectDepartment: \"Select department\",\n      active: \"Active\",\n      published: \"Published\",\n      closed: \"Closed\",\n      draft: \"Draft\",\n      drafts: \"Drafts\",\n      fullTime: \"Full-time\",\n      partTime: \"Part-time\",\n      contract: \"Contract\",\n      remote: \"Remote\",\n      hybrid: \"Hybrid\",\n      onSite: \"On-site\",\n      noJobs: \"No job postings yet\",\n      noJobsMatch: \"No job postings match your search\",\n      createFirst: \"Create your first job posting!\",\n      createDraft: \"Create Draft\",\n      creating: \"Creating...\",\n      cancel: \"Cancel\",\n      all: \"All\",\n      searchJobs: \"Search jobs...\",\n      openPositions: \"open positions available\",\n      jobRegistration: \"Job Application Registration\",\n      jobRegistrationDesc: \"Register your interest and apply for open positions\",\n      submitApplicationDesc: \"Submit your application to join our growing team. We review all applications carefully.\",\n      registerNow: \"Register Now\",\n      applicationForm: \"Job Application Form\",\n      fullName: \"Full Name\",\n      fullNamePlaceholder: \"Enter your full name\",\n      email: \"Email Address\",\n      emailPlaceholder: \"your@email.com\",\n      phone: \"Phone Number\",\n      phonePlaceholder: \"+1 (555) 000-0000\",\n      positionInterested: \"Position Interested In\",\n      selectPosition: \"Select a position\",\n      generalApplication: \"General Application\",\n      yearsExperience: \"Years of Experience\",\n      selectExperience: \"Select experience level\",\n      exp01: \"0-1 years\",\n      exp13: \"1-3 years\",\n      exp35: \"3-5 years\",\n      exp510: \"5-10 years\",\n      exp10plus: \"10+ years\",\n      resumeLink: \"Resume/CV Link\",\n      resumePlaceholder: \"Link to your resume (Google Drive, Dropbox, etc.)\",\n      coverLetter: \"Cover Letter / Additional Notes\",\n      coverLetterPlaceholder: \"Tell us why you're interested in this position...\",\n      submitApplication: \"Submit Application\",\n      jobCreated: \"Job created\",\n      jobCreatedDesc: \"Your job posting has been saved as a draft.\",\n      applicationSubmitted: \"Application Submitted\",\n      applicationSubmittedDesc: \"Thank you for your application. We'll review it and get back to you soon.\",\n      missingInfo: \"Missing Information\",\n      fillRequired: \"Please fill in all required fields.\",\n      error: \"Error\",\n      failedCreate: \"Failed to create job posting.\",\n      engineering: \"Engineering\",\n      design: \"Design\",\n      product: \"Product\",\n      marketing: \"Marketing\",\n      sales: \"Sales\",\n      hr: \"HR\",\n    },\n    storefront: {\n      title: \"Services Marketplace\",\n      subtitle: \"Browse and rate services\",\n      searchPlaceholder: \"Search services...\",\n      searchButton: \"Search\",\n      allCategories: \"All Categories\",\n      noServices: \"No services found\",\n      noServicesDesc: \"Try adjusting your filters\",\n      servicesWillAppear: \"Services will appear here once offices add them\",\n      clearFilters: \"Clear Filters\",\n      rating: \"Rating\",\n      reviews: \"reviews\",\n      price: \"Price\",\n      requestService: \"Request\",\n      filterBy: \"Filter by\",\n      sortBy: \"Sort by\",\n      newest: \"Newest\",\n      priceHighToLow: \"Price: High to Low\",\n      priceLowToHigh: \"Price: Low to High\",\n      topRated: \"Top Rated\",\n      featured: \"Featured\",\n      featuredServices: \"Featured Services\",\n      featuredServicesDesc: \"Most popular services from our partners\",\n      allServices: \"All Services\",\n      allServicesDesc: \"Browse services by category\",\n      heroTitle1: \"Request Services\",\n      heroTitle2: \"From Top Offices\",\n      heroSubtitle: \"Browse professional services from verified partner offices. Legal, administrative, consulting and more - all in one marketplace.\",\n      professionalServices: \"Professional Office Services\",\n      servicesAvailable: \"Services Available\",\n      partnerOffices: \"Partner Offices\",\n      verifiedPartners: \"Verified Partners\",\n      support247: \"Support\",\n      signIn: \"Sign In\",\n      services: \"Services\",\n      pricing: \"Pricing\",\n      visitorHub: \"Visitor Hub\",\n      partnerWithUs: \"Partner With Us\",\n      forOfficePartners: \"For Office Partners\",\n      partnerDescription: \"List your office services on our marketplace and reach more customers\",\n      monthly: \"Monthly\",\n      annual: \"Annual\",\n      perfectForStarting: \"Perfect for getting started\",\n      saveWithYearly: \"Save 50% with yearly\",\n      perMonth: \"per month\",\n      perYear: \"per year\",\n      bestValue: \"Best Value\",\n      getStarted: \"Get Started\",\n      listUnlimitedServices: \"List unlimited services\",\n      receiveServiceRequests: \"Receive service requests\",\n      customerMessaging: \"Customer messaging\",\n      basicAnalytics: \"Basic analytics\",\n      everythingInMonthly: \"Everything in Monthly\",\n      featuredListings: \"Featured service listings\",\n      prioritySupport: \"Priority support\",\n      advancedAnalytics: \"Advanced analytics\",\n      advertising: \"Advertising\",\n      advertisingDesc: \"Get your service featured on the homepage\",\n      threeDayPlacement: \"3-day placement\",\n      allRightsReserved: \"All rights reserved.\",\n      contactForPricing: \"Contact for pricing\",\n      free: \"Free\",\n      hourly: \"/hour\",\n      from: \"From\",\n      requestSubmitted: \"Request Submitted\",\n      requestSubmittedDesc: \"We'll contact you shortly about this service.\",\n      thankYouInterest: \"Thank you for your interest in\",\n      officeWillContact: \"The office team will contact you at the email provided.\",\n      requestServiceTitle: \"Request Service\",\n      fillFormToRequest: \"Fill out the form below to request\",\n      fromOffice: \"from\",\n      yourName: \"Your Name\",\n      namePlaceholder: \"John Doe\",\n      emailAddress: \"Email Address\",\n      emailPlaceholder: \"you@example.com\",\n      phoneOptional: \"Phone Number (Optional)\",\n      phonePlaceholder: \"+966 5XX XXX XXXX\",\n      messageOptional: \"Message (Optional)\",\n      messagePlaceholder: \"Tell us more about what you need...\",\n      cancel: \"Cancel\",\n      submitting: \"Submitting...\",\n      submitRequest: \"Submit Request\",\n      close: \"Close\",\n      error: \"Error\",\n      failedSubmitRequest: \"Failed to submit request. Please try again.\",\n      service: \"Service\",\n      legal: \"Legal\",\n      administrative: \"Administrative\",\n      supportCategory: \"Support\",\n      consulting: \"Consulting\",\n      sar: \"SAR\",\n    },\n    officeDetail: {\n      back: \"Back\",\n      backToMarketplace: \"Back to Marketplace\",\n      about: \"About\",\n      services: \"Services\",\n      contact: \"Contact\",\n      contactInformation: \"Contact Information\",\n      location: \"Location\",\n      workingHours: \"Working Hours\",\n      email: \"Email\",\n      phone: \"Phone\",\n      requestService: \"Request\",\n      noServices: \"No services listed\",\n      noServicesDesc: \"This office hasn't added any services yet.\",\n      rating: \"Rating\",\n      reviews: \"reviews\",\n      price: \"Price\",\n      officeNotFound: \"Office Not Found\",\n      officeNotFoundDesc: \"This virtual office doesn't exist or is not available.\",\n      media: \"Media\",\n      posts: \"Posts\",\n      noMedia: \"No media content\",\n      noMediaDesc: \"This office hasn't uploaded any videos or announcements.\",\n      noPosts: \"No posts yet\",\n      noPostsDesc: \"This office hasn't published any posts.\",\n      videos: \"Videos\",\n      announcements: \"Announcements\",\n      views: \"views\",\n      login: \"Login\",\n      chatWithReceptionist: \"Chat with Receptionist\",\n      startConversation: \"Start a conversation with\",\n      typeMessage: \"Type your message...\",\n      receptionist: \"Receptionist\",\n      yourName: \"Your name\",\n      yourNameOptional: \"Your name (optional)\",\n      save: \"Save\",\n      videoCall: \"Video Call\",\n      startVideoCall: \"Start a Video Call\",\n      connectWith: \"Connect face-to-face with\",\n      connecting: \"Connecting...\",\n      initiatingCall: \"Initiating call...\",\n      waitingForReceptionist: \"Waiting for Receptionist\",\n      pleaseWait: \"Please wait while the receptionist answers...\",\n      cancelCall: \"Cancel Call\",\n      callInProgress: \"Video call in progress\",\n      room: \"Room\",\n      endCall: \"End Call\",\n      callDeclined: \"Call Declined\",\n      receptionistUnavailable: \"The receptionist is unavailable right now.\",\n      callEnded: \"Call Ended\",\n      thankYouConnecting: \"Thank you for connecting with us.\",\n      rate: \"Rate\",\n      yourRating: \"Your rating:\",\n      submitRating: \"Submit Rating\",\n      writeComment: \"Write your comment...\",\n      postComment: \"Post Comment\",\n      comments: \"Comments\",\n      guest: \"Guest\",\n    },\n    visitorHub: {\n      title: \"Visitor Hub\",\n      subtitle: \"Explore our services\",\n      headerTitle: \"CloudOffice Visitor\",\n      browseOffices: \"Browse Offices\",\n      viewServices: \"View Services\",\n      findJobs: \"Find Jobs\",\n      contactUs: \"Contact Us\",\n      featuredOffices: \"Featured Offices\",\n      latestServices: \"Latest Services\",\n      jobOpportunities: \"Job Opportunities\",\n      dailyStatus: \"Daily Status\",\n      announcements: \"Announcements\",\n      offices: \"Offices\",\n      dailyStatusVideos: \"Daily Status Videos\",\n      updatedToday: \"Updated today\",\n      live: \"LIVE\",\n      latestAnnouncements: \"Latest Announcements\",\n      important: \"Important\",\n      share: \"Share\",\n      browsePartnerOffices: \"Browse Partner Offices\",\n      searchPlaceholder: \"Search offices by name or location...\",\n      filterAll: \"All\",\n      filterPremium: \"Premium\",\n      filterStandard: \"Standard\",\n      filterAvailable: \"Available\",\n      statusRented: \"Rented\",\n      statusOpen: \"Open\",\n      employees: \"employees\",\n      depts: \"depts\",\n      viewDetails: \"View Details\",\n      noOfficesMatch: \"No offices match your search\",\n      allRightsReserved: \"All rights reserved.\",\n      virtualOffice: \"Virtual Office\",\n      contactForPricing: \"Contact for pricing\",\n    },\n    advertising: {\n      title: \"Advertising\",\n      subtitle: \"Promote your office or services to CloudOffice visitors\",\n      createAd: \"Create Advertisement\",\n      createNewAd: \"Create New Advertisement\",\n      adDisplayedFor3Days: \"Your ad will be displayed on the homepage for 3 days\",\n      adTitle: \"Title\",\n      adTitleRequired: \"Title *\",\n      enterAdTitle: \"Enter advertisement title\",\n      adDescription: \"Description\",\n      describeOffer: \"Describe your offer or service\",\n      imageUrl: \"Image URL (optional)\",\n      linkUrl: \"Link URL (optional)\",\n      paymentMethod: \"Payment Method\",\n      cancel: \"Cancel\",\n      processing: \"Processing...\",\n      pay500SAR: \"Pay 500 SAR\",\n      myAds: \"My Advertisements\",\n      manageAds: \"Manage your active and past advertisements\",\n      noAdsYet: \"No advertisements yet\",\n      createFirstAd: \"Create your first ad to start reaching visitors\",\n      active: \"Active\",\n      pending: \"Pending\",\n      expired: \"Expired\",\n      views: \"views\",\n      clicks: \"clicks\",\n      ends: \"Ends\",\n      ended: \"Ended\",\n      link: \"Link\",\n      pricing: \"Pricing\",\n      price500SAR: \"500 SAR\",\n      for3Days: \"for 3 days\",\n      displayedOnHomepage: \"Displayed on homepage\",\n      alongsideOtherAds: \"Alongside other ads\",\n      viewClickTracking: \"View & click tracking\",\n      linkToWebsite: \"Link to your website\",\n      tipsForSuccess: \"Tips for Success\",\n      useClearTitles: \"Use clear titles\",\n      useClearTitlesDesc: \"Make your offer immediately understandable.\",\n      addAnImage: \"Add an image\",\n      addAnImageDesc: \"Ads with images get 2x more clicks.\",\n      includeALink: \"Include a link\",\n      includeALinkDesc: \"Direct visitors to your office or service page.\",\n      subscriptionRequired: \"Subscription Required\",\n      subscriptionRequiredDesc: \"You need an active office subscription to create advertisements.\",\n      subscriptionRequiredInfo: \"Subscribe to CloudOffice to unlock advertising features and promote your services to visitors.\",\n      viewSubscriptionPlans: \"View Subscription Plans\",\n      adCreated: \"Advertisement Created\",\n      adCreatedDesc: \"Your ad is now live and will run for 3 days.\",\n      failedToCreateAd: \"Failed to Create Ad\",\n      pleaseRetry: \"Please try again.\",\n      adDeleted: \"Advertisement Deleted\",\n      adDeletedDesc: \"Your ad has been removed.\",\n      failedToDelete: \"Failed to Delete\",\n      titleRequired: \"Title Required\",\n      titleRequiredDesc: \"Please enter a title for your advertisement.\",\n      applePay: \"Apple Pay\",\n      visa: \"Visa\",\n      creditCard: \"Credit Card\",\n    },\n  },\n  ar: {\n    dashboard: {\n      title: \" \",\n      welcomeBack: \"    \",\n      systemOnline: \" \",\n      dailyStories: \" \",\n      taskCompletion: \" \",\n      activeTasks: \" \",\n      openTickets: \" \",\n      teamMembers: \" \",\n      meetings: \"\",\n      departments: \"\",\n      completed: \"\",\n      pending: \" \",\n      resolved: \" \",\n      activeNow: \" \",\n      upcoming: \"\",\n      active: \"\",\n      weeklyActivity: \" \",\n      taskDistribution: \" \",\n      noTaskData: \"    \",\n      financialOverview: \" \",\n      revenue: \"\",\n      expenses: \"\",\n      netBalance: \" \",\n      profitable: \"\",\n      loss: \"\",\n      details: \"\",\n      viewAll: \" \",\n      createTask: \" \",\n      noActiveTasks: \"   \",\n      departmentsInOrg: \"/  \",\n      noDepartments: \"   \",\n      createDepartment: \"   \",\n      addDepartment: \" \",\n      inProgress: \" \",\n      Pending: \" \",\n      Completed: \"\",\n    },\n    tasks: {\n      title: \"\",\n      subtitle: \"   \",\n      newTask: \" \",\n      createNewTask: \"  \",\n      taskTitle: \"\",\n      titlePlaceholder: \"   \",\n      description: \"\",\n      descriptionPlaceholder: \"   ...\",\n      assignee: \"\",\n      selectAssignee: \"...\",\n      priority: \"\",\n      dueDate: \" \",\n      createTask: \" \",\n      creating: \" ...\",\n      allTasks: \" \",\n      aiAutomation: \"  \",\n      pendingReview: \" \",\n      searchTasks: \"  ...\",\n      filter: \"\",\n      total: \"\",\n      pending: \" \",\n      inProgress: \" \",\n      completed: \"\",\n      high: \"\",\n      medium: \"\",\n      low: \"\",\n      priorityHigh: \"\",\n      priorityMedium: \"\",\n      priorityLow: \"\",\n      priorityUrgent: \"\",\n      selectPriority: \" \",\n      noTasksMatch: \"    \",\n      noTasksYet: \"   \",\n      createFirstTask: \"   \",\n      n8nNotConfigured: \"    n8n\",\n      n8nDescription: \"  n8n         \",\n      configureN8n: \" n8n\",\n      pendingReviewTitle: \" \",\n      aiSuggestionReady: \"    \",\n      review: \"\",\n      automationHistory: \" \",\n      noAutomations: \"   \",\n      noAutomationsYet: \"   \",\n      sendFirstTask: \"   n8n   \",\n      sendTaskToN8n: \"   n8n \",\n      unknownTask: \"  \",\n      taskCreated: \"  \",\n      taskCreatedDesc: \"   .\",\n      taskSentToN8n: \"    n8n\",\n      taskSentDesc: \"    .      .\",\n      approved: \" \",\n      approvedDesc: \"        .\",\n      rejected: \"\",\n      rejectedDesc: \"    .\",\n      error: \"\",\n      failedCreate: \"   .\",\n      failedApprove: \"    .\",\n      failedReject: \"   .\",\n      unassigned: \" \",\n      noDate: \" \",\n    },\n    tickets: {\n      title: \" \",\n      subtitle: \"   \",\n      newTicket: \" \",\n      createTicket: \"  \",\n      ticketTitle: \"\",\n      titlePlaceholder: \"  \",\n      description: \"\",\n      descriptionPlaceholder: \"     ...\",\n      priority: \"\",\n      highPriority: \" \",\n      mediumPriority: \" \",\n      lowPriority: \" \",\n      submitTicket: \" \",\n      submitting: \" ...\",\n      searchTickets: \"  ...\",\n      filter: \"\",\n      allTickets: \" \",\n      open: \"\",\n      inProgress: \" \",\n      resolved: \" \",\n      closed: \"\",\n      total: \"\",\n      reportedBy: \" \",\n      assignedTo: \" \",\n      noTicketsMatch: \"    \",\n      noTicketsYet: \"   \",\n      createFirstTicket: \"    \",\n      ticketCreated: \"  \",\n      ticketCreatedDesc: \"     .\",\n      error: \"\",\n      failedCreate: \"   .\",\n    },\n    messages: {\n      title: \"\",\n      subtitle: \"    \",\n      newChat: \" \",\n      searchConversations: \"  ...\",\n      noConversations: \"   \",\n      noConversationsFound: \"  \",\n      startConversation: \"   +   \",\n      typeMessage: \" ...\",\n      send: \"\",\n      online: \"\",\n      offline: \" \",\n      members: \"\",\n      today: \"\",\n      yesterday: \"\",\n      selectUser: \"   \",\n      createGroup: \" \",\n      groupName: \" \",\n      enterGroupName: \"  ...\",\n      selectMembers: \" \",\n      createGroupBtn: \" \",\n      noMessagesYet: \"   \",\n    },\n    meetings: {\n      title: \"\",\n      subtitle: \"   \",\n      newMeeting: \" \",\n      scheduleMeeting: \" \",\n      scheduleNewMeeting: \"  \",\n      meetingTitle: \" \",\n      titlePlaceholder: \"  \",\n      description: \"\",\n      descriptionOptional: \" ()\",\n      descriptionPlaceholder: \"  ...\",\n      date: \"\",\n      startTime: \" \",\n      endTime: \" \",\n      room: \"\",\n      virtualRoom: \" \",\n      attendees: \"\",\n      selectAttendees: \" \",\n      createMeeting: \" \",\n      creating: \" ...\",\n      upcomingMeetings: \" \",\n      pastMeetings: \" \",\n      todaysMeetings: \" \",\n      allMeetings: \" \",\n      totalMeetings: \" \",\n      today: \"\",\n      upcoming: \"\",\n      noMeetings: \"   \",\n      noTodayMeetings: \"    \",\n      noUpcomingMeetings: \"   \",\n      scheduleFirst: \"   \",\n      planAhead: \"  \",\n      join: \"\",\n      edit: \"\",\n      delete: \"\",\n      attendee: \"\",\n      meetingCreated: \"  \",\n      meetingCreatedDesc: \"  .\",\n      meetingDeleted: \"  \",\n      meetingRemovedDesc: \"  .\",\n      error: \"\",\n      failedCreate: \"   .\",\n      failedDelete: \"   .\",\n      titleRequired: \"  .\",\n      dateTimeRequired: \"   .\",\n      joiningMeeting: \" \",\n      openingConference: \"      ...\",\n      confirmDelete: \"      \",\n    },\n    team: {\n      title: \"\",\n      subtitle: \"    \",\n      addMember: \" \",\n      searchMembers: \"  ...\",\n      searchPlaceholder: \"   ...\",\n      allMembers: \" \",\n      totalMembers: \" \",\n      departments: \"\",\n      onlineNow: \" \",\n      active: \"\",\n      inactive: \" \",\n      online: \"\",\n      away: \"\",\n      offline: \" \",\n      noMembers: \"     \",\n      noSearchResults: \"    \",\n      inviteFirst: \"  \",\n      role: \"\",\n      department: \"\",\n      email: \" \",\n      phone: \"\",\n      message: \"\",\n      joinedOn: \" \",\n      member: \"\",\n      admin: \"\",\n      manager: \"\",\n      completed: \"\",\n      totalTasks: \" \",\n    },\n    departments: {\n      title: \"\",\n      subtitle: \"   \",\n      myDepartments: \"\",\n      yourDepartments: \"\",\n      addDepartment: \" \",\n      createDepartment: \" \",\n      createDepartmentDesc: \"    .\",\n      departmentName: \" \",\n      departmentNamePlaceholder: \":   \",\n      description: \"\",\n      descriptionPlaceholder: \"  ...\",\n      icon: \"\",\n      color: \"\",\n      passwordProtection: \"   ()\",\n      passwordPlaceholder: \"    \",\n      passwordHint: \"     \",\n      creating: \" ...\",\n      searchDepartments: \"  ...\",\n      noDepartments: \"   \",\n      createFirst: \"    \",\n      employees: \"\",\n      active: \"\",\n      teamMembers: \" \",\n      noEmployees: \"   \",\n      addFirstEmployee: \"  \",\n      manageEmployees: \" \",\n      manager: \"\",\n      noManager: \"   \",\n      departmentProtected: \" \",\n      departmentLocked: \" \",\n      enterPasswordToAccess: \"    .    .\",\n      enterPassword: \"  \",\n      verifying: \" ...\",\n      unlock: \"\",\n      unlockDepartment: \" \",\n      selectDepartment: \" \",\n      chooseDepartment: \"     \",\n      accessGranted: \"  \",\n      departmentUnlocked: \"   .\",\n      accessDenied: \"  \",\n      incorrectPassword: \"   .\",\n      departmentCreated: \"  \",\n      departmentCreatedDesc: \"   .\",\n      departmentDeleted: \"  \",\n      departmentDeletedDesc: \"  .\",\n      error: \"\",\n      failedCreate: \"   .\",\n      colorBlue: \"\",\n      colorGreen: \"\",\n      colorPurple: \"\",\n      colorOrange: \"\",\n      colorRed: \"\",\n      colorPink: \"\",\n      colorYellow: \"\",\n      colorCyan: \"\",\n      iconGeneral: \"\",\n      iconFinance: \"\",\n      iconTeam: \"\",\n      iconHR: \" \",\n      iconLegal: \"\",\n      iconMarketing: \"\",\n      iconOperations: \"\",\n      iconSales: \"\",\n      statusActive: \"\",\n      statusInactive: \" \",\n    },\n    finances: {\n      title: \" \",\n      subtitle: \"  \",\n      addTransaction: \" \",\n      totalRevenue: \" \",\n      totalExpenses: \" \",\n      netBalance: \" \",\n      income: \"\",\n      expense: \"\",\n      recentTransactions: \" \",\n      noTransactions: \"   \",\n      addFirst: \"   \",\n      amount: \" ($)\",\n      type: \"\",\n      category: \"\",\n      date: \"\",\n      description: \"\",\n      pending: \" \",\n      approved: \" \",\n      rejected: \"\",\n      submitExpense: \" \",\n      descriptionPlaceholder: \"    \",\n      cancel: \"\",\n      submit: \"\",\n      submitting: \" ...\",\n      pendingApproval: \"  \",\n      allTransactions: \" \",\n      awaitingApproval: \"  \",\n      transactionHistory: \" \",\n      noPendingApprovals: \"   \",\n      approvedThisMonth: \"   \",\n      expenseSubmitted: \"  \",\n      expenseSubmittedDesc: \"   .\",\n      error: \"\",\n      failedSubmitExpense: \"   .\",\n      descriptionRequired: \" .\",\n      invalidAmount: \"   .\",\n      transactionUpdated: \"  \",\n      transactionUpdatedDesc: \"  .\",\n      categorySoftware: \"\",\n      categoryMeals: \"\",\n      categorySupplies: \"\",\n      categoryTravel: \"\",\n      categoryOther: \"\",\n    },\n    socialFeed: {\n      title: \" \",\n      subtitle: \"     \",\n      whatsOnMind: \"    \",\n      post: \"\",\n      posting: \" ...\",\n      like: \"\",\n      comment: \"\",\n      share: \"\",\n      comments: \"\",\n      likes: \"\",\n      writeComment: \" ...\",\n      noPostsYet: \"   \",\n      beFirst: \"      !\",\n      photo: \"\",\n      video: \"\",\n      posted: \" !\",\n      postedDesc: \"  .\",\n      error: \"\",\n      failedPost: \"   .\",\n      uploaded: \" !\",\n      readyToPost: \" .\",\n      uploadFailed: \" \",\n      uploadFailedDesc: \"   .    .\",\n      uploadPreview: \" \",\n    },\n    profile: {\n      title: \" \",\n      editProfile: \"  \",\n      firstName: \" \",\n      lastName: \" \",\n      email: \" \",\n      phone: \"\",\n      department: \"\",\n      role: \"\",\n      bio: \"\",\n      saveChanges: \" \",\n      saving: \" ...\",\n      profileUpdated: \"   \",\n      profileUpdatedDesc: \"    .\",\n    },\n    common: {\n      loading: \" ...\",\n      save: \"\",\n      cancel: \"\",\n      delete: \"\",\n      edit: \"\",\n      view: \"\",\n      create: \"\",\n      submit: \"\",\n      search: \"\",\n      filter: \"\",\n      all: \"\",\n      none: \" \",\n      yes: \"\",\n      no: \"\",\n      confirm: \"\",\n      back: \"\",\n      next: \"\",\n      previous: \"\",\n      close: \"\",\n      open: \"\",\n      success: \"\",\n      error: \"\",\n      warning: \"\",\n      info: \"\",\n      language: \"\",\n      arabic: \"\",\n      english: \"\",\n      you: \"\",\n      //  \n      somethingWentWrong: \"  \",\n      tryAgain: \"  \",\n      pleaseWait: \" ...\",\n      noDataFound: \"  \",\n      unauthorized: \"  \",\n      forbidden: \"     \",\n      notFound: \"  \",\n      serverError: \"   \",\n      networkError: \"   \",\n      sessionExpired: \" .     .\",\n      refreshPage: \" \",\n      goHome: \" \",\n      goBack: \"\",\n    },\n    welcome: {\n      greeting: \" \",\n      subtitle: \"    \",\n      searchPlaceholder: \"      ...\",\n      browseOffices: \" \",\n      viewServices: \" \",\n      findJobs: \"  \",\n      contactUs: \" \",\n      featuredOffices: \" \",\n      discoverOffices: \"    \",\n      viewAll: \" \",\n      noOffices: \"    \",\n      checkBack: \"    \",\n      availableServices: \" \",\n      servicesDescription: \"     \",\n      browseAll: \" \",\n      noServices: \"    \",\n      comingSoon: \"  \",\n      needHelp: \"      \",\n      helpDescription: \"          .\",\n      contactSupport: \"  \",\n      browseCareers: \" \",\n      virtual: \"\",\n      premium: \"\",\n      sar: \"\",\n    },\n    landing: {\n      welcomeTitle: \"   CloudOffice\",\n      welcomeSubtitle: \"   .     .\",\n      registerOffice: \" \",\n      registerOfficeDesc: \"     \",\n      getStarted: \" \",\n      visitor: \"\",\n      visitorDesc: \"      \",\n      explore: \"\",\n      jobOpportunities: \" \",\n      jobOpportunitiesDesc: \"      \",\n      viewJobs: \" \",\n      employeePortal: \" \",\n      employeePortalDesc: \"     \",\n      enter: \"\",\n      searchPlaceholder: \"   ...\",\n      signIn: \" \",\n      signInNow: \"  \",\n      exploreNow: \" \",\n      socialUpdates: \"  \",\n      achievementsTitle: \" \",\n      featuredPromotions: \" \",\n      availableOffices: \"   \",\n      viewDetails: \" \",\n      viewOffice: \" \",\n      ad: \"\",\n      globalReach: \" :\",\n      businessPartner: \" \",\n      globalReachDesc: \"        .\",\n      readyToStart: \"   \",\n      readyToStartDesc: \"      CloudOffice    .\",\n      allRightsReserved: \"  .\",\n      noOfficesMatch: \"    \",\n      reviews: \"\",\n      rented: \"\",\n      open: \"\",\n      stats: {\n        activeOffices: \" \",\n        onlineMembers: \" \",\n        hoursLogged: \" \",\n        productivity: \"\",\n        today: \"\",\n      },\n      filters: {\n        all: \"\",\n        premium: \"\",\n        standard: \"\",\n        available: \"\",\n        newlyRented: \" \",\n      },\n      achievements: {\n        premiumPartner: \" \",\n        premiumPartnerDesc: \"  \",\n        completeDoc: \" \",\n        completeDocDesc: \"  \",\n        topRated: \"  \",\n        topRatedDesc: \"  \",\n      },\n      socialPosts: {\n        post1Author: \" CloudOffice\",\n        post1Content: \"       !    .\",\n        post1Time: \" \",\n        post2Author: \" \",\n        post2Content: \"          !\",\n        post2Time: \" 4 \",\n      },\n    },\n    employeePortal: {\n      title: \" \",\n      subtitle: \"         \",\n      workEmail: \"  \",\n      emailPlaceholder: \"@.com\",\n      viewMyTasks: \" \",\n      portalNote: \"   .       .\",\n      myTasks: \"\",\n      tasksAssigned: \"    \",\n      switchAccount: \" \",\n      totalTasks: \" \",\n      pending: \" \",\n      inProgress: \" \",\n      completed: \"\",\n      all: \"\",\n      refresh: \"\",\n      noTasksAssigned: \"     \",\n      noTasksMatch: \"     \",\n      highPriority: \" \",\n      medium: \"\",\n      low: \"\",\n      due: \"\",\n      created: \" \",\n      allRightsReserved: \"  .\",\n    },\n    internalMail: {\n      title: \" \",\n      inbox: \"\",\n      sent: \"\",\n      drafts: \"\",\n      starred: \"\",\n      archived: \"\",\n      mail: \"\",\n      newMessage: \" \",\n      searchMessages: \"  ...\",\n      noMessages: \"  \",\n      noMatchingMessages: \"   \",\n      to: \"\",\n      from: \"\",\n      selectRecipient: \" ...\",\n      subject: \"\",\n      subjectPlaceholder: \" ...\",\n      content: \"\",\n      contentPlaceholder: \"  ...\",\n      saveDraft: \" \",\n      send: \"\",\n      selectMessage: \" \",\n      selectMessageDesc: \"     \",\n      replyPrefix: \":\",\n      replyToMessage: \"  \",\n    },\n    n8n: {\n      title: \"   n8n\",\n      subtitle: \"  n8n      \",\n      integrationStatus: \" \",\n      statusDesc: \"      n8n\",\n      active: \"\",\n      inactive: \" \",\n      webhookConfig: \" Webhook\",\n      webhookConfigDesc: \"    webhook   n8n    \",\n      webhookUrl: \" Webhook\",\n      webhookUrlPlaceholder: \"https://your-n8n-instance.com/webhook/xxx\",\n      webhookUrlHint: \"         \",\n      apiKey: \" API ()\",\n      apiKeyPlaceholder: \"  API \",\n      apiKeyHint: \" API     X-API-Key   webhook\",\n      saveConfig: \" \",\n      saving: \" ...\",\n      settingsSaved: \"  \",\n      settingsSavedDesc: \"    n8n  .\",\n      error: \"\",\n      failedSave: \"   \",\n      howItWorks: \" \",\n      workflowOverview: \"    \",\n      step1: \"   n8n   \",\n      step2: \"   n8n    webhook\",\n      step3: \"      \",\n      step4: \" n8n   CloudOffice\",\n      step5: \"      \",\n      step6: \"      \",\n      webhookPayload: \"  Webhook\",\n      expectedCallback: \" Callback \",\n      viewDocs: \"  n8n Webhook\",\n    },\n    employeeProfilePage: {\n      title: \" \",\n      overview: \" \",\n      tools: \"\",\n      loading: \"  ...\",\n      back: \"\",\n      contact: \" \",\n      email: \" \",\n      phone: \"\",\n      position: \"\",\n      department: \"\",\n      joinDate: \" \",\n      performance: \"\",\n      rating: \"\",\n      tasks: \"\",\n      completedTasks: \" \",\n      noDepartment: \"  \",\n      departmentTools: \" \",\n      availableTools: \" \",\n      unavailable: \" \",\n      employeeNotFound: \"    \",\n      goBack: \"\",\n    },\n    officeManagement: {\n      title: \" \",\n      subtitle: \"    \",\n      offices: \"\",\n      services: \"\",\n      settings: \"\",\n      addOffice: \" \",\n      editOffice: \" \",\n      deleteOffice: \" \",\n      officeName: \" \",\n      description: \"\",\n      location: \"\",\n      category: \"\",\n      contactEmail: \"  \",\n      contactPhone: \" \",\n      workingHours: \" \",\n      published: \"\",\n      unpublished: \" \",\n      draft: \"\",\n      save: \"\",\n      cancel: \"\",\n      creating: \" ...\",\n      updating: \" ...\",\n      deleteConfirm: \"      \",\n      deleteWarning: \"      .      .\",\n      addService: \" \",\n      editService: \" \",\n      deleteService: \" \",\n      serviceName: \" \",\n      serviceDescription: \" \",\n      price: \"\",\n      noOffices: \"   \",\n      createFirstOffice: \"        \",\n      noServices: \"   \",\n      addServicesToOffice: \"     \",\n      createOffice: \" \",\n      updateOffice: \" \",\n      createNewOffice: \"  \",\n      createNewOfficeDesc: \"        \",\n      urlSlug: \" URL \",\n      slugHint: \"    .      .\",\n      visitorsAccessAt: \"  :\",\n      selectCategory: \" \",\n      categoryGeneral: \"\",\n      categoryLegal: \" \",\n      categoryTech: \"\",\n      categoryConsulting: \"\",\n      categoryMedical: \"\",\n      categoryFinancial: \"\",\n      categoryMarketing: \"\",\n      categoryHR: \" \",\n      logoUrl: \" \",\n      coverUrl: \"  \",\n      publishOffice: \"  ( )\",\n      officeCreated: \"   \",\n      officeUpdated: \"   \",\n      officeDeleted: \"   \",\n      failedCreate: \"   \",\n      failedUpdate: \"   \",\n      failedDelete: \"   \",\n      officeNameRequired: \"  \",\n      slugMinLength: \"     3   \",\n      slugInvalid: \"          \",\n      serviceTitle: \" \",\n      priceType: \" \",\n      priceSAR: \" ()\",\n      imageUrl: \" \",\n      active: \"\",\n      featured: \"\",\n      hidden: \"\",\n      fixedPrice: \" \",\n      perHour: \" \",\n      negotiable: \" \",\n      free: \"\",\n      selectType: \" \",\n      serviceAdded: \"   \",\n      serviceUpdated: \"   \",\n      serviceDeleted: \"   \",\n      failedAddService: \"   \",\n      failedUpdateService: \"   \",\n      failedDeleteService: \"   \",\n      manageYourOffice: \"  \",\n      viewPublicPage: \"  \",\n      servicesCount: \"\",\n      messages: \"\",\n      visitorMessages: \" \",\n      messagesDescription: \"   .      .\",\n      noServicesYet: \"   \",\n      addServicesDescription: \"     \",\n      addFirstService: \"  \",\n      addNewService: \"  \",\n      addNewServiceDesc: \"      \",\n      updateServiceInfo: \"  \",\n      manage: \"\",\n      view: \"\",\n      delete: \"\",\n      createYourFirstOffice: \"   \",\n      deleteServiceConfirm: \"      \",\n    },\n    subscription: {\n      title: \" \",\n      subtitle: \"    \",\n      monthly: \"\",\n      yearly: \"\",\n      perMonth: \"/\",\n      perYear: \"/\",\n      save: \"\",\n      basePlan: \" \",\n      addOns: \" \",\n      totalPrice: \" \",\n      checkout: \" \",\n      paymentMethod: \" \",\n      processing: \" ...\",\n      subscribe: \"\",\n      activeSubscription: \" \",\n      expiresOn: \" \",\n      renewSubscription: \" \",\n      cancelSubscription: \" \",\n      features: \"\",\n      included: \"\",\n      selectPlan: \" \",\n      step1: \" 1:  \",\n      step2: \" 2: \",\n      back: \"\",\n      continue: \"\",\n      alreadySubscribed: \"   \",\n      manageSubscription: \"  \",\n      officeFeatures: \"  \",\n      officeFeaturesSubtitle: \"       \",\n      subscribeFirst: \"    \",\n      subscribeFirstDesc: \"            .\",\n      featureVirtualOffice: \"  \",\n      featureVirtualOfficeDesc: \"    \",\n      featureDashboard: \"  \",\n      featureDashboardDesc: \"   \",\n      featureTeam: \" \",\n      featureTeamDesc: \"    \",\n      featureTasks: \" \",\n      featureTasksDesc: \"   \",\n      featureMail: \" \",\n      featureMailDesc: \"    \",\n      featureChat: \" \",\n      featureChatDesc: \"    \",\n      featureVideo: \" \",\n      featureVideoDesc: \"   \",\n      featureNotifications: \" \",\n      featureNotificationsDesc: \"    \",\n      featureStorefront: \"  \",\n      featureStorefrontDesc: \"   \",\n      featureSupport: \" \",\n      featureSupportDesc: \"    \",\n      featureAccess: \" \",\n      featureAccessDesc: \"   \",\n      featureCustomize: \" \",\n      featureCustomizeDesc: \"   \",\n    },\n    sidebar: {\n      virtualWorkspace: \"  \",\n      businessServices: \" \",\n      welcomePortal: \" \",\n      overview: \" \",\n      productivity: \"\",\n      communication: \"\",\n      organization: \"\",\n      management: \"\",\n      admin: \"\",\n      dashboard: \" \",\n      employeeProfile: \" \",\n      tasks: \"\",\n      tickets: \"\",\n      n8nAutomation: \" n8n\",\n      socialProfile: \" \",\n      socialFeed: \" \",\n      messages: \"\",\n      internalMail: \" \",\n      meetings: \"\",\n      team: \"\",\n      departments: \"\",\n      officeManagement: \" \",\n      servicesShowcase: \" \",\n      jobPostings: \"\",\n      finances: \"\",\n      advertising: \"\",\n      accessControl: \" \",\n      myOffice: \"\",\n      myServices: \"\",\n      mySubscriptions: \"\",\n      welcome: \"\",\n      browseOffices: \" \",\n      viewServices: \" \",\n      findJobs: \"  \",\n      contactUs: \" \",\n      myProfile: \" \",\n      home: \"\",\n      explore: \"\",\n      opportunities: \"\",\n      support: \"\",\n      account: \"\",\n      logout: \" \",\n      visitor: \"\",\n    },\n    careers: {\n      title: \" \",\n      subtitle: \"     .        .\",\n      headerTitle: \" CloudOffice\",\n      joinPartners: \"  \",\n      findNext: \" \",\n      careerOpportunity: \"  \",\n      searchPlaceholder: \"    ...\",\n      search: \"\",\n      openPositions: \" \",\n      departments: \"\",\n      verified: \"\",\n      allJobs: \" \",\n      fullTime: \" \",\n      partTime: \" \",\n      contract: \"\",\n      internship: \"\",\n      remote: \" \",\n      noJobsFound: \"    \",\n      adjustSearch: \"    \",\n      checkBack: \"    \",\n      clearFilters: \" \",\n      applyNow: \" \",\n      postedToday: \" \",\n      postedDaysAgo: \"  {days} /\",\n      applyFor: \" \",\n      applicationSubmitted: \"  \",\n      applicationSubmittedDesc: \" .    .\",\n      thankYouApply: \"   \\\"{title}\\\".        .\",\n      close: \"\",\n      fullName: \" \",\n      fullNamePlaceholder: \"  \",\n      emailAddress: \" \",\n      emailPlaceholder: \"your@email.com\",\n      phoneNumber: \" \",\n      phonePlaceholder: \"+966 5XX XXX XXXX\",\n      yearsExperience: \" \",\n      selectExperience: \"  \",\n      exp01: \"0-1 \",\n      exp13: \"1-3 \",\n      exp35: \"3-5 \",\n      exp510: \"5-10 \",\n      exp10plus: \"+10 \",\n      resumeLink: \"  \",\n      resumePlaceholder: \"   (Google Drive Dropbox )\",\n      coverLetter: \"  /   \",\n      coverLetterPlaceholder: \"     ...\",\n      cancel: \"\",\n      submitApplication: \" \",\n      submitting: \" ...\",\n      error: \"\",\n      failedSubmit: \"   .    .\",\n      missingInfo: \" \",\n      fillNameEmail: \"    .\",\n      allRightsReserved: \"  .\",\n    },\n    jobs: {\n      title: \" \",\n      subtitle: \"   \",\n      addJob: \" \",\n      newJobPosting: \"  \",\n      editJob: \" \",\n      deleteJob: \" \",\n      createJobPosting: \"  \",\n      jobTitle: \" \",\n      jobTitlePlaceholder: \":  \",\n      description: \" \",\n      descriptionPlaceholder: \"  ...\",\n      requirements: \"\",\n      location: \"\",\n      salary: \" \",\n      salaryPlaceholder: \": 80  - 120  \",\n      type: \" \",\n      status: \"\",\n      department: \"\",\n      selectDepartment: \" \",\n      active: \"\",\n      published: \"\",\n      closed: \"\",\n      draft: \"\",\n      drafts: \"\",\n      fullTime: \" \",\n      partTime: \" \",\n      contract: \"\",\n      remote: \" \",\n      hybrid: \"\",\n      onSite: \" \",\n      noJobs: \"   \",\n      noJobsMatch: \"    \",\n      createFirst: \"   !\",\n      createDraft: \" \",\n      creating: \" ...\",\n      cancel: \"\",\n      all: \"\",\n      searchJobs: \"  ...\",\n      openPositions: \" \",\n      jobRegistration: \"  \",\n      jobRegistrationDesc: \"     \",\n      submitApplicationDesc: \"     .    .\",\n      registerNow: \" \",\n      applicationForm: \"  \",\n      fullName: \" \",\n      fullNamePlaceholder: \"  \",\n      email: \" \",\n      emailPlaceholder: \"your@email.com\",\n      phone: \" \",\n      phonePlaceholder: \"+966 5XX XXX XXXX\",\n      positionInterested: \"  \",\n      selectPosition: \" \",\n      generalApplication: \" \",\n      yearsExperience: \" \",\n      selectExperience: \"  \",\n      exp01: \"0-1 \",\n      exp13: \"1-3 \",\n      exp35: \"3-5 \",\n      exp510: \"5-10 \",\n      exp10plus: \"+10 \",\n      resumeLink: \"  \",\n      resumePlaceholder: \"   (Google Drive Dropbox )\",\n      coverLetter: \"  /  \",\n      coverLetterPlaceholder: \"     ...\",\n      submitApplication: \" \",\n      jobCreated: \"  \",\n      jobCreatedDesc: \"    .\",\n      applicationSubmitted: \"  \",\n      applicationSubmittedDesc: \" .     .\",\n      missingInfo: \" \",\n      fillRequired: \"    .\",\n      error: \"\",\n      failedCreate: \"    .\",\n      engineering: \"\",\n      design: \"\",\n      product: \"\",\n      marketing: \"\",\n      sales: \"\",\n      hr: \" \",\n    },\n    storefront: {\n      title: \" \",\n      subtitle: \"  \",\n      searchPlaceholder: \"  ...\",\n      searchButton: \"\",\n      allCategories: \" \",\n      noServices: \"  \",\n      noServicesDesc: \"  \",\n      servicesWillAppear: \"      \",\n      clearFilters: \" \",\n      rating: \"\",\n      reviews: \"\",\n      price: \"\",\n      requestService: \"\",\n      filterBy: \" \",\n      sortBy: \" \",\n      newest: \"\",\n      priceHighToLow: \":   \",\n      priceLowToHigh: \":   \",\n      topRated: \" \",\n      featured: \"\",\n      featuredServices: \" \",\n      featuredServicesDesc: \"    \",\n      allServices: \" \",\n      allServicesDesc: \"   \",\n      heroTitle1: \" \",\n      heroTitle2: \"  \",\n      heroSubtitle: \"      .     -    .\",\n      professionalServices: \"  \",\n      servicesAvailable: \" \",\n      partnerOffices: \" \",\n      verifiedPartners: \" \",\n      support247: \"\",\n      signIn: \" \",\n      services: \"\",\n      pricing: \"\",\n      visitorHub: \" \",\n      partnerWithUs: \"  \",\n      forOfficePartners: \" \",\n      partnerDescription: \"         \",\n      monthly: \"\",\n      annual: \"\",\n      perfectForStarting: \" \",\n      saveWithYearly: \" 50%   \",\n      perMonth: \"\",\n      perYear: \"\",\n      bestValue: \" \",\n      getStarted: \" \",\n      listUnlimitedServices: \"   \",\n      receiveServiceRequests: \"  \",\n      customerMessaging: \" \",\n      basicAnalytics: \" \",\n      everythingInMonthly: \"   \",\n      featuredListings: \"  \",\n      prioritySupport: \"  \",\n      advancedAnalytics: \" \",\n      advertising: \"\",\n      advertisingDesc: \"     \",\n      threeDayPlacement: \" 3 \",\n      allRightsReserved: \"  .\",\n      contactForPricing: \" \",\n      free: \"\",\n      hourly: \"/\",\n      from: \"\",\n      requestSubmitted: \"  \",\n      requestSubmittedDesc: \"     .\",\n      thankYouInterest: \"  \",\n      officeWillContact: \"       .\",\n      requestServiceTitle: \" \",\n      fillFormToRequest: \"   \",\n      fromOffice: \"\",\n      yourName: \"\",\n      namePlaceholder: \" \",\n      emailAddress: \" \",\n      emailPlaceholder: \"you@example.com\",\n      phoneOptional: \"  ()\",\n      phonePlaceholder: \"+966 5XX XXX XXXX\",\n      messageOptional: \" ()\",\n      messagePlaceholder: \"    ...\",\n      cancel: \"\",\n      submitting: \" ...\",\n      submitRequest: \" \",\n      close: \"\",\n      error: \"\",\n      failedSubmitRequest: \"   .    .\",\n      service: \"\",\n      legal: \"\",\n      administrative: \"\",\n      supportCategory: \"\",\n      consulting: \"\",\n      sar: \"\",\n    },\n    officeDetail: {\n      back: \"\",\n      backToMarketplace: \" \",\n      about: \"\",\n      services: \"\",\n      contact: \"\",\n      contactInformation: \" \",\n      location: \"\",\n      workingHours: \" \",\n      email: \" \",\n      phone: \"\",\n      requestService: \"\",\n      noServices: \"  \",\n      noServicesDesc: \"      .\",\n      rating: \"\",\n      reviews: \"\",\n      price: \"\",\n      officeNotFound: \"  \",\n      officeNotFoundDesc: \"       .\",\n      media: \"\",\n      posts: \"\",\n      noMedia: \"   \",\n      noMediaDesc: \"       .\",\n      noPosts: \"  \",\n      noPostsDesc: \"     .\",\n      videos: \"\",\n      announcements: \"\",\n      views: \"\",\n      login: \" \",\n      chatWithReceptionist: \"   \",\n      startConversation: \"  \",\n      typeMessage: \" ...\",\n      receptionist: \" \",\n      yourName: \"\",\n      yourNameOptional: \" ()\",\n      save: \"\",\n      videoCall: \" \",\n      startVideoCall: \"  \",\n      connectWith: \"   \",\n      connecting: \" ...\",\n      initiatingCall: \"  ...\",\n      waitingForReceptionist: \"   \",\n      pleaseWait: \"     ...\",\n      cancelCall: \" \",\n      callInProgress: \"  \",\n      room: \"\",\n      endCall: \" \",\n      callDeclined: \"  \",\n      receptionistUnavailable: \"    .\",\n      callEnded: \" \",\n      thankYouConnecting: \"  .\",\n      rate: \"\",\n      yourRating: \":\",\n      submitRating: \" \",\n      writeComment: \" ...\",\n      postComment: \" \",\n      comments: \"\",\n      guest: \"\",\n    },\n    visitorHub: {\n      title: \" \",\n      subtitle: \" \",\n      headerTitle: \" CloudOffice\",\n      browseOffices: \" \",\n      viewServices: \" \",\n      findJobs: \"  \",\n      contactUs: \" \",\n      featuredOffices: \" \",\n      latestServices: \" \",\n      jobOpportunities: \" \",\n      dailyStatus: \" \",\n      announcements: \"\",\n      offices: \"\",\n      dailyStatusVideos: \"  \",\n      updatedToday: \" \",\n      live: \"\",\n      latestAnnouncements: \" \",\n      important: \"\",\n      share: \"\",\n      browsePartnerOffices: \"  \",\n      searchPlaceholder: \"     ...\",\n      filterAll: \"\",\n      filterPremium: \"\",\n      filterStandard: \"\",\n      filterAvailable: \"\",\n      statusRented: \"\",\n      statusOpen: \"\",\n      employees: \"\",\n      depts: \"\",\n      viewDetails: \" \",\n      noOfficesMatch: \"    \",\n      allRightsReserved: \"  .\",\n      virtualOffice: \" \",\n      contactForPricing: \" \",\n    },\n    advertising: {\n      title: \"\",\n      subtitle: \"     CloudOffice\",\n      createAd: \" \",\n      createNewAd: \"  \",\n      adDisplayedFor3Days: \"       3 \",\n      adTitle: \"\",\n      adTitleRequired: \" *\",\n      enterAdTitle: \"  \",\n      adDescription: \"\",\n      describeOffer: \"   \",\n      imageUrl: \"  ()\",\n      linkUrl: \" URL ()\",\n      paymentMethod: \" \",\n      cancel: \"\",\n      processing: \" ...\",\n      pay500SAR: \" 500 \",\n      myAds: \"\",\n      manageAds: \"   \",\n      noAdsYet: \"   \",\n      createFirstAd: \"     \",\n      active: \"\",\n      pending: \" \",\n      expired: \"\",\n      views: \"\",\n      clicks: \"\",\n      ends: \"\",\n      ended: \"\",\n      link: \"\",\n      pricing: \"\",\n      price500SAR: \"500 \",\n      for3Days: \" 3 \",\n      displayedOnHomepage: \"   \",\n      alongsideOtherAds: \"  \",\n      viewClickTracking: \"  \",\n      linkToWebsite: \" \",\n      tipsForSuccess: \" \",\n      useClearTitles: \"  \",\n      useClearTitlesDesc: \"   .\",\n      addAnImage: \" \",\n      addAnImageDesc: \"      .\",\n      includeALink: \" \",\n      includeALinkDesc: \"     .\",\n      subscriptionRequired: \" \",\n      subscriptionRequiredDesc: \"     .\",\n      subscriptionRequiredInfo: \"  CloudOffice      .\",\n      viewSubscriptionPlans: \"  \",\n      adCreated: \"  \",\n      adCreatedDesc: \"     3 .\",\n      failedToCreateAd: \"   \",\n      pleaseRetry: \"   .\",\n      adDeleted: \"  \",\n      adDeletedDesc: \"  .\",\n      failedToDelete: \"  \",\n      titleRequired: \" \",\n      titleRequiredDesc: \"   .\",\n      applePay: \"Apple Pay\",\n      visa: \"Visa\",\n      creditCard: \" \",\n    },\n  },\n};\n\nexport function useTranslation() {\n  const { language } = useLanguage();\n  const t = translations[language as keyof typeof translations];\n  return { t, language };\n}\n","path":null,"size_bytes":108365,"size_tokens":null},"client/src/lib/notifications.ts":{"content":"import { apiRequest } from './queryClient';\n\nlet cachedVapidKey: string | null = null;\n\nasync function getVapidPublicKey(): Promise<string> {\n  if (cachedVapidKey) return cachedVapidKey;\n  \n  try {\n    const response = await fetch('/api/push/vapid-public-key');\n    const data = await response.json();\n    cachedVapidKey = data.publicKey || '';\n    return cachedVapidKey || '';\n  } catch (error) {\n    console.error('Failed to fetch VAPID key:', error);\n    return '';\n  }\n}\n\nfunction urlBase64ToUint8Array(base64String: string): Uint8Array {\n  const padding = '='.repeat((4 - (base64String.length % 4)) % 4);\n  const base64 = (base64String + padding)\n    .replace(/-/g, '+')\n    .replace(/_/g, '/');\n\n  const rawData = window.atob(base64);\n  const outputArray = new Uint8Array(rawData.length);\n\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n  return outputArray;\n}\n\nexport function isPushSupported(): boolean {\n  return 'serviceWorker' in navigator && 'PushManager' in window && 'Notification' in window;\n}\n\nexport async function getNotificationPermission(): Promise<NotificationPermission> {\n  if (!('Notification' in window)) {\n    return 'denied';\n  }\n  return Notification.permission;\n}\n\nexport async function requestNotificationPermission(): Promise<NotificationPermission> {\n  if (!('Notification' in window)) {\n    return 'denied';\n  }\n  return await Notification.requestPermission();\n}\n\nexport async function registerServiceWorker(): Promise<ServiceWorkerRegistration | null> {\n  if (!('serviceWorker' in navigator)) {\n    console.warn('Service workers are not supported');\n    return null;\n  }\n\n  try {\n    const registration = await navigator.serviceWorker.register('/sw.js', {\n      scope: '/',\n    });\n    console.log('Service Worker registered:', registration.scope);\n    return registration;\n  } catch (error) {\n    console.error('Service Worker registration failed:', error);\n    return null;\n  }\n}\n\nexport async function subscribeToPush(): Promise<boolean> {\n  if (!isPushSupported()) {\n    console.warn('Push notifications are not supported');\n    return false;\n  }\n\n  const vapidKey = await getVapidPublicKey();\n  if (!vapidKey) {\n    console.warn('VAPID public key not configured');\n    return false;\n  }\n\n  try {\n    const permission = await requestNotificationPermission();\n    if (permission !== 'granted') {\n      console.log('Notification permission not granted');\n      return false;\n    }\n\n    const registration = await registerServiceWorker();\n    if (!registration) {\n      return false;\n    }\n\n    await navigator.serviceWorker.ready;\n\n    let subscription = await registration.pushManager.getSubscription();\n\n    if (!subscription) {\n      subscription = await registration.pushManager.subscribe({\n        userVisibleOnly: true,\n        applicationServerKey: urlBase64ToUint8Array(vapidKey),\n      });\n    }\n\n    const keys = subscription.toJSON().keys;\n    if (!keys) {\n      console.error('Failed to get subscription keys');\n      return false;\n    }\n\n    await apiRequest('POST', '/api/push/subscribe', {\n      endpoint: subscription.endpoint,\n      p256dh: keys.p256dh,\n      auth: keys.auth,\n      userAgent: navigator.userAgent,\n    });\n\n    console.log('Push subscription successful');\n    return true;\n  } catch (error) {\n    console.error('Failed to subscribe to push notifications:', error);\n    return false;\n  }\n}\n\nexport async function unsubscribeFromPush(): Promise<boolean> {\n  if (!('serviceWorker' in navigator)) {\n    return false;\n  }\n\n  try {\n    const registration = await navigator.serviceWorker.ready;\n    const subscription = await registration.pushManager.getSubscription();\n\n    if (subscription) {\n      await subscription.unsubscribe();\n      await apiRequest('POST', '/api/push/unsubscribe', {\n        endpoint: subscription.endpoint,\n      });\n    }\n\n    console.log('Push unsubscription successful');\n    return true;\n  } catch (error) {\n    console.error('Failed to unsubscribe from push notifications:', error);\n    return false;\n  }\n}\n\nexport async function isSubscribedToPush(): Promise<boolean> {\n  if (!('serviceWorker' in navigator)) {\n    return false;\n  }\n\n  try {\n    const registration = await navigator.serviceWorker.ready;\n    const subscription = await registration.pushManager.getSubscription();\n    return !!subscription;\n  } catch (error) {\n    return false;\n  }\n}\n\nexport function showLocalNotification(title: string, options?: NotificationOptions): void {\n  if (Notification.permission === 'granted') {\n    new Notification(title, {\n      icon: '/favicon.ico',\n      badge: '/favicon.ico',\n      ...options,\n    });\n  }\n}\n","path":null,"size_bytes":4651,"size_tokens":null},"client/src/components/NotificationPermission.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { Bell, BellOff, X } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { \n  isPushSupported, \n  getNotificationPermission, \n  subscribeToPush,\n  unsubscribeFromPush,\n  isSubscribedToPush,\n} from '@/lib/notifications';\nimport { useToast } from '@/hooks/use-toast';\nimport { useAuth } from '@/hooks/useAuth';\n\ninterface NotificationPermissionProps {\n  showBanner?: boolean;\n}\n\nexport function NotificationPermission({ showBanner = true }: NotificationPermissionProps) {\n  const { isAuthenticated } = useAuth();\n  const [isSupported, setIsSupported] = useState(false);\n  const [permission, setPermission] = useState<NotificationPermission>('default');\n  const [isSubscribed, setIsSubscribed] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [isDismissed, setIsDismissed] = useState(false);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    const checkStatus = async () => {\n      setIsSupported(isPushSupported());\n      const perm = await getNotificationPermission();\n      setPermission(perm);\n      if (perm === 'granted') {\n        const subscribed = await isSubscribedToPush();\n        setIsSubscribed(subscribed);\n      }\n      const dismissed = localStorage.getItem('notification-banner-dismissed');\n      if (dismissed) {\n        setIsDismissed(true);\n      }\n    };\n    checkStatus();\n  }, []);\n\n  const handleSubscribe = async () => {\n    setIsLoading(true);\n    try {\n      const success = await subscribeToPush();\n      if (success) {\n        setIsSubscribed(true);\n        setPermission('granted');\n        toast({\n          title: 'Notifications enabled',\n          description: 'You will now receive push notifications',\n        });\n      } else {\n        toast({\n          title: 'Could not enable notifications',\n          description: 'Please check your browser settings',\n          variant: 'destructive',\n        });\n      }\n    } catch (error) {\n      console.error('Subscribe error:', error);\n      toast({\n        title: 'Error',\n        description: 'Failed to enable notifications',\n        variant: 'destructive',\n      });\n    }\n    setIsLoading(false);\n  };\n\n  const handleUnsubscribe = async () => {\n    setIsLoading(true);\n    try {\n      await unsubscribeFromPush();\n      setIsSubscribed(false);\n      toast({\n        title: 'Notifications disabled',\n        description: 'You will no longer receive push notifications',\n      });\n    } catch (error) {\n      console.error('Unsubscribe error:', error);\n    }\n    setIsLoading(false);\n  };\n\n  const handleDismiss = () => {\n    setIsDismissed(true);\n    localStorage.setItem('notification-banner-dismissed', 'true');\n  };\n\n  if (!isSupported || permission === 'denied' || !isAuthenticated) {\n    return null;\n  }\n\n  if (showBanner && !isDismissed && permission === 'default') {\n    return (\n      <Card className=\"fixed bottom-4 right-4 z-50 w-80 shadow-lg border border-white/10 glass\">\n        <CardContent className=\"p-4\">\n          <div className=\"flex items-start gap-3\">\n            <div className=\"p-2 rounded-lg bg-primary/10\">\n              <Bell className=\"h-5 w-5 text-primary\" />\n            </div>\n            <div className=\"flex-1\">\n              <h4 className=\"font-semibold text-sm mb-1\">Enable Notifications</h4>\n              <p className=\"text-xs text-muted-foreground mb-3\">\n                Get notified about new messages, tasks, and updates\n              </p>\n              <div className=\"flex gap-2\">\n                <Button \n                  size=\"sm\" \n                  onClick={handleSubscribe}\n                  disabled={isLoading}\n                  data-testid=\"button-enable-notifications\"\n                >\n                  Enable\n                </Button>\n                <Button \n                  size=\"sm\" \n                  variant=\"ghost\" \n                  onClick={handleDismiss}\n                  data-testid=\"button-dismiss-notifications\"\n                >\n                  Later\n                </Button>\n              </div>\n            </div>\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              className=\"h-6 w-6\"\n              onClick={handleDismiss}\n              data-testid=\"button-close-notification-banner\"\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return null;\n}\n\nexport function NotificationToggle() {\n  const [isSupported, setIsSupported] = useState(false);\n  const [isSubscribed, setIsSubscribed] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    const checkStatus = async () => {\n      const supported = isPushSupported();\n      setIsSupported(supported);\n      if (supported) {\n        const subscribed = await isSubscribedToPush();\n        setIsSubscribed(subscribed);\n      }\n    };\n    checkStatus();\n  }, []);\n\n  const handleToggle = async () => {\n    setIsLoading(true);\n    try {\n      if (isSubscribed) {\n        await unsubscribeFromPush();\n        setIsSubscribed(false);\n        toast({\n          title: 'Notifications disabled',\n          description: 'You will no longer receive push notifications',\n        });\n      } else {\n        const success = await subscribeToPush();\n        if (success) {\n          setIsSubscribed(true);\n          toast({\n            title: 'Notifications enabled',\n            description: 'You will now receive push notifications',\n          });\n        }\n      }\n    } catch (error) {\n      console.error('Toggle error:', error);\n    }\n    setIsLoading(false);\n  };\n\n  if (!isSupported) {\n    return null;\n  }\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={handleToggle}\n      disabled={isLoading}\n      title={isSubscribed ? 'Disable notifications' : 'Enable notifications'}\n      data-testid=\"button-toggle-notifications\"\n    >\n      {isSubscribed ? (\n        <Bell className=\"h-5 w-5 text-primary\" />\n      ) : (\n        <BellOff className=\"h-5 w-5 text-muted-foreground\" />\n      )}\n    </Button>\n  );\n}\n","path":null,"size_bytes":6216,"size_tokens":null},"server/web-push.d.ts":{"content":"declare module 'web-push';\n","path":null,"size_bytes":27,"size_tokens":null},"public/sw.js":{"content":"self.addEventListener('install', (event) => {\n  self.skipWaiting();\n});\n\nself.addEventListener('activate', (event) => {\n  event.waitUntil(clients.claim());\n});\n\nself.addEventListener('push', (event) => {\n  if (!event.data) return;\n\n  try {\n    const data = event.data.json();\n    const options = {\n      body: data.body || 'New notification',\n      icon: data.icon || '/favicon.ico',\n      badge: data.badge || '/favicon.ico',\n      tag: data.tag || 'cloudoffice-notification',\n      data: data.data || {},\n      requireInteraction: data.requireInteraction || false,\n      actions: data.actions || [],\n      vibrate: [100, 50, 100],\n    };\n\n    event.waitUntil(\n      self.registration.showNotification(data.title || 'CloudOffice', options)\n    );\n  } catch (error) {\n    console.error('Push notification error:', error);\n  }\n});\n\nself.addEventListener('notificationclick', (event) => {\n  event.notification.close();\n\n  const urlToOpen = event.notification.data?.url || '/';\n\n  event.waitUntil(\n    clients.matchAll({ type: 'window', includeUncontrolled: true }).then((clientList) => {\n      for (const client of clientList) {\n        if (client.url.includes(self.location.origin) && 'focus' in client) {\n          try {\n            client.navigate(urlToOpen);\n            return client.focus();\n          } catch (err) {\n            console.error('Navigation error:', err);\n            return client.focus();\n          }\n        }\n      }\n      if (clients.openWindow) {\n        return clients.openWindow(urlToOpen);\n      }\n    }).catch((err) => {\n      console.error('Notification click handler error:', err);\n    })\n  );\n});\n","path":null,"size_bytes":1629,"size_tokens":null},"server/pushService.ts":{"content":"import webpush from 'web-push';\nimport { storage } from './storage';\n\nconst VAPID_PUBLIC_KEY = process.env.VAPID_PUBLIC_KEY || '';\nconst VAPID_PRIVATE_KEY = process.env.VAPID_PRIVATE_KEY || '';\n\nif (VAPID_PUBLIC_KEY && VAPID_PRIVATE_KEY) {\n  webpush.setVapidDetails(\n    'mailto:admin@cloudoffice.app',\n    VAPID_PUBLIC_KEY,\n    VAPID_PRIVATE_KEY\n  );\n}\n\nexport interface PushPayload {\n  title: string;\n  body: string;\n  icon?: string;\n  badge?: string;\n  tag?: string;\n  data?: {\n    url?: string;\n    [key: string]: unknown;\n  };\n  requireInteraction?: boolean;\n  actions?: Array<{\n    action: string;\n    title: string;\n    icon?: string;\n  }>;\n}\n\nexport async function sendPushNotification(userId: string, payload: PushPayload): Promise<void> {\n  if (!VAPID_PUBLIC_KEY || !VAPID_PRIVATE_KEY) {\n    console.warn('VAPID keys not configured, skipping push notification');\n    return;\n  }\n\n  try {\n    const subscriptions = await storage.getPushSubscriptions(userId);\n    \n    if (subscriptions.length === 0) {\n      console.log(`No push subscriptions found for user ${userId}`);\n      return;\n    }\n\n    const payloadString = JSON.stringify(payload);\n    const failedSubscriptions: Array<{ endpoint: string; userId: string }> = [];\n\n    await Promise.all(\n      subscriptions.map(async (subscription) => {\n        try {\n          await webpush.sendNotification(\n            {\n              endpoint: subscription.endpoint,\n              keys: {\n                p256dh: subscription.p256dh,\n                auth: subscription.auth,\n              },\n            },\n            payloadString,\n            {\n              TTL: 86400,\n              urgency: 'high',\n            }\n          );\n          console.log(`Push notification sent to ${subscription.endpoint.substring(0, 50)}...`);\n        } catch (error: any) {\n          console.error('Failed to send push notification:', error.message);\n          if (error.statusCode === 404 || error.statusCode === 410) {\n            failedSubscriptions.push({ endpoint: subscription.endpoint, userId: subscription.userId });\n          }\n        }\n      })\n    );\n\n    for (const { endpoint, userId: subUserId } of failedSubscriptions) {\n      await storage.deletePushSubscription(endpoint, subUserId);\n      console.log(`Removed invalid subscription: ${endpoint.substring(0, 50)}...`);\n    }\n  } catch (error) {\n    console.error('Error sending push notifications:', error);\n  }\n}\n\nexport async function sendPushToAllUsers(payload: PushPayload): Promise<void> {\n  if (!VAPID_PUBLIC_KEY || !VAPID_PRIVATE_KEY) {\n    console.warn('VAPID keys not configured, skipping push notification');\n    return;\n  }\n\n  try {\n    const allSubscriptions = await storage.getAllPushSubscriptions();\n    \n    if (allSubscriptions.length === 0) {\n      console.log('No push subscriptions found');\n      return;\n    }\n\n    const payloadString = JSON.stringify(payload);\n    const failedSubscriptions: Array<{ endpoint: string; userId: string }> = [];\n\n    await Promise.all(\n      allSubscriptions.map(async (subscription) => {\n        try {\n          await webpush.sendNotification(\n            {\n              endpoint: subscription.endpoint,\n              keys: {\n                p256dh: subscription.p256dh,\n                auth: subscription.auth,\n              },\n            },\n            payloadString,\n            {\n              TTL: 86400,\n              urgency: 'normal',\n            }\n          );\n        } catch (error: any) {\n          console.error('Failed to send push notification:', error.message);\n          if (error.statusCode === 404 || error.statusCode === 410) {\n            failedSubscriptions.push({ endpoint: subscription.endpoint, userId: subscription.userId });\n          }\n        }\n      })\n    );\n\n    for (const { endpoint, userId } of failedSubscriptions) {\n      await storage.deletePushSubscription(endpoint, userId);\n    }\n  } catch (error) {\n    console.error('Error broadcasting push notifications:', error);\n  }\n}\n","path":null,"size_bytes":3979,"size_tokens":null}},"version":2}